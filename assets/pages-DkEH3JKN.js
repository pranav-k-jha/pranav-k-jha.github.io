var qs=o=>{throw TypeError(o)};var Ki=(o,t,e)=>t.has(o)||qs("Cannot "+e);var it=(o,t,e)=>(Ki(o,t,"read from private field"),e?e.call(o):t.get(o)),$t=(o,t,e)=>t.has(o)?qs("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(o):t.set(o,e),Pt=(o,t,e,i)=>(Ki(o,t,"write to private field"),i?i.call(o,e):t.set(o,e),e),Vt=(o,t,e)=>(Ki(o,t,"access private method"),e);var Xs=(o,t,e,i)=>({set _(s){Pt(o,t,s,e)},get _(){return it(o,t,i)}});import{r as C,R as me,L as Ke,u as ca,a as ha,g as da}from"./react-CM8CWKx_.js";import{j as f,m as T,A as ie,u as ua}from"./animations-CfQA6OJG.js";const pa=o=>o.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),fa=o=>o.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,e,i)=>i?i.toUpperCase():e.toLowerCase()),Ys=o=>{const t=fa(o);return t.charAt(0).toUpperCase()+t.slice(1)},Vn=(...o)=>o.filter((t,e,i)=>!!t&&t.trim()!==""&&i.indexOf(t)===e).join(" ").trim(),ga=o=>{for(const t in o)if(t.startsWith("aria-")||t==="role"||t==="title")return!0};var ma={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const ba=C.forwardRef(({color:o="currentColor",size:t=24,strokeWidth:e=2,absoluteStrokeWidth:i,className:s="",children:n,iconNode:r,...a},l)=>C.createElement("svg",{ref:l,...ma,width:t,height:t,stroke:o,strokeWidth:i?Number(e)*24/Number(t):e,className:Vn("lucide",s),...!n&&!ga(a)&&{"aria-hidden":"true"},...a},[...r.map(([c,h])=>C.createElement(c,h)),...Array.isArray(n)?n:[n]]));const Y=(o,t)=>{const e=C.forwardRef(({className:i,...s},n)=>C.createElement(ba,{ref:n,iconNode:t,className:Vn(`lucide-${pa(Ys(o))}`,`lucide-${o}`,i),...s}));return e.displayName=Ys(o),e};const ya=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],Dh=Y("activity",ya);const wa=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],Nh=Y("arrow-left",wa);const va=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],Ss=Y("arrow-right",va);const xa=[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]],Ih=Y("book-open",xa);const Aa=[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]],Fh=Y("bot",Aa);const Sa=[["path",{d:"M12 18V5",key:"adv99a"}],["path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4",key:"1e3is1"}],["path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5",key:"1gqd8o"}],["path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77",key:"iwvgf7"}],["path",{d:"M18 18a4 4 0 0 0 2-7.464",key:"efp6ie"}],["path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517",key:"1gq6am"}],["path",{d:"M6 18a4 4 0 0 1-2-7.464",key:"k1g0md"}],["path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77",key:"q97ue3"}]],Wn=Y("brain",Sa);const ka=[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]],Oh=Y("briefcase",ka);const _a=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],jh=Y("calendar",_a);const Ea=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Ca=Y("circle-check-big",Ea);const Ta=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Bh=Y("clock",Ta);const La=[["path",{d:"m18 16 4-4-4-4",key:"1inbqp"}],["path",{d:"m6 8-4 4 4 4",key:"15zrgr"}],["path",{d:"m14.5 4-5 16",key:"e7oirm"}]],Hh=Y("code-xml",La);const Pa=[["path",{d:"m16 18 6-6-6-6",key:"eg8j8"}],["path",{d:"m8 6-6 6 6 6",key:"ppft3o"}]],qn=Y("code",Pa);const Ma=[["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M17 20v2",key:"1rnc9c"}],["path",{d:"M17 2v2",key:"11trls"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M2 17h2",key:"7oei6x"}],["path",{d:"M2 7h2",key:"asdhe0"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"M20 17h2",key:"1fpfkl"}],["path",{d:"M20 7h2",key:"1o8tra"}],["path",{d:"M7 20v2",key:"4gnj0m"}],["path",{d:"M7 2v2",key:"1i4yhu"}],["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"8",y:"8",width:"8",height:"8",rx:"1",key:"z9xiuo"}]],Uh=Y("cpu",Ma);const Ra=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]],Xn=Y("database",Ra);const Da=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],zh=Y("globe",Da);const Na=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],Ia=Y("loader-circle",Na);const Fa=[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]],Gh=Y("menu",Fa);const Oa=[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]],$h=Y("moon",Oa);const ja=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],Ba=Y("shield-alert",ja);const Ha=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],Vh=Y("shield",Ha);const Ua=[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]],Yn=Y("smartphone",Ua);const za=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],Wh=Y("sparkles",za);const Ga=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],qh=Y("star",Ga);const $a=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],Xh=Y("sun",$a);const Va=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],Yh=Y("target",Va);const Wa=[["path",{d:"M12 19h8",key:"baeox8"}],["path",{d:"m4 17 6-6-6-6",key:"1yngyt"}]],Kh=Y("terminal",Wa);const qa=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],Qh=Y("trending-up",qa);const Xa=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Jh=Y("x",Xa);const Ya=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],Zh=Y("zap",Ya);var Kn={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},Ks=me.createContext&&me.createContext(Kn),Ka=["attr","size","title"];function Qa(o,t){if(o==null)return{};var e=Ja(o,t),i,s;if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(o);for(s=0;s<n.length;s++)i=n[s],!(t.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(o,i)&&(e[i]=o[i])}return e}function Ja(o,t){if(o==null)return{};var e={};for(var i in o)if(Object.prototype.hasOwnProperty.call(o,i)){if(t.indexOf(i)>=0)continue;e[i]=o[i]}return e}function Pi(){return Pi=Object.assign?Object.assign.bind():function(o){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(o[i]=e[i])}return o},Pi.apply(this,arguments)}function Qs(o,t){var e=Object.keys(o);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(o);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(o,s).enumerable})),e.push.apply(e,i)}return e}function Mi(o){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?Qs(Object(e),!0).forEach(function(i){Za(o,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(e)):Qs(Object(e)).forEach(function(i){Object.defineProperty(o,i,Object.getOwnPropertyDescriptor(e,i))})}return o}function Za(o,t,e){return t=to(t),t in o?Object.defineProperty(o,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):o[t]=e,o}function to(o){var t=eo(o,"string");return typeof t=="symbol"?t:t+""}function eo(o,t){if(typeof o!="object"||!o)return o;var e=o[Symbol.toPrimitive];if(e!==void 0){var i=e.call(o,t);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(o)}function Qn(o){return o&&o.map((t,e)=>me.createElement(t.tag,Mi({key:e},t.attr),Qn(t.child)))}function dt(o){return t=>me.createElement(io,Pi({attr:Mi({},o.attr)},t),Qn(o.child))}function io(o){var t=e=>{var{attr:i,size:s,title:n}=o,r=Qa(o,Ka),a=s||e.size||"1em",l;return e.className&&(l=e.className),o.className&&(l=(l?l+" ":"")+o.className),me.createElement("svg",Pi({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},e.attr,i,r,{className:l,style:Mi(Mi({color:o.color||e.color},e.style),o.style),height:a,width:a,xmlns:"http://www.w3.org/2000/svg"}),n&&me.createElement("title",null,n),o.children)};return Ks!==void 0?me.createElement(Ks.Consumer,null,e=>t(e)):t(Kn)}function so(o){return dt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"19",y1:"12",x2:"5",y2:"12"},child:[]},{tag:"polyline",attr:{points:"12 19 5 12 12 5"},child:[]}]})(o)}function Qi(o){return dt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"5",y1:"12",x2:"19",y2:"12"},child:[]},{tag:"polyline",attr:{points:"12 5 19 12 12 19"},child:[]}]})(o)}function no(o){return dt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"12",y1:"19",x2:"12",y2:"5"},child:[]},{tag:"polyline",attr:{points:"5 12 12 5 19 12"},child:[]}]})(o)}function ro(o){return dt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"},child:[]},{tag:"path",attr:{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"},child:[]}]})(o)}function ao(o){return dt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"},child:[]},{tag:"line",attr:{x1:"16",y1:"2",x2:"16",y2:"6"},child:[]},{tag:"line",attr:{x1:"8",y1:"2",x2:"8",y2:"6"},child:[]},{tag:"line",attr:{x1:"3",y1:"10",x2:"21",y2:"10"},child:[]}]})(o)}function Jn(o){return dt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"6 9 12 15 18 9"},child:[]}]})(o)}function td(o){return dt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"},child:[]}]})(o)}function oo(o){return dt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"16 18 22 12 16 6"},child:[]},{tag:"polyline",attr:{points:"8 6 2 12 8 18"},child:[]}]})(o)}function lo(o){return dt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"4",y:"4",width:"16",height:"16",rx:"2",ry:"2"},child:[]},{tag:"rect",attr:{x:"9",y:"9",width:"6",height:"6"},child:[]},{tag:"line",attr:{x1:"9",y1:"1",x2:"9",y2:"4"},child:[]},{tag:"line",attr:{x1:"15",y1:"1",x2:"15",y2:"4"},child:[]},{tag:"line",attr:{x1:"9",y1:"20",x2:"9",y2:"23"},child:[]},{tag:"line",attr:{x1:"15",y1:"20",x2:"15",y2:"23"},child:[]},{tag:"line",attr:{x1:"20",y1:"9",x2:"23",y2:"9"},child:[]},{tag:"line",attr:{x1:"20",y1:"14",x2:"23",y2:"14"},child:[]},{tag:"line",attr:{x1:"1",y1:"9",x2:"4",y2:"9"},child:[]},{tag:"line",attr:{x1:"1",y1:"14",x2:"4",y2:"14"},child:[]}]})(o)}function ed(o){return dt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"ellipse",attr:{cx:"12",cy:"5",rx:"9",ry:"3"},child:[]},{tag:"path",attr:{d:"M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"},child:[]},{tag:"path",attr:{d:"M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"},child:[]}]})(o)}function Ri(o){return dt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"},child:[]},{tag:"polyline",attr:{points:"15 3 21 3 21 9"},child:[]},{tag:"line",attr:{x1:"10",y1:"14",x2:"21",y2:"3"},child:[]}]})(o)}function id(o){return dt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"},child:[]},{tag:"polyline",attr:{points:"14 2 14 8 20 8"},child:[]},{tag:"line",attr:{x1:"16",y1:"13",x2:"8",y2:"13"},child:[]},{tag:"line",attr:{x1:"16",y1:"17",x2:"8",y2:"17"},child:[]},{tag:"polyline",attr:{points:"10 9 9 9 8 9"},child:[]}]})(o)}function sd(o){return dt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"},child:[]},{tag:"polyline",attr:{points:"13 2 13 9 20 9"},child:[]}]})(o)}function co(o){return dt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"},child:[]}]})(o)}function nd(o){return dt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"6",y1:"3",x2:"6",y2:"15"},child:[]},{tag:"circle",attr:{cx:"18",cy:"6",r:"3"},child:[]},{tag:"circle",attr:{cx:"6",cy:"18",r:"3"},child:[]},{tag:"path",attr:{d:"M18 9a9 9 0 0 1-9 9"},child:[]}]})(o)}function hs(o){return dt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"},child:[]}]})(o)}function ho(o){return dt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"12 2 2 7 12 12 22 7 12 2"},child:[]},{tag:"polyline",attr:{points:"2 17 12 22 22 17"},child:[]},{tag:"polyline",attr:{points:"2 12 12 17 22 12"},child:[]}]})(o)}function rd(o){return dt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"},child:[]}]})(o)}function uo(o){return dt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"5 3 19 12 5 21 5 3"},child:[]}]})(o)}function ad(o){return dt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"},child:[]}]})(o)}function od(o){return dt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2"},child:[]}]})(o)}const Ji=[{id:1,title:"Ecole De Conduite Educar",startDate:"August 2025",endDate:"September 2025",associatedWith:"",description:"Designed, developed, and currently maintain the Ecole De Conduite Educar website using Next.js, React, Tailwind CSS, and TypeScript.",skills:["Next.js","React","Tailwind CSS","TypeScript","Web Development","Responsive Design"],link:"https://educar-ecoledeconduite.ca/",notes:"Featured Project",imageUrl:"/images/projects/project-1.png",category:"web",isFeatured:!0},{id:2,title:"MKJHA Consulting Website",startDate:"April 2025",endDate:"May 2025",associatedWith:"MKJHA CONSULTING",description:"Designed, developed, and currently maintain the MKJHA Consulting website using Next.js, React, Tailwind CSS, and TypeScript. The site features a modern, responsive design with an emphasis on user experience and accessibility.",skills:["Next.js","Tailwind CSS","TypeScript","Web Development","Website Design","Website Development"],link:"https://www.mkjhaconsult.com",notes:null,imageUrl:"/images/projects/project-2.png",category:"web"},{id:3,title:"4C Research Lab Website",startDate:"May 2025",endDate:"Present",associatedWith:"Western University",description:"Designed, developed, and currently maintain the 4C Research Lab website using Next.js, React, Tailwind CSS, and TypeScript. The site features a modern, responsive design with database integration.",skills:["Next.js","React","Tailwind CSS","TypeScript","Database Design","Analytics","Web Development","Research Data Management","Data Visualization"],link:"https://4c-research.vercel.app/",notes:null,imageUrl:"/images/projects/project-3.png",category:"web"},{id:4,title:"Beaut-AI Mobile Application",startDate:"December 2025",endDate:"January 2025",associatedWith:"Beaut Ai",description:"Developed a comprehensive mobile application with React Native and Expo Router, featuring advanced backend authentication, GraphQL API integration, and NestJS microservices architecture. The app provides AI-powered beauty and wellness solutions with secure user management, real-time data synchronization, and seamless cross-platform performance.",skills:["React Native","Expo Router","GraphQL","NestJS","Mobile Development","Backend Authentication","JWT","Microservices","API Development","Cross-Platform Development","TypeScript","Node.js","Database Design","Real-time Sync","Mobile UI/UX"],link:null,notes:"Full-stack mobile application with advanced authentication and AI integration",imageUrl:"https://images.unsplash.com/photo-1512941937669-90a1b58e7e9c?auto=format&fit=crop&q=80",videoUrl:"https://drive.google.com/file/d/1FIjJpagUK7Lwc64iPaNmUl8VIEEiPBP3/view?usp=drive_link",category:"app"},{id:5,title:"Chat Interface",startDate:"March 2023",endDate:"April 2023",associatedWith:"Western University",description:"Developed an interactive chat interface using React, Tailwind CSS, and Framer Motion. The application features real-time communication with multiple LLMs through a FastAPI backend. Key features include real-time chat with streaming responses, file upload and processing with RAG for document analysis, animated loading states with a 'thinking' indicator, and responsive UI with smooth animations. The application is containerized with Docker and deployed on UBC's HPC infrastructure.",skills:["React","FastAPI","LLM Integration","RAG","Docker","Tailwind CSS","Framer Motion","Redux","React-Query","Web Development","Real-time Chat","API Integration","State Management","Data Fetching"],notes:null,imageUrl:"/images/projects/project-4.png",category:"web"},{id:6,title:"REST Countries API with Color Theme Switcher and Dark Mode",startDate:"March 2024",endDate:"March 2024",associatedWith:"Frontend Mentor",description:"This project is a solution to the REST Countries API with Color Theme Switcher and Dark Mode challenge from Frontend Mentor.",challengeLink:{url:"https://www.frontendmentor.io/challenges/rest-countries-api-with-color-theme-switcher-5cacc469fec04111f7b848ca",text:"View Challenge on Frontend Mentor"},skills:["React","Tailwind CSS","Web Development","Responsive Design","Dark Mode","Color Theme Switcher"],notes:null,imageUrl:"/images/projects/project-6.png",category:"personal",link:"https://countries-api-react-gray.vercel.app/"}],po={hidden:{opacity:0,y:30},visible:o=>({opacity:1,y:0,transition:{delay:o*.1,duration:.5,ease:[.25,.1,.25,1],when:"beforeChildren",staggerChildren:.1}}),exit:{opacity:0,y:-20,transition:{duration:.3}}},Js={hidden:{opacity:0,y:10},visible:{opacity:1,y:0,transition:{duration:.4,ease:"easeOut"}}},fo=({project:o,index:t})=>f.jsxs(T.article,{className:`group relative flex flex-col ${t%2===0?"md:flex-row":"md:flex-row-reverse"} items-center gap-8 mb-24 last:mb-0`,variants:po,initial:"hidden",animate:"visible",exit:"exit",custom:t%5,layout:!0,children:[f.jsxs(T.div,{className:"w-full md:w-1/2 relative",variants:Js,children:[f.jsxs(T.div,{whileHover:{scale:1.02,boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)"},whileTap:{scale:.98},transition:{type:"spring",stiffness:300,damping:15},className:"overflow-hidden rounded-2xl shadow-lg relative group bg-gray-50 dark:bg-gray-800",children:[f.jsx(T.div,{className:"relative w-full h-64 md:h-80 overflow-hidden",whileHover:{scale:1.05,transition:{duration:.5,ease:[.4,0,.2,1]}},children:f.jsx(T.img,{src:o.imageUrl,alt:o.title,className:"w-full h-full object-cover",loading:t<3?"eager":"lazy",initial:{scale:1.1},animate:{scale:1},transition:{duration:.7,ease:[.4,0,.2,1]}})}),f.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/70 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end p-6",children:f.jsxs("div",{className:"translate-y-4 group-hover:translate-y-0 transition-transform duration-300 space-y-3",children:[f.jsx("h3",{className:"text-xl font-bold text-white",children:o.title}),f.jsxs("div",{className:"flex gap-3",children:[o.link&&f.jsxs("a",{href:o.link,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center px-4 py-2 bg-white text-gray-900 rounded-lg font-medium hover:bg-gray-100",onClick:e=>e.stopPropagation(),children:[f.jsx(Ri,{className:"mr-2"})," Live Demo"]}),o.github&&f.jsxs("a",{href:o.github,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center px-4 py-2 bg-gray-900 text-white rounded-lg font-medium hover:bg-gray-800",onClick:e=>e.stopPropagation(),children:[f.jsx(hs,{className:"mr-2"})," View Code"]})]})]})})]}),f.jsx("span",{className:"absolute -top-3 right-4 bg-gradient-to-r from-blue-600 to-cyan-500 text-white text-xs font-medium px-3 py-1 rounded-full shadow-md z-10",children:o.category.charAt(0).toUpperCase()+o.category.slice(1)})]}),f.jsx(T.div,{className:"w-full md:w-1/2",variants:Js,children:f.jsxs(T.div,{className:`${t%2===0?"md:pl-8":"md:pr-8"}`,initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},children:[f.jsx("h3",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors",children:o.title}),o.associatedWith&&f.jsx("p",{className:"text-blue-600 dark:text-blue-400 text-sm font-medium mb-3",children:o.associatedWith}),f.jsxs("div",{className:"flex items-center text-sm text-gray-500 dark:text-gray-400 mb-4 gap-4 flex-wrap",children:[f.jsxs("span",{className:"flex items-center",children:[f.jsx(ao,{className:"mr-1.5"}),o.startDate," - ",o.endDate||"Present"]}),o.notes&&f.jsx("span",{className:"px-2 py-1 bg-amber-100 dark:bg-amber-900/30 text-amber-800 dark:text-amber-300 text-xs rounded-full",children:o.notes})]}),f.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-5 leading-relaxed",children:o.description}),f.jsxs("div",{className:"flex flex-wrap gap-2 mb-6",children:[o.skills.slice(0,6).map(e=>f.jsx("span",{className:"px-3 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300 text-xs font-medium rounded-full",children:e},e)),o.skills.length>6&&f.jsxs("span",{className:"px-3 py-1 bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300 text-xs font-medium rounded-full",children:["+",o.skills.length-6," more"]})]}),f.jsxs("div",{className:"flex flex-wrap gap-3",children:[o.link&&f.jsxs("a",{href:o.link,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center px-5 py-2.5 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors",children:[f.jsx(Ri,{className:"mr-2"})," View Project"]}),o.github&&f.jsxs("a",{href:o.github,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center px-5 py-2.5 bg-gray-200 hover:bg-gray-300 dark:bg-gray-800 dark:hover:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg font-medium transition-colors",children:[f.jsx(hs,{className:"mr-2"})," Source Code"]}),o.videoUrl&&f.jsxs("a",{href:o.videoUrl,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center px-5 py-2.5 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-medium transition-colors",children:[f.jsx(uo,{className:"mr-2"})," Watch Demo"]})]})]})})]}),go=({count:o=3})=>f.jsx("div",{className:"space-y-12",children:Array.from({length:o}).map((t,e)=>f.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-8 animate-pulse",children:[f.jsx("div",{className:"w-full md:w-1/2 h-64 bg-gray-200 dark:bg-gray-800 rounded-xl"}),f.jsxs("div",{className:"w-full md:w-1/2 space-y-4",children:[f.jsx("div",{className:"h-8 bg-gray-200 dark:bg-gray-800 rounded w-3/4"}),f.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-800 rounded w-1/2"}),f.jsxs("div",{className:"space-y-2",children:[f.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-800 rounded w-full"}),f.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-800 rounded w-5/6"}),f.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-800 rounded w-4/6"})]}),f.jsx("div",{className:"flex gap-2 flex-wrap",children:[1,2,3].map(i=>f.jsx("div",{className:"h-6 bg-gray-200 dark:bg-gray-800 rounded-full w-20"},i))}),f.jsxs("div",{className:"flex gap-3 pt-2",children:[f.jsx("div",{className:"h-10 bg-gray-200 dark:bg-gray-800 rounded-lg w-32"}),f.jsx("div",{className:"h-10 bg-gray-200 dark:bg-gray-800 rounded-lg w-32"})]})]})]},e))}),mo=(o=400)=>{const[t,e]=C.useState(!1),i=C.useCallback(()=>{e(window.pageYOffset>o)},[o]),s=C.useCallback(()=>{window.scrollTo({top:0,behavior:"smooth"})},[]);return C.useEffect(()=>(window.addEventListener("scroll",i,{passive:!0}),()=>{window.removeEventListener("scroll",i)}),[i]),{isVisible:t,scrollToTop:s}},bo={hidden:{opacity:0},show:{opacity:1,transition:{staggerChildren:.15}}},yo={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.6,delay:.2,ease:[.25,.46,.45,.94]}}},wo={hidden:{opacity:0,scale:.8},visible:{opacity:1,scale:1,transition:{duration:.3}},exit:{opacity:0,scale:.8,transition:{duration:.2}}},ld=()=>{const[o,t]=C.useState("all"),[e,i]=C.useState(!0),{isVisible:s,scrollToTop:n}=mo(400),r=C.useMemo(()=>["all",...new Set(Ji.map(l=>l.category))],[]),a=C.useMemo(()=>o==="all"?Ji:Ji.filter(l=>l.category===o),[o]);return C.useEffect(()=>{const l=setTimeout(()=>{i(!1)},500);return()=>clearTimeout(l)},[o]),f.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50/50 via-white to-purple-50/50 dark:from-gray-900/50 dark:via-gray-950 dark:to-purple-900/50 py-12 px-4 sm:px-6",children:[f.jsxs("div",{className:"max-w-7xl mt-8 mx-auto px-4 sm:px-6 lg:px-8 py-12",children:[f.jsxs("div",{className:"space-y-4 mb-12",children:[f.jsx(T.h1,{variants:yo,initial:"hidden",animate:"visible",className:"text-2xl sm:text-3xl lg:text-4xl font-bold tracking-tight text-center",children:f.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-purple-600 via-blue-600 to-emerald-600 dark:from-purple-400 dark:via-blue-400 dark:to-emerald-400",children:"MY PROJECTS"})}),f.jsx(T.p,{className:"text-lg text-center text-gray-600 dark:text-gray-400 max-w-2xl mx-auto",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.6,delay:.3},children:"A collection of my recent work and personal projects"}),f.jsx(T.div,{className:"flex flex-wrap justify-center gap-3 mt-6",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.6,delay:.4},children:r.map(l=>f.jsxs("button",{onClick:()=>{t(l),i(!0)},className:`px-4 py-2 rounded-full text-sm font-medium transition-all duration-200 flex items-center gap-2 ${o===l?"bg-gradient-to-r from-blue-600 to-cyan-500 text-white shadow-md":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700/50 border border-gray-200 dark:border-gray-700"}`,"aria-label":`Filter by ${l}`,"aria-pressed":o===l,children:[o===l&&f.jsx(co,{className:"w-3.5 h-3.5"}),l.charAt(0).toUpperCase()+l.slice(1)]},l))})]}),f.jsxs("div",{className:"relative min-h-[400px]",children:[f.jsx(ie,{children:e&&f.jsx(T.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"space-y-24",children:f.jsx(go,{count:3})},"skeleton")}),f.jsx(ie,{children:!e&&a.length>0&&f.jsx(T.div,{variants:bo,initial:"hidden",animate:"show",className:"space-y-24",children:a.map((l,c)=>f.jsx(fo,{project:l,index:c},l.id))},"projects")}),f.jsx(ie,{children:!e&&a.length===0&&f.jsx(T.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0},className:"absolute inset-0 flex items-center justify-center text-center py-16",children:f.jsxs("div",{children:[f.jsx("h3",{className:"text-xl font-medium text-gray-600 dark:text-gray-400",children:"No projects found in this category."}),f.jsx("p",{className:"mt-2 text-gray-500 dark:text-gray-500",children:"Try selecting a different filter."})]})},"empty")})]})]}),f.jsx(ie,{children:s&&f.jsx(T.button,{variants:wo,initial:"hidden",animate:"visible",exit:"exit",onClick:n,className:"fixed bottom-8 right-8 w-14 h-14 bg-blue-600 hover:bg-blue-700 text-white rounded-full shadow-2xl flex items-center justify-center z-50 transition-all duration-200","aria-label":"Scroll to top",children:f.jsx(no,{className:"w-6 h-6"})})})]})},vo={hidden:{opacity:0},visible:{opacity:1,transition:{duration:.4,ease:"easeOut"}},exit:{opacity:0}},Zs={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},tn={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.5,ease:[.4,0,.2,1]}}},xo=o=>({hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{delay:o*.1,duration:.6,ease:[.16,1,.3,1]}}}),Ao={"AI & ML":{name:"AI & ML",icon:Wn,description:"Artificial Intelligence and Machine Learning solutions",color:"from-purple-500 to-pink-500"},"Web Development":{name:"Web Development",icon:qn,description:"Full-stack web applications and platforms",color:"from-blue-500 to-cyan-500"},"Data Engineering":{name:"Data Engineering",icon:Xn,description:"Data pipelines and analytics platforms",color:"from-orange-500 to-red-500"},"Mobile Development":{name:"Mobile Development",icon:Yn,description:"Cross-platform mobile applications",color:"from-teal-500 to-emerald-600"}},We=[{id:1,isActive:!0,title:"AI & Machine Learning Solutions",slug:"ai-ml",description:"Custom AI models, machine learning pipelines, and intelligent automation solutions tailored to your business needs.",image:"https://images.unsplash.com/photo-1677442136019-21780ecad995?auto=format&fit=crop&q=80&w=1000",icon:Wn,category:"AI & ML",features:["Custom ML Model Development","Natural Language Processing","Computer Vision Solutions","Predictive Analytics","AI Strategy Consulting"],technologies:["Python","TensorFlow","PyTorch","Scikit-learn","OpenAI API"],color:"from-purple-500 to-pink-500"},{id:2,isActive:!0,title:"Web Development",slug:"web-development",description:"Modern, scalable web applications built with cutting-edge technologies and best practices.",image:"https://images.unsplash.com/photo-1461749280684-dccba630e2f6?auto=format&fit=crop&q=80&w=1000",icon:qn,category:"Web Development",features:["React & Next.js Applications","Backend API Development","Database Design & Optimization","Cloud Deployment","Performance Optimization"],technologies:["React","Next.js","Node.js","PostgreSQL","AWS"],color:"from-blue-500 to-cyan-500"},{id:3,title:"Data Engineering & Analytics",slug:"data-engineering",description:"Robust data pipelines, ETL processes, and analytics platforms to unlock insights from your data.",image:"https://images.unsplash.com/photo-1551288049-bebda4e38f71?auto=format&fit=crop&q=80&w=1000",icon:Xn,category:"Data Engineering",features:["Data Pipeline Development","ETL/ELT Processes","Data Warehousing","Real-time Analytics","Data Visualization"],technologies:["Python","Apache Airflow","PostgreSQL","Redis","Docker"],color:"from-orange-500 to-red-500"},{id:4,title:"Mobile App Development",slug:"mobile-app-development",description:"Cross-platform mobile applications built with React Native and Expo Router, powered by a robust Node.js and GraphQL backend.",image:"https://images.unsplash.com/photo-1614680376573-df3480f0c6ff?auto=format&fit=crop&q=80&w=1000",icon:Yn,category:"Mobile Development",features:["Cross-platform iOS & Android Apps","Expo Router for Navigation","GraphQL API Integration","Offline-First Capabilities","Push Notifications"],technologies:["React Native","Expo Router","Node.js","GraphQL","TypeScript"],color:"from-green-500 to-emerald-500"}],So=()=>{C.useEffect(()=>{We.forEach(o=>{const t=new Image;t.src=o.image})},[])},ko=()=>{const[o,t]=C.useState(null),e=C.useMemo(()=>o?We.filter(n=>n.category===o):We,[o]),i=C.useMemo(()=>Object.keys(Ao).reduce((n,r)=>(n[r]=We.filter(a=>a.category===r).length,n),{}),[]),s=C.useCallback(n=>{t(r=>r===n?null:n)},[]);return{activeCategory:o,filteredServices:e,categoryStats:i,handleCategoryChange:s,totalServices:We.length}},_o=({service:o,index:t})=>{const e=o.icon,i=C.useRef(null),s=ua(i,{once:!0,margin:"-100px"});return f.jsxs(T.div,{ref:i,custom:t,initial:"hidden",animate:s?"visible":"hidden",variants:xo(t),whileHover:{y:-6,transition:{type:"spring",stiffness:300,damping:20}},className:"group relative bg-white dark:bg-zinc-900/80 backdrop-blur-sm rounded-2xl overflow-hidden shadow-sm hover:shadow-lg dark:shadow-xl dark:hover:shadow-2xl border border-gray-100 dark:border-zinc-800 flex flex-col h-full transition-shadow duration-300 isolate",style:{transform:"translateZ(0)"},children:[o.isActive&&f.jsx("div",{className:"absolute top-4 left-4 z-10 group",children:f.jsxs("div",{className:"relative inline-block",children:[f.jsxs("div",{className:"flex items-center px-4 py-1.5 text-sm font-bold text-yellow-300 bg-black/40 backdrop-blur-sm rounded-full border border-yellow-300/20 transition-colors duration-300 group-hover:bg-yellow-300/10",children:[f.jsx(T.span,{className:"w-2 h-2 mr-2 bg-yellow-300 rounded-full",animate:{scale:[1,1.3,1],opacity:[.7,1,.7]},transition:{duration:2,repeat:1/0,ease:"easeInOut"}}),f.jsx("span",{children:"Active"})]}),f.jsx(T.span,{className:"absolute bottom-0 left-0 w-full h-0.5 bg-yellow-300 rounded-full",initial:{width:"0%",left:"0%"},animate:{width:["0%","100%","0%"],left:["0%","0%","100%"]},transition:{duration:2,repeat:1/0,ease:"easeInOut"}})]})}),f.jsxs("div",{className:"relative h-48 overflow-hidden",children:[f.jsx(T.img,{src:o.image,alt:o.title,initial:{scale:1},whileHover:{scale:1.2},transition:{duration:.6,ease:[.4,0,.2,1]},className:"w-full h-full object-cover will-change-transform",style:{transform:"translateZ(0)"},loading:"lazy"}),f.jsx("div",{className:`absolute inset-0 bg-gradient-to-t ${o.color} opacity-30`}),f.jsx(T.div,{className:"absolute top-4 right-4",whileHover:{y:-4,rotate:8},transition:{duration:.3},children:f.jsx("div",{className:`p-3 rounded-xl bg-gradient-to-r ${o.color} shadow-lg backdrop-blur-sm`,children:f.jsx(e,{className:"w-6 h-6 text-white"})})})]}),f.jsxs("div",{className:"p-6 flex flex-col flex-1",children:[f.jsxs("div",{className:"flex-1",children:[f.jsx(T.h3,{className:`text-xl font-bold bg-gradient-to-r ${o.color} bg-clip-text text-transparent mb-3`,whileHover:{x:4},transition:{duration:.2},children:o.title}),f.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4 leading-relaxed text-sm",children:o.description}),f.jsxs("div",{className:"mb-4",children:[f.jsx("h4",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"Key Features:"}),f.jsx("ul",{className:"space-y-1.5",children:o.features.slice(0,3).map((n,r)=>f.jsxs(T.li,{initial:{opacity:0,x:-16},animate:s?{opacity:1,x:0}:{},transition:{delay:r*.1,duration:.4},className:"flex items-center text-sm text-gray-600 dark:text-gray-400",children:[f.jsx(Ca,{className:"w-4 h-4 text-green-500 mr-2 flex-shrink-0"}),n]},r))})]}),f.jsxs("div",{className:"mb-6",children:[f.jsx("h4",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"Technologies:"}),f.jsxs("div",{className:"flex flex-wrap gap-2",children:[o.technologies.slice(0,3).map((n,r)=>f.jsx(T.span,{initial:{opacity:0,scale:.8},animate:s?{opacity:1,scale:1}:{},transition:{delay:r*.05,duration:.3},whileHover:{scale:1.1,y:-2},className:"px-3 py-1 text-xs font-medium bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-300 rounded-full",children:n},r)),o.technologies.length>3&&f.jsxs("span",{className:"px-3 py-1 text-xs font-medium bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 rounded-full",children:["+",o.technologies.length-3]})]})]})]}),f.jsx("div",{className:"mt-auto",children:f.jsx(Ke,{to:`/services/${o.slug}`,children:f.jsxs(T.div,{whileHover:{scale:1.02},whileTap:{scale:.98},className:`w-full py-3 px-6 rounded-xl bg-gradient-to-r ${o.color} text-white font-semibold flex items-center justify-center shadow-md hover:shadow-xl transition-all duration-300`,children:[f.jsx("span",{className:"mr-2",children:"Learn More"}),f.jsx(T.span,{initial:{x:0},whileHover:{x:6},transition:{type:"spring",stiffness:400,damping:10},children:f.jsx(Ss,{className:"w-4 h-4"})})]})})})]})]})};function cd(){const{filteredServices:o}=ko();return So(),f.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-white to-gray-50 dark:from-gray-950 dark:via-gray-900 dark:to-gray-950",children:f.jsx(ie,{mode:"wait",children:f.jsxs(T.div,{variants:vo,initial:"hidden",animate:"visible",exit:"hidden",children:[f.jsxs("div",{className:"max-w-7xl mt-10 mx-auto px-4 sm:px-6 lg:px-8 py-20",children:[f.jsxs(T.div,{className:"text-center mb-12",children:[f.jsx(T.h1,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.1},className:"text-2xl sm:text-3xl lg:text-4xl font-bold tracking-tight",children:f.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-purple-600 via-blue-600 to-emerald-600 dark:from-purple-400 dark:via-blue-400 dark:to-emerald-400",children:"MY SERVICES"})}),f.jsx(T.p,{initial:{opacity:0,y:15},animate:{opacity:1,y:0},transition:{duration:.6,delay:.3,ease:[.25,.46,.45,.94]},className:"mt-4 text-lg sm:text-xl font-light text-gray-600 dark:text-gray-400 max-w-2xl mx-auto",children:"I provide freelance services to individuals, startups, and organizationsâ€”offering AI solutions, full-stack development, and end-to-end technology support to bring ideas to life."})]}),f.jsx(T.div,{variants:Zs,initial:"hidden",animate:"visible",className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10",children:o.map((t,e)=>f.jsx(T.div,{variants:tn,className:"w-full",children:f.jsx(_o,{service:t,index:e})},t.id))}),o.length===0&&f.jsx(T.p,{initial:{opacity:0},animate:{opacity:1},className:"text-center text-gray-500 dark:text-gray-400 py-12 text-lg",children:"No services found in this category."})]}),f.jsx(T.section,{initial:"hidden",whileInView:"visible",viewport:{once:!0,margin:"-100px"},variants:Zs,className:"py-20 px-6 bg-gradient-to-br from-gray-50/50 via-white to-blue-50/50 dark:from-gray-900/50 dark:via-gray-950 dark:to-blue-900/50",children:f.jsx("div",{className:"container mx-auto max-w-4xl text-center",children:f.jsxs(T.div,{variants:tn,children:[f.jsxs("h2",{className:"text-3xl sm:text-4xl font-light tracking-tight mb-4 text-gray-900 dark:text-white",children:["Ready to ",f.jsx("span",{className:"font-bold",children:"Transform"})," Your Ideas?"]}),f.jsx("p",{className:"text-gray-700 dark:text-gray-400 max-w-2xl mx-auto mb-8",children:"Let's discuss how my services can help you achieve your goals and drive innovation in your organization."}),f.jsx(Ke,{to:"/contact",children:f.jsxs(T.div,{whileHover:{scale:1.02},whileTap:{scale:.98},className:"inline-flex items-center py-3 px-6 rounded-xl bg-gradient-to-r from-blue-600 to-purple-600 dark:from-blue-500 dark:to-purple-500 text-white font-semibold shadow-md hover:shadow-xl transition-all duration-300",children:["Get Started",f.jsx(T.div,{whileHover:{x:4},transition:{duration:.2},className:"ml-2",children:f.jsx(Ss,{className:"w-5 h-5"})})]})})]})})})]},"services-content")})})}const Eo=[{title:"LLM Fundamentals",icon:f.jsx(ho,{className:"w-6 h-6"}),description:"Core concepts for understanding LLMs",overview:"Master the essential building blocks of machine learning and deep learning that power modern LLMs. This section covers the mathematical foundations, programming skills, and neural network concepts required to work effectively with large language models.",topics:[{title:"Mathematics for Machine Learning",content:["Linear Algebra: Vectors, matrices, eigenvalues, and transformations","Calculus: Derivatives, gradients, and optimization","Probability & Statistics: Distributions, MLE, and Bayesian inference","Key Resources: 3Blue1Brown, StatQuest, Khan Academy"]},{title:"Python for Machine Learning",content:["Python fundamentals and data structures","Data Science Stack: NumPy, Pandas, Matplotlib/Seaborn","Data Preprocessing and Feature Engineering","Scikit-learn for traditional ML algorithms"]},{title:"Neural Networks",content:["Neural Network Fundamentals: Architecture and training","Activation Functions and Backpropagation","Optimization: SGD, Adam, RMSprop","Regularization: Dropout, L1/L2, Early Stopping"]},{title:"Natural Language Processing (NLP)",content:["Text Preprocessing: Tokenization, stemming, lemmatization","Feature Extraction: BoW, TF-IDF, n-grams","Word Embeddings: Word2Vec, GloVe, FastText","Sequence Models: RNNs, LSTMs, GRUs"]}]},{title:"The LLM Scientist",icon:f.jsx(lo,{className:"w-6 h-6"}),description:"Mastering LLM development",overview:"Dive deep into building state-of-the-art language models. This section covers everything from architecture design to training optimization, evaluation, and the latest research trends in LLM development.",topics:[{title:"LLM Architecture",content:["Transformer architecture and attention mechanisms","Tokenization strategies and their impact","Self-attention and its variants","Sampling techniques for text generation"]},{title:"Pre-training Models",content:["Data preparation and cleaning at scale","Distributed training strategies","Training optimization techniques","Performance monitoring and profiling"]},{title:"Post-training & SFT",content:["Dataset preparation and chat templates","Synthetic data generation","Supervised Fine-Tuning techniques","Parameter-efficient fine-tuning (LoRA, QLoRA)"]},{title:"Preference Alignment",content:["Rejection sampling and data curation","Direct Preference Optimization (DPO)","Reward modeling and RLHF","GRPO and PPO for alignment"]},{title:"Evaluation & Optimization",content:["Automated benchmarks and human evaluation","Model-based evaluation techniques","Quantization methods (GGUF, GPTQ, AWQ)","Performance optimization strategies"]},{title:"Emerging Trends",content:["Model merging techniques","Multimodal model architectures","Interpretability and mechanistic analysis","Test-time compute scaling"]}]},{title:"The LLM Engineer",icon:f.jsx(oo,{className:"w-6 h-6"}),description:"Building production LLM applications",overview:"Master the end-to-end development of LLM-powered applications, from prototyping to production deployment. Learn to build robust, scalable, and secure applications with modern LLM technologies.",topics:[{title:"Running LLMs",content:["LLM APIs vs. open-source models","Local deployment options","Advanced prompt engineering","Structured output generation"]},{title:"Vector Storage & RAG",content:["Document ingestion and processing","Text splitting strategies","Embedding models and vector DBs","Retrieval Augmented Generation"]},{title:"Advanced RAG & Agents",content:["Query construction and rewriting","Multi-vector and hybrid retrieval","Agent frameworks (LangGraph, LlamaIndex)","Multi-agent systems"]},{title:"Deployment & Scaling",content:["Local and demo deployment","Server deployment at scale","Inference optimization techniques","Edge deployment options"]},{title:"Security & Production",content:["Prompt injection and jailbreaking","Data privacy and compliance","Monitoring and observability","Performance optimization"]}]}],bi={author:"Maxime Labonne",url:"https://github.com/mlabonne/llm-course",license:"Apache License 2.0",book:{url:"https://www.amazon.ca/dp/1836200072"}},hd=()=>{const[o,t]=C.useState(null),e=ca();C.useEffect(()=>{e.state?.scrollPosition&&window.scrollTo(0,e.state.scrollPosition)},[e]),C.useEffect(()=>{const s=()=>{sessionStorage.setItem("llmCourseScrollPosition",window.scrollY)};return window.addEventListener("beforeunload",s),()=>{window.removeEventListener("beforeunload",s)}},[]),C.useEffect(()=>{if(performance.navigation?.type===1){const s=sessionStorage.getItem("llmCourseScrollPosition");s&&(window.scrollTo(0,parseInt(s,10)),sessionStorage.removeItem("llmCourseScrollPosition"))}},[]);const i=s=>{sessionStorage.setItem("llmCourseScroll",window.scrollY),t(o===s?null:s)};return f.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-white to-gray-50 dark:from-gray-950 dark:via-gray-900 dark:to-gray-950",children:f.jsxs("div",{className:"max-w-7xl my-20 mx-auto px-4 sm:px-6 lg:px-8 py-12",children:[f.jsxs("div",{className:"space-y-4 mb-16",children:[f.jsx(T.h1,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.2,ease:[.25,.46,.45,.94]},className:"text-2xl sm:text-3xl lg:text-4xl font-bold tracking-tight text-center",children:f.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-purple-600 via-blue-600 to-emerald-600 dark:from-purple-400 dark:via-blue-400 dark:to-emerald-400",children:"LARGE LANGUAGE MODELS"})}),f.jsx(T.div,{className:"space-y-2 text-center",initial:{opacity:0,y:15},animate:{opacity:1,y:0},transition:{duration:.6,delay:.3,ease:[.25,.46,.45,.94]},children:f.jsx("h2",{className:"text-lg sm:text-xl font-light text-gray-600 dark:text-gray-400",children:"A comprehensive guide to understanding and working with Large Language Models"})}),f.jsxs(T.div,{className:"flex flex-wrap justify-center gap-3 mt-6",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.4,duration:.5},children:[f.jsx("span",{className:"px-4 py-2 bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300 rounded-full text-sm font-medium",children:"Natural Language Processing"}),f.jsx("span",{className:"px-4 py-2 bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300 rounded-full text-sm font-medium",children:"AI Assistants"}),f.jsx("span",{className:"px-4 py-2 bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300 rounded-full text-sm font-medium",children:"Content Generation"})]})]}),f.jsx(T.div,{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-100 dark:border-blue-800 rounded-xl p-6 mb-12 shadow-sm",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,ease:"easeOut"},children:f.jsxs("div",{className:"max-w-4xl mx-auto",children:[f.jsxs(T.p,{className:"text-gray-700 dark:text-gray-300 mb-4",initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.1,duration:.5},children:[f.jsx("span",{className:"font-medium",children:"Note:"})," This course is based on the excellent work by"," ",f.jsx("a",{href:"https://www.linkedin.com/in/maxime-labonne/",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:underline",children:bi.author}),". The LLM course is available under the"," ",f.jsx("a",{href:"https://github.com/mlabonne/llm-course/blob/main/LICENSE",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:underline",children:bi.license})," ","and will always stay free."]}),f.jsxs(T.div,{className:"bg-white dark:bg-gray-800/50 p-5 rounded-lg my-4 border-l-4 border-blue-500 dark:border-blue-400",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2,duration:.5},children:[f.jsx(T.p,{className:"text-gray-800 dark:text-gray-200 mb-3 font-medium",initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},children:"From the original author:"}),f.jsxs(T.p,{className:"text-gray-800 dark:text-gray-200 mb-4",initial:{opacity:0},animate:{opacity:1},transition:{delay:.4},children:['"Based on this course, I wrote the'," ",f.jsx("a",{href:"https://www.llmhandbook.com",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:underline",children:"LLM Engineer's Handbook"})," ","with"," ",f.jsx("a",{href:"https://www.linkedin.com/in/pauliusztin/",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:underline",children:"Paul Iuzstin"}),`. It's a hands-on and detailed book that covers an end-to-end LLM application from design to deployment. The LLM course will always stay free but feel free to support my work by purchasing the book."`]}),f.jsxs(T.p,{className:"text-gray-800 dark:text-gray-200",initial:{opacity:0},animate:{opacity:1},transition:{delay:.5},children:["For an interactive version of this course, I created an LLM assistant that will answer questions and test your knowledge in a personalized way on"," ",f.jsx("a",{href:"https://huggingface.co/chat/assistant/66029d2e5f4a884f7aabc9d1",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:underline",children:"HuggingChat"})," ","or"," ",f.jsx("a",{href:"https://chatgpt.com/g/g-yviLuLqvI-llm-course",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:underline",children:"ChatGPT"}),"."]})]}),f.jsxs(T.div,{className:"flex flex-wrap gap-4 mt-5",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.6},children:[f.jsxs(T.a,{whileHover:{scale:1.03},whileTap:{scale:.98},href:bi.url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors",children:[f.jsx(hs,{className:"mr-2 h-4 w-4"}),"View on GitHub"]}),f.jsxs(T.a,{whileHover:{scale:1.03},whileTap:{scale:.98},href:bi.book.url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors",children:[f.jsx(ro,{className:"mr-2 h-4 w-4"}),"View Book"]})]})]})}),f.jsxs(T.div,{className:"text-center mb-12",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},children:[f.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Course Modules"}),f.jsx("p",{className:"text-gray-600 dark:text-gray-400 max-w-3xl mx-auto",children:"A structured learning path from LLM fundamentals to advanced applications."})]}),f.jsxs(T.div,{className:"grid grid-cols-1 md:grid-cols-3 gap-6 my-12",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},children:[f.jsx(Ke,{to:"/llm-fundamentals",className:"group block h-full",children:f.jsx("div",{className:"h-full bg-white dark:bg-gray-800 rounded-xl shadow-md overflow-hidden border border-gray-200 dark:border-gray-700 hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1",children:f.jsxs("div",{className:"p-6",children:[f.jsxs("div",{className:"flex items-center justify-between mb-4",children:[f.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"LLM Fundamentals"}),f.jsx(Qi,{className:"text-blue-600 dark:text-blue-400 group-hover:translate-x-1 transition-transform"})]}),f.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"Master the core concepts and practical applications of Large Language Models"}),f.jsx("div",{className:"flex items-center text-sm text-blue-600 dark:text-blue-400 font-medium",children:f.jsx("span",{children:"Start Learning"})})]})})}),f.jsx(Ke,{to:"/llm-scientist",className:"group block h-full",children:f.jsx("div",{className:"h-full bg-white dark:bg-gray-800 rounded-xl shadow-md overflow-hidden border border-gray-200 dark:border-gray-700 hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1",children:f.jsxs("div",{className:"p-6",children:[f.jsxs("div",{className:"flex items-center justify-between mb-4",children:[f.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"LLM Scientist"}),f.jsx(Qi,{className:"text-purple-600 dark:text-purple-400 group-hover:translate-x-1 transition-transform"})]}),f.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"Advanced techniques and research in Large Language Models for AI researchers"}),f.jsx("div",{className:"flex items-center text-sm text-purple-600 dark:text-purple-400 font-medium",children:f.jsx("span",{children:"Explore Research"})})]})})}),f.jsx(Ke,{to:"/llm-engineer",className:"group block h-full",children:f.jsx("div",{className:"h-full bg-white dark:bg-gray-800 rounded-xl shadow-md overflow-hidden border border-gray-200 dark:border-gray-700 hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1",children:f.jsxs("div",{className:"p-6",children:[f.jsxs("div",{className:"flex items-center justify-between mb-4",children:[f.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"LLM Engineer"}),f.jsx(Qi,{className:"text-green-600 dark:text-green-400 group-hover:translate-x-1 transition-transform"})]}),f.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"Build and deploy production-grade LLM applications at scale"}),f.jsx("div",{className:"flex items-center text-sm text-green-600 dark:text-green-400 font-medium",children:f.jsx("span",{children:"Start Building"})})]})})})]}),f.jsx("div",{className:"space-y-4",children:Eo.map((s,n)=>f.jsxs(T.div,{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm hover:shadow-md transition-shadow duration-200 overflow-hidden border border-gray-200 dark:border-gray-700",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*n},children:[f.jsxs("button",{className:`w-full px-6 py-4 flex items-center justify-between text-left focus:outline-none transition-colors ${o===n?"bg-gray-50 dark:bg-gray-800/50":"hover:bg-gray-50 dark:hover:bg-gray-800/30"}`,onClick:()=>i(n),children:[f.jsxs("div",{className:"flex items-center space-x-4",children:[f.jsx("div",{className:`p-2 rounded-lg transition-colors ${o===n?"bg-blue-100 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400":"bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400"}`,children:s.icon}),f.jsxs("div",{children:[f.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:s.title}),f.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:s.description})]})]}),f.jsx(T.div,{animate:{rotate:o===n?180:0},transition:{duration:.3},children:f.jsx(Jn,{className:"w-5 h-5 text-gray-400"})})]}),f.jsx(ie,{children:o===n&&f.jsx(T.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3,ease:"easeInOut"},className:"overflow-hidden",children:f.jsxs("div",{className:"px-6 pb-6 pt-4 border-t border-gray-200 dark:border-gray-700 bg-gray-50/30 dark:bg-gray-800/30",children:[f.jsx("p",{className:"text-gray-700 dark:text-gray-300 mb-4",children:s.overview}),f.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6 mt-6",children:s.topics.map((r,a)=>f.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm border border-gray-100 dark:border-gray-700",children:[f.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-3",children:r.title}),f.jsx("ul",{className:"space-y-2",children:r.content.map((l,c)=>f.jsxs("li",{className:"flex items-start",children:[f.jsx("svg",{className:"h-5 w-5 text-green-500 dark:text-green-400 mr-2 mt-0.5 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:f.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),f.jsx("span",{className:"text-gray-600 dark:text-gray-300 text-sm",children:l})]},c))})]},a))})]})})})]},n))})]})})},Co=[{id:1,title:"Mathematics for Machine Learning",description:"Before mastering machine learning, it is important to understand the fundamental mathematical concepts that power these algorithms.",topics:[{name:"Linear Algebra",details:"This is crucial for understanding many algorithms, especially those used in deep learning. Key concepts include vectors, matrices, determinants, eigenvalues and eigenvectors, vector spaces, and linear transformations."},{name:"Calculus",details:"Many machine learning algorithms involve the optimization of continuous functions, which requires an understanding of derivatives, integrals, limits, and series. Multivariable calculus and the concept of gradients are also important."},{name:"Probability and Statistics",details:"These are crucial for understanding how models learn from data and make predictions. Key concepts include probability theory, random variables, probability distributions, expectations, variance, covariance, correlation, hypothesis testing, confidence intervals, maximum likelihood estimation, and Bayesian inference."}],resources:[{name:"3Blue1Brown - The Essence of Linear Algebra",url:"https://www.youtube.com/watch?v=fNk_zzaMoSs&list=PLZHQObOWTQDPD3MizzM2xVFitgF8hE_ab"},{name:"StatQuest with Josh Starmer - Statistics Fundamentals",url:"https://www.youtube.com/watch?v=qBigTkBLU6g&list=PLblh5JKOoLUK0FLuzwntyYI10UQFUhsY9"},{name:"AP Statistics Intuition by Ms Aerin",url:"https://automata88.medium.com/list/cacc224d5e7d"},{name:"Immersive Linear Algebra",url:"https://immersivemath.com/ila/learnmore.html"},{name:"Khan Academy - Linear Algebra",url:"https://www.khanacademy.org/math/linear-algebra"},{name:"Khan Academy - Calculus",url:"https://www.khanacademy.org/math/calculus-1"},{name:"Khan Academy - Probability and Statistics",url:"https://www.khanacademy.org/math/statistics-probability"}]},{id:2,title:"Python for Machine Learning",description:"Python is a powerful and flexible programming language that's particularly good for machine learning, thanks to its readability, consistency, and robust ecosystem of data science libraries.",topics:[{name:"Python Basics",details:"Python programming requires a good understanding of the basic syntax, data types, error handling, and object-oriented programming."},{name:"Data Science Libraries",details:"It includes familiarity with NumPy for numerical operations, Pandas for data manipulation and analysis, Matplotlib and Seaborn for data visualization."},{name:"Data Preprocessing",details:"This involves feature scaling and normalization, handling missing data, outlier detection, categorical data encoding, and splitting data into training, validation, and test sets."},{name:"Machine Learning Libraries",details:"Proficiency with Scikit-learn, a library providing a wide selection of supervised and unsupervised learning algorithms, is vital. Understanding how to implement algorithms like linear regression, logistic regression, decision trees, random forests, k-nearest neighbors (K-NN), and K-means clustering is important. Dimensionality reduction techniques like PCA and t-SNE are also helpful for visualizing high-dimensional data."}],resources:[{name:"Real Python",url:"https://realpython.com/"},{name:"freeCodeCamp - Learn Python",url:"https://www.youtube.com/watch?v=rfscVS0vtbw"},{name:"Python Data Science Handbook",url:"https://jakevdp.github.io/PythonDataScienceHandbook/"},{name:"freeCodeCamp - Machine Learning for Everybody",url:"https://youtu.be/i_LwzRVP7bg"},{name:"Udacity - Intro to Machine Learning",url:"https://www.udacity.com/course/intro-to-machine-learning--ud120"}]},{id:3,title:"Neural Networks",description:"Neural networks are a fundamental part of many machine learning models, particularly in the realm of deep learning. To utilize them effectively, a comprehensive understanding of their design and mechanics is essential.",topics:[{name:"Fundamentals",details:"This includes understanding the structure of a neural network, such as layers, weights, biases, and activation functions (sigmoid, tanh, ReLU, etc.)"},{name:"Training and Optimization",details:"Familiarize yourself with backpropagation and different types of loss functions, like Mean Squared Error (MSE) and Cross-Entropy. Understand various optimization algorithms like Gradient Descent, Stochastic Gradient Descent, RMSprop, and Adam."},{name:"Overfitting",details:"Understand the concept of overfitting (where a model performs well on training data but poorly on unseen data) and learn various regularization techniques (dropout, L1/L2 regularization, early stopping, data augmentation) to prevent it."},{name:"Implement a Multilayer Perceptron (MLP)",details:"Build an MLP, also known as a fully connected network, using PyTorch."}],resources:[{name:"3Blue1Brown - But what is a Neural Network?",url:"https://www.youtube.com/watch?v=aircAruvnKk"},{name:"freeCodeCamp - Deep Learning Crash Course",url:"https://www.youtube.com/watch?v=VyWAvY2CF9c"},{name:"Fast.ai - Practical Deep Learning",url:"https://course.fast.ai/"},{name:"Patrick Loeber - PyTorch Tutorials",url:"https://www.youtube.com/playlist?list=PLqnslRFeH2UrcDBWF5mfPGpqQDSta6VK4"}]},{id:4,title:"Natural Language Processing (NLP)",description:"NLP is a fascinating branch of artificial intelligence that bridges the gap between human language and machine understanding. From simple text processing to understanding linguistic nuances, NLP plays a crucial role in many applications like translation, sentiment analysis, chatbots, and much more.",topics:[{name:"Text Preprocessing",details:"Learn various text preprocessing steps like tokenization (splitting text into words or sentences), stemming (reducing words to their root form), lemmatization (similar to stemming but considers the context), stop word removal, etc."},{name:"Feature Extraction Techniques",details:"Become familiar with techniques to convert text data into a format that can be understood by machine learning algorithms. Key methods include Bag-of-words (BoW), Term Frequency-Inverse Document Frequency (TF-IDF), and n-grams."},{name:"Word Embeddings",details:"Word embeddings are a type of word representation that allows words with similar meanings to have similar representations. Key methods include Word2Vec, GloVe, and FastText."},{name:"Recurrent Neural Networks (RNNs)",details:"Understand the working of RNNs, a type of neural network designed to work with sequence data. Explore LSTMs and GRUs, two RNN variants that are capable of learning long-term dependencies."}],resources:[{name:"Lena Voita - Word Embeddings",url:"https://lena-voita.github.io/nlp_course/word_embeddings.html"},{name:"RealPython - NLP with spaCy in Python",url:"https://realpython.com/natural-language-processing-spacy-python/"},{name:"Kaggle - NLP Guide",url:"https://www.kaggle.com/learn-guide/natural-language-processing"},{name:"Jay Alammar - The Illustration Word2Vec",url:"https://jalammar.github.io/illustrated-word2vec/"},{name:"Jake Tae - PyTorch RNN from Scratch",url:"https://jaketae.github.io/study/pytorch-rnn/"},{name:"colah's blog - Understanding LSTM Networks",url:"https://colah.github.io/posts/2015-08-Understanding-LSTMs/"}]}],To=({module:o,index:t,resources:e=[],details:i=[]})=>{const[s,n]=C.useState(!1);return f.jsx(T.div,{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm hover:shadow-md transition-shadow duration-200 overflow-hidden border border-gray-200 dark:border-gray-700",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*t},children:f.jsxs("div",{className:"p-6",children:[f.jsxs("div",{className:"flex items-center justify-between mb-4",children:[f.jsxs("div",{className:"flex items-center",children:[f.jsx("span",{className:"flex items-center justify-center w-10 h-10 rounded-full bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 font-medium text-lg mr-4",children:t+1}),f.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:o.title})]}),f.jsx("span",{className:"px-3 py-1 text-sm font-medium rounded-full bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400",children:o.duration})]}),f.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:o.description}),f.jsxs("div",{className:"mt-4",children:[f.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Topics Covered:"}),f.jsx("div",{className:"space-y-2",children:i.map((r,a)=>f.jsxs("div",{className:"border-b border-gray-100 dark:border-gray-700 pb-2",children:[f.jsx("div",{className:"font-medium text-gray-800 dark:text-gray-200",children:r.name}),f.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:r.description})]},a))})]}),e.length>0&&f.jsxs("div",{className:"mt-6 pt-4 border-t border-gray-100 dark:border-gray-700",children:[f.jsxs("button",{onClick:()=>n(!s),className:"flex items-center text-sm font-medium text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 transition-colors",children:[s?"Hide":"Show"," Resources",f.jsx(Jn,{className:`ml-1 transition-transform ${s?"rotate-180":""}`})]}),f.jsx(ie,{children:s&&f.jsx(T.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},className:"overflow-hidden",children:f.jsxs("div",{className:"mt-3 space-y-2",children:[f.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Recommended Resources:"}),f.jsx("ul",{className:"space-y-2",children:e.map((r,a)=>f.jsx("li",{className:"text-sm",children:f.jsxs("a",{href:r.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center text-blue-600 dark:text-blue-400 hover:underline",children:[r.name,f.jsx(Ri,{className:"ml-1 w-3 h-3"})]})},a))})]})})})]})]})},t)},ks=({courseData:o})=>{const t=ha(),e=o.sections.map(s=>({title:s.title,duration:s.topics.length>3?"2 weeks":"1 week",description:s.description,topics:s.topics.map(n=>n.name),resources:s.resources||[],details:s.topics.map(n=>({name:n.name,description:n.details}))})),i=e.reduce((s,n)=>s+(n.duration.includes("week")?1:0),0);return f.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50/50 via-white to-purple-50/50 dark:from-gray-900/50 dark:via-gray-800/50 dark:to-purple-900/20 py-12 px-4 sm:px-6",children:f.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:[f.jsxs("button",{onClick:()=>t("/llm-course"),className:"flex items-center text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 mb-8 transition-colors",children:[f.jsx(so,{className:"mr-2"}),"Back to LLM Courses"]}),f.jsxs(T.div,{className:"text-center mb-16",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[f.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-gray-900 dark:text-white mb-4",children:o.title}),f.jsx("p",{className:"text-xl text-gray-600 dark:text-gray-300 max-w-3xl mx-auto",children:o.subtitle||""})]}),f.jsxs(T.div,{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-8 mb-16",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2,duration:.5},children:[f.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-4",children:"Course Overview"}),f.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:o.intro}),f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mt-8",children:[f.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg",children:[f.jsx("h3",{className:"font-semibold text-blue-700 dark:text-blue-400",children:"Duration"}),f.jsxs("p",{className:"text-gray-600 dark:text-gray-300",children:[i," Week",i!==1?"s":""]})]}),f.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 p-4 rounded-lg",children:[f.jsx("h3",{className:"font-semibold text-purple-700 dark:text-purple-400",children:"Level"}),f.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:o.level||"All Levels"})]}),f.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 p-4 rounded-lg",children:[f.jsx("h3",{className:"font-semibold text-green-700 dark:text-green-400",children:"Sections"}),f.jsxs("p",{className:"text-gray-600 dark:text-gray-300",children:[o.sections.length," Comprehensive Sections"]})]})]})]}),f.jsxs("div",{className:"space-y-6",children:[f.jsxs(T.div,{className:"text-center mb-8",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:[f.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:o.modulesTitle||"Course Modules"}),f.jsx("p",{className:"text-gray-600 dark:text-gray-400 max-w-3xl mx-auto",children:o.modulesDescription||"A structured learning path covering all aspects of the course"})]}),f.jsx("div",{className:"space-y-6",children:e.map((s,n)=>f.jsx(To,{module:s,index:n,resources:s.resources,details:s.details},n))})]}),f.jsxs(T.div,{className:"mt-16 p-6 bg-blue-50 dark:bg-blue-900/20 rounded-lg border-l-4 border-blue-400 dark:border-blue-600",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},children:[f.jsx("h3",{className:"text-lg font-semibold text-blue-800 dark:text-blue-200 mb-2",children:"Note from the Original Author"}),f.jsx("p",{className:"text-blue-700 dark:text-blue-300 text-sm mb-3",children:"The following acknowledgments are from the original author of this learning path:"}),f.jsxs("div",{className:"bg-white dark:bg-gray-800/50 p-4 rounded-lg",children:[f.jsxs("p",{className:"text-gray-700 dark:text-gray-300 text-sm mb-3",children:["This roadmap was inspired by the excellent"," ",f.jsxs("a",{href:"https://github.com/milanm/DevOps-Roadmap",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:underline inline-flex items-center",children:["DevOps Roadmap ",f.jsx(Ri,{className:"ml-1",size:14})]})," ","from Milan MilanoviÄ‡ and Romano Roth."]}),f.jsx("p",{className:"text-gray-700 dark:text-gray-300 text-sm mb-3",children:"Special thanks to:"}),f.jsxs("ul",{className:"list-disc list-inside text-gray-700 dark:text-gray-300 text-sm space-y-1 pl-4",children:[f.jsx("li",{children:"Thomas Thelen for motivating me to create a roadmap"}),f.jsx("li",{children:"AndrÃ© Frade for his input and review of the first draft"}),f.jsx("li",{children:"Dino Dunn for providing resources about LLM security"}),f.jsx("li",{children:'Magdalena Kuhn for improving the "human evaluation" part'}),f.jsx("li",{children:"Odoverdose for suggesting 3Blue1Brown's video about Transformers"}),f.jsx("li",{children:"Everyone who contributed to the educational references in this course :)"})]}),f.jsx("p",{className:"text-gray-700 dark:text-gray-300 text-sm mt-3 italic",children:"Disclaimer: I am not affiliated with any sources listed here."})]}),f.jsx("p",{className:"text-blue-700 dark:text-blue-300 text-xs mt-3 italic",children:"This note is included to properly credit the original authors and contributors of this learning path."})]})]})})},dd=()=>{const o={title:"LLM Fundamentals",subtitle:"Build a strong foundation in Large Language Models",intro:"This section introduces essential knowledge about mathematics, Python, and neural networks. You might not want to start here but refer to it as needed.",level:"Beginner",modulesTitle:"Course Modules",modulesDescription:"A structured learning path covering all aspects of LLM fundamentals",sections:Co};return f.jsx(ks,{courseData:o})},Lo=[{id:1,title:"The LLM architecture",description:"An in-depth knowledge of the Transformer architecture is not required, but it's important to understand the main steps of modern LLMs: converting text into numbers through tokenization, processing these tokens through layers including attention mechanisms, and finally generating new text through various sampling strategies.",topics:[{name:"Architectural Overview",details:"Understand the evolution from encoder-decoder Transformers to decoder-only architectures like GPT, which form the basis of modern LLMs. Focus on how these models process and generate text at a high level."},{name:"Tokenization",details:"Learn the principles of tokenization - how text is converted into numerical representations that LLMs can process. Explore different tokenization strategies and their impact on model performance and output quality."},{name:"Attention mechanisms",details:"Master the core concepts of attention mechanisms, particularly self-attention and its variants. Understand how these mechanisms enable LLMs to process long-range dependencies and maintain context throughout sequences."},{name:"Sampling techniques",details:"Explore various text generation approaches and their tradeoffs. Compare deterministic methods like greedy search and beam search with probabilistic approaches like temperature sampling and nucleus sampling."}],resources:[{name:"Visual intro to Transformers",url:"https://www.youtube.com/watch?v=wjZofJX0v4M"},{name:"LLM Visualization",url:"https://bbycroft.net/llm"},{name:"nanoGPT",url:"https://www.youtube.com/watch?v=kCc8FmEb1nY"},{name:"Attention? Attention!",url:"https://lilianweng.github.io/posts/2018-06-24-attention/"},{name:"Decoding Strategies in LLMs",url:"https://mlabonne.github.io/blog/posts/2023-06-07-Decoding_strategies.html"}]},{id:2,title:"Pre-training models",description:"Pre-training is a computationally intensive and expensive process. While it's not the focus of this course, it's important to have a solid understanding of how models are pre-trained, especially in terms of data and parameters. Pre-training can also be performed by hobbyists at a small scale with <1B models.",topics:[{name:"Data preparation",details:"Pre-training requires massive datasets (e.g., Llama 3.1 was trained on 15 trillion tokens) that need careful curation, cleaning, deduplication, and tokenization. Modern pre-training pipelines implement sophisticated filtering to remove low-quality or problematic content."},{name:"Distributed training",details:"Combine different parallelization strategies: data parallel (batch distribution), pipeline parallel (layer distribution), and tensor parallel (operation splitting). These strategies require optimized network communication and memory management across GPU clusters."},{name:"Training optimization",details:"Use adaptive learning rates with warm-up, gradient clipping, and normalization to prevent explosions, mixed-precision training for memory efficiency, and modern optimizers (AdamW, Lion) with tuned hyperparameters."},{name:"Monitoring",details:"Track key metrics (loss, gradients, GPU stats) using dashboards, implement targeted logging for distributed training issues, and set up performance profiling to identify bottlenecks in computation and communication across devices."}],resources:[{name:"FineWeb",url:"https://huggingface.co/spaces/HuggingFaceFW/blogpost-fineweb-v1"},{name:"RedPajama v2",url:"https://www.together.ai/blog/redpajama-data-v2"},{name:"nanotron",url:"https://github.com/huggingface/nanotron"},{name:"Parallel training",url:"https://www.andrew.cmu.edu/course/11-667/lectures/W10L2%20Scaling%20Up%20Parallel%20Training.pdf"},{name:"Distributed training",url:"https://arxiv.org/abs/2407.20018"},{name:"OLMo 2",url:"https://allenai.org/olmo"},{name:"LLM360",url:"https://www.llm360.ai/"}]},{id:3,title:"Post-training datasets",description:"Post-training datasets have a precise structure with instructions and answers (supervised fine-tuning) or instructions and chosen/rejected answers (preference alignment). Conversational structures are a lot rarer than the raw text used for pre-training, which is why we often need to process seed data and refine it to improve the accuracy, diversity, and complexity of the samples. More information and examples are available in my repo ðŸ’¾ LLM Datasets.",topics:[{name:"Storage & chat templates",details:"Because of the conversational structure, post-training datasets are stored in a specific format like ShareGPT or OpenAI/HF. Then, these formats are mapped to a chat template like ChatML or Alpaca to produce the final samples the model is trained on."},{name:"Synthetic data generation",details:"Create instruction-response pairs based on seed data using frontier models like GPT-4o. This approach allows for flexible and scalable dataset creation with high-quality answers. Key considerations include designing diverse seed tasks and effective system prompts."},{name:"Data enhancement",details:"Enhance existing samples using techniques like verified outputs (using unit tests or solvers), multiple answers with rejection sampling, Auto-Evol, Chain-of-Thought, Branch-Solve-Merge, personas, etc."},{name:"Quality filtering",details:"Traditional techniques involve rule-based filtering, removing duplicates or near-duplicates (with MinHash or embeddings), and n-gram decontamination. Reward models and judge LLMs complement this step with fine-grained and customizable quality control."}],resources:[{name:"Synthetic Data Generator",url:"https://huggingface.co/spaces/argilla/synthetic-data-generator"},{name:"LLM Datasets",url:"https://github.com/mlabonne/llm-datasets"},{name:"NeMo-Curator",url:"https://github.com/NVIDIA/NeMo-Curator"},{name:"Distilabel",url:"https://distilabel.argilla.io/dev/sections/pipeline_samples/"},{name:"Semhash",url:"https://github.com/MinishLab/semhash"},{name:"Chat Template",url:"https://huggingface.co/docs/transformers/main/en/chat_templating"}]},{id:4,title:"Supervised Fine-Tuning",description:"SFT turns base models into helpful assistants, capable of answering questions and following instructions. During this process, they learn how to structure answers and reactivate a subset of knowledge learned during pre-training. Instilling new knowledge is possible but superficial: it cannot be used to learn a completely new language. Always prioritize data quality over parameter optimization.",topics:[{name:"Training techniques",details:"Full fine-tuning updates all model parameters but requires significant compute. Parameter-efficient fine-tuning techniques like LoRA and QLoRA reduce memory requirements by training a small number of adapter parameters while keeping base weights frozen. QLoRA combines 4-bit quantization with LoRA to reduce VRAM usage. These techniques are all implemented in the most popular fine-tuning frameworks: TRL, Unsloth, and Axolotl."},{name:"Training parameters",details:"Key parameters include learning rate with schedulers, batch size, gradient accumulation, number of epochs, optimizer (like 8-bit AdamW), weight decay for regularization, and warmup steps for training stability. LoRA also adds three parameters: rank (typically 16-128), alpha (1-2x rank), and target modules."},{name:"Distributed training",details:"Scale training across multiple GPUs using DeepSpeed or FSDP. DeepSpeed provides three ZeRO optimization stages with increasing levels of memory efficiency through state partitioning. Both methods support gradient checkpointing for memory efficiency."},{name:"Monitoring",details:"Track training metrics including loss curves, learning rate schedules, and gradient norms. Monitor for common issues like loss spikes, gradient explosions, or performance degradation."}],resources:[{name:"Fine-tune Llama 3.1 Ultra-Efficiently with Unsloth",url:"https://huggingface.co/blog/mlabonne/sft-llama3"},{name:"Axolotl - Documentation",url:"https://axolotl-ai-cloud.github.io/axolotl/"},{name:"Mastering LLMs",url:"https://parlance-labs.com/education/"},{name:"LoRA insights",url:"https://lightning.ai/pages/community/lora-insights/"}]},{id:5,title:"Preference Alignment",description:"Preference alignment is a second stage in the post-training pipeline, focused on aligning generated answers with human preferences. This stage was designed to tune the tone of LLMs and reduce toxicity and hallucinations. However, it has become increasingly important to also boost their performance and improve usefulness. Unlike SFT, there are many preference alignment algorithms. Here, we'll focus on the three most important ones: DPO, GRPO, and PPO.",topics:[{name:"Rejection sampling",details:"For each prompt, use the trained model to generate multiple responses, and score them to infer chosen/rejected answers. This creates on-policy data, where both responses come from the model being trained, improving alignment stability."},{name:"Direct Preference Optimization",details:"Directly optimizes the policy to maximize the likelihood of chosen responses over rejected ones. It doesn't require reward modeling, which makes it more computationally efficient than RL techniques but slightly worse in terms of quality. Great for creating chat models.",url:"https://arxiv.org/abs/2305.18290"},{name:"Reward model",details:"Train a reward model with human feedback to predict metrics like human preferences. It can leverage frameworks like TRL, verl, and OpenRLHF for scalable training.",urls:["https://huggingface.co/docs/trl/en/index","https://github.com/volcengine/verl","https://github.com/OpenRLHF/OpenRLHF"]},{name:"Reinforcement Learning",details:"RL techniques like GRPO and PPO iteratively update a policy to maximize rewards while staying close to the initial behavior. They can use a reward model or reward functions to score responses. They tend to be computationally expensive and require careful tuning of hyperparameters, including learning rate, batch size, and clip range. Ideal for creating reasoning models.",urls:["https://arxiv.org/abs/2402.03300","https://arxiv.org/abs/1707.06347"]}],resources:[{name:"Illustrating RLHF",url:"https://huggingface.co/blog/rlhf"},{name:"LLM Training: RLHF and Its Alternatives",url:"https://magazine.sebastianraschka.com/p/llm-training-rlhf-and-its-alternatives"},{name:"Preference Tuning LLMs",url:"https://huggingface.co/blog/pref-tuning"},{name:"Fine-tune with DPO",url:"https://mlabonne.github.io/blog/posts/Fine_tune_Mistral_7b_with_DPO.html"},{name:"Fine-tune with GRPO",url:"https://huggingface.co/learn/llm-course/en/chapter12/5"},{name:"DPO Wandb logs",url:"https://wandb.ai/alexander-vishnevskiy/dpo/reports/TRL-Original-DPO--Vmlldzo1NjI4MTc4"}]},{id:6,title:"Evaluation",description:"Reliably evaluating LLMs is a complex but essential task guiding data generation and training. It provides invaluable feedback about areas of improvement, which can be leveraged to modify the data mixture, quality, and training parameters. However, it's always good to remember Goodhart's law: 'When a measure becomes a target, it ceases to be a good measure.'",topics:[{name:"Automated benchmarks",details:"Evaluate models on specific tasks using curated datasets and metrics, like MMLU. It works well for concrete tasks but struggles with abstract and creative capabilities. It is also prone to data contamination."},{name:"Human evaluation",details:"It involves humans prompting models and grading responses. Methods range from vibe checks to systematic annotations with specific guidelines and large-scale community voting (arena). It is more suited for subjective tasks and less reliable for factual accuracy."},{name:"Model-based evaluation",details:"Use judge and reward models to evaluate model outputs. It highly correlates with human preferences but suffers from bias toward their own outputs and inconsistent scoring."},{name:"Feedback signal",details:"Analyze error patterns to identify specific weaknesses, such as limitations in following complex instructions, lack of specific knowledge, or susceptibility to adversarial prompts. This can be improved with better data generation and training parameters."}],resources:[{name:"Evaluation guidebook",url:"https://github.com/huggingface/evaluation-guidebook"},{name:"Open LLM Leaderboard",url:"https://huggingface.co/spaces/open-llm-leaderboard/open_llm_leaderboard"},{name:"Language Model Evaluation Harness",url:"https://github.com/EleutherAI/lm-evaluation-harness"},{name:"Lighteval",url:"https://github.com/huggingface/lighteval"},{name:"Chatbot Arena",url:"https://lmarena.ai/"}]},{id:7,title:"Quantization",description:"Quantization is the process of converting the parameters and activations of a model using a lower precision. For example, weights stored using 16 bits can be converted into a 4-bit representation. This technique has become increasingly important to reduce the computational and memory costs associated with LLMs.",topics:[{name:"Base techniques",details:"Learn the different levels of precision (FP32, FP16, INT8, etc.) and how to perform naÃ¯ve quantization with absmax and zero-point techniques."},{name:"GGUF & llama.cpp",details:"Originally designed to run on CPUs, llama.cpp and the GGUF format have become the most popular tools to run LLMs on consumer-grade hardware. It supports storing special tokens, vocabulary, and metadata in a single file.",urls:["https://github.com/ggerganov/llama.cpp"]},{name:"GPTQ & AWQ",details:"Techniques like GPTQ/EXL2 and AWQ introduce layer-by-layer calibration that retains performance at extremely low bitwidths. They reduce catastrophic outliers using dynamic scaling, selectively skipping or re-centering the heaviest parameters.",urls:["https://arxiv.org/abs/2210.17323","https://github.com/turboderp/exllamav2","https://arxiv.org/abs/2306.00978"]},{name:"SmoothQuant & ZeroQuant",details:"New quantization-friendly transformations (SmoothQuant) and compiler-based optimizations (ZeroQuant) help mitigate outliers before quantization. They also reduce hardware overhead by fusing certain ops and optimizing dataflow.",urls:["https://github.com/mit-han-lab/smoothquant/blob/main/examples/smoothquant_llama_demo.ipynb","https://www.deepspeed.ai/tutorials/model-compression/"]}],resources:[{name:"Introduction to quantization",url:"https://mlabonne.github.io/blog/posts/Introduction_to_Weight_Quantization.html"},{name:"Quantize Llama models with llama.cpp",url:"https://mlabonne.github.io/blog/posts/Quantize_Llama_2_models_using_ggml.html"},{name:"4-bit LLM Quantization with GPTQ",url:"https://mlabonne.github.io/blog/posts/4_bit_Quantization_with_GPTQ.html"},{name:"Understanding Activation-Aware Weight Quantization",url:"https://medium.com/friendliai/understanding-activation-aware-weight-quantization-awq-boosting-inference-serving-efficiency-in-10bb0faf63a8"}]},{id:8,title:"New Trends",description:"Here are notable topics that didn't fit into other categories. Some are established (model merging, multimodal) techniques, but others are more experimental (interpretability, test-time compute scaling) and the focus of numerous research papers.",topics:[{name:"Model merging",details:"Merging trained models has become a popular way of creating performant models without any fine-tuning. The popular mergekit library implements the most popular merging methods, like SLERP, DARE, and TIES.",urls:["https://github.com/cg123/mergekit","https://arxiv.org/abs/2311.03099"]},{name:"Multimodal models",details:"These models (like CLIP, Stable Diffusion, or LLaVA) process multiple types of inputs (text, images, audio, etc.) with a unified embedding space, which unlocks powerful applications like text-to-image.",urls:["https://openai.com/research/clip","https://stability.ai/stable-image","https://llava-vl.github.io/"]},{name:"Interpretability",details:"Mechanistic interpretability techniques like Sparse Autoencoders (SAEs) have made remarkable progress to provide insights about the inner workings of LLMs. This has also been applied with techniques such as abliteration, which allow you to modify the behavior of models without training.",urls:["https://huggingface.co/blog/mlabonne/abliteration","https://adamkarvonen.github.io/machine_learning/2024/06/11/sae-intuitions.html"]},{name:"Test-time compute",details:"Reasoning models trained with RL techniques can be further improved by scaling the compute budget during test time. It can involve multiple calls, MCTS, or specialized models like a Process Reward Model (PRM). Iterative steps with precise scoring significantly improve performance for complex reasoning tasks.",urls:["https://huggingface.co/spaces/HuggingFaceH4/blogpost-scaling-test-time-compute"]}],resources:[{name:"Merge LLMs with mergekit",url:"https://mlabonne.github.io/blog/posts/2024-01-08_Merge_LLMs_with_mergekit.html"},{name:"Smol Vision",url:"https://github.com/merveenoyan/smol-vision"},{name:"Large Multimodal Models",url:"https://huyenchip.com/2023/10/10/multimodal.html"},{name:"Unsensor any LLM with abliteration",url:"https://huggingface.co/blog/mlabonne/abliteration"},{name:"Scaling test-time compute",url:"https://huggingface.co/spaces/HuggingFaceH4/blogpost-scaling-test-time-compute"}]}],ud=()=>{const o={title:"LLM Scientist",subtitle:"Dive deep into LLM research and development",intro:"This section of the course focuses on learning how to build the best possible LLMs using the latest techniques.",level:"Advanced",modulesTitle:"Research Tracks",modulesDescription:"Advanced modules for LLM research and development",sections:Lo};return f.jsx(ks,{courseData:o})},Po=[{id:1,title:"Running LLMs",description:"Running LLMs can be difficult due to high hardware requirements. Depending on your use case, you might want to simply consume a model through an API (like GPT-4) or run it locally. In any case, additional prompting and guidance techniques can improve and constrain the output for your applications.",topics:[{name:"LLM APIs",details:"APIs are a convenient way to deploy LLMs. This space is divided between private LLMs (OpenAI, Google, Anthropic, etc.) and open-source LLMs (OpenRouter, Hugging Face, Together AI, etc.).",urls:["https://platform.openai.com/","https://cloud.google.com/vertex-ai/docs/generative-ai/learn/overview","https://docs.anthropic.com/claude/reference/getting-started-with-the-api","https://openrouter.ai/","https://huggingface.co/inference-api","https://www.together.ai/"]},{name:"Open-source LLMs",details:"The Hugging Face Hub is a great place to find LLMs. You can directly run some of them in Hugging Face Spaces, or download and run them locally in apps like LM Studio or through the CLI with llama.cpp or ollama.",urls:["https://huggingface.co/models","https://huggingface.co/spaces","https://lmstudio.ai/","https://github.com/ggerganov/llama.cpp","https://ollama.ai/"]},{name:"Prompt engineering",details:"Common techniques include zero-shot prompting, few-shot prompting, chain of thought, and ReAct. They work better with bigger models, but can be adapted to smaller ones."},{name:"Structuring outputs",details:"Many tasks require a structured output, like a strict template or a JSON format. Libraries like Outlines can be used to guide the generation and respect a given structure. Some APIs also support structured output generation natively using JSON schemas.",urls:["https://github.com/outlines-dev/outlines"]}],resources:[{name:"Run an LLM locally with LM Studio",url:"https://www.kdnuggets.com/run-an-llm-locally-with-lm-studio"},{name:"Prompt engineering guide",url:"https://www.promptingguide.ai/"},{name:"Outlines - Quickstart",url:"https://dottxt-ai.github.io/outlines/latest/quickstart/"},{name:"LMQL - Overview",url:"https://lmql.ai/docs/language/overview.html"}]},{id:2,title:"Building a Vector Storage",description:"Creating a vector storage is the first step to building a Retrieval Augmented Generation (RAG) pipeline. Documents are loaded, split, and relevant chunks are used to produce vector representations (embeddings) that are stored for future use during inference.",topics:[{name:"Ingesting documents",details:"Document loaders are convenient wrappers that can handle many formats: PDF, JSON, HTML, Markdown, etc. They can also directly retrieve data from some databases and APIs (GitHub, Reddit, Google Drive, etc.)."},{name:"Splitting documents",details:"Text splitters break down documents into smaller, semantically meaningful chunks. Instead of splitting text after n characters, it's often better to split by header or recursively, with some additional metadata."},{name:"Embedding models",details:"Embedding models convert text into vector representations. Picking task-specific models significantly improves performance for semantic search and RAG."},{name:"Vector databases",details:"Vector databases (like Chroma, Pinecone, Milvus, FAISS, Annoy, etc.) are designed to store embedding vectors. They enable efficient retrieval of data that is 'most similar' to a query based on vector similarity.",urls:["https://www.trychroma.com/","https://www.pinecone.io/","https://milvus.io/","https://faiss.ai/","https://github.com/spotify/annoy"]}],resources:[{name:"LangChain - Text splitters",url:"https://python.langchain.com/docs/how_to/#text-splitters"},{name:"Sentence Transformers library",url:"https://www.sbert.net/"},{name:"MTEB Leaderboard",url:"https://huggingface.co/spaces/mteb/leaderboard"},{name:"The Top 7 Vector Databases",url:"https://www.datacamp.com/blog/the-top-5-vector-databases"}]},{id:3,title:"Retrieval Augmented Generation",description:"With RAG, LLMs retrieve contextual documents from a database to improve the accuracy of their answers. RAG is a popular way of augmenting the model's knowledge without any fine-tuning.",topics:[{name:"Orchestrators",details:"Orchestrators like LangChain and LlamaIndex are popular frameworks to connect your LLMs with tools and databases. The Model Context Protocol (MCP) introduces a new standard to pass data and context to models across providers.",urls:["https://python.langchain.com/docs/get_started/introduction","https://docs.llamaindex.ai/en/stable/","https://modelcontextprotocol.io/introduction"]},{name:"Retrievers",details:"Query rewriters and generative retrievers like CoRAG and HyDE enhance search by transforming user queries. Multi-vector and hybrid retrieval methods combine embeddings with keyword signals to improve recall and precision."},{name:"Memory",details:"To remember previous instructions and answers, LLMs and chatbots like ChatGPT add this history to their context window. This buffer can be improved with summarization (e.g., using a smaller LLM), a vector store + RAG, etc."},{name:"Evaluation",details:"We need to evaluate both the document retrieval (context precision and recall) and generation stages (faithfulness and answer relevancy). It can be simplified with tools Ragas and DeepEval (assessing quality).",urls:["https://github.com/explodinggradients/ragas/tree/main","https://github.com/confident-ai/deepeval"]}],resources:[{name:"Llamaindex - High-level concepts",url:"https://docs.llamaindex.ai/en/stable/getting_started/concepts.html"},{name:"Model Context Protocol",url:"https://modelcontextprotocol.io/introduction"},{name:"Pinecone - Retrieval Augmentation",url:"https://www.pinecone.io/learn/series/langchain/langchain-retrieval-augmentation/"},{name:"LangChain - Q&A with RAG",url:"https://python.langchain.com/docs/tutorials/rag/"},{name:"LangChain - Memory types",url:"https://python.langchain.com/docs/how_to/chatbots_memory/"},{name:"RAG pipeline - Metrics",url:"https://docs.ragas.io/en/stable/concepts/metrics/index.html"}]},{id:4,title:"Advanced RAG",description:"Real-life applications can require complex pipelines, including SQL or graph databases, as well as automatically selecting relevant tools and APIs. These advanced techniques can improve a baseline solution and provide additional features.",topics:[{name:"Query construction",details:"Structured data stored in traditional databases requires a specific query language like SQL, Cypher, metadata, etc. We can directly translate the user instruction into a query to access the data with query construction."},{name:"Tools",details:"Agents augment LLMs by automatically selecting the most relevant tools to provide an answer. These tools can be as simple as using Google or Wikipedia, or more complex like a Python interpreter or Jira.",urls:["https://www.pinecone.io/learn/series/langchain/langchain-agents/","https://lilianweng.github.io/posts/2023-06-23-agent/"]},{name:"Post-processing",details:"Final step that processes the inputs that are fed to the LLM. It enhances the relevance and diversity of documents retrieved with re-ranking, RAG-fusion, and classification.",urls:["https://github.com/Raudaschl/rag-fusion"]},{name:"Program LLMs",details:"Frameworks like DSPy allow you to optimize prompts and weights based on automated evaluations in a programmatic way.",urls:["https://github.com/stanfordnlp/dspy","https://dspy-docs.vercel.app/docs/building-blocks/solving_your_task"]}],resources:[{name:"LangChain - Query Construction",url:"https://blog.langchain.dev/query-construction/"},{name:"LangChain - SQL",url:"https://python.langchain.com/docs/tutorials/sql_qa/"},{name:"Pinecone - LLM agents",url:"https://www.pinecone.io/learn/series/langchain/langchain-agents/"},{name:"LLM Powered Autonomous Agents",url:"https://lilianweng.github.io/posts/2023-06-23-agent/"},{name:"LangChain - OpenAI's RAG",url:"https://blog.langchain.dev/applying-openai-rag/"},{name:"DSPy in 8 Steps",url:"https://dspy-docs.vercel.app/docs/building-blocks/solving_your_task"}]},{id:5,title:"Agents",description:"An LLM agent can autonomously perform tasks by taking actions based on reasoning about its environment, typically through the use of tools or functions to interact with external systems.",topics:[{name:"Agent fundamentals",details:"Agents operate using thoughts (internal reasoning to decide what to do next), action (executing tasks, often by interacting with external tools), and observation (analyzing feedback or results to refine the next step)."},{name:"Agent frameworks",details:"Agent development can be streamlined using different frameworks like LangGraph (design and visualization of workflows), LlamaIndex (data-augmented agents with RAG), or smolagents (beginner-friendly, lightweight option).",urls:["https://www.langchain.com/langgraph","https://docs.llamaindex.ai/en/stable/use_cases/agents/","https://github.com/huggingface/smolagents"]},{name:"Multi-agents",details:"More experimental frameworks include collaboration between different agents, such as CrewAI (role-based team orchestration), AutoGen (conversation-driven multi-agent systems), and OpenAI Agents SDK (production-ready with strong OpenAI model integration).",urls:["https://docs.crewai.com/introduction","https://github.com/microsoft/autogen","https://github.com/openai/openai-agents-python"]}],resources:[{name:"Agents Course",url:"https://huggingface.co/learn/agents-course/unit0/introduction"},{name:"AI Agents Comparison",url:"https://langfuse.com/blog/2025-03-19-ai-agent-comparison"},{name:"LangGraph",url:"https://langchain-ai.github.io/langgraph/concepts/why-langgraph/"},{name:"LlamaIndex Agents",url:"https://docs.llamaindex.ai/en/stable/use_cases/agents/"},{name:"smolagents",url:"https://huggingface.co/docs/smolagents/index"}]},{id:6,title:"Inference optimization",description:"Text generation is a costly process that requires expensive hardware. In addition to quantization, various techniques have been proposed to maximize throughput and reduce inference costs.",topics:[{name:"Flash Attention",details:"Optimization of the attention mechanism to transform its complexity from quadratic to linear, speeding up both training and inference."},{name:"Key-value cache",details:"Understand the key-value cache and the improvements introduced in Multi-Query Attention (MQA) and Grouped-Query Attention (GQA).",urls:["https://arxiv.org/abs/1911.02150","https://arxiv.org/abs/2305.13245"]},{name:"Speculative decoding",details:"Use a small model to produce drafts that are then reviewed by a larger model to speed up text generation."}],resources:[{name:"GPU Inference",url:"https://huggingface.co/docs/transformers/main/en/perf_infer_gpu_one"},{name:"LLM Inference",url:"https://www.databricks.com/blog/llm-inference-performance-engineering-best-practices"},{name:"Optimizing LLMs for Speed and Memory",url:"https://huggingface.co/docs/transformers/main/en/llm_tutorial_optimization"},{name:"Assisted Generation",url:"https://huggingface.co/blog/assisted-generation"}]},{id:7,title:"Deploying LLMs",description:"Deploying LLMs at scale is an engineering feat that can require multiple clusters of GPUs. In other scenarios, demos and local apps can be achieved with a much lower complexity.",topics:[{name:"Local deployment",details:"Privacy is an important advantage that open-source LLMs have over private ones. Local LLM servers (LM Studio, Ollama, oobabooga, kobold.cpp, etc.) capitalize on this advantage to power local apps.",urls:["https://lmstudio.ai/","https://ollama.ai/","https://github.com/oobabooga/text-generation-webui","https://github.com/LostRuins/koboldcpp"]},{name:"Demo deployment",details:"Frameworks like Gradio and Streamlit are helpful to prototype applications and share demos. You can also easily host them online using Hugging Face Spaces.",urls:["https://www.gradio.app/","https://docs.streamlit.io/","https://huggingface.co/spaces"]},{name:"Server deployment",details:"Deploy LLMs at scale requires cloud (SkyPilot) or on-prem infrastructure and often leverages optimized text generation frameworks like TGI or vLLM.",urls:["https://skypilot.readthedocs.io/en/latest/","https://github.com/huggingface/text-generation-inference","https://github.com/vllm-project/vllm/tree/main"]},{name:"Edge deployment",details:"High-performance frameworks like MLC LLM and mnn-llm can deploy LLMs in web browsers, Android, and iOS for constrained environments.",urls:["https://github.com/mlc-ai/mlc-llm","https://github.com/wangzhaode/mnn-llm/blob/master/README_en.md"]}],resources:[{name:"Streamlit - Build a basic LLM app",url:"https://docs.streamlit.io/knowledge-base/tutorials/build-conversational-apps"},{name:"HF LLM Inference Container",url:"https://huggingface.co/blog/sagemaker-huggingface-llm"},{name:"Philschmid blog",url:"https://www.philschmid.de/"},{name:"Optimizing latence",url:"https://hamel.dev/notes/llm/inference/03_inference.html"}]},{id:8,title:"Securing LLMs",description:"In addition to traditional security problems associated with software, LLMs have unique weaknesses due to the way they are trained and prompted.",topics:[{name:"Prompt hacking",details:"Different techniques related to prompt engineering, including prompt injection (additional instruction to hijack the model's answer), data/prompt leaking (retrieve its original data/prompt), and jailbreaking (craft prompts to bypass safety features)."},{name:"Backdoors",details:"Attack vectors can target the training data itself, by poisoning the training data or creating backdoors (secret triggers to change the model's behavior during inference)."},{name:"Defensive measures",details:"The best way to protect your LLM applications is to test them against these vulnerabilities (e.g., using red teaming and checks like garak) and observe them in production (with a framework like langfuse).",urls:["https://github.com/leondz/garak/","https://github.com/langfuse/langfuse"]}],resources:[{name:"OWASP LLM Top 10",url:"https://owasp.org/www-project-top-10-for-large-language-model-applications/"},{name:"Prompt Injection Primer",url:"https://github.com/jthack/PIPE"},{name:"LLM Security",url:"https://llmsecurity.net/"},{name:"Red teaming LLMs",url:"https://learn.microsoft.com/en-us/azure/ai-services/openai/concepts/red-teaming"}]}],pd=()=>{const o={title:"LLM Engineer",subtitle:"Build and deploy production-grade LLM applications",intro:"This course focuses on building and deploying production-grade LLM applications. Learn to optimize, scale, and maintain LLM applications with industry best practices.",level:"Advanced",modulesTitle:"Engineering Tracks",modulesDescription:"Comprehensive modules covering the full LLM engineering lifecycle",sections:Po};return f.jsx(ks,{courseData:o})},Zi=[{id:1,title:"Natural Language for Machine Learning",description:"Comprehensive guide on applying natural language processing techniques in machine learning, covering text processing, feature extraction, and model architectures.",pdfPath:"/resources/pdfs/1756170671202.pdf",category:"Machine Learning",date:"2025-07-05"},{id:2,title:"Python Programming Guide",description:"Comprehensive guide to Python programming, covering fundamental concepts to advanced topics including data structures, OOP, and best practices.",pdfPath:"/resources/pdfs/1755575602183.pdf",category:"Programming",date:"2025-06-05"},{id:3,title:"Mathematical Foundations of Gradient Descent and Backpropagation",description:"Comprehensive guide on mathematical foundations of gradient descent and backpropagation, covering linear algebra, calculus, and optimization techniques.",pdfPath:"/resources/pdfs/1727144999481.pdf",category:"Machine Learning",date:"2024-06-26"},{id:4,title:"SQL: Structured Query Language in Modern Data Management",description:"Comprehensive guide on SQL in modern data management.",pdfPath:"/resources/pdfs/1727490596359.pdf",category:"Database",date:"2024-06-26"},{id:5,title:"Neural Networks Solved Questions",description:"Solved questions on neural networks.",pdfPath:"/resources/pdfs/1727493473454.pdf",category:"Neural Networks",date:"2025-11-02"},{id:6,title:"Designing GraphQL APIs for Modular Table Queries Using NestJS",description:"A detailed guide on building modular GraphQL APIs with NestJS for efficient data querying.",pdfPath:"/resources/pdfs/1731868617730.pdf",category:"Programming",date:"2025-11-02"},{id:7,title:"Understanding Data Normalization in Database Design",description:"Comprehensive notes on database normalization forms and their applications.",pdfPath:"/resources/pdfs/1731361247545.pdf",category:"Database",date:"2025-11-02"},{id:8,title:"Data Structures and Algorithms (DSA) Topics",description:"Essential topics and explanations covering key DSA concepts and problem-solving techniques.",pdfPath:"/resources/pdfs/1737831281395.pdf",category:"Programming",date:"2025-11-02"},{id:9,title:"Implementation and Maintenance of MySQL Databases",description:"Best practices and procedures for implementing and maintaining MySQL databases effectively.",pdfPath:"/resources/pdfs/1731950182853.pdf",category:"Database",date:"2025-11-02"}],Ct=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),ds=[.001,0,0,.001,0,0],ts=1.35,Dt={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},Qt={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},Ze="pdfjs_internal_editor_",j={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,POPUP:16,SIGNATURE:101,COMMENT:102},V={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_THICKNESS:32,HIGHLIGHT_FREE:33,HIGHLIGHT_SHOW_ALL:34,DRAW_STEP:41},Zn={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},yt={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},Qe={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},ct={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},Ee={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},ai={ERRORS:0,WARNINGS:1,INFOS:5},Fe={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93,rawFillPath:94},yi={moveTo:0,lineTo:1,curveTo:2,closePath:3},tr={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let ji=ai.WARNINGS;function Mo(o){Number.isInteger(o)&&(ji=o)}function Ro(){return ji}function Bi(o){ji>=ai.INFOS&&console.info(`Info: ${o}`)}function B(o){ji>=ai.WARNINGS&&console.warn(`Warning: ${o}`)}function J(o){throw new Error(o)}function W(o,t){o||J(t)}function Do(o){switch(o?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function _s(o,t=null,e=null){if(!o)return null;if(e&&typeof o=="string"&&(e.addDefaultProtocol&&o.startsWith("www.")&&o.match(/\./g)?.length>=2&&(o=`http://${o}`),e.tryConvertEncoding))try{o=jo(o)}catch{}const i=t?URL.parse(o,t):URL.parse(o);return Do(i)?i:null}function Es(o,t,e=!1){const i=URL.parse(o);return i?(i.hash=t,i.href):e&&_s(o,"http://example.com")?o.split("#",1)[0]+`${t?`#${t}`:""}`:""}function z(o,t,e,i=!1){return Object.defineProperty(o,t,{value:e,enumerable:!i,configurable:!0,writable:!1}),e}const ve=(function(){function t(e,i){this.message=e,this.name=i}return t.prototype=new Error,t.constructor=t,t})();class en extends ve{constructor(t,e){super(t,"PasswordException"),this.code=e}}class es extends ve{constructor(t,e){super(t,"UnknownErrorException"),this.details=e}}class Di extends ve{constructor(t){super(t,"InvalidPDFException")}}class ti extends ve{constructor(t,e,i){super(t,"ResponseException"),this.status=e,this.missing=i}}class No extends ve{constructor(t){super(t,"FormatError")}}class se extends ve{constructor(t){super(t,"AbortException")}}function er(o){(typeof o!="object"||o?.length===void 0)&&J("Invalid argument for bytesToString");const t=o.length,e=8192;if(t<e)return String.fromCharCode.apply(null,o);const i=[];for(let s=0;s<t;s+=e){const n=Math.min(s+e,t),r=o.subarray(s,n);i.push(String.fromCharCode.apply(null,r))}return i.join("")}function oi(o){typeof o!="string"&&J("Invalid argument for stringToBytes");const t=o.length,e=new Uint8Array(t);for(let i=0;i<t;++i)e[i]=o.charCodeAt(i)&255;return e}function Io(o){return String.fromCharCode(o>>24&255,o>>16&255,o>>8&255,o&255)}function Fo(){const o=new Uint8Array(4);return o[0]=1,new Uint32Array(o.buffer,0,1)[0]===1}function Oo(){try{return new Function(""),!0}catch{return!1}}class bt{static get isLittleEndian(){return z(this,"isLittleEndian",Fo())}static get isEvalSupported(){return z(this,"isEvalSupported",Oo())}static get isOffscreenCanvasSupported(){return z(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return z(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get platform(){const{platform:t,userAgent:e}=navigator;return z(this,"platform",{isAndroid:e.includes("Android"),isLinux:t.includes("Linux"),isMac:t.includes("Mac"),isWindows:t.includes("Win"),isFirefox:e.includes("Firefox")})}static get isCSSRoundSupported(){return z(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}const is=Array.from(Array(256).keys(),o=>o.toString(16).padStart(2,"0"));class N{static makeHexColor(t,e,i){return`#${is[t]}${is[e]}${is[i]}`}static domMatrixToTransform(t){return[t.a,t.b,t.c,t.d,t.e,t.f]}static scaleMinMax(t,e){let i;t[0]?(t[0]<0&&(i=e[0],e[0]=e[2],e[2]=i),e[0]*=t[0],e[2]*=t[0],t[3]<0&&(i=e[1],e[1]=e[3],e[3]=i),e[1]*=t[3],e[3]*=t[3]):(i=e[0],e[0]=e[1],e[1]=i,i=e[2],e[2]=e[3],e[3]=i,t[1]<0&&(i=e[1],e[1]=e[3],e[3]=i),e[1]*=t[1],e[3]*=t[1],t[2]<0&&(i=e[0],e[0]=e[2],e[2]=i),e[0]*=t[2],e[2]*=t[2]),e[0]+=t[4],e[1]+=t[5],e[2]+=t[4],e[3]+=t[5]}static transform(t,e){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],t[0]*e[4]+t[2]*e[5]+t[4],t[1]*e[4]+t[3]*e[5]+t[5]]}static multiplyByDOMMatrix(t,e){return[t[0]*e.a+t[2]*e.b,t[1]*e.a+t[3]*e.b,t[0]*e.c+t[2]*e.d,t[1]*e.c+t[3]*e.d,t[0]*e.e+t[2]*e.f+t[4],t[1]*e.e+t[3]*e.f+t[5]]}static applyTransform(t,e,i=0){const s=t[i],n=t[i+1];t[i]=s*e[0]+n*e[2]+e[4],t[i+1]=s*e[1]+n*e[3]+e[5]}static applyTransformToBezier(t,e,i=0){const s=e[0],n=e[1],r=e[2],a=e[3],l=e[4],c=e[5];for(let h=0;h<6;h+=2){const d=t[i+h],u=t[i+h+1];t[i+h]=d*s+u*r+l,t[i+h+1]=d*n+u*a+c}}static applyInverseTransform(t,e){const i=t[0],s=t[1],n=e[0]*e[3]-e[1]*e[2];t[0]=(i*e[3]-s*e[2]+e[2]*e[5]-e[4]*e[3])/n,t[1]=(-i*e[1]+s*e[0]+e[4]*e[1]-e[5]*e[0])/n}static axialAlignedBoundingBox(t,e,i){const s=e[0],n=e[1],r=e[2],a=e[3],l=e[4],c=e[5],h=t[0],d=t[1],u=t[2],p=t[3];let m=s*h+l,g=m,y=s*u+l,b=y,v=a*d+c,w=v,A=a*p+c,x=A;if(n!==0||r!==0){const S=n*h,k=n*u,_=r*d,E=r*p;m+=_,b+=_,y+=E,g+=E,v+=S,x+=S,A+=k,w+=k}i[0]=Math.min(i[0],m,y,g,b),i[1]=Math.min(i[1],v,A,w,x),i[2]=Math.max(i[2],m,y,g,b),i[3]=Math.max(i[3],v,A,w,x)}static inverseTransform(t){const e=t[0]*t[3]-t[1]*t[2];return[t[3]/e,-t[1]/e,-t[2]/e,t[0]/e,(t[2]*t[5]-t[4]*t[3])/e,(t[4]*t[1]-t[5]*t[0])/e]}static singularValueDecompose2dScale(t,e){const i=t[0],s=t[1],n=t[2],r=t[3],a=i**2+s**2,l=i*n+s*r,c=n**2+r**2,h=(a+c)/2,d=Math.sqrt(h**2-(a*c-l**2));e[0]=Math.sqrt(h+d||1),e[1]=Math.sqrt(h-d||1)}static normalizeRect(t){const e=t.slice(0);return t[0]>t[2]&&(e[0]=t[2],e[2]=t[0]),t[1]>t[3]&&(e[1]=t[3],e[3]=t[1]),e}static intersect(t,e){const i=Math.max(Math.min(t[0],t[2]),Math.min(e[0],e[2])),s=Math.min(Math.max(t[0],t[2]),Math.max(e[0],e[2]));if(i>s)return null;const n=Math.max(Math.min(t[1],t[3]),Math.min(e[1],e[3])),r=Math.min(Math.max(t[1],t[3]),Math.max(e[1],e[3]));return n>r?null:[i,n,s,r]}static pointBoundingBox(t,e,i){i[0]=Math.min(i[0],t),i[1]=Math.min(i[1],e),i[2]=Math.max(i[2],t),i[3]=Math.max(i[3],e)}static rectBoundingBox(t,e,i,s,n){n[0]=Math.min(n[0],t,i),n[1]=Math.min(n[1],e,s),n[2]=Math.max(n[2],t,i),n[3]=Math.max(n[3],e,s)}static#t(t,e,i,s,n,r,a,l,c,h){if(c<=0||c>=1)return;const d=1-c,u=c*c,p=u*c,m=d*(d*(d*t+3*c*e)+3*u*i)+p*s,g=d*(d*(d*n+3*c*r)+3*u*a)+p*l;h[0]=Math.min(h[0],m),h[1]=Math.min(h[1],g),h[2]=Math.max(h[2],m),h[3]=Math.max(h[3],g)}static#e(t,e,i,s,n,r,a,l,c,h,d,u){if(Math.abs(c)<1e-12){Math.abs(h)>=1e-12&&this.#t(t,e,i,s,n,r,a,l,-d/h,u);return}const p=h**2-4*d*c;if(p<0)return;const m=Math.sqrt(p),g=2*c;this.#t(t,e,i,s,n,r,a,l,(-h+m)/g,u),this.#t(t,e,i,s,n,r,a,l,(-h-m)/g,u)}static bezierBoundingBox(t,e,i,s,n,r,a,l,c){c[0]=Math.min(c[0],t,a),c[1]=Math.min(c[1],e,l),c[2]=Math.max(c[2],t,a),c[3]=Math.max(c[3],e,l),this.#e(t,i,n,a,e,s,r,l,3*(-t+3*(i-n)+a),6*(t-2*i+n),3*(i-t),c),this.#e(t,i,n,a,e,s,r,l,3*(-e+3*(s-r)+l),6*(e-2*s+r),3*(s-e),c)}}function jo(o){return decodeURIComponent(escape(o))}let ss=null,sn=null;function ir(o){return ss||(ss=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,sn=new Map([["ï¬…","Å¿t"]])),o.replaceAll(ss,(t,e,i)=>e?e.normalize("NFKC"):sn.get(i))}function Cs(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const o=new Uint8Array(32);return crypto.getRandomValues(o),er(o)}const Ts="pdfjs_internal_id_";function Bo(o,t,e){if(!Array.isArray(e)||e.length<2)return!1;const[i,s,...n]=e;if(!o(i)&&!Number.isInteger(i)||!t(s))return!1;const r=n.length;let a=!0;switch(s.name){case"XYZ":if(r<2||r>3)return!1;break;case"Fit":case"FitB":return r===0;case"FitH":case"FitBH":case"FitV":case"FitBV":if(r>1)return!1;break;case"FitR":if(r!==4)return!1;a=!1;break;default:return!1}for(const l of n)if(!(typeof l=="number"||a&&l===null))return!1;return!0}function xt(o,t,e){return Math.min(Math.max(o,t),e)}function sr(o){return Uint8Array.prototype.toBase64?o.toBase64():btoa(er(o))}function Ho(o){return Uint8Array.fromBase64?Uint8Array.fromBase64(o):oi(atob(o))}typeof Promise.try!="function"&&(Promise.try=function(o,...t){return new Promise(e=>{e(o(...t))})});typeof Math.sumPrecise!="function"&&(Math.sumPrecise=function(o){return o.reduce((t,e)=>t+e,0)});class ei{static textContent(t){const e=[],i={items:e,styles:Object.create(null)};function s(n){if(!n)return;let r=null;const a=n.name;if(a==="#text")r=n.value;else if(ei.shouldBuildText(a))n?.attributes?.textContent?r=n.attributes.textContent:n.value&&(r=n.value);else return;if(r!==null&&e.push({str:r}),!!n.children)for(const l of n.children)s(l)}return s(t),i}static shouldBuildText(t){return!(t==="textarea"||t==="input"||t==="option"||t==="select")}}class Ls{static setupStorage(t,e,i,s,n){const r=s.getValue(e,{value:null});switch(i.name){case"textarea":if(r.value!==null&&(t.textContent=r.value),n==="print")break;t.addEventListener("input",a=>{s.setValue(e,{value:a.target.value})});break;case"input":if(i.attributes.type==="radio"||i.attributes.type==="checkbox"){if(r.value===i.attributes.xfaOn?t.setAttribute("checked",!0):r.value===i.attributes.xfaOff&&t.removeAttribute("checked"),n==="print")break;t.addEventListener("change",a=>{s.setValue(e,{value:a.target.checked?a.target.getAttribute("xfaOn"):a.target.getAttribute("xfaOff")})})}else{if(r.value!==null&&t.setAttribute("value",r.value),n==="print")break;t.addEventListener("input",a=>{s.setValue(e,{value:a.target.value})})}break;case"select":if(r.value!==null){t.setAttribute("value",r.value);for(const a of i.children)a.attributes.value===r.value?a.attributes.selected=!0:a.attributes.hasOwnProperty("selected")&&delete a.attributes.selected}t.addEventListener("input",a=>{const l=a.target.options,c=l.selectedIndex===-1?"":l[l.selectedIndex].value;s.setValue(e,{value:c})});break}}static setAttributes({html:t,element:e,storage:i=null,intent:s,linkService:n}){const{attributes:r}=e,a=t instanceof HTMLAnchorElement;r.type==="radio"&&(r.name=`${r.name}-${s}`);for(const[l,c]of Object.entries(r))if(c!=null)switch(l){case"class":c.length&&t.setAttribute(l,c.join(" "));break;case"dataId":break;case"id":t.setAttribute("data-element-id",c);break;case"style":Object.assign(t.style,c);break;case"textContent":t.textContent=c;break;default:(!a||l!=="href"&&l!=="newWindow")&&t.setAttribute(l,c)}a&&n.addLinkAttributes(t,r.href,r.newWindow),i&&r.dataId&&this.setupStorage(t,r.dataId,e,i)}static render(t){const e=t.annotationStorage,i=t.linkService,s=t.xfaHtml,n=t.intent||"display",r=document.createElement(s.name);s.attributes&&this.setAttributes({html:r,element:s,intent:n,linkService:i});const a=n!=="richText",l=t.div;if(l.append(r),t.viewport){const d=`matrix(${t.viewport.transform.join(",")})`;l.style.transform=d}a&&l.setAttribute("class","xfaLayer xfaFont");const c=[];if(s.children.length===0){if(s.value){const d=document.createTextNode(s.value);r.append(d),a&&ei.shouldBuildText(s.name)&&c.push(d)}return{textDivs:c}}const h=[[s,-1,r]];for(;h.length>0;){const[d,u,p]=h.at(-1);if(u+1===d.children.length){h.pop();continue}const m=d.children[++h.at(-1)[1]];if(m===null)continue;const{name:g}=m;if(g==="#text"){const b=document.createTextNode(m.value);c.push(b),p.append(b);continue}const y=m?.attributes?.xmlns?document.createElementNS(m.attributes.xmlns,g):document.createElement(g);if(p.append(y),m.attributes&&this.setAttributes({html:y,element:m,storage:e,intent:n,linkService:i}),m.children?.length>0)h.push([m,-1,y]);else if(m.value){const b=document.createTextNode(m.value);a&&ei.shouldBuildText(g)&&c.push(b),y.append(b)}}for(const d of l.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))d.setAttribute("readOnly",!0);return{textDivs:c}}static update(t){const e=`matrix(${t.viewport.transform.join(",")})`;t.div.style.transform=e,t.div.hidden=!1}}const te="http://www.w3.org/2000/svg";class be{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}async function Be(o,t="text"){if(qe(o,document.baseURI)){const e=await fetch(o);if(!e.ok)throw new Error(e.statusText);switch(t){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"json":return e.json()}return e.text()}return new Promise((e,i)=>{const s=new XMLHttpRequest;s.open("GET",o,!0),s.responseType=t,s.onreadystatechange=()=>{if(s.readyState===XMLHttpRequest.DONE){if(s.status===200||s.status===0){switch(t){case"arraybuffer":case"blob":case"json":e(s.response);return}e(s.responseText);return}i(new Error(s.statusText))}},s.send(null)})}class li{constructor({viewBox:t,userUnit:e,scale:i,rotation:s,offsetX:n=0,offsetY:r=0,dontFlip:a=!1}){this.viewBox=t,this.userUnit=e,this.scale=i,this.rotation=s,this.offsetX=n,this.offsetY=r,i*=e;const l=(t[2]+t[0])/2,c=(t[3]+t[1])/2;let h,d,u,p;switch(s%=360,s<0&&(s+=360),s){case 180:h=-1,d=0,u=0,p=1;break;case 90:h=0,d=1,u=1,p=0;break;case 270:h=0,d=-1,u=-1,p=0;break;case 0:h=1,d=0,u=0,p=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}a&&(u=-u,p=-p);let m,g,y,b;h===0?(m=Math.abs(c-t[1])*i+n,g=Math.abs(l-t[0])*i+r,y=(t[3]-t[1])*i,b=(t[2]-t[0])*i):(m=Math.abs(l-t[0])*i+n,g=Math.abs(c-t[1])*i+r,y=(t[2]-t[0])*i,b=(t[3]-t[1])*i),this.transform=[h*i,d*i,u*i,p*i,m-h*i*l-u*i*c,g-d*i*l-p*i*c],this.width=y,this.height=b}get rawDims(){const t=this.viewBox;return z(this,"rawDims",{pageWidth:t[2]-t[0],pageHeight:t[3]-t[1],pageX:t[0],pageY:t[1]})}clone({scale:t=this.scale,rotation:e=this.rotation,offsetX:i=this.offsetX,offsetY:s=this.offsetY,dontFlip:n=!1}={}){return new li({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:t,rotation:e,offsetX:i,offsetY:s,dontFlip:n})}convertToViewportPoint(t,e){const i=[t,e];return N.applyTransform(i,this.transform),i}convertToViewportRectangle(t){const e=[t[0],t[1]];N.applyTransform(e,this.transform);const i=[t[2],t[3]];return N.applyTransform(i,this.transform),[e[0],e[1],i[0],i[1]]}convertToPdfPoint(t,e){const i=[t,e];return N.applyInverseTransform(i,this.transform),i}}class Hi extends ve{constructor(t,e=0){super(t,"RenderingCancelledException"),this.extraDelay=e}}function ci(o){const t=o.length;let e=0;for(;e<t&&o[e].trim()==="";)e++;return o.substring(e,e+5).toLowerCase()==="data:"}function Ui(o){return typeof o=="string"&&/\.pdf$/i.test(o)}function nr(o){return[o]=o.split(/[#?]/,1),o.substring(o.lastIndexOf("/")+1)}function rr(o,t="document.pdf"){if(typeof o!="string")return t;if(ci(o))return B('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),t;const i=(a=>{try{return new URL(a)}catch{try{return new URL(decodeURIComponent(a))}catch{try{return new URL(a,"https://foo.bar")}catch{try{return new URL(decodeURIComponent(a),"https://foo.bar")}catch{return null}}}}})(o);if(!i)return t;const s=a=>{try{let l=decodeURIComponent(a);return l.includes("/")?(l=l.split("/").at(-1),l.test(/^\.pdf$/i)?l:a):l}catch{return a}},n=/\.pdf$/i,r=i.pathname.split("/").at(-1);if(n.test(r))return s(r);if(i.searchParams.size>0){const a=Array.from(i.searchParams.values()).reverse();for(const c of a)if(n.test(c))return s(c);const l=Array.from(i.searchParams.keys()).reverse();for(const c of l)if(n.test(c))return s(c)}if(i.hash){const l=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i.exec(i.hash);if(l)return s(l[0])}return t}class nn{started=Object.create(null);times=[];time(t){t in this.started&&B(`Timer is already running for ${t}`),this.started[t]=Date.now()}timeEnd(t){t in this.started||B(`Timer has not been started for ${t}`),this.times.push({name:t,start:this.started[t],end:Date.now()}),delete this.started[t]}toString(){const t=[];let e=0;for(const{name:i}of this.times)e=Math.max(i.length,e);for(const{name:i,start:s,end:n}of this.times)t.push(`${i.padEnd(e)} ${n-s}ms
`);return t.join("")}}function qe(o,t){const e=t?URL.parse(o,t):URL.parse(o);return e?.protocol==="http:"||e?.protocol==="https:"}function Ft(o){o.preventDefault()}function ot(o){o.preventDefault(),o.stopPropagation()}function Uo(o){console.log("Deprecated API usage: "+o)}class Ni{static#t;static toDateObject(t){if(t instanceof Date)return t;if(!t||typeof t!="string")return null;this.#t||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");const e=this.#t.exec(t);if(!e)return null;const i=parseInt(e[1],10);let s=parseInt(e[2],10);s=s>=1&&s<=12?s-1:0;let n=parseInt(e[3],10);n=n>=1&&n<=31?n:1;let r=parseInt(e[4],10);r=r>=0&&r<=23?r:0;let a=parseInt(e[5],10);a=a>=0&&a<=59?a:0;let l=parseInt(e[6],10);l=l>=0&&l<=59?l:0;const c=e[7]||"Z";let h=parseInt(e[8],10);h=h>=0&&h<=23?h:0;let d=parseInt(e[9],10)||0;return d=d>=0&&d<=59?d:0,c==="-"?(r+=h,a+=d):c==="+"&&(r-=h,a-=d),new Date(Date.UTC(i,s,n,r,a,l))}}function ar(o,{scale:t=1,rotation:e=0}){const{width:i,height:s}=o.attributes.style,n=[0,0,parseInt(i),parseInt(s)];return new li({viewBox:n,userUnit:1,scale:t,rotation:e})}function He(o){if(o.startsWith("#")){const t=parseInt(o.slice(1),16);return[(t&16711680)>>16,(t&65280)>>8,t&255]}return o.startsWith("rgb(")?o.slice(4,-1).split(",").map(t=>parseInt(t)):o.startsWith("rgba(")?o.slice(5,-1).split(",").map(t=>parseInt(t)).slice(0,3):(B(`Not a valid color format: "${o}"`),[0,0,0])}function zo(o){const t=document.createElement("span");t.style.visibility="hidden",t.style.colorScheme="only light",document.body.append(t);for(const e of o.keys()){t.style.color=e;const i=window.getComputedStyle(t).color;o.set(e,He(i))}t.remove()}function at(o){const{a:t,b:e,c:i,d:s,e:n,f:r}=o.getTransform();return[t,e,i,s,n,r]}function Wt(o){const{a:t,b:e,c:i,d:s,e:n,f:r}=o.getTransform().invertSelf();return[t,e,i,s,n,r]}function ce(o,t,e=!1,i=!0){if(t instanceof li){const{pageWidth:s,pageHeight:n}=t.rawDims,{style:r}=o,a=bt.isCSSRoundSupported,l=`var(--total-scale-factor) * ${s}px`,c=`var(--total-scale-factor) * ${n}px`,h=a?`round(down, ${l}, var(--scale-round-x))`:`calc(${l})`,d=a?`round(down, ${c}, var(--scale-round-y))`:`calc(${c})`;!e||t.rotation%180===0?(r.width=h,r.height=d):(r.width=d,r.height=h)}i&&o.setAttribute("data-main-rotation",t.rotation)}class zt{constructor(){const{pixelRatio:t}=zt;this.sx=t,this.sy=t}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}limitCanvas(t,e,i,s,n=-1){let r=1/0,a=1/0,l=1/0;i=zt.capPixels(i,n),i>0&&(r=Math.sqrt(i/(t*e))),s!==-1&&(a=s/t,l=s/e);const c=Math.min(r,a,l);return this.sx>c||this.sy>c?(this.sx=c,this.sy=c,!0):!1}static get pixelRatio(){return globalThis.devicePixelRatio||1}static capPixels(t,e){if(e>=0){const i=Math.ceil(window.screen.availWidth*window.screen.availHeight*this.pixelRatio**2*(1+e/100));return t>0?Math.min(t,i):i}return t}}const Ii=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];class Go{static get isDarkMode(){return z(this,"isDarkMode",!!window?.matchMedia?.("(prefers-color-scheme: dark)").matches)}}class or{static get commentForegroundColor(){const t=document.createElement("span");t.classList.add("comment","sidebar");const{style:e}=t;e.width=e.height="0",e.display="none",e.color="var(--comment-fg-color)",document.body.append(t);const{color:i}=window.getComputedStyle(t);return t.remove(),z(this,"commentForegroundColor",He(i))}}function lr(o,t,e,i){i=Math.min(Math.max(i??1,0),1);const s=255*(1-i);return o=Math.round(o*i+s),t=Math.round(t*i+s),e=Math.round(e*i+s),[o,t,e]}function rn(o,t){const e=o[0]/255,i=o[1]/255,s=o[2]/255,n=Math.max(e,i,s),r=Math.min(e,i,s),a=(n+r)/2;if(n===r)t[0]=t[1]=0;else{const l=n-r;switch(t[1]=a<.5?l/(n+r):l/(2-n-r),n){case e:t[0]=((i-s)/l+(i<s?6:0))*60;break;case i:t[0]=((s-e)/l+2)*60;break;case s:t[0]=((e-i)/l+4)*60;break}}t[2]=a}function us(o,t){const e=o[0],i=o[1],s=o[2],n=(1-Math.abs(2*s-1))*i,r=n*(1-Math.abs(e/60%2-1)),a=s-n/2;switch(Math.floor(e/60)){case 0:t[0]=n+a,t[1]=r+a,t[2]=a;break;case 1:t[0]=r+a,t[1]=n+a,t[2]=a;break;case 2:t[0]=a,t[1]=n+a,t[2]=r+a;break;case 3:t[0]=a,t[1]=r+a,t[2]=n+a;break;case 4:t[0]=r+a,t[1]=a,t[2]=n+a;break;case 5:case 6:t[0]=n+a,t[1]=a,t[2]=r+a;break}}function an(o){return o<=.03928?o/12.92:((o+.055)/1.055)**2.4}function on(o,t,e){us(o,e),e.map(an);const i=.2126*e[0]+.7152*e[1]+.0722*e[2];us(t,e),e.map(an);const s=.2126*e[0]+.7152*e[1]+.0722*e[2];return i>s?(i+.05)/(s+.05):(s+.05)/(i+.05)}const ln=new Map;function cr(o,t){const e=o[0]+o[1]*256+o[2]*65536+t[0]*16777216+t[1]*4294967296+t[2]*1099511627776;let i=ln.get(e);if(i)return i;const s=new Float32Array(9),n=s.subarray(0,3),r=s.subarray(3,6);rn(o,r);const a=s.subarray(6,9);rn(t,a);const l=a[2]<.5,c=l?12:4.5;if(r[2]=l?Math.sqrt(r[2]):1-Math.sqrt(1-r[2]),on(r,a,n)<c){let h,d;l?(h=r[2],d=1):(h=0,d=r[2]);const u=.005;for(;d-h>u;){const p=r[2]=(h+d)/2;l===on(r,a,n)<c?h=p:d=p}r[2]=l?d:h}return us(r,n),i=N.makeHexColor(Math.round(n[0]*255),Math.round(n[1]*255),Math.round(n[2]*255)),ln.set(e,i),i}function Ps({html:o,dir:t,className:e},i){const s=document.createDocumentFragment();if(typeof o=="string"){const n=document.createElement("p");n.dir=t||"auto";const r=o.split(/(?:\r\n?|\n)/);for(let a=0,l=r.length;a<l;++a){const c=r[a];n.append(document.createTextNode(c)),a<l-1&&n.append(document.createElement("br"))}s.append(n)}else Ls.render({xfaHtml:o,div:s,intent:"richText"});s.firstChild.classList.add("richText",e),i.append(s)}class Je{#t=null;#e=null;#s;#i=null;#a=null;#n=null;#r=null;#o=null;static#c=null;constructor(t){this.#s=t,Je.#c||=Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"})}render(){const t=this.#t=document.createElement("div");t.classList.add("editToolbar","hidden"),t.setAttribute("role","toolbar");const e=this.#s._uiManager._signal;e instanceof AbortSignal&&!e.aborted&&(t.addEventListener("contextmenu",Ft,{signal:e}),t.addEventListener("pointerdown",Je.#l,{signal:e}));const i=this.#i=document.createElement("div");i.className="buttons",t.append(i);const s=this.#s.toolbarPosition;if(s){const{style:n}=t,r=this.#s._uiManager.direction==="ltr"?1-s[0]:s[0];n.insetInlineEnd=`${100*r}%`,n.top=`calc(${100*s[1]}% + var(--editor-toolbar-vert-offset))`}return t}get div(){return this.#t}static#l(t){t.stopPropagation()}#u(t){this.#s._focusEventsAllowed=!1,ot(t)}#d(t){this.#s._focusEventsAllowed=!0,ot(t)}#p(t){const e=this.#s._uiManager._signal;return!(e instanceof AbortSignal)||e.aborted?!1:(t.addEventListener("focusin",this.#u.bind(this),{capture:!0,signal:e}),t.addEventListener("focusout",this.#d.bind(this),{capture:!0,signal:e}),t.addEventListener("contextmenu",Ft,{signal:e}),!0)}hide(){this.#t.classList.add("hidden"),this.#e?.hideDropdown()}show(){this.#t.classList.remove("hidden"),this.#a?.shown(),this.#n?.shown()}addDeleteButton(){const{editorType:t,_uiManager:e}=this.#s,i=document.createElement("button");i.classList.add("basic","deleteButton"),i.tabIndex=0,i.setAttribute("data-l10n-id",Je.#c[t]),this.#p(i)&&i.addEventListener("click",s=>{e.delete()},{signal:e._signal}),this.#i.append(i)}get#m(){const t=document.createElement("div");return t.className="divider",t}async addAltText(t){const e=await t.render();this.#p(e),this.#i.append(e,this.#m),this.#a=t}addComment(t,e=null){if(this.#n)return;const i=t.renderForToolbar();if(!i)return;this.#p(i);const s=this.#r=this.#m;e?(this.#i.insertBefore(i,e),this.#i.insertBefore(s,e)):this.#i.append(i,s),this.#n=t,t.toolbar=this}addColorPicker(t){if(this.#e)return;this.#e=t;const e=t.renderButton();this.#p(e),this.#i.append(e,this.#m)}async addEditSignatureButton(t){const e=this.#o=await t.renderEditButton(this.#s);this.#p(e),this.#i.append(e,this.#m)}removeButton(t){switch(t){case"comment":this.#n?.removeToolbarCommentButton(),this.#n=null,this.#r?.remove(),this.#r=null;break}}async addButton(t,e){switch(t){case"colorPicker":this.addColorPicker(e);break;case"altText":await this.addAltText(e);break;case"editSignature":await this.addEditSignatureButton(e);break;case"delete":this.addDeleteButton();break;case"comment":this.addComment(e);break}}async addButtonBefore(t,e,i){const s=this.#i.querySelector(i);s&&t==="comment"&&this.addComment(e,s)}updateEditSignatureButton(t){this.#o&&(this.#o.title=t)}remove(){this.#t.remove(),this.#e?.destroy(),this.#e=null}}class $o{#t=null;#e=null;#s;constructor(t){this.#s=t}#i(){const t=this.#e=document.createElement("div");t.className="editToolbar",t.setAttribute("role","toolbar");const e=this.#s._signal;e instanceof AbortSignal&&!e.aborted&&t.addEventListener("contextmenu",Ft,{signal:e});const i=this.#t=document.createElement("div");return i.className="buttons",t.append(i),this.#s.hasCommentManager()&&this.#n("commentButton","pdfjs-comment-floating-button","pdfjs-comment-floating-button-label",()=>{this.#s.commentSelection("floating_button")}),this.#n("highlightButton","pdfjs-highlight-floating-button1","pdfjs-highlight-floating-button-label",()=>{this.#s.highlightSelection("floating_button")}),t}#a(t,e){let i=0,s=0;for(const n of t){const r=n.y+n.height;if(r<i)continue;const a=n.x+(e?n.width:0);if(r>i){s=a,i=r;continue}e?a>s&&(s=a):a<s&&(s=a)}return[e?1-s:s,i]}show(t,e,i){const[s,n]=this.#a(e,i),{style:r}=this.#e||=this.#i();t.append(this.#e),r.insetInlineEnd=`${100*s}%`,r.top=`calc(${100*n}% + var(--editor-toolbar-vert-offset))`}hide(){this.#e.remove()}#n(t,e,i,s){const n=document.createElement("button");n.classList.add("basic",t),n.tabIndex=0,n.setAttribute("data-l10n-id",e);const r=document.createElement("span");n.append(r),r.className="visuallyHidden",r.setAttribute("data-l10n-id",i);const a=this.#s._signal;a instanceof AbortSignal&&!a.aborted&&(n.addEventListener("contextmenu",Ft,{signal:a}),n.addEventListener("click",s,{signal:a})),this.#t.append(n)}}function hr(o,t,e){for(const i of e)t.addEventListener(i,o[i].bind(o))}class Vo{#t=0;get id(){return`${Ze}${this.#t++}`}}class Ms{#t=Cs();#e=0;#s=null;static get _isSVGFittingCanvas(){const t='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',i=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),s=new Image;s.src=t;const n=s.decode().then(()=>(i.drawImage(s,0,0,1,1,0,0,1,3),new Uint32Array(i.getImageData(0,0,1,1).data.buffer)[0]===0));return z(this,"_isSVGFittingCanvas",n)}async#i(t,e){this.#s||=new Map;let i=this.#s.get(t);if(i===null)return null;if(i?.bitmap)return i.refCounter+=1,i;try{i||={bitmap:null,id:`image_${this.#t}_${this.#e++}`,refCounter:0,isSvg:!1};let s;if(typeof e=="string"?(i.url=e,s=await Be(e,"blob")):e instanceof File?s=i.file=e:e instanceof Blob&&(s=e),s.type==="image/svg+xml"){const n=Ms._isSVGFittingCanvas,r=new FileReader,a=new Image,l=new Promise((c,h)=>{a.onload=()=>{i.bitmap=a,i.isSvg=!0,c()},r.onload=async()=>{const d=i.svgUrl=r.result;a.src=await n?`${d}#svgView(preserveAspectRatio(none))`:d},a.onerror=r.onerror=h});r.readAsDataURL(s),await l}else i.bitmap=await createImageBitmap(s);i.refCounter=1}catch(s){B(s),i=null}return this.#s.set(t,i),i&&this.#s.set(i.id,i),i}async getFromFile(t){const{lastModified:e,name:i,size:s,type:n}=t;return this.#i(`${e}_${i}_${s}_${n}`,t)}async getFromUrl(t){return this.#i(t,t)}async getFromBlob(t,e){const i=await e;return this.#i(t,i)}async getFromId(t){this.#s||=new Map;const e=this.#s.get(t);if(!e)return null;if(e.bitmap)return e.refCounter+=1,e;if(e.file)return this.getFromFile(e.file);if(e.blobPromise){const{blobPromise:i}=e;return delete e.blobPromise,this.getFromBlob(e.id,i)}return this.getFromUrl(e.url)}getFromCanvas(t,e){this.#s||=new Map;let i=this.#s.get(t);if(i?.bitmap)return i.refCounter+=1,i;const s=new OffscreenCanvas(e.width,e.height);return s.getContext("2d").drawImage(e,0,0),i={bitmap:s.transferToImageBitmap(),id:`image_${this.#t}_${this.#e++}`,refCounter:1,isSvg:!1},this.#s.set(t,i),this.#s.set(i.id,i),i}getSvgUrl(t){const e=this.#s.get(t);return e?.isSvg?e.svgUrl:null}deleteId(t){this.#s||=new Map;const e=this.#s.get(t);if(!e||(e.refCounter-=1,e.refCounter!==0))return;const{bitmap:i}=e;if(!e.url&&!e.file){const s=new OffscreenCanvas(i.width,i.height);s.getContext("bitmaprenderer").transferFromImageBitmap(i),e.blobPromise=s.convertToBlob()}i.close?.(),e.bitmap=null}isValidId(t){return t.startsWith(`image_${this.#t}_`)}}class Wo{#t=[];#e=!1;#s;#i=-1;constructor(t=128){this.#s=t}add({cmd:t,undo:e,post:i,mustExec:s,type:n=NaN,overwriteIfSameType:r=!1,keepUndo:a=!1}){if(s&&t(),this.#e)return;const l={cmd:t,undo:e,post:i,type:n};if(this.#i===-1){this.#t.length>0&&(this.#t.length=0),this.#i=0,this.#t.push(l);return}if(r&&this.#t[this.#i].type===n){a&&(l.undo=this.#t[this.#i].undo),this.#t[this.#i]=l;return}const c=this.#i+1;c===this.#s?this.#t.splice(0,1):(this.#i=c,c<this.#t.length&&this.#t.splice(c)),this.#t.push(l)}undo(){if(this.#i===-1)return;this.#e=!0;const{undo:t,post:e}=this.#t[this.#i];t(),e?.(),this.#e=!1,this.#i-=1}redo(){if(this.#i<this.#t.length-1){this.#i+=1,this.#e=!0;const{cmd:t,post:e}=this.#t[this.#i];t(),e?.(),this.#e=!1}}hasSomethingToUndo(){return this.#i!==-1}hasSomethingToRedo(){return this.#i<this.#t.length-1}cleanType(t){if(this.#i!==-1){for(let e=this.#i;e>=0;e--)if(this.#t[e].type!==t){this.#t.splice(e+1,this.#i-e),this.#i=e;return}this.#t.length=0,this.#i=-1}}destroy(){this.#t=null}}class hi{constructor(t){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:e}=bt.platform;for(const[i,s,n={}]of t)for(const r of i){const a=r.startsWith("mac+");e&&a?(this.callbacks.set(r.slice(4),{callback:s,options:n}),this.allKeys.add(r.split("+").at(-1))):!e&&!a&&(this.callbacks.set(r,{callback:s,options:n}),this.allKeys.add(r.split("+").at(-1)))}}#t(t){t.altKey&&this.buffer.push("alt"),t.ctrlKey&&this.buffer.push("ctrl"),t.metaKey&&this.buffer.push("meta"),t.shiftKey&&this.buffer.push("shift"),this.buffer.push(t.key);const e=this.buffer.join("+");return this.buffer.length=0,e}exec(t,e){if(!this.allKeys.has(e.key))return;const i=this.callbacks.get(this.#t(e));if(!i)return;const{callback:s,options:{bubbles:n=!1,args:r=[],checker:a=null}}=i;a&&!a(t,e)||(s.bind(t,...r,e)(),n||ot(e))}}class Rs{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){const t=new Map([["CanvasText",null],["Canvas",null]]);return zo(t),z(this,"_colors",t)}convert(t){const e=He(t);if(!window.matchMedia("(forced-colors: active)").matches)return e;for(const[i,s]of this._colors)if(s.every((n,r)=>n===e[r]))return Rs._colorsMapping.get(i);return e}getHexCode(t){const e=this._colors.get(t);return e?N.makeHexColor(...e):t}}class ne{#t=new AbortController;#e=null;#s=null;#i=new Map;#a=new Map;#n=null;#r=null;#o=null;#c=new Wo;#l=null;#u=null;#d=null;#p=0;#m=new Set;#f=null;#h=null;#g=new Set;_editorUndoBar=null;#b=!1;#w=!1;#y=!1;#_=null;#S=null;#v=null;#C=null;#A=!1;#k=null;#P=new Vo;#T=!1;#L=!1;#O=!1;#R=null;#N=null;#j=null;#I=null;#$=null;#E=j.NONE;#x=new Set;#D=null;#B=null;#U=null;#q=null;#W=null;#X={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1};#z=[0,0];#F=null;#V=null;#J=null;#Z=null;#H=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){const t=ne.prototype,e=r=>r.#V.contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&r.hasSomethingToControl(),i=(r,{target:a})=>{if(a instanceof HTMLInputElement){const{type:l}=a;return l!=="text"&&l!=="number"}return!0},s=this.TRANSLATE_SMALL,n=this.TRANSLATE_BIG;return z(this,"_keyboardManager",new hi([[["ctrl+a","mac+meta+a"],t.selectAll,{checker:i}],[["ctrl+z","mac+meta+z"],t.undo,{checker:i}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],t.redo,{checker:i}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],t.delete,{checker:i}],[["Enter","mac+Enter"],t.addNewEditorFromKeyboard,{checker:(r,{target:a})=>!(a instanceof HTMLButtonElement)&&r.#V.contains(a)&&!r.isEnterHandled}],[[" ","mac+ "],t.addNewEditorFromKeyboard,{checker:(r,{target:a})=>!(a instanceof HTMLButtonElement)&&r.#V.contains(document.activeElement)}],[["Escape","mac+Escape"],t.unselectAll],[["ArrowLeft","mac+ArrowLeft"],t.translateSelectedEditors,{args:[-s,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t.translateSelectedEditors,{args:[-n,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t.translateSelectedEditors,{args:[s,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t.translateSelectedEditors,{args:[n,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t.translateSelectedEditors,{args:[0,-s],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t.translateSelectedEditors,{args:[0,-n],checker:e}],[["ArrowDown","mac+ArrowDown"],t.translateSelectedEditors,{args:[0,s],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t.translateSelectedEditors,{args:[0,n],checker:e}]]))}constructor(t,e,i,s,n,r,a,l,c,h,d,u,p,m,g,y){const b=this._signal=this.#t.signal;this.#V=t,this.#J=e,this.#Z=i,this.#n=s,this.#l=n,this.#B=r,this.#W=l,this._eventBus=a,a._on("editingaction",this.onEditingAction.bind(this),{signal:b}),a._on("pagechanging",this.onPageChanging.bind(this),{signal:b}),a._on("scalechanging",this.onScaleChanging.bind(this),{signal:b}),a._on("rotationchanging",this.onRotationChanging.bind(this),{signal:b}),a._on("setpreference",this.onSetPreference.bind(this),{signal:b}),a._on("switchannotationeditorparams",v=>this.updateParams(v.type,v.value),{signal:b}),window.addEventListener("pointerdown",()=>{this.#L=!0},{capture:!0,signal:b}),window.addEventListener("pointerup",()=>{this.#L=!1},{capture:!0,signal:b}),this.#lt(),this.#ut(),this.#et(),this.#r=l.annotationStorage,this.#_=l.filterFactory,this.#U=c,this.#C=h||null,this.#b=d,this.#w=u,this.#y=p,this.#$=m||null,this.viewParameters={realScale:be.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=g||null,this._supportsPinchToZoom=y!==!1,n?.setSidebarUiManager(this)}destroy(){this.#H?.resolve(),this.#H=null,this.#t?.abort(),this.#t=null,this._signal=null;for(const t of this.#a.values())t.destroy();this.#a.clear(),this.#i.clear(),this.#g.clear(),this.#I?.clear(),this.#e=null,this.#x.clear(),this.#c.destroy(),this.#n?.destroy(),this.#l?.destroy(),this.#B?.destroy(),this.#k?.hide(),this.#k=null,this.#j?.destroy(),this.#j=null,this.#s=null,this.#S&&(clearTimeout(this.#S),this.#S=null),this.#F&&(clearTimeout(this.#F),this.#F=null),this._editorUndoBar?.destroy(),this.#W=null}combinedSignal(t){return AbortSignal.any([this._signal,t.signal])}get mlManager(){return this.#$}get useNewAltTextFlow(){return this.#w}get useNewAltTextWhenAddingImage(){return this.#y}get hcmFilter(){return z(this,"hcmFilter",this.#U?this.#_.addHCMFilter(this.#U.foreground,this.#U.background):"none")}get direction(){return z(this,"direction",getComputedStyle(this.#V).direction)}get _highlightColors(){return z(this,"_highlightColors",this.#C?new Map(this.#C.split(",").map(t=>(t=t.split("=").map(e=>e.trim()),t[1]=t[1].toUpperCase(),t))):null)}get highlightColors(){const{_highlightColors:t}=this;if(!t)return z(this,"highlightColors",null);const e=new Map,i=!!this.#U;for(const[s,n]of t){const r=s.endsWith("_HCM");if(i&&r){e.set(s.replace("_HCM",""),n);continue}!i&&!r&&e.set(s,n)}return z(this,"highlightColors",e)}get highlightColorNames(){return z(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,t=>t.reverse())):null)}getNonHCMColor(t){if(!this._highlightColors)return t;const e=this.highlightColorNames.get(t);return this._highlightColors.get(e)||t}getNonHCMColorName(t){return this.highlightColorNames.get(t)||t}setCurrentDrawingSession(t){t?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),this.#d=t}setMainHighlightColorPicker(t){this.#j=t}editAltText(t,e=!1){this.#n?.editAltText(this,t,e)}hasCommentManager(){return!!this.#l}editComment(t,e,i,s){this.#l?.showDialog(this,t,e,i,s)}selectComment(t,e){this.#a.get(t)?.getEditorByUID(e)?.toggleComment(!0,!0)}updateComment(t){this.#l?.updateComment(t.getData())}updatePopupColor(t){this.#l?.updatePopupColor(t)}removeComment(t){this.#l?.removeComments([t.uid])}toggleComment(t,e,i=void 0){this.#l?.toggleCommentPopup(t,e,i)}makeCommentColor(t,e){return t&&this.#l?.makeCommentColor(t,e)||null}getCommentDialogElement(){return this.#l?.dialogElement||null}async waitForEditorsRendered(t){if(this.#a.has(t-1))return;const{resolve:e,promise:i}=Promise.withResolvers(),s=n=>{n.pageNumber===t&&(this._eventBus._off("editorsrendered",s),e())};this._eventBus.on("editorsrendered",s),await i}getSignature(t){this.#B?.getSignature({uiManager:this,editor:t})}get signatureManager(){return this.#B}switchToMode(t,e){this._eventBus.on("annotationeditormodechanged",e,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:t})}setPreference(t,e){this._eventBus.dispatch("setpreference",{source:this,name:t,value:e})}onSetPreference({name:t,value:e}){switch(t){case"enableNewAltTextWhenAddingImage":this.#y=e;break}}onPageChanging({pageNumber:t}){this.#p=t-1}focusMainContainer(){this.#V.focus()}findParent(t,e){for(const i of this.#a.values()){const{x:s,y:n,width:r,height:a}=i.div.getBoundingClientRect();if(t>=s&&t<=s+r&&e>=n&&e<=n+a)return i}return null}disableUserSelect(t=!1){this.#J.classList.toggle("noUserSelect",t)}addShouldRescale(t){this.#g.add(t)}removeShouldRescale(t){this.#g.delete(t)}onScaleChanging({scale:t}){this.commitOrRemove(),this.viewParameters.realScale=t*be.PDF_TO_CSS_UNITS;for(const e of this.#g)e.onScaleChanging();this.#d?.onScaleChanging()}onRotationChanging({pagesRotation:t}){this.commitOrRemove(),this.viewParameters.rotation=t}#Q({anchorNode:t}){return t.nodeType===Node.TEXT_NODE?t.parentElement:t}#tt(t){const{currentLayer:e}=this;if(e.hasTextLayer(t))return e;for(const i of this.#a.values())if(i.hasTextLayer(t))return i;return null}highlightSelection(t="",e=!1){const i=document.getSelection();if(!i||i.isCollapsed)return;const{anchorNode:s,anchorOffset:n,focusNode:r,focusOffset:a}=i,l=i.toString(),h=this.#Q(i).closest(".textLayer"),d=this.getSelectionBoxes(h);if(!d)return;i.empty();const u=this.#tt(h),p=this.#E===j.NONE,m=()=>{const g=u?.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:t,boxes:d,anchorNode:s,anchorOffset:n,focusNode:r,focusOffset:a,text:l});p&&this.showAllEditors("highlight",!0,!0),e&&g?.editComment()};if(p){this.switchToMode(j.HIGHLIGHT,m);return}m()}commentSelection(t=""){this.highlightSelection(t,!0)}#at(){const t=document.getSelection();if(!t||t.isCollapsed)return;const i=this.#Q(t).closest(".textLayer"),s=this.getSelectionBoxes(i);s&&(this.#k||=new $o(this),this.#k.show(i,s,this.direction==="ltr"))}getAndRemoveDataFromAnnotationStorage(t){if(!this.#r)return null;const e=`${Ze}${t}`,i=this.#r.getRawValue(e);return i&&this.#r.remove(e),i}addToAnnotationStorage(t){!t.isEmpty()&&this.#r&&!this.#r.has(t.id)&&this.#r.setValue(t.id,t)}a11yAlert(t,e=null){const i=this.#Z;i&&(i.setAttribute("data-l10n-id",t),e?i.setAttribute("data-l10n-args",JSON.stringify(e)):i.removeAttribute("data-l10n-args"))}#ot(){const t=document.getSelection();if(!t||t.isCollapsed){this.#D&&(this.#k?.hide(),this.#D=null,this.#M({hasSelectedText:!1}));return}const{anchorNode:e}=t;if(e===this.#D)return;const s=this.#Q(t).closest(".textLayer");if(!s){this.#D&&(this.#k?.hide(),this.#D=null,this.#M({hasSelectedText:!1}));return}if(this.#k?.hide(),this.#D=e,this.#M({hasSelectedText:!0}),!(this.#E!==j.HIGHLIGHT&&this.#E!==j.NONE)&&(this.#E===j.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),this.#A=this.isShiftKeyDown,!this.isShiftKeyDown)){const n=this.#E===j.HIGHLIGHT?this.#tt(s):null;if(n?.toggleDrawing(),this.#L){const r=new AbortController,a=this.combinedSignal(r),l=c=>{c.type==="pointerup"&&c.button!==0||(r.abort(),n?.toggleDrawing(!0),c.type==="pointerup"&&this.#Y("main_toolbar"))};window.addEventListener("pointerup",l,{signal:a}),window.addEventListener("blur",l,{signal:a})}else n?.toggleDrawing(!0),this.#Y("main_toolbar")}}#Y(t=""){this.#E===j.HIGHLIGHT?this.highlightSelection(t):this.#b&&this.#at()}#lt(){document.addEventListener("selectionchange",this.#ot.bind(this),{signal:this._signal})}#ct(){if(this.#v)return;this.#v=new AbortController;const t=this.combinedSignal(this.#v);window.addEventListener("focus",this.focus.bind(this),{signal:t}),window.addEventListener("blur",this.blur.bind(this),{signal:t})}#ht(){this.#v?.abort(),this.#v=null}blur(){if(this.isShiftKeyDown=!1,this.#A&&(this.#A=!1,this.#Y("main_toolbar")),!this.hasSelection)return;const{activeElement:t}=document;for(const e of this.#x)if(e.div.contains(t)){this.#N=[e,t],e._focusEventsAllowed=!1;break}}focus(){if(!this.#N)return;const[t,e]=this.#N;this.#N=null,e.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this._signal}),e.focus()}#et(){if(this.#R)return;this.#R=new AbortController;const t=this.combinedSignal(this.#R);window.addEventListener("keydown",this.keydown.bind(this),{signal:t}),window.addEventListener("keyup",this.keyup.bind(this),{signal:t})}#dt(){this.#R?.abort(),this.#R=null}#it(){if(this.#u)return;this.#u=new AbortController;const t=this.combinedSignal(this.#u);document.addEventListener("copy",this.copy.bind(this),{signal:t}),document.addEventListener("cut",this.cut.bind(this),{signal:t}),document.addEventListener("paste",this.paste.bind(this),{signal:t})}#st(){this.#u?.abort(),this.#u=null}#ut(){const t=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:t}),document.addEventListener("drop",this.drop.bind(this),{signal:t})}addEditListeners(){this.#et(),this.#it()}removeEditListeners(){this.#dt(),this.#st()}dragOver(t){for(const{type:e}of t.dataTransfer.items)for(const i of this.#h)if(i.isHandlingMimeForPasting(e)){t.dataTransfer.dropEffect="copy",t.preventDefault();return}}drop(t){for(const e of t.dataTransfer.items)for(const i of this.#h)if(i.isHandlingMimeForPasting(e.type)){i.paste(e,this.currentLayer),t.preventDefault();return}}copy(t){if(t.preventDefault(),this.#e?.commitOrRemove(),!this.hasSelection)return;const e=[];for(const i of this.#x){const s=i.serialize(!0);s&&e.push(s)}e.length!==0&&t.clipboardData.setData("application/pdfjs",JSON.stringify(e))}cut(t){this.copy(t),this.delete()}async paste(t){t.preventDefault();const{clipboardData:e}=t;for(const n of e.items)for(const r of this.#h)if(r.isHandlingMimeForPasting(n.type)){r.paste(n,this.currentLayer);return}let i=e.getData("application/pdfjs");if(!i)return;try{i=JSON.parse(i)}catch(n){B(`paste: "${n.message}".`);return}if(!Array.isArray(i))return;this.unselectAll();const s=this.currentLayer;try{const n=[];for(const l of i){const c=await s.deserialize(l);if(!c)return;n.push(c)}const r=()=>{for(const l of n)this.#nt(l);this.#rt(n)},a=()=>{for(const l of n)l.remove()};this.addCommands({cmd:r,undo:a,mustExec:!0})}catch(n){B(`paste: "${n.message}".`)}}keydown(t){!this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!0),this.#E!==j.NONE&&!this.isEditorHandlingKeyboard&&ne._keyboardManager.exec(this,t)}keyup(t){this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!1,this.#A&&(this.#A=!1,this.#Y("main_toolbar")))}onEditingAction({name:t}){switch(t){case"undo":case"redo":case"delete":case"selectAll":this[t]();break;case"highlightSelection":this.highlightSelection("context_menu");break;case"commentSelection":this.commentSelection("context_menu");break}}#M(t){Object.entries(t).some(([i,s])=>this.#X[i]!==s)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#X,t)}),this.#E===j.HIGHLIGHT&&t.hasSelectedEditor===!1&&this.#G([[V.HIGHLIGHT_FREE,!0]]))}#G(t){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:t})}setEditingState(t){t?(this.#ct(),this.#it(),this.#M({isEditing:this.#E!==j.NONE,isEmpty:this.#K(),hasSomethingToUndo:this.#c.hasSomethingToUndo(),hasSomethingToRedo:this.#c.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#ht(),this.#st(),this.#M({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(t){if(!this.#h){this.#h=t;for(const e of this.#h)this.#G(e.defaultPropertiesToUpdate)}}getId(){return this.#P.id}get currentLayer(){return this.#a.get(this.#p)}getLayer(t){return this.#a.get(t)}get currentPageIndex(){return this.#p}addLayer(t){this.#a.set(t.pageIndex,t),this.#T?t.enable():t.disable()}removeLayer(t){this.#a.delete(t.pageIndex)}async updateMode(t,e=null,i=!1,s=!1,n=!1){if(this.#E!==t&&!(this.#H&&(await this.#H.promise,!this.#H))){if(this.#H=Promise.withResolvers(),this.#d?.commitOrRemove(),this.#E===j.POPUP&&this.#l?.hideSidebar(),this.#l?.destroyPopup(),this.#E=t,t===j.NONE){this.setEditingState(!1),this.#ft();for(const r of this.#i.values())r.hideStandaloneCommentButton();this._editorUndoBar?.hide(),this.toggleComment(null),this.#H.resolve();return}for(const r of this.#i.values())r.addStandaloneCommentButton();t===j.SIGNATURE&&await this.#B?.loadSignatures(),this.setEditingState(!0),await this.#pt(),this.unselectAll();for(const r of this.#a.values())r.updateMode(t);if(t===j.POPUP){this.#s||=await this.#W.getAnnotationsByType(new Set(this.#h.map(l=>l._editorType)));const r=new Set,a=[];for(const l of this.#i.values()){const{annotationElementId:c,hasComment:h,deleted:d}=l;c&&r.add(c),h&&!d&&a.push(l.getData())}for(const l of this.#s){const{id:c,popupRef:h,contentsObj:d}=l;h&&d?.str&&!r.has(c)&&!this.#m.has(c)&&a.push(l)}this.#l?.showSidebar(a)}if(!e){i&&this.addNewEditorFromKeyboard(),this.#H.resolve();return}for(const r of this.#i.values())r.uid===e?(this.setSelected(r),n?r.editComment():s?r.enterInEditMode():r.focus()):r.unselect();this.#H.resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(t){t.mode!==this.#E&&this._eventBus.dispatch("switchannotationeditormode",{source:this,...t})}updateParams(t,e){if(this.#h){switch(t){case V.CREATE:this.currentLayer.addNewEditor(e);return;case V.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(this.#q||=new Map).set(t,e),this.showAllEditors("highlight",e);break}if(this.hasSelection)for(const i of this.#x)i.updateParams(t,e);else for(const i of this.#h)i.updateDefaultParams(t,e)}}showAllEditors(t,e,i=!1){for(const n of this.#i.values())n.editorType===t&&n.show(e);(this.#q?.get(V.HIGHLIGHT_SHOW_ALL)??!0)!==e&&this.#G([[V.HIGHLIGHT_SHOW_ALL,e]])}enableWaiting(t=!1){if(this.#O!==t){this.#O=t;for(const e of this.#a.values())t?e.disableClick():e.enableClick(),e.div.classList.toggle("waiting",t)}}async#pt(){if(!this.#T){this.#T=!0;const t=[];for(const e of this.#a.values())t.push(e.enable());await Promise.all(t);for(const e of this.#i.values())e.enable()}}#ft(){if(this.unselectAll(),this.#T){this.#T=!1;for(const t of this.#a.values())t.disable();for(const t of this.#i.values())t.disable()}}*getEditors(t){for(const e of this.#i.values())e.pageIndex===t&&(yield e)}getEditor(t){return this.#i.get(t)}addEditor(t){this.#i.set(t.id,t)}removeEditor(t){t.div.contains(document.activeElement)&&(this.#S&&clearTimeout(this.#S),this.#S=setTimeout(()=>{this.focusMainContainer(),this.#S=null},0)),this.#i.delete(t.id),t.annotationElementId&&this.#I?.delete(t.annotationElementId),this.unselect(t),(!t.annotationElementId||!this.#m.has(t.annotationElementId))&&this.#r?.remove(t.id)}addDeletedAnnotationElement(t){this.#m.add(t.annotationElementId),this.addChangedExistingAnnotation(t),t.deleted=!0}isDeletedAnnotationElement(t){return this.#m.has(t)}removeDeletedAnnotationElement(t){this.#m.delete(t.annotationElementId),this.removeChangedExistingAnnotation(t),t.deleted=!1}#nt(t){const e=this.#a.get(t.pageIndex);e?e.addOrRebuild(t):(this.addEditor(t),this.addToAnnotationStorage(t))}setActiveEditor(t){this.#e!==t&&(this.#e=t,t&&this.#G(t.propertiesToUpdate))}get#gt(){let t=null;for(t of this.#x);return t}updateUI(t){this.#gt===t&&this.#G(t.propertiesToUpdate)}updateUIForDefaultProperties(t){this.#G(t.defaultPropertiesToUpdate)}toggleSelected(t){if(this.#x.has(t)){this.#x.delete(t),t.unselect(),this.#M({hasSelectedEditor:this.hasSelection});return}this.#x.add(t),t.select(),this.#G(t.propertiesToUpdate),this.#M({hasSelectedEditor:!0})}setSelected(t){this.updateToolbar({mode:t.mode,editId:t.id}),this.#d?.commitOrRemove();for(const e of this.#x)e!==t&&e.unselect();this.#x.clear(),this.#x.add(t),t.select(),this.#G(t.propertiesToUpdate),this.#M({hasSelectedEditor:!0})}isSelected(t){return this.#x.has(t)}get firstSelectedEditor(){return this.#x.values().next().value}unselect(t){t.unselect(),this.#x.delete(t),this.#M({hasSelectedEditor:this.hasSelection})}get hasSelection(){return this.#x.size!==0}get isEnterHandled(){return this.#x.size===1&&this.firstSelectedEditor.isEnterHandled}undo(){this.#c.undo(),this.#M({hasSomethingToUndo:this.#c.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#K()}),this._editorUndoBar?.hide()}redo(){this.#c.redo(),this.#M({hasSomethingToUndo:!0,hasSomethingToRedo:this.#c.hasSomethingToRedo(),isEmpty:this.#K()})}addCommands(t){this.#c.add(t),this.#M({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#K()})}cleanUndoStack(t){this.#c.cleanType(t)}#K(){if(this.#i.size===0)return!0;if(this.#i.size===1)for(const t of this.#i.values())return t.isEmpty();return!1}delete(){this.commitOrRemove();const t=this.currentLayer?.endDrawingSession(!0);if(!this.hasSelection&&!t)return;const e=t?[t]:[...this.#x],i=()=>{this._editorUndoBar?.show(s,e.length===1?e[0].editorType:e.length);for(const n of e)n.remove()},s=()=>{for(const n of e)this.#nt(n)};this.addCommands({cmd:i,undo:s,mustExec:!0})}commitOrRemove(){this.#e?.commitOrRemove()}hasSomethingToControl(){return this.#e||this.hasSelection}#rt(t){for(const e of this.#x)e.unselect();this.#x.clear();for(const e of t)e.isEmpty()||(this.#x.add(e),e.select());this.#M({hasSelectedEditor:this.hasSelection})}selectAll(){for(const t of this.#x)t.commit();this.#rt(this.#i.values())}unselectAll(){if(!(this.#e&&(this.#e.commitOrRemove(),this.#E!==j.NONE))&&!this.#d?.commitOrRemove()&&this.hasSelection){for(const t of this.#x)t.unselect();this.#x.clear(),this.#M({hasSelectedEditor:!1})}}translateSelectedEditors(t,e,i=!1){if(i||this.commitOrRemove(),!this.hasSelection)return;this.#z[0]+=t,this.#z[1]+=e;const[s,n]=this.#z,r=[...this.#x],a=1e3;this.#F&&clearTimeout(this.#F),this.#F=setTimeout(()=>{this.#F=null,this.#z[0]=this.#z[1]=0,this.addCommands({cmd:()=>{for(const l of r)this.#i.has(l.id)&&(l.translateInPage(s,n),l.translationDone())},undo:()=>{for(const l of r)this.#i.has(l.id)&&(l.translateInPage(-s,-n),l.translationDone())},mustExec:!1})},a);for(const l of r)l.translateInPage(t,e),l.translationDone()}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#f=new Map;for(const t of this.#x)this.#f.set(t,{savedX:t.x,savedY:t.y,savedPageIndex:t.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#f)return!1;this.disableUserSelect(!1);const t=this.#f;this.#f=null;let e=!1;for(const[{x:s,y:n,pageIndex:r},a]of t)a.newX=s,a.newY=n,a.newPageIndex=r,e||=s!==a.savedX||n!==a.savedY||r!==a.savedPageIndex;if(!e)return!1;const i=(s,n,r,a)=>{if(this.#i.has(s.id)){const l=this.#a.get(a);l?s._setParentAndPosition(l,n,r):(s.pageIndex=a,s.x=n,s.y=r)}};return this.addCommands({cmd:()=>{for(const[s,{newX:n,newY:r,newPageIndex:a}]of t)i(s,n,r,a)},undo:()=>{for(const[s,{savedX:n,savedY:r,savedPageIndex:a}]of t)i(s,n,r,a)},mustExec:!0}),!0}dragSelectedEditors(t,e){if(this.#f)for(const i of this.#f.keys())i.drag(t,e)}rebuild(t){if(t.parent===null){const e=this.getLayer(t.pageIndex);e?(e.changeParent(t),e.addOrRebuild(t)):(this.addEditor(t),this.addToAnnotationStorage(t),t.rebuild())}else t.parent.addOrRebuild(t)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||this.#x.size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(t){return this.#e===t}getActive(){return this.#e}getMode(){return this.#E}isEditingMode(){return this.#E!==j.NONE}get imageManager(){return z(this,"imageManager",new Ms)}getSelectionBoxes(t){if(!t)return null;const e=document.getSelection();for(let c=0,h=e.rangeCount;c<h;c++)if(!t.contains(e.getRangeAt(c).commonAncestorContainer))return null;const{x:i,y:s,width:n,height:r}=t.getBoundingClientRect();let a;switch(t.getAttribute("data-main-rotation")){case"90":a=(c,h,d,u)=>({x:(h-s)/r,y:1-(c+d-i)/n,width:u/r,height:d/n});break;case"180":a=(c,h,d,u)=>({x:1-(c+d-i)/n,y:1-(h+u-s)/r,width:d/n,height:u/r});break;case"270":a=(c,h,d,u)=>({x:1-(h+u-s)/r,y:(c-i)/n,width:u/r,height:d/n});break;default:a=(c,h,d,u)=>({x:(c-i)/n,y:(h-s)/r,width:d/n,height:u/r});break}const l=[];for(let c=0,h=e.rangeCount;c<h;c++){const d=e.getRangeAt(c);if(!d.collapsed)for(const{x:u,y:p,width:m,height:g}of d.getClientRects())m===0||g===0||l.push(a(u,p,m,g))}return l.length===0?null:l}addChangedExistingAnnotation({annotationElementId:t,id:e}){(this.#o||=new Map).set(t,e)}removeChangedExistingAnnotation({annotationElementId:t}){this.#o?.delete(t)}renderAnnotationElement(t){const e=this.#o?.get(t.data.id);if(!e)return;const i=this.#r.getRawValue(e);i&&(this.#E===j.NONE&&!i.hasBeenModified||i.renderAnnotationElement(t))}setMissingCanvas(t,e,i){const s=this.#I?.get(t);s&&(s.setCanvas(e,i),this.#I.delete(t))}addMissingCanvas(t,e){(this.#I||=new Map).set(t,e)}}class Yt{#t=null;#e=!1;#s=null;#i=null;#a=null;#n=null;#r=!1;#o=null;#c=null;#l=null;#u=null;#d=!1;static#p=null;static _l10n=null;constructor(t){this.#c=t,this.#d=t._uiManager.useNewAltTextFlow,Yt.#p||=Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"})}static initialize(t){Yt._l10n??=t}async render(){const t=this.#s=document.createElement("button");t.className="altText",t.tabIndex="0";const e=this.#i=document.createElement("span");t.append(e),this.#d?(t.classList.add("new"),t.setAttribute("data-l10n-id",Yt.#p.missing),e.setAttribute("data-l10n-id",Yt.#p["missing-label"])):(t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const i=this.#c._uiManager._signal;t.addEventListener("contextmenu",Ft,{signal:i}),t.addEventListener("pointerdown",n=>n.stopPropagation(),{signal:i});const s=n=>{n.preventDefault(),this.#c._uiManager.editAltText(this.#c),this.#d&&this.#c._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:this.#m}})};return t.addEventListener("click",s,{capture:!0,signal:i}),t.addEventListener("keydown",n=>{n.target===t&&n.key==="Enter"&&(this.#r=!0,s(n))},{signal:i}),await this.#f(),t}get#m(){return this.#t&&"added"||this.#t===null&&this.guessedText&&"review"||"missing"}finish(){this.#s&&(this.#s.focus({focusVisible:this.#r}),this.#r=!1)}isEmpty(){return this.#d?this.#t===null:!this.#t&&!this.#e}hasData(){return this.#d?this.#t!==null||!!this.#l:this.isEmpty()}get guessedText(){return this.#l}async setGuessedText(t){this.#t===null&&(this.#l=t,this.#u=await Yt._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:t}),this.#f())}toggleAltTextBadge(t=!1){if(!this.#d||this.#t){this.#o?.remove(),this.#o=null;return}if(!this.#o){const e=this.#o=document.createElement("div");e.className="noAltTextBadge",this.#c.div.append(e)}this.#o.classList.toggle("hidden",!t)}serialize(t){let e=this.#t;return!t&&this.#l===e&&(e=this.#u),{altText:e,decorative:this.#e,guessedText:this.#l,textWithDisclaimer:this.#u}}get data(){return{altText:this.#t,decorative:this.#e}}set data({altText:t,decorative:e,guessedText:i,textWithDisclaimer:s,cancel:n=!1}){i&&(this.#l=i,this.#u=s),!(this.#t===t&&this.#e===e)&&(n||(this.#t=t,this.#e=e),this.#f())}toggle(t=!1){this.#s&&(!t&&this.#n&&(clearTimeout(this.#n),this.#n=null),this.#s.disabled=!t)}shown(){this.#c._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:this.#m}})}destroy(){this.#s?.remove(),this.#s=null,this.#i=null,this.#a=null,this.#o?.remove(),this.#o=null}async#f(){const t=this.#s;if(!t)return;if(this.#d){if(t.classList.toggle("done",!!this.#t),t.setAttribute("data-l10n-id",Yt.#p[this.#m]),this.#i?.setAttribute("data-l10n-id",Yt.#p[`${this.#m}-label`]),!this.#t){this.#a?.remove();return}}else{if(!this.#t&&!this.#e){t.classList.remove("done"),this.#a?.remove();return}t.classList.add("done"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let e=this.#a;if(!e){this.#a=e=document.createElement("span"),e.className="tooltip",e.setAttribute("role","tooltip"),e.id=`alt-text-tooltip-${this.#c.id}`;const s=100,n=this.#c._uiManager._signal;n.addEventListener("abort",()=>{clearTimeout(this.#n),this.#n=null},{once:!0}),t.addEventListener("mouseenter",()=>{this.#n=setTimeout(()=>{this.#n=null,this.#a.classList.add("show"),this.#c._reportTelemetry({action:"alt_text_tooltip"})},s)},{signal:n}),t.addEventListener("mouseleave",()=>{this.#n&&(clearTimeout(this.#n),this.#n=null),this.#a?.classList.remove("show")},{signal:n})}this.#e?e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(e.removeAttribute("data-l10n-id"),e.textContent=this.#t),e.parentNode||t.append(e),this.#c.getElementForAltText()?.setAttribute("aria-describedby",e.id)}}class wi{#t=null;#e=null;#s=!1;#i=null;#a=null;#n=null;#r=null;#o=null;#c=!1;#l=null;constructor(t){this.#i=t}renderForToolbar(){const t=this.#e=document.createElement("button");return t.className="comment",this.#u(t,!1)}renderForStandalone(){const t=this.#t=document.createElement("button");t.className="annotationCommentButton";const e=this.#i.commentButtonPosition;if(e){const{style:i}=t;i.insetInlineEnd=`calc(${100*(this.#i._uiManager.direction==="ltr"?1-e[0]:e[0])}% - var(--comment-button-dim))`,i.top=`calc(${100*e[1]}% - var(--comment-button-dim))`;const s=this.#i.commentButtonColor;s&&(i.backgroundColor=s)}return this.#u(t,!0)}focusButton(){setTimeout(()=>{(this.#t??this.#e)?.focus()},0)}onUpdatedColor(){if(!this.#t)return;const t=this.#i.commentButtonColor;t&&(this.#t.style.backgroundColor=t),this.#i._uiManager.updatePopupColor(this.#i)}get commentButtonWidth(){return(this.#t?.getBoundingClientRect().width??0)/this.#i.parent.boundingClientRect.width}get commentPopupPositionInLayer(){if(this.#l)return this.#l;if(!this.#t)return null;const{x:t,y:e,height:i}=this.#t.getBoundingClientRect(),{x:s,y:n,width:r,height:a}=this.#i.parent.boundingClientRect;return[(t-s)/r,(e+i-n)/a]}set commentPopupPositionInLayer(t){this.#l=t}hasDefaultPopupPosition(){return this.#l===null}removeStandaloneCommentButton(){this.#t?.remove(),this.#t=null}removeToolbarCommentButton(){this.#e?.remove(),this.#e=null}setCommentButtonStates({selected:t,hasPopup:e}){this.#t&&(this.#t.classList.toggle("selected",t),this.#t.ariaExpanded=e)}#u(t,e){if(!this.#i._uiManager.hasCommentManager())return null;t.tabIndex="0",t.ariaHasPopup="dialog",e?(t.ariaControls="commentPopup",t.setAttribute("data-l10n-id","pdfjs-show-comment-button")):(t.ariaControlsElements=[this.#i._uiManager.getCommentDialogElement()],t.setAttribute("data-l10n-id","pdfjs-editor-edit-comment-button"));const i=this.#i._uiManager._signal;if(!(i instanceof AbortSignal)||i.aborted)return t;t.addEventListener("contextmenu",Ft,{signal:i}),e&&(t.addEventListener("focusin",n=>{this.#i._focusEventsAllowed=!1,ot(n)},{capture:!0,signal:i}),t.addEventListener("focusout",n=>{this.#i._focusEventsAllowed=!0,ot(n)},{capture:!0,signal:i})),t.addEventListener("pointerdown",n=>n.stopPropagation(),{signal:i});const s=n=>{n.preventDefault(),t===this.#e?this.edit():this.#i.toggleComment(!0)};return t.addEventListener("click",s,{capture:!0,signal:i}),t.addEventListener("keydown",n=>{n.target===t&&n.key==="Enter"&&(this.#s=!0,s(n))},{signal:i}),t.addEventListener("pointerenter",()=>{this.#i.toggleComment(!1,!0)},{signal:i}),t.addEventListener("pointerleave",()=>{this.#i.toggleComment(!1,!1)},{signal:i}),t}edit(t){const e=this.commentPopupPositionInLayer;let i,s;if(e)[i,s]=e;else{[i,s]=this.#i.commentButtonPosition;const{width:h,height:d,x:u,y:p}=this.#i;i=u+i*h,s=p+s*d}const n=this.#i.parent.boundingClientRect,{x:r,y:a,width:l,height:c}=n;this.#i._uiManager.editComment(this.#i,r+i*l,a+s*c,{...t,parentDimensions:n})}finish(){this.#e&&(this.#e.focus({focusVisible:this.#s}),this.#s=!1)}isDeleted(){return this.#c||this.#r===""}isEmpty(){return this.#r===null}hasBeenEdited(){return this.isDeleted()||this.#r!==this.#a}serialize(){return this.data}get data(){return{text:this.#r,richText:this.#n,date:this.#o,deleted:this.isDeleted()}}set data(t){if(t!==this.#r&&(this.#n=null),t===null){this.#r="",this.#c=!0;return}this.#r=t,this.#o=new Date,this.#c=!1}setInitialText(t,e=null){this.#a=t,this.data=t,this.#o=null,this.#n=e}shown(){}destroy(){this.#e?.remove(),this.#e=null,this.#t?.remove(),this.#t=null,this.#r="",this.#n=null,this.#o=null,this.#i=null,this.#s=!1,this.#c=!1}}class di{#t;#e=!1;#s=null;#i;#a;#n;#r;#o=null;#c;#l=null;#u;#d=null;constructor({container:t,isPinchingDisabled:e=null,isPinchingStopped:i=null,onPinchStart:s=null,onPinching:n=null,onPinchEnd:r=null,signal:a}){this.#t=t,this.#s=i,this.#i=e,this.#a=s,this.#n=n,this.#r=r,this.#u=new AbortController,this.#c=AbortSignal.any([a,this.#u.signal]),t.addEventListener("touchstart",this.#p.bind(this),{passive:!1,signal:this.#c})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/zt.pixelRatio}#p(t){if(this.#i?.())return;if(t.touches.length===1){if(this.#o)return;const s=this.#o=new AbortController,n=AbortSignal.any([this.#c,s.signal]),r=this.#t,a={capture:!0,signal:n,passive:!1},l=c=>{c.pointerType==="touch"&&(this.#o?.abort(),this.#o=null)};r.addEventListener("pointerdown",c=>{c.pointerType==="touch"&&(ot(c),l(c))},a),r.addEventListener("pointerup",l,a),r.addEventListener("pointercancel",l,a);return}if(!this.#d){this.#d=new AbortController;const s=AbortSignal.any([this.#c,this.#d.signal]),n=this.#t,r={signal:s,capture:!1,passive:!1};n.addEventListener("touchmove",this.#m.bind(this),r);const a=this.#f.bind(this);n.addEventListener("touchend",a,r),n.addEventListener("touchcancel",a,r),r.capture=!0,n.addEventListener("pointerdown",ot,r),n.addEventListener("pointermove",ot,r),n.addEventListener("pointercancel",ot,r),n.addEventListener("pointerup",ot,r),this.#a?.()}if(ot(t),t.touches.length!==2||this.#s?.()){this.#l=null;return}let[e,i]=t.touches;e.identifier>i.identifier&&([e,i]=[i,e]),this.#l={touch0X:e.screenX,touch0Y:e.screenY,touch1X:i.screenX,touch1Y:i.screenY}}#m(t){if(!this.#l||t.touches.length!==2)return;ot(t);let[e,i]=t.touches;e.identifier>i.identifier&&([e,i]=[i,e]);const{screenX:s,screenY:n}=e,{screenX:r,screenY:a}=i,l=this.#l,{touch0X:c,touch0Y:h,touch1X:d,touch1Y:u}=l,p=d-c,m=u-h,g=r-s,y=a-n,b=Math.hypot(g,y)||1,v=Math.hypot(p,m)||1;if(!this.#e&&Math.abs(v-b)<=di.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(l.touch0X=s,l.touch0Y=n,l.touch1X=r,l.touch1Y=a,!this.#e){this.#e=!0;return}const w=[(s+r)/2,(n+a)/2];this.#n?.(w,v,b)}#f(t){t.touches.length>=2||(this.#d&&(this.#d.abort(),this.#d=null,this.#r?.()),this.#l&&(ot(t),this.#l=null,this.#e=!1))}destroy(){this.#u?.abort(),this.#u=null,this.#o?.abort(),this.#o=null}}class I{#t=null;#e=null;#s=null;#i=null;#a=null;#n=!1;#r=null;#o="";#c=null;#l=null;#u=null;#d=null;#p=null;#m="";#f=!1;#h=null;#g=!1;#b=!1;#w=!1;#y=null;#_=0;#S=0;#v=null;#C=null;isSelected=!1;_isCopy=!1;_editToolbar=null;_initialOptions=Object.create(null);_initialData=null;_isVisible=!0;_uiManager=null;_focusEventsAllowed=!0;static _l10n=null;static _l10nResizer=null;#A=!1;#k=I._zIndex++;static _borderLineWidth=-1;static _colorManager=new Rs;static _zIndex=1;static _telemetryTimeout=1e3;static get _resizerKeyboardManager(){const t=I.prototype._resizeWithKeyboard,e=ne.TRANSLATE_SMALL,i=ne.TRANSLATE_BIG;return z(this,"_resizerKeyboardManager",new hi([[["ArrowLeft","mac+ArrowLeft"],t,{args:[-e,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t,{args:[-i,0]}],[["ArrowRight","mac+ArrowRight"],t,{args:[e,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t,{args:[i,0]}],[["ArrowUp","mac+ArrowUp"],t,{args:[0,-e]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t,{args:[0,-i]}],[["ArrowDown","mac+ArrowDown"],t,{args:[0,e]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t,{args:[0,i]}],[["Escape","mac+Escape"],I.prototype._stopResizingWithKeyboard]]))}constructor(t){this.parent=t.parent,this.id=t.id,this.width=this.height=null,this.pageIndex=t.parent.pageIndex,this.name=t.name,this.div=null,this._uiManager=t.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=t.isCentered,this._structTreeParentId=null,this.annotationElementId=t.annotationElementId||null,this.creationDate=t.creationDate||new Date,this.modificationDate=t.modificationDate||null;const{rotation:e,rawDims:{pageWidth:i,pageHeight:s,pageX:n,pageY:r}}=this.parent.viewport;this.rotation=e,this.pageRotation=(360+e-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[i,s],this.pageTranslation=[n,r];const[a,l]=this.parentDimensions;this.x=t.x/a,this.y=t.y/l,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}get mode(){return Object.getPrototypeOf(this).constructor._editorType}static get isDrawer(){return!1}static get _defaultLineColor(){return z(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(t){const e=new qo({id:t.parent.getNextId(),parent:t.parent,uiManager:t._uiManager});e.annotationElementId=t.annotationElementId,e.deleted=!0,e._uiManager.addToAnnotationStorage(e)}static initialize(t,e){if(I._l10n??=t,I._l10nResizer||=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"}),I._borderLineWidth!==-1)return;const i=getComputedStyle(document.documentElement);I._borderLineWidth=parseFloat(i.getPropertyValue("--outline-width"))||0}static updateDefaultParams(t,e){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(t){return!1}static paste(t,e){J("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#A}set _isDraggable(t){this.#A=t,this.div?.classList.toggle("draggable",t)}get uid(){return this.annotationElementId||this.id}get isEnterHandled(){return!0}center(){const[t,e]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*e/(t*2),this.y+=this.width*t/(e*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*e/(t*2),this.y-=this.width*t/(e*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(t){this._uiManager.addCommands(t)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#k}setParent(t){t!==null?(this.pageIndex=t.pageIndex,this.pageDimensions=t.pageDimensions):(this.#F(),this.#d?.remove(),this.#d=null),this.parent=t}focusin(t){this._focusEventsAllowed&&(this.#f?this.#f=!1:this.parent.setSelected(this))}focusout(t){!this._focusEventsAllowed||!this.isAttachedToDOM||t.relatedTarget?.closest(`#${this.id}`)||(t.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.isInEditMode()&&this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(t,e,i,s){const[n,r]=this.parentDimensions;[i,s]=this.screenToPageTranslation(i,s),this.x=(t+i)/n,this.y=(e+s)/r,this.fixAndSetPosition()}_moveAfterPaste(t,e){const[i,s]=this.parentDimensions;this.setAt(t*i,e*s,this.width*i,this.height*s),this._onTranslated()}#P([t,e],i,s){[i,s]=this.screenToPageTranslation(i,s),this.x+=i/t,this.y+=s/e,this._onTranslating(this.x,this.y),this.fixAndSetPosition()}translate(t,e){this.#P(this.parentDimensions,t,e)}translateInPage(t,e){this.#h||=[this.x,this.y,this.width,this.height],this.#P(this.pageDimensions,t,e),this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(t,e){this.#h||=[this.x,this.y,this.width,this.height];const{div:i,parentDimensions:[s,n]}=this;if(this.x+=t/s,this.y+=e/n,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:d,y:u}=this.div.getBoundingClientRect();this.parent.findNewParent(this,d,u)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:r,y:a}=this;const[l,c]=this.getBaseTranslation();r+=l,a+=c;const{style:h}=i;h.left=`${(100*r).toFixed(2)}%`,h.top=`${(100*a).toFixed(2)}%`,this._onTranslating(r,a),i.scrollIntoView({block:"nearest"})}_onTranslating(t,e){}_onTranslated(t,e){}get _hasBeenMoved(){return!!this.#h&&(this.#h[0]!==this.x||this.#h[1]!==this.y)}get _hasBeenResized(){return!!this.#h&&(this.#h[2]!==this.width||this.#h[3]!==this.height)}getBaseTranslation(){const[t,e]=this.parentDimensions,{_borderLineWidth:i}=I,s=i/t,n=i/e;switch(this.rotation){case 90:return[-s,n];case 180:return[s,n];case 270:return[s,-n];default:return[-s,-n]}}get _mustFixPosition(){return!0}fixAndSetPosition(t=this.rotation){const{div:{style:e},pageDimensions:[i,s]}=this;let{x:n,y:r,width:a,height:l}=this;if(a*=i,l*=s,n*=i,r*=s,this._mustFixPosition)switch(t){case 0:n=xt(n,0,i-a),r=xt(r,0,s-l);break;case 90:n=xt(n,0,i-l),r=xt(r,a,s);break;case 180:n=xt(n,a,i),r=xt(r,l,s);break;case 270:n=xt(n,l,i),r=xt(r,0,s-a);break}this.x=n/=i,this.y=r/=s;const[c,h]=this.getBaseTranslation();n+=c,r+=h,e.left=`${(100*n).toFixed(2)}%`,e.top=`${(100*r).toFixed(2)}%`,this.moveInDOM()}static#T(t,e,i){switch(i){case 90:return[e,-t];case 180:return[-t,-e];case 270:return[-e,t];default:return[t,e]}}screenToPageTranslation(t,e){return I.#T(t,e,this.parentRotation)}pageTranslationToScreen(t,e){return I.#T(t,e,360-this.parentRotation)}#L(t){switch(t){case 90:{const[e,i]=this.pageDimensions;return[0,-e/i,i/e,0]}case 180:return[-1,0,0,-1];case 270:{const[e,i]=this.pageDimensions;return[0,e/i,-i/e,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:t,pageDimensions:[e,i]}=this;return[e*t,i*t]}setDims(){const{div:{style:t},width:e,height:i}=this;t.width=`${(100*e).toFixed(2)}%`,t.height=`${(100*i).toFixed(2)}%`}getInitialTranslation(){return[0,0]}#O(){if(this.#c)return;this.#c=document.createElement("div"),this.#c.classList.add("resizers");const t=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],e=this._uiManager._signal;for(const i of t){const s=document.createElement("div");this.#c.append(s),s.classList.add("resizer",i),s.setAttribute("data-resizer-name",i),s.addEventListener("pointerdown",this.#R.bind(this,i),{signal:e}),s.addEventListener("contextmenu",Ft,{signal:e}),s.tabIndex=-1}this.div.prepend(this.#c)}#R(t,e){e.preventDefault();const{isMac:i}=bt.platform;if(e.button!==0||e.ctrlKey&&i)return;this.#s?.toggle(!1);const s=this._isDraggable;this._isDraggable=!1,this.#l=[e.screenX,e.screenY];const n=new AbortController,r=this._uiManager.combinedSignal(n);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",this.#I.bind(this,t),{passive:!0,capture:!0,signal:r}),window.addEventListener("touchmove",ot,{passive:!1,signal:r}),window.addEventListener("contextmenu",Ft,{signal:r}),this.#u={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const a=this.parent.div.style.cursor,l=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(e.target).cursor;const c=()=>{n.abort(),this.parent.togglePointerEvents(!0),this.#s?.toggle(!0),this._isDraggable=s,this.parent.div.style.cursor=a,this.div.style.cursor=l,this.#j()};window.addEventListener("pointerup",c,{signal:r}),window.addEventListener("blur",c,{signal:r})}#N(t,e,i,s){this.width=i,this.height=s,this.x=t,this.y=e,this.setDims(),this.fixAndSetPosition(),this._onResized()}_onResized(){}#j(){if(!this.#u)return;const{savedX:t,savedY:e,savedWidth:i,savedHeight:s}=this.#u;this.#u=null;const n=this.x,r=this.y,a=this.width,l=this.height;n===t&&r===e&&a===i&&l===s||this.addCommands({cmd:this.#N.bind(this,n,r,a,l),undo:this.#N.bind(this,t,e,i,s),mustExec:!0})}static _round(t){return Math.round(t*1e4)/1e4}#I(t,e){const[i,s]=this.parentDimensions,n=this.x,r=this.y,a=this.width,l=this.height,c=I.MIN_SIZE/i,h=I.MIN_SIZE/s,d=this.#L(this.rotation),u=(M,R)=>[d[0]*M+d[2]*R,d[1]*M+d[3]*R],p=this.#L(360-this.rotation),m=(M,R)=>[p[0]*M+p[2]*R,p[1]*M+p[3]*R];let g,y,b=!1,v=!1;switch(t){case"topLeft":b=!0,g=(M,R)=>[0,0],y=(M,R)=>[M,R];break;case"topMiddle":g=(M,R)=>[M/2,0],y=(M,R)=>[M/2,R];break;case"topRight":b=!0,g=(M,R)=>[M,0],y=(M,R)=>[0,R];break;case"middleRight":v=!0,g=(M,R)=>[M,R/2],y=(M,R)=>[0,R/2];break;case"bottomRight":b=!0,g=(M,R)=>[M,R],y=(M,R)=>[0,0];break;case"bottomMiddle":g=(M,R)=>[M/2,R],y=(M,R)=>[M/2,0];break;case"bottomLeft":b=!0,g=(M,R)=>[0,R],y=(M,R)=>[M,0];break;case"middleLeft":v=!0,g=(M,R)=>[0,R/2],y=(M,R)=>[M,R/2];break}const w=g(a,l),A=y(a,l);let x=u(...A);const S=I._round(n+x[0]),k=I._round(r+x[1]);let _=1,E=1,L,P;if(e.fromKeyboard)({deltaX:L,deltaY:P}=e);else{const{screenX:M,screenY:R}=e,[U,nt]=this.#l;[L,P]=this.screenToPageTranslation(M-U,R-nt),this.#l[0]=M,this.#l[1]=R}if([L,P]=m(L/i,P/s),b){const M=Math.hypot(a,l);_=E=Math.max(Math.min(Math.hypot(A[0]-w[0]-L,A[1]-w[1]-P)/M,1/a,1/l),c/a,h/l)}else v?_=xt(Math.abs(A[0]-w[0]-L),c,1)/a:E=xt(Math.abs(A[1]-w[1]-P),h,1)/l;const G=I._round(a*_),H=I._round(l*E);x=u(...y(G,H));const O=S-x[0],$=k-x[1];this.#h||=[this.x,this.y,this.width,this.height],this.width=G,this.height=H,this.x=O,this.y=$,this.setDims(),this.fixAndSetPosition(),this._onResizing()}_onResizing(){}altTextFinish(){this.#s?.finish()}get toolbarButtons(){return null}async addEditToolbar(){if(this._editToolbar||this.#b)return this._editToolbar;this._editToolbar=new Je(this),this.div.append(this._editToolbar.render());const{toolbarButtons:t}=this;if(t)for(const[e,i]of t)await this._editToolbar.addButton(e,i);return this.hasComment||this._editToolbar.addButton("comment",this.addCommentButton()),this._editToolbar.addButton("delete"),this._editToolbar}addCommentButtonInToolbar(){this._editToolbar?.addButtonBefore("comment",this.addCommentButton(),".deleteButton")}removeCommentButtonFromToolbar(){this._editToolbar?.removeButton("comment")}removeEditToolbar(){this._editToolbar?.remove(),this._editToolbar=null,this.#s?.destroy()}addContainer(t){const e=this._editToolbar?.div;e?e.before(t):this.div.append(t)}getClientDimensions(){return this.div.getBoundingClientRect()}createAltText(){return this.#s||(Yt.initialize(I._l10n),this.#s=new Yt(this),this.#t&&(this.#s.data=this.#t,this.#t=null)),this.#s}get altTextData(){return this.#s?.data}set altTextData(t){this.#s&&(this.#s.data=t)}get guessedAltText(){return this.#s?.guessedText}async setGuessedAltText(t){await this.#s?.setGuessedText(t)}serializeAltText(t){return this.#s?.serialize(t)}hasAltText(){return!!this.#s&&!this.#s.isEmpty()}hasAltTextData(){return this.#s?.hasData()??!1}focusCommentButton(){this.#i?.focusButton()}addCommentButton(){return this.#i||=new wi(this)}addStandaloneCommentButton(){if(this.#a){this._uiManager.isEditingMode()&&this.#a.classList.remove("hidden");return}this.hasComment&&(this.#a=this.#i.renderForStandalone(),this.div.append(this.#a))}removeStandaloneCommentButton(){this.#i.removeStandaloneCommentButton(),this.#a=null}hideStandaloneCommentButton(){this.#a?.classList.add("hidden")}get comment(){const{data:{richText:t,text:e,date:i,deleted:s}}=this.#i;return{text:e,richText:t,date:i,deleted:s,color:this.getNonHCMColor(),opacity:this.opacity??1}}set comment(t){this.#i||=new wi(this),this.#i.data=t,this.hasComment?(this.removeCommentButtonFromToolbar(),this.addStandaloneCommentButton(),this._uiManager.updateComment(this)):(this.addCommentButtonInToolbar(),this.removeStandaloneCommentButton(),this._uiManager.removeComment(this))}setCommentData({comment:t,popupRef:e,richText:i}){if(!e||(this.#i||=new wi(this),this.#i.setInitialText(t,i),!this.annotationElementId))return;const s=this._uiManager.getAndRemoveDataFromAnnotationStorage(this.annotationElementId);s&&this.updateFromAnnotationLayer(s)}get hasEditedComment(){return this.#i?.hasBeenEdited()}get hasDeletedComment(){return this.#i?.isDeleted()}get hasComment(){return!!this.#i&&!this.#i.isEmpty()&&!this.#i.isDeleted()}async editComment(t){this.#i||=new wi(this),this.#i.edit(t)}toggleComment(t,e=void 0){this.hasComment&&this._uiManager.toggleComment(this,t,e)}setSelectedCommentButton(t){this.#i.setSelectedButton(t)}addComment(t){if(this.hasEditedComment){const[,,,s]=t.rect,[n]=this.pageDimensions,[r]=this.pageTranslation,a=r+n+1,l=s-100,c=a+180;t.popup={contents:this.comment.text,deleted:this.comment.deleted,rect:[a,l,c,s]}}}updateFromAnnotationLayer({popup:{contents:t,deleted:e}}){this.#i.data=e?null:t}get parentBoundingClientRect(){return this.parent.boundingClientRect}render(){const t=this.div=document.createElement("div");t.setAttribute("data-editor-rotation",(360-this.rotation)%360),t.className=this.name,t.setAttribute("id",this.id),t.tabIndex=this.#n?-1:0,t.setAttribute("role","application"),this.defaultL10nId&&t.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||t.classList.add("hidden"),this.setInForeground(),this.#U();const[e,i]=this.parentDimensions;this.parentRotation%180!==0&&(t.style.maxWidth=`${(100*i/e).toFixed(2)}%`,t.style.maxHeight=`${(100*e/i).toFixed(2)}%`);const[s,n]=this.getInitialTranslation();return this.translate(s,n),hr(this,t,["keydown","pointerdown","dblclick"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(this.#C||=new di({container:t,isPinchingDisabled:()=>!this.isSelected,onPinchStart:this.#$.bind(this),onPinching:this.#E.bind(this),onPinchEnd:this.#x.bind(this),signal:this._uiManager._signal})),this.addStandaloneCommentButton(),this._uiManager._editorUndoBar?.hide(),t}#$(){this.#u={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height},this.#s?.toggle(!1),this.parent.togglePointerEvents(!1)}#E(t,e,i){let n=.7*(i/e)+1-.7;if(n===1)return;const r=this.#L(this.rotation),a=(S,k)=>[r[0]*S+r[2]*k,r[1]*S+r[3]*k],[l,c]=this.parentDimensions,h=this.x,d=this.y,u=this.width,p=this.height,m=I.MIN_SIZE/l,g=I.MIN_SIZE/c;n=Math.max(Math.min(n,1/u,1/p),m/u,g/p);const y=I._round(u*n),b=I._round(p*n);if(y===u&&b===p)return;this.#h||=[h,d,u,p];const v=a(u/2,p/2),w=I._round(h+v[0]),A=I._round(d+v[1]),x=a(y/2,b/2);this.x=w-x[0],this.y=A-x[1],this.width=y,this.height=b,this.setDims(),this.fixAndSetPosition(),this._onResizing()}#x(){this.#s?.toggle(!0),this.parent.togglePointerEvents(!0),this.#j()}pointerdown(t){const{isMac:e}=bt.platform;if(t.button!==0||t.ctrlKey&&e){t.preventDefault();return}if(this.#f=!0,this._isDraggable){this.#B(t);return}this.#D(t)}#D(t){const{isMac:e}=bt.platform;t.ctrlKey&&!e||t.shiftKey||t.metaKey&&e?this.parent.toggleSelected(this):this.parent.setSelected(this)}#B(t){const{isSelected:e}=this;this._uiManager.setUpDragSession();let i=!1;const s=new AbortController,n=this._uiManager.combinedSignal(s),r={capture:!0,passive:!1,signal:n},a=c=>{s.abort(),this.#r=null,this.#f=!1,this._uiManager.endDragSession()||this.#D(c),i&&this._onStopDragging()};e&&(this.#_=t.clientX,this.#S=t.clientY,this.#r=t.pointerId,this.#o=t.pointerType,window.addEventListener("pointermove",c=>{i||(i=!0,this._uiManager.toggleComment(this,!0,!1),this._onStartDragging());const{clientX:h,clientY:d,pointerId:u}=c;if(u!==this.#r){ot(c);return}const[p,m]=this.screenToPageTranslation(h-this.#_,d-this.#S);this.#_=h,this.#S=d,this._uiManager.dragSelectedEditors(p,m)},r),window.addEventListener("touchmove",ot,r),window.addEventListener("pointerdown",c=>{c.pointerType===this.#o&&(this.#C||c.isPrimary)&&a(c),ot(c)},r));const l=c=>{if(!this.#r||this.#r===c.pointerId){a(c);return}ot(c)};window.addEventListener("pointerup",l,{signal:n}),window.addEventListener("blur",l,{signal:n})}_onStartDragging(){}_onStopDragging(){}moveInDOM(){this.#y&&clearTimeout(this.#y),this.#y=setTimeout(()=>{this.#y=null,this.parent?.moveEditorInDOM(this)},0)}_setParentAndPosition(t,e,i){t.changeParent(this),this.x=e,this.y=i,this.fixAndSetPosition(),this._onTranslated()}getRect(t,e,i=this.rotation){const s=this.parentScale,[n,r]=this.pageDimensions,[a,l]=this.pageTranslation,c=t/s,h=e/s,d=this.x*n,u=this.y*r,p=this.width*n,m=this.height*r;switch(i){case 0:return[d+c+a,r-u-h-m+l,d+c+p+a,r-u-h+l];case 90:return[d+h+a,r-u+c+l,d+h+m+a,r-u+c+p+l];case 180:return[d-c-p+a,r-u+h+l,d-c+a,r-u+h+m+l];case 270:return[d-h-m+a,r-u-c-p+l,d-h+a,r-u-c+l];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(t,e){const[i,s,n,r]=t,a=n-i,l=r-s;switch(this.rotation){case 0:return[i,e-r,a,l];case 90:return[i,e-s,l,a];case 180:return[n,e-s,a,l];case 270:return[n,e-r,l,a];default:throw new Error("Invalid rotation")}}getPDFRect(){return this.getRect(0,0)}getNonHCMColor(){return this.color&&I._colorManager.convert(this._uiManager.getNonHCMColor(this.color))}onUpdatedColor(){this.#i?.onUpdatedColor()}getData(){const{comment:{text:t,color:e,date:i,opacity:s,deleted:n,richText:r},uid:a,pageIndex:l,creationDate:c,modificationDate:h}=this;return{id:a,pageIndex:l,rect:this.getPDFRect(),richText:r,contentsObj:{str:t},creationDate:c,modificationDate:i||h,popupRef:!n,color:e,opacity:s}}onceAdded(t){}isEmpty(){return!1}enableEditMode(){return this.isInEditMode()?!1:(this.parent.setEditingState(!1),this.#b=!0,!0)}disableEditMode(){return this.isInEditMode()?(this.parent.setEditingState(!0),this.#b=!1,!0):!1}isInEditMode(){return this.#b}shouldGetKeyboardEvents(){return this.#w}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:t,left:e,bottom:i,right:s}=this.getClientDimensions(),{innerHeight:n,innerWidth:r}=window;return e<r&&s>0&&t<n&&i>0}#U(){if(this.#p||!this.div)return;this.#p=new AbortController;const t=this._uiManager.combinedSignal(this.#p);this.div.addEventListener("focusin",this.focusin.bind(this),{signal:t}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:t})}rebuild(){this.#U()}rotate(t){}resize(){}serializeDeleted(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:this._initialData?.popupRef||""}}serialize(t=!1,e=null){return{annotationType:this.mode,pageIndex:this.pageIndex,rect:this.getPDFRect(),rotation:this.rotation,structTreeParentId:this._structTreeParentId,popupRef:this._initialData?.popupRef||""}}static async deserialize(t,e,i){const s=new this.prototype.constructor({parent:e,id:e.getNextId(),uiManager:i,annotationElementId:t.annotationElementId,creationDate:t.creationDate,modificationDate:t.modificationDate});s.rotation=t.rotation,s.#t=t.accessibilityData,s._isCopy=t.isCopy||!1;const[n,r]=s.pageDimensions,[a,l,c,h]=s.getRectInCurrentCoords(t.rect,r);return s.x=a/n,s.y=l/r,s.width=c/n,s.height=h/r,s}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){if(this.#p?.abort(),this.#p=null,this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.#y&&(clearTimeout(this.#y),this.#y=null),this.#F(),this.removeEditToolbar(),this.#v){for(const t of this.#v.values())clearTimeout(t);this.#v=null}this.parent=null,this.#C?.destroy(),this.#C=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#O(),this.#c.classList.remove("hidden"))}get toolbarPosition(){return null}get commentButtonPosition(){return this._uiManager.direction==="ltr"?[1,0]:[0,0]}get commentButtonPositionInPage(){const{commentButtonPosition:[t,e]}=this,[i,s,n,r]=this.getPDFRect();return[I._round(i+(n-i)*t),I._round(s+(r-s)*(1-e))]}get commentButtonColor(){return this._uiManager.makeCommentColor(this.getNonHCMColor(),this.opacity)}get commentPopupPosition(){return this.#i.commentPopupPositionInLayer}set commentPopupPosition(t){this.#i.commentPopupPositionInLayer=t}hasDefaultPopupPosition(){return this.#i.hasDefaultPopupPosition()}get commentButtonWidth(){return this.#i.commentButtonWidth}get elementBeforePopup(){return this.div}setCommentButtonStates(t){this.#i.setCommentButtonStates(t)}keydown(t){if(!this.isResizable||t.target!==this.div||t.key!=="Enter")return;this._uiManager.setSelected(this),this.#u={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const e=this.#c.children;if(!this.#e){this.#e=Array.from(e);const r=this.#q.bind(this),a=this.#W.bind(this),l=this._uiManager._signal;for(const c of this.#e){const h=c.getAttribute("data-resizer-name");c.setAttribute("role","spinbutton"),c.addEventListener("keydown",r,{signal:l}),c.addEventListener("blur",a,{signal:l}),c.addEventListener("focus",this.#X.bind(this,h),{signal:l}),c.setAttribute("data-l10n-id",I._l10nResizer[h])}}const i=this.#e[0];let s=0;for(const r of e){if(r===i)break;s++}const n=(360-this.rotation+this.parentRotation)%360/90*(this.#e.length/4);if(n!==s){if(n<s)for(let a=0;a<s-n;a++)this.#c.append(this.#c.firstChild);else if(n>s)for(let a=0;a<n-s;a++)this.#c.firstChild.before(this.#c.lastChild);let r=0;for(const a of e){const c=this.#e[r++].getAttribute("data-resizer-name");a.setAttribute("data-l10n-id",I._l10nResizer[c])}}this.#z(0),this.#w=!0,this.#c.firstChild.focus({focusVisible:!0}),t.preventDefault(),t.stopImmediatePropagation()}#q(t){I._resizerKeyboardManager.exec(this,t)}#W(t){this.#w&&t.relatedTarget?.parentNode!==this.#c&&this.#F()}#X(t){this.#m=this.#w?t:""}#z(t){if(this.#e)for(const e of this.#e)e.tabIndex=t}_resizeWithKeyboard(t,e){this.#w&&this.#I(this.#m,{deltaX:t,deltaY:e,fromKeyboard:!0})}#F(){this.#w=!1,this.#z(-1),this.#j()}_stopResizingWithKeyboard(){this.#F(),this.div.focus()}select(){if(this.isSelected&&this._editToolbar){this._editToolbar.show();return}if(this.isSelected=!0,this.makeResizable(),this.div?.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{this.div?.classList.contains("selectedEditor")&&this._editToolbar?.show()});return}this._editToolbar?.show(),this.#s?.toggleAltTextBadge(!1)}focus(){this.div&&!this.div.contains(document.activeElement)&&setTimeout(()=>this.div?.focus({preventScroll:!0}),0)}unselect(){this.isSelected&&(this.isSelected=!1,this.#c?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),this._editToolbar?.hide(),this.#s?.toggleAltTextBadge(!0),this.hasComment&&this._uiManager.toggleComment(this,!1,!1))}updateParams(t,e){}disableEditing(){}enableEditing(){}get canChangeContent(){return!1}enterInEditMode(){this.canChangeContent&&(this.enableEditMode(),this.div.focus())}dblclick(t){t.target.nodeName!=="BUTTON"&&(this.enterInEditMode(),this.parent.updateToolbar({mode:this.constructor._editorType,editId:this.id}))}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return this.#g}set isEditing(t){this.#g=t,this.parent&&(t?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(t,e=!1){if(e){this.#v||=new Map;const{action:i}=t;let s=this.#v.get(i);s&&clearTimeout(s),s=setTimeout(()=>{this._reportTelemetry(t),this.#v.delete(i),this.#v.size===0&&(this.#v=null)},I._telemetryTimeout),this.#v.set(i,s);return}t.type||=this.editorType,this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:t}})}show(t=this._isVisible){this.div.classList.toggle("hidden",!t),this._isVisible=t}enable(){this.div&&(this.div.tabIndex=0),this.#n=!1}disable(){this.div&&(this.div.tabIndex=-1),this.#n=!0}updateFakeAnnotationElement(t){if(!this.#d&&!this.deleted){this.#d=t.addFakeAnnotation(this);return}if(this.deleted){this.#d.remove(),this.#d=null;return}(this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized)&&this.#d.updateEdited({rect:this.getPDFRect(),popup:this.comment})}renderAnnotationElement(t){if(this.deleted)return t.hide(),null;let e=t.container.querySelector(".annotationContent");if(!e)e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),t.container.prepend(e);else if(e.nodeName==="CANVAS"){const i=e;e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),i.before(e)}return e}resetAnnotationElement(t){const{firstChild:e}=t.container;e?.nodeName==="DIV"&&e.classList.contains("annotationContent")&&e.remove()}}class qo extends I{constructor(t){super(t),this.annotationElementId=t.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const cn=3285377520,jt=4294901760,qt=65535;class dr{constructor(t){this.h1=t?t&4294967295:cn,this.h2=t?t&4294967295:cn}update(t){let e,i;if(typeof t=="string"){e=new Uint8Array(t.length*2),i=0;for(let g=0,y=t.length;g<y;g++){const b=t.charCodeAt(g);b<=255?e[i++]=b:(e[i++]=b>>>8,e[i++]=b&255)}}else if(ArrayBuffer.isView(t))e=t.slice(),i=e.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const s=i>>2,n=i-s*4,r=new Uint32Array(e.buffer,0,s);let a=0,l=0,c=this.h1,h=this.h2;const d=3432918353,u=461845907,p=d&qt,m=u&qt;for(let g=0;g<s;g++)g&1?(a=r[g],a=a*d&jt|a*p&qt,a=a<<15|a>>>17,a=a*u&jt|a*m&qt,c^=a,c=c<<13|c>>>19,c=c*5+3864292196):(l=r[g],l=l*d&jt|l*p&qt,l=l<<15|l>>>17,l=l*u&jt|l*m&qt,h^=l,h=h<<13|h>>>19,h=h*5+3864292196);switch(a=0,n){case 3:a^=e[s*4+2]<<16;case 2:a^=e[s*4+1]<<8;case 1:a^=e[s*4],a=a*d&jt|a*p&qt,a=a<<15|a>>>17,a=a*u&jt|a*m&qt,s&1?c^=a:h^=a}this.h1=c,this.h2=h}hexdigest(){let t=this.h1,e=this.h2;return t^=e>>>1,t=t*3981806797&jt|t*36045&qt,e=e*4283543511&jt|((e<<16|t>>>16)*2950163797&jt)>>>16,t^=e>>>1,t=t*444984403&jt|t*60499&qt,e=e*3301882366&jt|((e<<16|t>>>16)*3120437893&jt)>>>16,t^=e>>>1,(t>>>0).toString(16).padStart(8,"0")+(e>>>0).toString(16).padStart(8,"0")}}const ps=Object.freeze({map:null,hash:"",transfer:void 0});class Ds{#t=!1;#e=null;#s=null;#i=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(t,e){const i=this.#i.get(t);return i===void 0?e:Object.assign(e,i)}getRawValue(t){return this.#i.get(t)}remove(t){const e=this.#i.get(t);if(e!==void 0&&(e instanceof I&&this.#s.delete(e.annotationElementId),this.#i.delete(t),this.#i.size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function")){for(const i of this.#i.values())if(i instanceof I)return;this.onAnnotationEditor(null)}}setValue(t,e){const i=this.#i.get(t);let s=!1;if(i!==void 0)for(const[n,r]of Object.entries(e))i[n]!==r&&(s=!0,i[n]=r);else s=!0,this.#i.set(t,e);s&&this.#a(),e instanceof I&&((this.#s||=new Map).set(e.annotationElementId,e),typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(e.constructor._type))}has(t){return this.#i.has(t)}get size(){return this.#i.size}#a(){this.#t||(this.#t=!0,typeof this.onSetModified=="function"&&this.onSetModified())}resetModified(){this.#t&&(this.#t=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new ur(this)}get serializable(){if(this.#i.size===0)return ps;const t=new Map,e=new dr,i=[],s=Object.create(null);let n=!1;for(const[r,a]of this.#i){const l=a instanceof I?a.serialize(!1,s):a;l&&(t.set(r,l),e.update(`${r}:${JSON.stringify(l)}`),n||=!!l.bitmap)}if(n)for(const r of t.values())r.bitmap&&i.push(r.bitmap);return t.size>0?{map:t,hash:e.hexdigest(),transfer:i}:ps}get editorStats(){let t=null;const e=new Map;let i=0,s=0;for(const n of this.#i.values()){if(!(n instanceof I)){n.popup&&(n.popup.deleted?s+=1:i+=1);continue}n.isCommentDeleted?s+=1:n.hasEditedComment&&(i+=1);const r=n.telemetryFinalData;if(!r)continue;const{type:a}=r;e.has(a)||e.set(a,Object.getPrototypeOf(n).constructor),t||=Object.create(null);const l=t[a]||=new Map;for(const[c,h]of Object.entries(r)){if(c==="type")continue;let d=l.get(c);d||(d=new Map,l.set(c,d));const u=d.get(h)??0;d.set(h,u+1)}}if((s>0||i>0)&&(t||=Object.create(null),t.comments={deleted:s,edited:i}),!t)return null;for(const[n,r]of e)t[n]=r.computeTelemetryFinalData(t[n]);return t}resetModifiedIds(){this.#e=null}updateEditor(t,e){const i=this.#s?.get(t);return i?(i.updateFromAnnotationLayer(e),!0):!1}getEditor(t){return this.#s?.get(t)||null}get modifiedIds(){if(this.#e)return this.#e;const t=[];if(this.#s)for(const e of this.#s.values())e.serialize()&&t.push(e.annotationElementId);return this.#e={ids:new Set(t),hash:t.join(",")}}[Symbol.iterator](){return this.#i.entries()}}class ur extends Ds{#t;constructor(t){super();const{map:e,hash:i,transfer:s}=t.serializable,n=structuredClone(e,s?{transfer:s}:null);this.#t={map:n,hash:i,transfer:s}}get print(){J("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#t}get modifiedIds(){return z(this,"modifiedIds",{ids:new Set,hash:""})}}class Xo{#t=new Set;constructor({ownerDocument:t=globalThis.document,styleElement:e=null}){this._document=t,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(t){this.nativeFontFaces.add(t),this._document.fonts.add(t)}removeNativeFontFace(t){this.nativeFontFaces.delete(t),this._document.fonts.delete(t)}insertRule(t){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const e=this.styleElement.sheet;e.insertRule(t,e.cssRules.length)}clear(){for(const t of this.nativeFontFaces)this._document.fonts.delete(t);this.nativeFontFaces.clear(),this.#t.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:t,disableFontFace:e,_inspectFont:i}){if(!(!t||this.#t.has(t.loadedName))){if(W(!e,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:s,src:n,style:r}=t,a=new FontFace(s,n,r);this.addNativeFontFace(a);try{await a.load(),this.#t.add(s),i?.(t)}catch{B(`Cannot load system font: ${t.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(a)}return}J("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(t){if(t.attached||t.missingFile&&!t.systemFontInfo)return;if(t.attached=!0,t.systemFontInfo){await this.loadSystemFont(t);return}if(this.isFontLoadingAPISupported){const i=t.createNativeFontFace();if(i){this.addNativeFontFace(i);try{await i.loaded}catch(s){throw B(`Failed to load font '${i.family}': '${s}'.`),t.disableFontFace=!0,s}}return}const e=t.createFontFaceRule();if(e){if(this.insertRule(e),this.isSyncFontLoadingSupported)return;await new Promise(i=>{const s=this._queueLoadingCallback(i);this._prepareFontLoadEvent(t,s)})}}get isFontLoadingAPISupported(){const t=!!this._document?.fonts;return z(this,"isFontLoadingAPISupported",t)}get isSyncFontLoadingSupported(){return z(this,"isSyncFontLoadingSupported",Ct||bt.platform.isFirefox)}_queueLoadingCallback(t){function e(){for(W(!s.done,"completeRequest() cannot be called twice."),s.done=!0;i.length>0&&i[0].done;){const n=i.shift();setTimeout(n.callback,0)}}const{loadingRequests:i}=this,s={done:!1,complete:e,callback:t};return i.push(s),s}get _loadTestFont(){const t=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return z(this,"_loadTestFont",t)}_prepareFontLoadEvent(t,e){function i(A,x){return A.charCodeAt(x)<<24|A.charCodeAt(x+1)<<16|A.charCodeAt(x+2)<<8|A.charCodeAt(x+3)&255}function s(A,x,S,k){const _=A.substring(0,x),E=A.substring(x+S);return _+k+E}let n,r;const a=this._document.createElement("canvas");a.width=1,a.height=1;const l=a.getContext("2d");let c=0;function h(A,x){if(++c>30){B("Load test font never loaded."),x();return}if(l.font="30px "+A,l.fillText(".",0,20),l.getImageData(0,0,1,1).data[3]>0){x();return}setTimeout(h.bind(null,A,x))}const d=`lt${Date.now()}${this.loadTestFontId++}`;let u=this._loadTestFont;u=s(u,976,d.length,d);const m=16,g=1482184792;let y=i(u,m);for(n=0,r=d.length-3;n<r;n+=4)y=y-g+i(d,n)|0;n<d.length&&(y=y-g+i(d+"XXX",n)|0),u=s(u,m,4,Io(y));const b=`url(data:font/opentype;base64,${btoa(u)});`,v=`@font-face {font-family:"${d}";src:${b}}`;this.insertRule(v);const w=this._document.createElement("div");w.style.visibility="hidden",w.style.width=w.style.height="10px",w.style.position="absolute",w.style.top=w.style.left="0px";for(const A of[t.loadedName,d]){const x=this._document.createElement("span");x.textContent="Hi",x.style.fontFamily=A,w.append(x)}this._document.body.append(w),h(d,()=>{w.remove(),e.complete()})}}class Yo{#t;constructor(t,e=null,i,s){this.compiledGlyphs=Object.create(null),this.#t=t,this._inspectFont=e,i&&Object.assign(this,i),s&&(this.charProcOperatorList=s)}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let t;if(!this.cssFontInfo)t=new FontFace(this.loadedName,this.data,{});else{const e={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(e.style=`oblique ${this.cssFontInfo.italicAngle}deg`),t=new FontFace(this.cssFontInfo.fontFamily,this.data,e)}return this._inspectFont?.(this),t}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const t=`url(data:${this.mimetype};base64,${sr(this.data)});`;let e;if(!this.cssFontInfo)e=`@font-face {font-family:"${this.loadedName}";src:${t}}`;else{let i=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(i+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),e=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${i}src:${t}}`}return this._inspectFont?.(this,t),e}getPathGenerator(t,e){if(this.compiledGlyphs[e]!==void 0)return this.compiledGlyphs[e];const i=this.loadedName+"_path_"+e;let s;try{s=t.get(i)}catch(r){B(`getPathGenerator - ignoring character: "${r}".`)}const n=new Path2D(s||"");return this.fontExtraProperties||t.delete(i),this.compiledGlyphs[e]=n}get black(){return this.#t.black}get bold(){return this.#t.bold}get disableFontFace(){return this.#t.disableFontFace??!1}get fontExtraProperties(){return this.#t.fontExtraProperties??!1}get isInvalidPDFjsFont(){return this.#t.isInvalidPDFjsFont}get isType3Font(){return this.#t.isType3Font}get italic(){return this.#t.italic}get missingFile(){return this.#t.missingFile}get remeasure(){return this.#t.remeasure}get vertical(){return this.#t.vertical}get ascent(){return this.#t.ascent}get defaultWidth(){return this.#t.defaultWidth}get descent(){return this.#t.descent}get bbox(){return this.#t.bbox}get fontMatrix(){return this.#t.fontMatrix}get fallbackName(){return this.#t.fallbackName}get loadedName(){return this.#t.loadedName}get mimetype(){return this.#t.mimetype}get name(){return this.#t.name}get data(){return this.#t.data}clearData(){this.#t.clearData()}get cssFontInfo(){return this.#t.cssFontInfo}get systemFontInfo(){return this.#t.systemFontInfo}get defaultVMetrics(){return this.#t.defaultVMetrics}}function Ko(o){if(o instanceof URL)return o.href;if(typeof o=="string"){if(Ct)return o;const t=URL.parse(o,window.location);if(t)return t.href}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function Qo(o){if(Ct&&typeof Buffer<"u"&&o instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(o instanceof Uint8Array&&o.byteLength===o.buffer.byteLength)return o;if(typeof o=="string")return oi(o);if(o instanceof ArrayBuffer||ArrayBuffer.isView(o)||typeof o=="object"&&!isNaN(o?.length))return new Uint8Array(o);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function vi(o){if(typeof o!="string")return null;if(o.endsWith("/"))return o;throw new Error(`Invalid factory url: "${o}" must include trailing slash.`)}const fs=o=>typeof o=="object"&&Number.isInteger(o?.num)&&o.num>=0&&Number.isInteger(o?.gen)&&o.gen>=0,Jo=o=>typeof o=="object"&&typeof o?.name=="string",pr=Bo.bind(null,fs,Jo);class Zo{#t=new Map;#e=Promise.resolve();postMessage(t,e){const i={data:structuredClone(t,e?{transfer:e}:null)};this.#e.then(()=>{for(const[s]of this.#t)s.call(this,i)})}addEventListener(t,e,i=null){let s=null;if(i?.signal instanceof AbortSignal){const{signal:n}=i;if(n.aborted){B("LoopbackPort - cannot use an `aborted` signal.");return}const r=()=>this.removeEventListener(t,e);s=()=>n.removeEventListener("abort",r),n.addEventListener("abort",r)}this.#t.set(e,s)}removeEventListener(t,e){this.#t.get(e)?.(),this.#t.delete(e)}terminate(){for(const[,t]of this.#t)t?.();this.#t.clear()}}const xi={DATA:1,ERROR:2},ut={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function hn(){}function Mt(o){if(o instanceof se||o instanceof Di||o instanceof en||o instanceof ti||o instanceof es)return o;switch(o instanceof Error||typeof o=="object"&&o!==null||J('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),o.name){case"AbortException":return new se(o.message);case"InvalidPDFException":return new Di(o.message);case"PasswordException":return new en(o.message,o.code);case"ResponseException":return new ti(o.message,o.status,o.missing);case"UnknownErrorException":return new es(o.message,o.details)}return new es(o.message,o.toString())}class Xe{#t=new AbortController;constructor(t,e,i){this.sourceName=t,this.targetName=e,this.comObj=i,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),i.addEventListener("message",this.#e.bind(this),{signal:this.#t.signal})}#e({data:t}){if(t.targetName!==this.sourceName)return;if(t.stream){this.#i(t);return}if(t.callback){const i=t.callbackId,s=this.callbackCapabilities[i];if(!s)throw new Error(`Cannot resolve callback ${i}`);if(delete this.callbackCapabilities[i],t.callback===xi.DATA)s.resolve(t.data);else if(t.callback===xi.ERROR)s.reject(Mt(t.reason));else throw new Error("Unexpected callback case");return}const e=this.actionHandler[t.action];if(!e)throw new Error(`Unknown action from worker: ${t.action}`);if(t.callbackId){const i=this.sourceName,s=t.sourceName,n=this.comObj;Promise.try(e,t.data).then(function(r){n.postMessage({sourceName:i,targetName:s,callback:xi.DATA,callbackId:t.callbackId,data:r})},function(r){n.postMessage({sourceName:i,targetName:s,callback:xi.ERROR,callbackId:t.callbackId,reason:Mt(r)})});return}if(t.streamId){this.#s(t);return}e(t.data)}on(t,e){const i=this.actionHandler;if(i[t])throw new Error(`There is already an actionName called "${t}"`);i[t]=e}send(t,e,i){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,data:e},i)}sendWithPromise(t,e,i){const s=this.callbackId++,n=Promise.withResolvers();this.callbackCapabilities[s]=n;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,callbackId:s,data:e},i)}catch(r){n.reject(r)}return n.promise}sendWithStream(t,e,i,s){const n=this.streamId++,r=this.sourceName,a=this.targetName,l=this.comObj;return new ReadableStream({start:c=>{const h=Promise.withResolvers();return this.streamControllers[n]={controller:c,startCall:h,pullCall:null,cancelCall:null,isClosed:!1},l.postMessage({sourceName:r,targetName:a,action:t,streamId:n,data:e,desiredSize:c.desiredSize},s),h.promise},pull:c=>{const h=Promise.withResolvers();return this.streamControllers[n].pullCall=h,l.postMessage({sourceName:r,targetName:a,stream:ut.PULL,streamId:n,desiredSize:c.desiredSize}),h.promise},cancel:c=>{W(c instanceof Error,"cancel must have a valid reason");const h=Promise.withResolvers();return this.streamControllers[n].cancelCall=h,this.streamControllers[n].isClosed=!0,l.postMessage({sourceName:r,targetName:a,stream:ut.CANCEL,streamId:n,reason:Mt(c)}),h.promise}},i)}#s(t){const e=t.streamId,i=this.sourceName,s=t.sourceName,n=this.comObj,r=this,a=this.actionHandler[t.action],l={enqueue(c,h=1,d){if(this.isCancelled)return;const u=this.desiredSize;this.desiredSize-=h,u>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),n.postMessage({sourceName:i,targetName:s,stream:ut.ENQUEUE,streamId:e,chunk:c},d)},close(){this.isCancelled||(this.isCancelled=!0,n.postMessage({sourceName:i,targetName:s,stream:ut.CLOSE,streamId:e}),delete r.streamSinks[e])},error(c){W(c instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,n.postMessage({sourceName:i,targetName:s,stream:ut.ERROR,streamId:e,reason:Mt(c)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:t.desiredSize,ready:null};l.sinkCapability.resolve(),l.ready=l.sinkCapability.promise,this.streamSinks[e]=l,Promise.try(a,t.data,l).then(function(){n.postMessage({sourceName:i,targetName:s,stream:ut.START_COMPLETE,streamId:e,success:!0})},function(c){n.postMessage({sourceName:i,targetName:s,stream:ut.START_COMPLETE,streamId:e,reason:Mt(c)})})}#i(t){const e=t.streamId,i=this.sourceName,s=t.sourceName,n=this.comObj,r=this.streamControllers[e],a=this.streamSinks[e];switch(t.stream){case ut.START_COMPLETE:t.success?r.startCall.resolve():r.startCall.reject(Mt(t.reason));break;case ut.PULL_COMPLETE:t.success?r.pullCall.resolve():r.pullCall.reject(Mt(t.reason));break;case ut.PULL:if(!a){n.postMessage({sourceName:i,targetName:s,stream:ut.PULL_COMPLETE,streamId:e,success:!0});break}a.desiredSize<=0&&t.desiredSize>0&&a.sinkCapability.resolve(),a.desiredSize=t.desiredSize,Promise.try(a.onPull||hn).then(function(){n.postMessage({sourceName:i,targetName:s,stream:ut.PULL_COMPLETE,streamId:e,success:!0})},function(c){n.postMessage({sourceName:i,targetName:s,stream:ut.PULL_COMPLETE,streamId:e,reason:Mt(c)})});break;case ut.ENQUEUE:if(W(r,"enqueue should have stream controller"),r.isClosed)break;r.controller.enqueue(t.chunk);break;case ut.CLOSE:if(W(r,"close should have stream controller"),r.isClosed)break;r.isClosed=!0,r.controller.close(),this.#a(r,e);break;case ut.ERROR:W(r,"error should have stream controller"),r.controller.error(Mt(t.reason)),this.#a(r,e);break;case ut.CANCEL_COMPLETE:t.success?r.cancelCall.resolve():r.cancelCall.reject(Mt(t.reason)),this.#a(r,e);break;case ut.CANCEL:if(!a)break;const l=Mt(t.reason);Promise.try(a.onCancel||hn,l).then(function(){n.postMessage({sourceName:i,targetName:s,stream:ut.CANCEL_COMPLETE,streamId:e,success:!0})},function(c){n.postMessage({sourceName:i,targetName:s,stream:ut.CANCEL_COMPLETE,streamId:e,reason:Mt(c)})}),a.sinkCapability.reject(l),a.isCancelled=!0,delete this.streamSinks[e];break;default:throw new Error("Unexpected stream case")}}async#a(t,e){await Promise.allSettled([t.startCall?.promise,t.pullCall?.promise,t.cancelCall?.promise]),delete this.streamControllers[e]}destroy(){this.#t?.abort(),this.#t=null}}class fr{#t=!1;constructor({enableHWA:t=!1}){this.#t=t}create(t,e){if(t<=0||e<=0)throw new Error("Invalid canvas size");const i=this._createCanvas(t,e);return{canvas:i,context:i.getContext("2d",{willReadFrequently:!this.#t})}}reset(t,e,i){if(!t.canvas)throw new Error("Canvas is not specified");if(e<=0||i<=0)throw new Error("Invalid canvas size");t.canvas.width=e,t.canvas.height=i}destroy(t){if(!t.canvas)throw new Error("Canvas is not specified");t.canvas.width=0,t.canvas.height=0,t.canvas=null,t.context=null}_createCanvas(t,e){J("Abstract method `_createCanvas` called.")}}class tl extends fr{constructor({ownerDocument:t=globalThis.document,enableHWA:e=!1}){super({enableHWA:e}),this._document=t}_createCanvas(t,e){const i=this._document.createElement("canvas");return i.width=t,i.height=e,i}}class gr{constructor({baseUrl:t=null,isCompressed:e=!0}){this.baseUrl=t,this.isCompressed=e}async fetch({name:t}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!t)throw new Error("CMap name must be specified.");const e=this.baseUrl+t+(this.isCompressed?".bcmap":"");return this._fetch(e).then(i=>({cMapData:i,isCompressed:this.isCompressed})).catch(i=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${e}`)})}async _fetch(t){J("Abstract method `_fetch` called.")}}class dn extends gr{async _fetch(t){const e=await Be(t,this.isCompressed?"arraybuffer":"text");return e instanceof ArrayBuffer?new Uint8Array(e):oi(e)}}class mr{addFilter(t){return"none"}addHCMFilter(t,e){return"none"}addAlphaFilter(t){return"none"}addLuminosityFilter(t){return"none"}addHighlightHCMFilter(t,e,i,s,n){return"none"}destroy(t=!1){}}class el extends mr{#t;#e;#s;#i;#a;#n;#r=0;constructor({docId:t,ownerDocument:e=globalThis.document}){super(),this.#i=t,this.#a=e}get#o(){return this.#e||=new Map}get#c(){return this.#n||=new Map}get#l(){if(!this.#s){const t=this.#a.createElement("div"),{style:e}=t;e.visibility="hidden",e.contain="strict",e.width=e.height=0,e.position="absolute",e.top=e.left=0,e.zIndex=-1;const i=this.#a.createElementNS(te,"svg");i.setAttribute("width",0),i.setAttribute("height",0),this.#s=this.#a.createElementNS(te,"defs"),t.append(i),i.append(this.#s),this.#a.body.append(t)}return this.#s}#u(t){if(t.length===1){const l=t[0],c=new Array(256);for(let d=0;d<256;d++)c[d]=l[d]/255;const h=c.join(",");return[h,h,h]}const[e,i,s]=t,n=new Array(256),r=new Array(256),a=new Array(256);for(let l=0;l<256;l++)n[l]=e[l]/255,r[l]=i[l]/255,a[l]=s[l]/255;return[n.join(","),r.join(","),a.join(",")]}#d(t){if(this.#t===void 0){this.#t="";const e=this.#a.URL;e!==this.#a.baseURI&&(ci(e)?B('#createUrl: ignore "data:"-URL for performance reasons.'):this.#t=Es(e,""))}return`url(${this.#t}#${t})`}addFilter(t){if(!t)return"none";let e=this.#o.get(t);if(e)return e;const[i,s,n]=this.#u(t),r=t.length===1?i:`${i}${s}${n}`;if(e=this.#o.get(r),e)return this.#o.set(t,e),e;const a=`g_${this.#i}_transfer_map_${this.#r++}`,l=this.#d(a);this.#o.set(t,l),this.#o.set(r,l);const c=this.#f(a);return this.#g(i,s,n,c),l}addHCMFilter(t,e){const i=`${t}-${e}`,s="base";let n=this.#c.get(s);if(n?.key===i||(n?(n.filter?.remove(),n.key=i,n.url="none",n.filter=null):(n={key:i,url:"none",filter:null},this.#c.set(s,n)),!t||!e))return n.url;const r=this.#w(t);t=N.makeHexColor(...r);const a=this.#w(e);if(e=N.makeHexColor(...a),this.#l.style.color="",t==="#000000"&&e==="#ffffff"||t===e)return n.url;const l=new Array(256);for(let p=0;p<=255;p++){const m=p/255;l[p]=m<=.03928?m/12.92:((m+.055)/1.055)**2.4}const c=l.join(","),h=`g_${this.#i}_hcm_filter`,d=n.filter=this.#f(h);this.#g(c,c,c,d),this.#m(d);const u=(p,m)=>{const g=r[p]/255,y=a[p]/255,b=new Array(m+1);for(let v=0;v<=m;v++)b[v]=g+v/m*(y-g);return b.join(",")};return this.#g(u(0,5),u(1,5),u(2,5),d),n.url=this.#d(h),n.url}addAlphaFilter(t){let e=this.#o.get(t);if(e)return e;const[i]=this.#u([t]),s=`alpha_${i}`;if(e=this.#o.get(s),e)return this.#o.set(t,e),e;const n=`g_${this.#i}_alpha_map_${this.#r++}`,r=this.#d(n);this.#o.set(t,r),this.#o.set(s,r);const a=this.#f(n);return this.#b(i,a),r}addLuminosityFilter(t){let e=this.#o.get(t||"luminosity");if(e)return e;let i,s;if(t?([i]=this.#u([t]),s=`luminosity_${i}`):s="luminosity",e=this.#o.get(s),e)return this.#o.set(t,e),e;const n=`g_${this.#i}_luminosity_map_${this.#r++}`,r=this.#d(n);this.#o.set(t,r),this.#o.set(s,r);const a=this.#f(n);return this.#p(a),t&&this.#b(i,a),r}addHighlightHCMFilter(t,e,i,s,n){const r=`${e}-${i}-${s}-${n}`;let a=this.#c.get(t);if(a?.key===r||(a?(a.filter?.remove(),a.key=r,a.url="none",a.filter=null):(a={key:r,url:"none",filter:null},this.#c.set(t,a)),!e||!i))return a.url;const[l,c]=[e,i].map(this.#w.bind(this));let h=Math.round(.2126*l[0]+.7152*l[1]+.0722*l[2]),d=Math.round(.2126*c[0]+.7152*c[1]+.0722*c[2]),[u,p]=[s,n].map(this.#w.bind(this));d<h&&([h,d,u,p]=[d,h,p,u]),this.#l.style.color="";const m=(b,v,w)=>{const A=new Array(256),x=(d-h)/w,S=b/255,k=(v-b)/(255*w);let _=0;for(let E=0;E<=w;E++){const L=Math.round(h+E*x),P=S+E*k;for(let G=_;G<=L;G++)A[G]=P;_=L+1}for(let E=_;E<256;E++)A[E]=A[_-1];return A.join(",")},g=`g_${this.#i}_hcm_${t}_filter`,y=a.filter=this.#f(g);return this.#m(y),this.#g(m(u[0],p[0],5),m(u[1],p[1],5),m(u[2],p[2],5),y),a.url=this.#d(g),a.url}destroy(t=!1){t&&this.#n?.size||(this.#s?.parentNode.parentNode.remove(),this.#s=null,this.#e?.clear(),this.#e=null,this.#n?.clear(),this.#n=null,this.#r=0)}#p(t){const e=this.#a.createElementNS(te,"feColorMatrix");e.setAttribute("type","matrix"),e.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(e)}#m(t){const e=this.#a.createElementNS(te,"feColorMatrix");e.setAttribute("type","matrix"),e.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(e)}#f(t){const e=this.#a.createElementNS(te,"filter");return e.setAttribute("color-interpolation-filters","sRGB"),e.setAttribute("id",t),this.#l.append(e),e}#h(t,e,i){const s=this.#a.createElementNS(te,e);s.setAttribute("type","discrete"),s.setAttribute("tableValues",i),t.append(s)}#g(t,e,i,s){const n=this.#a.createElementNS(te,"feComponentTransfer");s.append(n),this.#h(n,"feFuncR",t),this.#h(n,"feFuncG",e),this.#h(n,"feFuncB",i)}#b(t,e){const i=this.#a.createElementNS(te,"feComponentTransfer");e.append(i),this.#h(i,"feFuncA",t)}#w(t){return this.#l.style.color=t,He(getComputedStyle(this.#l).getPropertyValue("color"))}}class br{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!t)throw new Error("Font filename must be specified.");const e=`${this.baseUrl}${t}`;return this._fetch(e).catch(i=>{throw new Error(`Unable to load font data at: ${e}`)})}async _fetch(t){J("Abstract method `_fetch` called.")}}class un extends br{async _fetch(t){const e=await Be(t,"arraybuffer");return new Uint8Array(e)}}class yr{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error("Ensure that the `wasmUrl` API parameter is provided.");if(!t)throw new Error("Wasm filename must be specified.");const e=`${this.baseUrl}${t}`;return this._fetch(e).catch(i=>{throw new Error(`Unable to load wasm data at: ${e}`)})}async _fetch(t){J("Abstract method `_fetch` called.")}}class pn extends yr{async _fetch(t){const e=await Be(t,"arraybuffer");return new Uint8Array(e)}}Ct&&B("Please use the `legacy` build in Node.js environments.");async function Ns(o){const e=await process.getBuiltinModule("fs").promises.readFile(o);return new Uint8Array(e)}class il extends mr{}class sl extends fr{_createCanvas(t,e){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(t,e)}}class nl extends gr{async _fetch(t){return Ns(t)}}class rl extends br{async _fetch(t){return Ns(t)}}class al extends yr{async _fetch(t){return Ns(t)}}const ke="__forcedDependency",{floor:fn,ceil:gn}=Math;function Ai(o,t,e,i,s,n){o[t*4+0]=Math.min(o[t*4+0],e),o[t*4+1]=Math.min(o[t*4+1],i),o[t*4+2]=Math.max(o[t*4+2],s),o[t*4+3]=Math.max(o[t*4+3],n)}const gs=new Uint32Array(new Uint8Array([255,255,0,0]).buffer)[0];class ol{#t;#e;constructor(t,e){this.#t=t,this.#e=e}get length(){return this.#t.length}isEmpty(t){return this.#t[t]===gs}minX(t){return this.#e[t*4+0]/256}minY(t){return this.#e[t*4+1]/256}maxX(t){return(this.#e[t*4+2]+1)/256}maxY(t){return(this.#e[t*4+3]+1)/256}}const Si=(o,t)=>{if(!o)return;let e=o.get(t);return e||(e={dependencies:new Set,isRenderingOperation:!1},o.set(t,e)),e};class ll{#t={__proto__:null};#e={__proto__:null,transform:[],moveText:[],sameLineText:[],[ke]:[]};#s=new Map;#i=[];#a=[];#n=[[1,0,0,1,0,0]];#r=[-1/0,-1/0,1/0,1/0];#o=new Float64Array([1/0,1/0,-1/0,-1/0]);#c=-1;#l=new Set;#u=new Map;#d=new Map;#p;#m;#f;#h;#g;constructor(t,e,i=!1){this.#p=t.width,this.#m=t.height,this.#b(e),i&&(this.#g=new Map)}growOperationsCount(t){t>=this.#h.length&&this.#b(t,this.#h)}#b(t,e){const i=new ArrayBuffer(t*4);this.#f=new Uint8ClampedArray(i),this.#h=new Uint32Array(i),e&&e.length>0?(this.#h.set(e),this.#h.fill(gs,e.length)):this.#h.fill(gs)}save(t){return this.#t={__proto__:this.#t},this.#e={__proto__:this.#e,transform:{__proto__:this.#e.transform},moveText:{__proto__:this.#e.moveText},sameLineText:{__proto__:this.#e.sameLineText},[ke]:{__proto__:this.#e[ke]}},this.#r={__proto__:this.#r},this.#i.push(t),this}restore(t){const e=Object.getPrototypeOf(this.#t);if(e===null)return this;this.#t=e,this.#e=Object.getPrototypeOf(this.#e),this.#r=Object.getPrototypeOf(this.#r);const i=this.#i.pop();return i!==void 0&&(Si(this.#g,t)?.dependencies.add(i),this.#h[t]=this.#h[i]),this}recordOpenMarker(t){return this.#i.push(t),this}getOpenMarker(){return this.#i.length===0?null:this.#i.at(-1)}recordCloseMarker(t){const e=this.#i.pop();return e!==void 0&&(Si(this.#g,t)?.dependencies.add(e),this.#h[t]=this.#h[e]),this}beginMarkedContent(t){return this.#a.push(t),this}endMarkedContent(t){const e=this.#a.pop();return e!==void 0&&(Si(this.#g,t)?.dependencies.add(e),this.#h[t]=this.#h[e]),this}pushBaseTransform(t){return this.#n.push(N.multiplyByDOMMatrix(this.#n.at(-1),t.getTransform())),this}popBaseTransform(){return this.#n.length>1&&this.#n.pop(),this}recordSimpleData(t,e){return this.#t[t]=e,this}recordIncrementalData(t,e){return this.#e[t].push(e),this}resetIncrementalData(t,e){return this.#e[t].length=0,this}recordNamedData(t,e){return this.#s.set(t,e),this}recordSimpleDataFromNamed(t,e,i){this.#t[t]=this.#s.get(e)??i}recordFutureForcedDependency(t,e){return this.recordIncrementalData(ke,e),this}inheritSimpleDataAsFutureForcedDependencies(t){for(const e of t)e in this.#t&&this.recordFutureForcedDependency(e,this.#t[e]);return this}inheritPendingDependenciesAsFutureForcedDependencies(){for(const t of this.#l)this.recordFutureForcedDependency(ke,t);return this}resetBBox(t){return this.#c!==t&&(this.#c=t,this.#o[0]=1/0,this.#o[1]=1/0,this.#o[2]=-1/0,this.#o[3]=-1/0),this}recordClipBox(t,e,i,s,n,r){const a=N.multiplyByDOMMatrix(this.#n.at(-1),e.getTransform()),l=[1/0,1/0,-1/0,-1/0];N.axialAlignedBoundingBox([i,n,s,r],a,l);const c=N.intersect(this.#r,l);return c?(this.#r[0]=c[0],this.#r[1]=c[1],this.#r[2]=c[2],this.#r[3]=c[3]):(this.#r[0]=this.#r[1]=1/0,this.#r[2]=this.#r[3]=-1/0),this}recordBBox(t,e,i,s,n,r){const a=this.#r;if(a[0]===1/0)return this;const l=N.multiplyByDOMMatrix(this.#n.at(-1),e.getTransform());if(a[0]===-1/0)return N.axialAlignedBoundingBox([i,n,s,r],l,this.#o),this;const c=[1/0,1/0,-1/0,-1/0];return N.axialAlignedBoundingBox([i,n,s,r],l,c),this.#o[0]=Math.min(this.#o[0],Math.max(c[0],a[0])),this.#o[1]=Math.min(this.#o[1],Math.max(c[1],a[1])),this.#o[2]=Math.max(this.#o[2],Math.min(c[2],a[2])),this.#o[3]=Math.max(this.#o[3],Math.min(c[3],a[3])),this}recordCharacterBBox(t,e,i,s=1,n=0,r=0,a){const l=i.bbox;let c,h;if(l&&(c=l[2]!==l[0]&&l[3]!==l[1]&&this.#d.get(i),c!==!1&&(h=[0,0,0,0],N.axialAlignedBoundingBox(l,i.fontMatrix,h),(s!==1||n!==0||r!==0)&&N.scaleMinMax([s,0,0,-s,n,r],h),c)))return this.recordBBox(t,e,h[0],h[2],h[1],h[3]);if(!a)return this.recordFullPageBBox(t);const d=a();return l&&h&&c===void 0&&(c=h[0]<=n-d.actualBoundingBoxLeft&&h[2]>=n+d.actualBoundingBoxRight&&h[1]<=r-d.actualBoundingBoxAscent&&h[3]>=r+d.actualBoundingBoxDescent,this.#d.set(i,c),c)?this.recordBBox(t,e,h[0],h[2],h[1],h[3]):this.recordBBox(t,e,n-d.actualBoundingBoxLeft,n+d.actualBoundingBoxRight,r-d.actualBoundingBoxAscent,r+d.actualBoundingBoxDescent)}recordFullPageBBox(t){return this.#o[0]=Math.max(0,this.#r[0]),this.#o[1]=Math.max(0,this.#r[1]),this.#o[2]=Math.min(this.#p,this.#r[2]),this.#o[3]=Math.min(this.#m,this.#r[3]),this}getSimpleIndex(t){return this.#t[t]}recordDependencies(t,e){const i=this.#l,s=this.#t,n=this.#e;for(const r of e)r in this.#t?i.add(s[r]):r in n&&n[r].forEach(i.add,i);return this}recordNamedDependency(t,e){return this.#s.has(e)&&this.#l.add(this.#s.get(e)),this}recordOperation(t,e=!1){if(this.recordDependencies(t,[ke]),this.#g){const i=Si(this.#g,t),{dependencies:s}=i;this.#l.forEach(s.add,s),this.#i.forEach(s.add,s),this.#a.forEach(s.add,s),s.delete(t),i.isRenderingOperation=!0}if(this.#c===t){const i=fn(this.#o[0]*256/this.#p),s=fn(this.#o[1]*256/this.#m),n=gn(this.#o[2]*256/this.#p),r=gn(this.#o[3]*256/this.#m);Ai(this.#f,t,i,s,n,r);for(const a of this.#l)a!==t&&Ai(this.#f,a,i,s,n,r);for(const a of this.#i)a!==t&&Ai(this.#f,a,i,s,n,r);for(const a of this.#a)a!==t&&Ai(this.#f,a,i,s,n,r);e||(this.#l.clear(),this.#c=-1)}return this}recordShowTextOperation(t,e=!1){const i=Array.from(this.#l);this.recordOperation(t,e),this.recordIncrementalData("sameLineText",t);for(const s of i)this.recordIncrementalData("sameLineText",s);return this}bboxToClipBoxDropOperation(t,e=!1){return this.#c===t&&(this.#c=-1,this.#r[0]=Math.max(this.#r[0],this.#o[0]),this.#r[1]=Math.max(this.#r[1],this.#o[1]),this.#r[2]=Math.min(this.#r[2],this.#o[2]),this.#r[3]=Math.min(this.#r[3],this.#o[3]),e||this.#l.clear()),this}_takePendingDependencies(){const t=this.#l;return this.#l=new Set,t}_extractOperation(t){const e=this.#u.get(t);return this.#u.delete(t),e}_pushPendingDependencies(t){for(const e of t)this.#l.add(e)}take(){return this.#d.clear(),new ol(this.#h,this.#f)}takeDebugMetadata(){return this.#g}}class Fi{#t;#e;#s;#i=0;#a=0;constructor(t,e,i){if(t instanceof Fi&&t.#s===!!i)return t;this.#t=t,this.#e=e,this.#s=!!i}growOperationsCount(){throw new Error("Unreachable")}save(t){return this.#a++,this.#t.save(this.#e),this}restore(t){return this.#a>0&&(this.#t.restore(this.#e),this.#a--),this}recordOpenMarker(t){return this.#i++,this}getOpenMarker(){return this.#i>0?this.#e:this.#t.getOpenMarker()}recordCloseMarker(t){return this.#i--,this}beginMarkedContent(t){return this}endMarkedContent(t){return this}pushBaseTransform(t){return this.#t.pushBaseTransform(t),this}popBaseTransform(){return this.#t.popBaseTransform(),this}recordSimpleData(t,e){return this.#t.recordSimpleData(t,this.#e),this}recordIncrementalData(t,e){return this.#t.recordIncrementalData(t,this.#e),this}resetIncrementalData(t,e){return this.#t.resetIncrementalData(t,this.#e),this}recordNamedData(t,e){return this}recordSimpleDataFromNamed(t,e,i){return this.#t.recordSimpleDataFromNamed(t,e,this.#e),this}recordFutureForcedDependency(t,e){return this.#t.recordFutureForcedDependency(t,this.#e),this}inheritSimpleDataAsFutureForcedDependencies(t){return this.#t.inheritSimpleDataAsFutureForcedDependencies(t),this}inheritPendingDependenciesAsFutureForcedDependencies(){return this.#t.inheritPendingDependenciesAsFutureForcedDependencies(),this}resetBBox(t){return this.#s||this.#t.resetBBox(this.#e),this}recordClipBox(t,e,i,s,n,r){return this.#s||this.#t.recordClipBox(this.#e,e,i,s,n,r),this}recordBBox(t,e,i,s,n,r){return this.#s||this.#t.recordBBox(this.#e,e,i,s,n,r),this}recordCharacterBBox(t,e,i,s,n,r,a){return this.#s||this.#t.recordCharacterBBox(this.#e,e,i,s,n,r,a),this}recordFullPageBBox(t){return this.#s||this.#t.recordFullPageBBox(this.#e),this}getSimpleIndex(t){return this.#t.getSimpleIndex(t)}recordDependencies(t,e){return this.#t.recordDependencies(this.#e,e),this}recordNamedDependency(t,e){return this.#t.recordNamedDependency(this.#e,e),this}recordOperation(t){return this.#t.recordOperation(this.#e,!0),this}recordShowTextOperation(t){return this.#t.recordShowTextOperation(this.#e,!0),this}bboxToClipBoxDropOperation(t){return this.#s||this.#t.bboxToClipBoxDropOperation(this.#e,!0),this}take(){throw new Error("Unreachable")}takeDebugMetadata(){throw new Error("Unreachable")}}const Bt={stroke:["path","transform","filter","strokeColor","strokeAlpha","lineWidth","lineCap","lineJoin","miterLimit","dash"],fill:["path","transform","filter","fillColor","fillAlpha","globalCompositeOperation","SMask"],imageXObject:["transform","SMask","filter","fillAlpha","strokeAlpha","globalCompositeOperation"],rawFillPath:["filter","fillColor","fillAlpha"],showText:["transform","leading","charSpacing","wordSpacing","hScale","textRise","moveText","textMatrix","font","fontObj","filter","fillColor","textRenderingMode","SMask","fillAlpha","strokeAlpha","globalCompositeOperation","sameLineText"],transform:["transform"],transformAndFill:["transform","fillColor"]},wt={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function ms(o,t){if(!t)return;const e=t[2]-t[0],i=t[3]-t[1],s=new Path2D;s.rect(t[0],t[1],e,i),o.clip(s)}class Is{isModifyingCurrentTransform(){return!1}getPattern(){J("Abstract method `getPattern` called.")}}class cl extends Is{constructor(t){super(),this._type=t[1],this._bbox=t[2],this._colorStops=t[3],this._p0=t[4],this._p1=t[5],this._r0=t[6],this._r1=t[7],this.matrix=null}_createGradient(t){let e;this._type==="axial"?e=t.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(e=t.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const i of this._colorStops)e.addColorStop(i[0],i[1]);return e}getPattern(t,e,i,s){let n;if(s===wt.STROKE||s===wt.FILL){const r=e.current.getClippedPathBoundingBox(s,at(t))||[0,0,0,0],a=Math.ceil(r[2]-r[0])||1,l=Math.ceil(r[3]-r[1])||1,c=e.cachedCanvases.getCanvas("pattern",a,l),h=c.context;h.clearRect(0,0,h.canvas.width,h.canvas.height),h.beginPath(),h.rect(0,0,h.canvas.width,h.canvas.height),h.translate(-r[0],-r[1]),i=N.transform(i,[1,0,0,1,r[0],r[1]]),h.transform(...e.baseTransform),this.matrix&&h.transform(...this.matrix),ms(h,this._bbox),h.fillStyle=this._createGradient(h),h.fill(),n=t.createPattern(c.canvas,"no-repeat");const d=new DOMMatrix(i);n.setTransform(d)}else ms(t,this._bbox),n=this._createGradient(t);return n}}function ns(o,t,e,i,s,n,r,a){const l=t.coords,c=t.colors,h=o.data,d=o.width*4;let u;l[e+1]>l[i+1]&&(u=e,e=i,i=u,u=n,n=r,r=u),l[i+1]>l[s+1]&&(u=i,i=s,s=u,u=r,r=a,a=u),l[e+1]>l[i+1]&&(u=e,e=i,i=u,u=n,n=r,r=u);const p=(l[e]+t.offsetX)*t.scaleX,m=(l[e+1]+t.offsetY)*t.scaleY,g=(l[i]+t.offsetX)*t.scaleX,y=(l[i+1]+t.offsetY)*t.scaleY,b=(l[s]+t.offsetX)*t.scaleX,v=(l[s+1]+t.offsetY)*t.scaleY;if(m>=v)return;const w=c[n],A=c[n+1],x=c[n+2],S=c[r],k=c[r+1],_=c[r+2],E=c[a],L=c[a+1],P=c[a+2],G=Math.round(m),H=Math.round(v);let O,$,M,R,U,nt,St,Ot;for(let tt=G;tt<=H;tt++){if(tt<y){const Z=tt<m?0:(m-tt)/(m-y);O=p-(p-g)*Z,$=w-(w-S)*Z,M=A-(A-k)*Z,R=x-(x-_)*Z}else{let Z;tt>v?Z=1:y===v?Z=0:Z=(y-tt)/(y-v),O=g-(g-b)*Z,$=S-(S-E)*Z,M=k-(k-L)*Z,R=_-(_-P)*Z}let X;tt<m?X=0:tt>v?X=1:X=(m-tt)/(m-v),U=p-(p-b)*X,nt=w-(w-E)*X,St=A-(A-L)*X,Ot=x-(x-P)*X;const kt=Math.round(Math.min(O,U)),Lt=Math.round(Math.max(O,U));let _t=d*tt+kt*4;for(let Z=kt;Z<=Lt;Z++)X=(O-Z)/(O-U),X<0?X=0:X>1&&(X=1),h[_t++]=$-($-nt)*X|0,h[_t++]=M-(M-St)*X|0,h[_t++]=R-(R-Ot)*X|0,h[_t++]=255}}function hl(o,t,e){const i=t.coords,s=t.colors;let n,r;switch(t.type){case"lattice":const a=t.verticesPerRow,l=Math.floor(i.length/a)-1,c=a-1;for(n=0;n<l;n++){let h=n*a;for(let d=0;d<c;d++,h++)ns(o,e,i[h],i[h+1],i[h+a],s[h],s[h+1],s[h+a]),ns(o,e,i[h+a+1],i[h+1],i[h+a],s[h+a+1],s[h+1],s[h+a])}break;case"triangles":for(n=0,r=i.length;n<r;n+=3)ns(o,e,i[n],i[n+1],i[n+2],s[n],s[n+1],s[n+2]);break;default:throw new Error("illegal figure")}}class dl extends Is{constructor(t){super(),this._coords=t[2],this._colors=t[3],this._figures=t[4],this._bounds=t[5],this._bbox=t[6],this._background=t[7],this.matrix=null}_createMeshCanvas(t,e,i){const a=Math.floor(this._bounds[0]),l=Math.floor(this._bounds[1]),c=Math.ceil(this._bounds[2])-a,h=Math.ceil(this._bounds[3])-l,d=Math.min(Math.ceil(Math.abs(c*t[0]*1.1)),3e3),u=Math.min(Math.ceil(Math.abs(h*t[1]*1.1)),3e3),p=c/d,m=h/u,g={coords:this._coords,colors:this._colors,offsetX:-a,offsetY:-l,scaleX:1/p,scaleY:1/m},y=d+4,b=u+4,v=i.getCanvas("mesh",y,b),w=v.context,A=w.createImageData(d,u);if(e){const S=A.data;for(let k=0,_=S.length;k<_;k+=4)S[k]=e[0],S[k+1]=e[1],S[k+2]=e[2],S[k+3]=255}for(const S of this._figures)hl(A,S,g);return w.putImageData(A,2,2),{canvas:v.canvas,offsetX:a-2*p,offsetY:l-2*m,scaleX:p,scaleY:m}}isModifyingCurrentTransform(){return!0}getPattern(t,e,i,s){ms(t,this._bbox);const n=new Float32Array(2);if(s===wt.SHADING)N.singularValueDecompose2dScale(at(t),n);else if(this.matrix){N.singularValueDecompose2dScale(this.matrix,n);const[a,l]=n;N.singularValueDecompose2dScale(e.baseTransform,n),n[0]*=a,n[1]*=l}else N.singularValueDecompose2dScale(e.baseTransform,n);const r=this._createMeshCanvas(n,s===wt.SHADING?null:this._background,e.cachedCanvases);return s!==wt.SHADING&&(t.setTransform(...e.baseTransform),this.matrix&&t.transform(...this.matrix)),t.translate(r.offsetX,r.offsetY),t.scale(r.scaleX,r.scaleY),t.createPattern(r.canvas,"no-repeat")}}class ul extends Is{getPattern(){return"hotpink"}}function pl(o){switch(o[0]){case"RadialAxial":return new cl(o);case"Mesh":return new dl(o);case"Dummy":return new ul}throw new Error(`Unknown IR type: ${o[0]}`)}const mn={COLORED:1,UNCOLORED:2};class Fs{static MAX_PATTERN_SIZE=3e3;constructor(t,e,i,s){this.color=t[1],this.operatorList=t[2],this.matrix=t[3],this.bbox=t[4],this.xstep=t[5],this.ystep=t[6],this.paintType=t[7],this.tilingType=t[8],this.ctx=e,this.canvasGraphicsFactory=i,this.baseTransform=s}createPatternCanvas(t,e){const{bbox:i,operatorList:s,paintType:n,tilingType:r,color:a,canvasGraphicsFactory:l}=this;let{xstep:c,ystep:h}=this;c=Math.abs(c),h=Math.abs(h),Bi("TilingType: "+r);const d=i[0],u=i[1],p=i[2],m=i[3],g=p-d,y=m-u,b=new Float32Array(2);N.singularValueDecompose2dScale(this.matrix,b);const[v,w]=b;N.singularValueDecompose2dScale(this.baseTransform,b);const A=v*b[0],x=w*b[1];let S=g,k=y,_=!1,E=!1;const L=Math.ceil(c*A),P=Math.ceil(h*x),G=Math.ceil(g*A),H=Math.ceil(y*x);L>=G?S=c:_=!0,P>=H?k=h:E=!0;const O=this.getSizeAndScale(S,this.ctx.canvas.width,A),$=this.getSizeAndScale(k,this.ctx.canvas.height,x),M=t.cachedCanvases.getCanvas("pattern",O.size,$.size),R=M.context,U=l.createCanvasGraphics(R,e);if(U.groupLevel=t.groupLevel,this.setFillAndStrokeStyleToContext(U,n,a),R.translate(-O.scale*d,-$.scale*u),U.transform(0,O.scale,0,0,$.scale,0,0),R.save(),U.dependencyTracker?.save(),this.clipBbox(U,d,u,p,m),U.baseTransform=at(U.ctx),U.executeOperatorList(s),U.endDrawing(),U.dependencyTracker?.restore(),R.restore(),_||E){const nt=M.canvas;_&&(S=c),E&&(k=h);const St=this.getSizeAndScale(S,this.ctx.canvas.width,A),Ot=this.getSizeAndScale(k,this.ctx.canvas.height,x),tt=St.size,X=Ot.size,kt=t.cachedCanvases.getCanvas("pattern-workaround",tt,X),Lt=kt.context,_t=_?Math.floor(g/c):0,Z=E?Math.floor(y/h):0;for(let Gt=0;Gt<=_t;Gt++)for(let Et=0;Et<=Z;Et++)Lt.drawImage(nt,tt*Gt,X*Et,tt,X,0,0,tt,X);return{canvas:kt.canvas,scaleX:St.scale,scaleY:Ot.scale,offsetX:d,offsetY:u}}return{canvas:M.canvas,scaleX:O.scale,scaleY:$.scale,offsetX:d,offsetY:u}}getSizeAndScale(t,e,i){const s=Math.max(Fs.MAX_PATTERN_SIZE,e);let n=Math.ceil(t*i);return n>=s?n=s:i=n/t,{scale:i,size:n}}clipBbox(t,e,i,s,n){const r=s-e,a=n-i;t.ctx.rect(e,i,r,a),N.axialAlignedBoundingBox([e,i,s,n],at(t.ctx),t.current.minMax),t.clip(),t.endPath()}setFillAndStrokeStyleToContext(t,e,i){const s=t.ctx,n=t.current;switch(e){case mn.COLORED:const{fillStyle:r,strokeStyle:a}=this.ctx;s.fillStyle=n.fillColor=r,s.strokeStyle=n.strokeColor=a;break;case mn.UNCOLORED:s.fillStyle=s.strokeStyle=i,n.fillColor=n.strokeColor=i;break;default:throw new No(`Unsupported paint type: ${e}`)}}isModifyingCurrentTransform(){return!1}getPattern(t,e,i,s,n){let r=i;s!==wt.SHADING&&(r=N.transform(r,e.baseTransform),this.matrix&&(r=N.transform(r,this.matrix)));const a=this.createPatternCanvas(e,n);let l=new DOMMatrix(r);l=l.translate(a.offsetX,a.offsetY),l=l.scale(1/a.scaleX,1/a.scaleY);const c=t.createPattern(a.canvas,"repeat");return c.setTransform(l),c}}function fl({src:o,srcPos:t=0,dest:e,width:i,height:s,nonBlackColor:n=4294967295,inverseDecode:r=!1}){const a=bt.isLittleEndian?4278190080:255,[l,c]=r?[n,a]:[a,n],h=i>>3,d=i&7,u=o.length;e=new Uint32Array(e.buffer);let p=0;for(let m=0;m<s;m++){for(const y=t+h;t<y;t++){const b=t<u?o[t]:255;e[p++]=b&128?c:l,e[p++]=b&64?c:l,e[p++]=b&32?c:l,e[p++]=b&16?c:l,e[p++]=b&8?c:l,e[p++]=b&4?c:l,e[p++]=b&2?c:l,e[p++]=b&1?c:l}if(d===0)continue;const g=t<u?o[t++]:255;for(let y=0;y<d;y++)e[p++]=g&1<<7-y?c:l}return{srcPos:t,destPos:p}}const bn=16,yn=100,gl=15,wn=10,Rt=16,rs=new DOMMatrix,It=new Float32Array(2),Te=new Float32Array([1/0,1/0,-1/0,-1/0]);function ml(o,t){if(o._removeMirroring)throw new Error("Context is already forwarding operations.");o.__originalSave=o.save,o.__originalRestore=o.restore,o.__originalRotate=o.rotate,o.__originalScale=o.scale,o.__originalTranslate=o.translate,o.__originalTransform=o.transform,o.__originalSetTransform=o.setTransform,o.__originalResetTransform=o.resetTransform,o.__originalClip=o.clip,o.__originalMoveTo=o.moveTo,o.__originalLineTo=o.lineTo,o.__originalBezierCurveTo=o.bezierCurveTo,o.__originalRect=o.rect,o.__originalClosePath=o.closePath,o.__originalBeginPath=o.beginPath,o._removeMirroring=()=>{o.save=o.__originalSave,o.restore=o.__originalRestore,o.rotate=o.__originalRotate,o.scale=o.__originalScale,o.translate=o.__originalTranslate,o.transform=o.__originalTransform,o.setTransform=o.__originalSetTransform,o.resetTransform=o.__originalResetTransform,o.clip=o.__originalClip,o.moveTo=o.__originalMoveTo,o.lineTo=o.__originalLineTo,o.bezierCurveTo=o.__originalBezierCurveTo,o.rect=o.__originalRect,o.closePath=o.__originalClosePath,o.beginPath=o.__originalBeginPath,delete o._removeMirroring},o.save=function(){t.save(),this.__originalSave()},o.restore=function(){t.restore(),this.__originalRestore()},o.translate=function(e,i){t.translate(e,i),this.__originalTranslate(e,i)},o.scale=function(e,i){t.scale(e,i),this.__originalScale(e,i)},o.transform=function(e,i,s,n,r,a){t.transform(e,i,s,n,r,a),this.__originalTransform(e,i,s,n,r,a)},o.setTransform=function(e,i,s,n,r,a){t.setTransform(e,i,s,n,r,a),this.__originalSetTransform(e,i,s,n,r,a)},o.resetTransform=function(){t.resetTransform(),this.__originalResetTransform()},o.rotate=function(e){t.rotate(e),this.__originalRotate(e)},o.clip=function(e){t.clip(e),this.__originalClip(e)},o.moveTo=function(e,i){t.moveTo(e,i),this.__originalMoveTo(e,i)},o.lineTo=function(e,i){t.lineTo(e,i),this.__originalLineTo(e,i)},o.bezierCurveTo=function(e,i,s,n,r,a){t.bezierCurveTo(e,i,s,n,r,a),this.__originalBezierCurveTo(e,i,s,n,r,a)},o.rect=function(e,i,s,n){t.rect(e,i,s,n),this.__originalRect(e,i,s,n)},o.closePath=function(){t.closePath(),this.__originalClosePath()},o.beginPath=function(){t.beginPath(),this.__originalBeginPath()}}class bl{constructor(t){this.canvasFactory=t,this.cache=Object.create(null)}getCanvas(t,e,i){let s;return this.cache[t]!==void 0?(s=this.cache[t],this.canvasFactory.reset(s,e,i)):(s=this.canvasFactory.create(e,i),this.cache[t]=s),s}delete(t){delete this.cache[t]}clear(){for(const t in this.cache){const e=this.cache[t];this.canvasFactory.destroy(e),delete this.cache[t]}}}function ki(o,t,e,i,s,n,r,a,l,c){const[h,d,u,p,m,g]=at(o);if(d===0&&u===0){const v=r*h+m,w=Math.round(v),A=a*p+g,x=Math.round(A),S=(r+l)*h+m,k=Math.abs(Math.round(S)-w)||1,_=(a+c)*p+g,E=Math.abs(Math.round(_)-x)||1;return o.setTransform(Math.sign(h),0,0,Math.sign(p),w,x),o.drawImage(t,e,i,s,n,0,0,k,E),o.setTransform(h,d,u,p,m,g),[k,E]}if(h===0&&p===0){const v=a*u+m,w=Math.round(v),A=r*d+g,x=Math.round(A),S=(a+c)*u+m,k=Math.abs(Math.round(S)-w)||1,_=(r+l)*d+g,E=Math.abs(Math.round(_)-x)||1;return o.setTransform(0,Math.sign(d),Math.sign(u),0,w,x),o.drawImage(t,e,i,s,n,0,0,E,k),o.setTransform(h,d,u,p,m,g),[E,k]}o.drawImage(t,e,i,s,n,r,a,l,c);const y=Math.hypot(h,d),b=Math.hypot(u,p);return[y*l,b*c]}class vn{alphaIsShape=!1;fontSize=0;fontSizeScale=1;textMatrix=null;textMatrixScale=1;fontMatrix=ds;leading=0;x=0;y=0;lineX=0;lineY=0;charSpacing=0;wordSpacing=0;textHScale=1;textRenderingMode=yt.FILL;textRise=0;fillColor="#000000";strokeColor="#000000";patternFill=!1;patternStroke=!1;fillAlpha=1;strokeAlpha=1;lineWidth=1;activeSMask=null;transferMaps="none";constructor(t,e,i){i?.(this),this.clipBox=new Float32Array([0,0,t,e]),this.minMax=Te.slice()}clone(){const t=Object.create(this);return t.clipBox=this.clipBox.slice(),t.minMax=this.minMax.slice(),t}getPathBoundingBox(t=wt.FILL,e=null){const i=this.minMax.slice();if(t===wt.STROKE){e||J("Stroke bounding box must include transform."),N.singularValueDecompose2dScale(e,It);const s=It[0]*this.lineWidth/2,n=It[1]*this.lineWidth/2;i[0]-=s,i[1]-=n,i[2]+=s,i[3]+=n}return i}updateClipFromPath(){const t=N.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(t||[0,0,0,0])}isEmptyClip(){return this.minMax[0]===1/0}startNewPathAndClipBox(t){this.clipBox.set(t,0),this.minMax.set(Te,0)}getClippedPathBoundingBox(t=wt.FILL,e=null){return N.intersect(this.clipBox,this.getPathBoundingBox(t,e))}}function xn(o,t){if(t instanceof ImageData){o.putImageData(t,0,0);return}const e=t.height,i=t.width,s=e%Rt,n=(e-s)/Rt,r=s===0?n:n+1,a=o.createImageData(i,Rt);let l=0,c;const h=t.data,d=a.data;let u,p,m,g;if(t.kind===Qe.GRAYSCALE_1BPP){const y=h.byteLength,b=new Uint32Array(d.buffer,0,d.byteLength>>2),v=b.length,w=i+7>>3,A=4294967295,x=bt.isLittleEndian?4278190080:255;for(u=0;u<r;u++){for(m=u<n?Rt:s,c=0,p=0;p<m;p++){const S=y-l;let k=0;const _=S>w?i:S*8-7,E=_&-8;let L=0,P=0;for(;k<E;k+=8)P=h[l++],b[c++]=P&128?A:x,b[c++]=P&64?A:x,b[c++]=P&32?A:x,b[c++]=P&16?A:x,b[c++]=P&8?A:x,b[c++]=P&4?A:x,b[c++]=P&2?A:x,b[c++]=P&1?A:x;for(;k<_;k++)L===0&&(P=h[l++],L=128),b[c++]=P&L?A:x,L>>=1}for(;c<v;)b[c++]=0;o.putImageData(a,0,u*Rt)}}else if(t.kind===Qe.RGBA_32BPP){for(p=0,g=i*Rt*4,u=0;u<n;u++)d.set(h.subarray(l,l+g)),l+=g,o.putImageData(a,0,p),p+=Rt;u<r&&(g=i*s*4,d.set(h.subarray(l,l+g)),o.putImageData(a,0,p))}else if(t.kind===Qe.RGB_24BPP)for(m=Rt,g=i*m,u=0;u<r;u++){for(u>=n&&(m=s,g=i*m),c=0,p=g;p--;)d[c++]=h[l++],d[c++]=h[l++],d[c++]=h[l++],d[c++]=255;o.putImageData(a,0,u*Rt)}else throw new Error(`bad image kind: ${t.kind}`)}function An(o,t){if(t.bitmap){o.drawImage(t.bitmap,0,0);return}const e=t.height,i=t.width,s=e%Rt,n=(e-s)/Rt,r=s===0?n:n+1,a=o.createImageData(i,Rt);let l=0;const c=t.data,h=a.data;for(let d=0;d<r;d++){const u=d<n?Rt:s;({srcPos:l}=fl({src:c,srcPos:l,dest:h,width:i,height:u,nonBlackColor:0})),o.putImageData(a,0,d*Rt)}}function ze(o,t){const e=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const i of e)o[i]!==void 0&&(t[i]=o[i]);o.setLineDash!==void 0&&(t.setLineDash(o.getLineDash()),t.lineDashOffset=o.lineDashOffset)}function _i(o){o.strokeStyle=o.fillStyle="#000000",o.fillRule="nonzero",o.globalAlpha=1,o.lineWidth=1,o.lineCap="butt",o.lineJoin="miter",o.miterLimit=10,o.globalCompositeOperation="source-over",o.font="10px sans-serif",o.setLineDash!==void 0&&(o.setLineDash([]),o.lineDashOffset=0);const{filter:t}=o;t!=="none"&&t!==""&&(o.filter="none")}function Sn(o,t){if(t)return!0;N.singularValueDecompose2dScale(o,It);const e=Math.fround(zt.pixelRatio*be.PDF_TO_CSS_UNITS);return It[0]<=e&&It[1]<=e}const yl=["butt","round","square"],wl=["miter","round","bevel"],vl={},kn={};class Pe{constructor(t,e,i,s,n,{optionalContentConfig:r,markedContentStack:a=null},l,c,h){this.ctx=t,this.current=new vn(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=e,this.objs=i,this.canvasFactory=s,this.filterFactory=n,this.groupStack=[],this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=a||[],this.optionalContentConfig=r,this.cachedCanvases=new bl(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=l,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=c,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map,this.dependencyTracker=h??null}getObject(t,e,i=null){return typeof e=="string"?(this.dependencyTracker?.recordNamedDependency(t,e),e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e)):i}beginDrawing({transform:t,viewport:e,transparency:i=!1,background:s=null}){const n=this.ctx.canvas.width,r=this.ctx.canvas.height,a=this.ctx.fillStyle;if(this.ctx.fillStyle=s||"#ffffff",this.ctx.fillRect(0,0,n,r),this.ctx.fillStyle=a,i){const l=this.cachedCanvases.getCanvas("transparent",n,r);this.compositeCtx=this.ctx,this.transparentCanvas=l.canvas,this.ctx=l.context,this.ctx.save(),this.ctx.transform(...at(this.compositeCtx))}this.ctx.save(),_i(this.ctx),t&&(this.ctx.transform(...t),this.outputScaleX=t[0],this.outputScaleY=t[0]),this.ctx.transform(...e.transform),this.viewportScale=e.scale,this.baseTransform=at(this.ctx)}executeOperatorList(t,e,i,s,n){const r=t.argsArray,a=t.fnArray;let l=e||0;const c=r.length;if(c===l)return l;const h=c-l>wn&&typeof i=="function",d=h?Date.now()+gl:0;let u=0;const p=this.commonObjs,m=this.objs;let g,y;for(;;){if(s!==void 0&&l===s.nextBreakPoint)return s.breakIt(l,i),l;if(!n||n(l))if(g=a[l],y=r[l]??null,g!==Fe.dependency)y===null?this[g](l):this[g](l,...y);else for(const b of y){this.dependencyTracker?.recordNamedData(b,l);const v=b.startsWith("g_")?p:m;if(!v.has(b))return v.get(b,i),l}if(l++,l===c)return l;if(h&&++u>wn){if(Date.now()>d)return i(),l;u=0}}}#t(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#t(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const t of this._cachedBitmapsMap.values()){for(const e of t.values())typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&(e.width=e.height=0);t.clear()}this._cachedBitmapsMap.clear(),this.#e()}#e(){if(this.pageColors){const t=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(t!=="none"){const e=this.ctx.filter;this.ctx.filter=t,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=e}}}_scaleImage(t,e){const i=t.width??t.displayWidth,s=t.height??t.displayHeight;let n=Math.max(Math.hypot(e[0],e[1]),1),r=Math.max(Math.hypot(e[2],e[3]),1),a=i,l=s,c="prescale1",h,d;for(;n>2&&a>1||r>2&&l>1;){let u=a,p=l;n>2&&a>1&&(u=a>=16384?Math.floor(a/2)-1||1:Math.ceil(a/2),n/=a/u),r>2&&l>1&&(p=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l)/2,r/=l/p),h=this.cachedCanvases.getCanvas(c,u,p),d=h.context,d.clearRect(0,0,u,p),d.drawImage(t,0,0,a,l,0,0,u,p),t=h.canvas,a=u,l=p,c=c==="prescale1"?"prescale2":"prescale1"}return{img:t,paintWidth:a,paintHeight:l}}_createMaskCanvas(t,e){const i=this.ctx,{width:s,height:n}=e,r=this.current.fillColor,a=this.current.patternFill,l=at(i);let c,h,d,u;if((e.bitmap||e.data)&&e.count>1){const L=e.bitmap||e.data.buffer;h=JSON.stringify(a?l:[l.slice(0,4),r]),c=this._cachedBitmapsMap.get(L),c||(c=new Map,this._cachedBitmapsMap.set(L,c));const P=c.get(h);if(P&&!a){const G=Math.round(Math.min(l[0],l[2])+l[4]),H=Math.round(Math.min(l[1],l[3])+l[5]);return this.dependencyTracker?.recordDependencies(t,Bt.transformAndFill),{canvas:P,offsetX:G,offsetY:H}}d=P}d||(u=this.cachedCanvases.getCanvas("maskCanvas",s,n),An(u.context,e));let p=N.transform(l,[1/s,0,0,-1/n,0,0]);p=N.transform(p,[1,0,0,1,0,-n]);const m=Te.slice();N.axialAlignedBoundingBox([0,0,s,n],p,m);const[g,y,b,v]=m,w=Math.round(b-g)||1,A=Math.round(v-y)||1,x=this.cachedCanvases.getCanvas("fillCanvas",w,A),S=x.context,k=g,_=y;S.translate(-k,-_),S.transform(...p),d||(d=this._scaleImage(u.canvas,Wt(S)),d=d.img,c&&a&&c.set(h,d)),S.imageSmoothingEnabled=Sn(at(S),e.interpolate),ki(S,d,0,0,d.width,d.height,0,0,s,n),S.globalCompositeOperation="source-in";const E=N.transform(Wt(S),[1,0,0,1,-k,-_]);return S.fillStyle=a?r.getPattern(i,this,E,wt.FILL,t):r,S.fillRect(0,0,s,n),c&&!a&&(this.cachedCanvases.delete("fillCanvas"),c.set(h,x.canvas)),this.dependencyTracker?.recordDependencies(t,Bt.transformAndFill),{canvas:x.canvas,offsetX:Math.round(k),offsetY:Math.round(_)}}setLineWidth(t,e){this.dependencyTracker?.recordSimpleData("lineWidth",t),e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(t,e){this.dependencyTracker?.recordSimpleData("lineCap",t),this.ctx.lineCap=yl[e]}setLineJoin(t,e){this.dependencyTracker?.recordSimpleData("lineJoin",t),this.ctx.lineJoin=wl[e]}setMiterLimit(t,e){this.dependencyTracker?.recordSimpleData("miterLimit",t),this.ctx.miterLimit=e}setDash(t,e,i){this.dependencyTracker?.recordSimpleData("dash",t);const s=this.ctx;s.setLineDash!==void 0&&(s.setLineDash(e),s.lineDashOffset=i)}setRenderingIntent(t,e){}setFlatness(t,e){}setGState(t,e){for(const[i,s]of e)switch(i){case"LW":this.setLineWidth(t,s);break;case"LC":this.setLineCap(t,s);break;case"LJ":this.setLineJoin(t,s);break;case"ML":this.setMiterLimit(t,s);break;case"D":this.setDash(t,s[0],s[1]);break;case"RI":this.setRenderingIntent(t,s);break;case"FL":this.setFlatness(t,s);break;case"Font":this.setFont(t,s[0],s[1]);break;case"CA":this.dependencyTracker?.recordSimpleData("strokeAlpha",t),this.current.strokeAlpha=s;break;case"ca":this.dependencyTracker?.recordSimpleData("fillAlpha",t),this.ctx.globalAlpha=this.current.fillAlpha=s;break;case"BM":this.dependencyTracker?.recordSimpleData("globalCompositeOperation",t),this.ctx.globalCompositeOperation=s;break;case"SMask":this.dependencyTracker?.recordSimpleData("SMask",t),this.current.activeSMask=s?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.dependencyTracker?.recordSimpleData("filter",t),this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(s);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const t=this.inSMaskMode;this.current.activeSMask&&!t?this.beginSMaskMode():!this.current.activeSMask&&t&&this.endSMaskMode()}beginSMaskMode(t){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const e=this.ctx.canvas.width,i=this.ctx.canvas.height,s="smaskGroupAt"+this.groupLevel,n=this.cachedCanvases.getCanvas(s,e,i);this.suspendedCtx=this.ctx;const r=this.ctx=n.context;r.setTransform(this.suspendedCtx.getTransform()),ze(this.suspendedCtx,r),ml(r,this.suspendedCtx),this.setGState(t,[["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),ze(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(t){if(!this.current.activeSMask)return;t?(t[0]=Math.floor(t[0]),t[1]=Math.floor(t[1]),t[2]=Math.ceil(t[2]),t[3]=Math.ceil(t[3])):t=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const e=this.current.activeSMask,i=this.suspendedCtx;this.composeSMask(i,e,this.ctx,t),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(t,e,i,s){const n=s[0],r=s[1],a=s[2]-n,l=s[3]-r;a===0||l===0||(this.genericComposeSMask(e.context,i,a,l,e.subtype,e.backdrop,e.transferMap,n,r,e.offsetX,e.offsetY),t.save(),t.globalAlpha=1,t.globalCompositeOperation="source-over",t.setTransform(1,0,0,1,0,0),t.drawImage(i.canvas,0,0),t.restore())}genericComposeSMask(t,e,i,s,n,r,a,l,c,h,d){let u=t.canvas,p=l-h,m=c-d;if(r)if(p<0||m<0||p+i>u.width||m+s>u.height){const y=this.cachedCanvases.getCanvas("maskExtension",i,s),b=y.context;b.drawImage(u,-p,-m),b.globalCompositeOperation="destination-atop",b.fillStyle=r,b.fillRect(0,0,i,s),b.globalCompositeOperation="source-over",u=y.canvas,p=m=0}else{t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0);const y=new Path2D;y.rect(p,m,i,s),t.clip(y),t.globalCompositeOperation="destination-atop",t.fillStyle=r,t.fillRect(p,m,i,s),t.restore()}e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0),n==="Alpha"&&a?e.filter=this.filterFactory.addAlphaFilter(a):n==="Luminosity"&&(e.filter=this.filterFactory.addLuminosityFilter(a));const g=new Path2D;g.rect(l,c,i,s),e.clip(g),e.globalCompositeOperation="destination-in",e.drawImage(u,p,m,i,s,l,c,i,s),e.restore()}save(t){this.inSMaskMode&&ze(this.ctx,this.suspendedCtx),this.ctx.save();const e=this.current;this.stateStack.push(e),this.current=e.clone(),this.dependencyTracker?.save(t)}restore(t){if(this.dependencyTracker?.restore(t),this.stateStack.length===0){this.inSMaskMode&&this.endSMaskMode();return}this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&ze(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}transform(t,e,i,s,n,r,a){this.dependencyTracker?.recordIncrementalData("transform",t),this.ctx.transform(e,i,s,n,r,a),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(t,e,i,s){let[n]=i;if(!s){n||=i[0]=new Path2D,this[e](t,n);return}if(this.dependencyTracker!==null){const r=e===Fe.stroke?this.current.lineWidth/2:0;this.dependencyTracker.resetBBox(t).recordBBox(t,this.ctx,s[0]-r,s[2]+r,s[1]-r,s[3]+r).recordDependencies(t,["transform"])}if(!(n instanceof Path2D)){const r=i[0]=new Path2D;for(let a=0,l=n.length;a<l;)switch(n[a++]){case yi.moveTo:r.moveTo(n[a++],n[a++]);break;case yi.lineTo:r.lineTo(n[a++],n[a++]);break;case yi.curveTo:r.bezierCurveTo(n[a++],n[a++],n[a++],n[a++],n[a++],n[a++]);break;case yi.closePath:r.closePath();break;default:B(`Unrecognized drawing path operator: ${n[a-1]}`);break}n=r}N.axialAlignedBoundingBox(s,at(this.ctx),this.current.minMax),this[e](t,n),this._pathStartIdx=t}closePath(t){this.ctx.closePath()}stroke(t,e,i=!0){const s=this.ctx,n=this.current.strokeColor;if(s.globalAlpha=this.current.strokeAlpha,this.contentVisible)if(typeof n=="object"&&n?.getPattern){const r=n.isModifyingCurrentTransform()?s.getTransform():null;if(s.save(),s.strokeStyle=n.getPattern(s,this,Wt(s),wt.STROKE,t),r){const a=new Path2D;a.addPath(e,s.getTransform().invertSelf().multiplySelf(r)),e=a}this.rescaleAndStroke(e,!1),s.restore()}else this.rescaleAndStroke(e,!0);this.dependencyTracker?.recordDependencies(t,Bt.stroke),i&&this.consumePath(t,e,this.current.getClippedPathBoundingBox(wt.STROKE,at(this.ctx))),s.globalAlpha=this.current.fillAlpha}closeStroke(t,e){this.stroke(t,e)}fill(t,e,i=!0){const s=this.ctx,n=this.current.fillColor,r=this.current.patternFill;let a=!1;if(r){const c=n.isModifyingCurrentTransform()?s.getTransform():null;if(this.dependencyTracker?.save(t),s.save(),s.fillStyle=n.getPattern(s,this,Wt(s),wt.FILL,t),c){const h=new Path2D;h.addPath(e,s.getTransform().invertSelf().multiplySelf(c)),e=h}a=!0}const l=this.current.getClippedPathBoundingBox();this.contentVisible&&l!==null&&(this.pendingEOFill?(s.fill(e,"evenodd"),this.pendingEOFill=!1):s.fill(e)),this.dependencyTracker?.recordDependencies(t,Bt.fill),a&&(s.restore(),this.dependencyTracker?.restore(t)),i&&this.consumePath(t,e,l)}eoFill(t,e){this.pendingEOFill=!0,this.fill(t,e)}fillStroke(t,e){this.fill(t,e,!1),this.stroke(t,e,!1),this.consumePath(t,e)}eoFillStroke(t,e){this.pendingEOFill=!0,this.fillStroke(t,e)}closeFillStroke(t,e){this.fillStroke(t,e)}closeEOFillStroke(t,e){this.pendingEOFill=!0,this.fillStroke(t,e)}endPath(t,e){this.consumePath(t,e)}rawFillPath(t,e){this.ctx.fill(e),this.dependencyTracker?.recordDependencies(t,Bt.rawFillPath).recordOperation(t)}clip(t){this.dependencyTracker?.recordFutureForcedDependency("clipMode",t),this.pendingClip=vl}eoClip(t){this.dependencyTracker?.recordFutureForcedDependency("clipMode",t),this.pendingClip=kn}beginText(t){this.current.textMatrix=null,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0,this.dependencyTracker?.recordOpenMarker(t).resetIncrementalData("sameLineText").resetIncrementalData("moveText",t)}endText(t){const e=this.pendingTextPaths,i=this.ctx;if(this.dependencyTracker){const{dependencyTracker:s}=this;e!==void 0&&s.recordFutureForcedDependency("textClip",s.getOpenMarker()).recordFutureForcedDependency("textClip",t),s.recordCloseMarker(t)}if(e!==void 0){const s=new Path2D,n=i.getTransform().invertSelf();for(const{transform:r,x:a,y:l,fontSize:c,path:h}of e)h&&s.addPath(h,new DOMMatrix(r).preMultiplySelf(n).translate(a,l).scale(c,-c));i.clip(s)}delete this.pendingTextPaths}setCharSpacing(t,e){this.dependencyTracker?.recordSimpleData("charSpacing",t),this.current.charSpacing=e}setWordSpacing(t,e){this.dependencyTracker?.recordSimpleData("wordSpacing",t),this.current.wordSpacing=e}setHScale(t,e){this.dependencyTracker?.recordSimpleData("hScale",t),this.current.textHScale=e/100}setLeading(t,e){this.dependencyTracker?.recordSimpleData("leading",t),this.current.leading=-e}setFont(t,e,i){this.dependencyTracker?.recordSimpleData("font",t).recordSimpleDataFromNamed("fontObj",e,t);const s=this.commonObjs.get(e),n=this.current;if(!s)throw new Error(`Can't find font for ${e}`);if(n.fontMatrix=s.fontMatrix||ds,(n.fontMatrix[0]===0||n.fontMatrix[3]===0)&&B("Invalid font matrix for font "+e),i<0?(i=-i,n.fontDirection=-1):n.fontDirection=1,this.current.font=s,this.current.fontSize=i,s.isType3Font)return;const r=s.loadedName||"sans-serif",a=s.systemFontInfo?.css||`"${r}", ${s.fallbackName}`;let l="normal";s.black?l="900":s.bold&&(l="bold");const c=s.italic?"italic":"normal";let h=i;i<bn?h=bn:i>yn&&(h=yn),this.current.fontSizeScale=i/h,this.ctx.font=`${c} ${l} ${h}px ${a}`}setTextRenderingMode(t,e){this.dependencyTracker?.recordSimpleData("textRenderingMode",t),this.current.textRenderingMode=e}setTextRise(t,e){this.dependencyTracker?.recordSimpleData("textRise",t),this.current.textRise=e}moveText(t,e,i){this.dependencyTracker?.resetIncrementalData("sameLineText").recordIncrementalData("moveText",t),this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=i}setLeadingMoveText(t,e,i){this.setLeading(t,-i),this.moveText(t,e,i)}setTextMatrix(t,e){this.dependencyTracker?.recordSimpleData("textMatrix",t);const{current:i}=this;i.textMatrix=e,i.textMatrixScale=Math.hypot(e[0],e[1]),i.x=i.lineX=0,i.y=i.lineY=0}nextLine(t){this.moveText(t,0,this.current.leading),this.dependencyTracker?.recordIncrementalData("moveText",this.dependencyTracker.getSimpleIndex("leading")??t)}#s(t,e,i){const s=new Path2D;return s.addPath(t,new DOMMatrix(i).invertSelf().multiplySelf(e)),s}paintChar(t,e,i,s,n,r){const a=this.ctx,l=this.current,c=l.font,h=l.textRenderingMode,d=l.fontSize/l.fontSizeScale,u=h&yt.FILL_STROKE_MASK,p=!!(h&yt.ADD_TO_PATH_FLAG),m=l.patternFill&&!c.missingFile,g=l.patternStroke&&!c.missingFile;let y;if((c.disableFontFace||p||m||g)&&!c.missingFile&&(y=c.getPathGenerator(this.commonObjs,e)),y&&(c.disableFontFace||m||g)){a.save(),a.translate(i,s),a.scale(d,-d),this.dependencyTracker?.recordCharacterBBox(t,a,c);let b;if(u===yt.FILL||u===yt.FILL_STROKE)if(n){b=a.getTransform(),a.setTransform(...n);const v=this.#s(y,b,n);a.fill(v)}else a.fill(y);if(u===yt.STROKE||u===yt.FILL_STROKE)if(r){b||=a.getTransform(),a.setTransform(...r);const{a:v,b:w,c:A,d:x}=b,S=N.inverseTransform(r),k=N.transform([v,w,A,x,0,0],S);N.singularValueDecompose2dScale(k,It),a.lineWidth*=Math.max(It[0],It[1])/d,a.stroke(this.#s(y,b,r))}else a.lineWidth/=d,a.stroke(y);a.restore()}else(u===yt.FILL||u===yt.FILL_STROKE)&&(a.fillText(e,i,s),this.dependencyTracker?.recordCharacterBBox(t,a,c,d,i,s,()=>a.measureText(e))),(u===yt.STROKE||u===yt.FILL_STROKE)&&(this.dependencyTracker&&this.dependencyTracker?.recordCharacterBBox(t,a,c,d,i,s,()=>a.measureText(e)).recordDependencies(t,Bt.stroke),a.strokeText(e,i,s));p&&((this.pendingTextPaths||=[]).push({transform:at(a),x:i,y:s,fontSize:d,path:y}),this.dependencyTracker?.recordCharacterBBox(t,a,c,d,i,s))}get isFontSubpixelAAEnabled(){const{context:t}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);t.scale(1.5,1),t.fillText("I",0,10);const e=t.getImageData(0,0,10,10).data;let i=!1;for(let s=3;s<e.length;s+=4)if(e[s]>0&&e[s]<255){i=!0;break}return z(this,"isFontSubpixelAAEnabled",i)}showText(t,e){this.dependencyTracker&&(this.dependencyTracker.recordDependencies(t,Bt.showText).resetBBox(t),this.current.textRenderingMode&yt.ADD_TO_PATH_FLAG&&this.dependencyTracker.recordFutureForcedDependency("textClip",t).inheritPendingDependenciesAsFutureForcedDependencies());const i=this.current,s=i.font;if(s.isType3Font){this.showType3Text(t,e),this.dependencyTracker?.recordShowTextOperation(t);return}const n=i.fontSize;if(n===0){this.dependencyTracker?.recordOperation(t);return}const r=this.ctx,a=i.fontSizeScale,l=i.charSpacing,c=i.wordSpacing,h=i.fontDirection,d=i.textHScale*h,u=e.length,p=s.vertical,m=p?1:-1,g=s.defaultVMetrics,y=n*i.fontMatrix[0],b=i.textRenderingMode===yt.FILL&&!s.disableFontFace&&!i.patternFill;r.save(),i.textMatrix&&r.transform(...i.textMatrix),r.translate(i.x,i.y+i.textRise),h>0?r.scale(d,-1):r.scale(d,1);let v,w;if(i.patternFill){r.save();const _=i.fillColor.getPattern(r,this,Wt(r),wt.FILL,t);v=at(r),r.restore(),r.fillStyle=_}if(i.patternStroke){r.save();const _=i.strokeColor.getPattern(r,this,Wt(r),wt.STROKE,t);w=at(r),r.restore(),r.strokeStyle=_}let A=i.lineWidth;const x=i.textMatrixScale;if(x===0||A===0){const _=i.textRenderingMode&yt.FILL_STROKE_MASK;(_===yt.STROKE||_===yt.FILL_STROKE)&&(A=this.getSinglePixelWidth())}else A/=x;if(a!==1&&(r.scale(a,a),A/=a),r.lineWidth=A,s.isInvalidPDFjsFont){const _=[];let E=0;for(const P of e)_.push(P.unicode),E+=P.width;const L=_.join("");if(r.fillText(L,0,0),this.dependencyTracker!==null){const P=r.measureText(L);this.dependencyTracker.recordBBox(t,this.ctx,-P.actualBoundingBoxLeft,P.actualBoundingBoxRight,-P.actualBoundingBoxAscent,P.actualBoundingBoxDescent).recordShowTextOperation(t)}i.x+=E*y*d,r.restore(),this.compose();return}let S=0,k;for(k=0;k<u;++k){const _=e[k];if(typeof _=="number"){S+=m*_*n/1e3;continue}let E=!1;const L=(_.isSpace?c:0)+l,P=_.fontChar,G=_.accent;let H,O,$=_.width;if(p){const U=_.vmetric||g,nt=-(_.vmetric?U[1]:$*.5)*y,St=U[2]*y;$=U?-U[0]:$,H=nt/a,O=(S+St)/a}else H=S/a,O=0;let M;if(s.remeasure&&$>0){M=r.measureText(P);const U=M.width*1e3/n*a;if($<U&&this.isFontSubpixelAAEnabled){const nt=$/U;E=!0,r.save(),r.scale(nt,1),H/=nt}else $!==U&&(H+=($-U)/2e3*n/a)}if(this.contentVisible&&(_.isInFont||s.missingFile)){if(b&&!G)r.fillText(P,H,O),this.dependencyTracker?.recordCharacterBBox(t,r,M?{bbox:null}:s,n/a,H,O,()=>M??r.measureText(P));else if(this.paintChar(t,P,H,O,v,w),G){const U=H+n*G.offset.x/a,nt=O-n*G.offset.y/a;this.paintChar(t,G.fontChar,U,nt,v,w)}}const R=p?$*y-L*h:$*y+L*h;S+=R,E&&r.restore()}p?i.y-=S:i.x+=S*d,r.restore(),this.compose(),this.dependencyTracker?.recordShowTextOperation(t)}showType3Text(t,e){const i=this.ctx,s=this.current,n=s.font,r=s.fontSize,a=s.fontDirection,l=n.vertical?1:-1,c=s.charSpacing,h=s.wordSpacing,d=s.textHScale*a,u=s.fontMatrix||ds,p=e.length,m=s.textRenderingMode===yt.INVISIBLE;let g,y,b,v;if(m||r===0)return;this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,i.save(),s.textMatrix&&i.transform(...s.textMatrix),i.translate(s.x,s.y+s.textRise),i.scale(d,a);const w=this.dependencyTracker;for(this.dependencyTracker=w?new Fi(w,t):null,g=0;g<p;++g){if(y=e[g],typeof y=="number"){v=l*y*r/1e3,this.ctx.translate(v,0),s.x+=v*d;continue}const A=(y.isSpace?h:0)+c,x=n.charProcOperatorList[y.operatorListId];x?this.contentVisible&&(this.save(),i.scale(r,r),i.transform(...u),this.executeOperatorList(x),this.restore()):B(`Type3 character "${y.operatorListId}" is not available.`);const S=[y.width,0];N.applyTransform(S,u),b=S[0]*r+A,i.translate(b,0),s.x+=b*d}i.restore(),w&&(this.dependencyTracker=w)}setCharWidth(t,e,i){}setCharWidthAndBounds(t,e,i,s,n,r,a){const l=new Path2D;l.rect(s,n,r-s,a-n),this.ctx.clip(l),this.dependencyTracker?.recordBBox(t,this.ctx,s,r,n,a).recordClipBox(t,this.ctx,s,r,n,a),this.endPath(t)}getColorN_Pattern(t,e){let i;if(e[0]==="TilingPattern"){const s=this.baseTransform||at(this.ctx),n={createCanvasGraphics:(r,a)=>new Pe(r,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack},void 0,void 0,this.dependencyTracker?new Fi(this.dependencyTracker,a,!0):null)};i=new Fs(e,this.ctx,n,s)}else i=this._getPattern(t,e[1],e[2]);return i}setStrokeColorN(t,...e){this.dependencyTracker?.recordSimpleData("strokeColor",t),this.current.strokeColor=this.getColorN_Pattern(t,e),this.current.patternStroke=!0}setFillColorN(t,...e){this.dependencyTracker?.recordSimpleData("fillColor",t),this.current.fillColor=this.getColorN_Pattern(t,e),this.current.patternFill=!0}setStrokeRGBColor(t,e){this.dependencyTracker?.recordSimpleData("strokeColor",t),this.ctx.strokeStyle=this.current.strokeColor=e,this.current.patternStroke=!1}setStrokeTransparent(t){this.dependencyTracker?.recordSimpleData("strokeColor",t),this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(t,e){this.dependencyTracker?.recordSimpleData("fillColor",t),this.ctx.fillStyle=this.current.fillColor=e,this.current.patternFill=!1}setFillTransparent(t){this.dependencyTracker?.recordSimpleData("fillColor",t),this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(t,e,i=null){let s;return this.cachedPatterns.has(e)?s=this.cachedPatterns.get(e):(s=pl(this.getObject(t,e)),this.cachedPatterns.set(e,s)),i&&(s.matrix=i),s}shadingFill(t,e){if(!this.contentVisible)return;const i=this.ctx;this.save(t);const s=this._getPattern(t,e);i.fillStyle=s.getPattern(i,this,Wt(i),wt.SHADING,t);const n=Wt(i);if(n){const{width:r,height:a}=i.canvas,l=Te.slice();N.axialAlignedBoundingBox([0,0,r,a],n,l);const[c,h,d,u]=l;this.ctx.fillRect(c,h,d-c,u-h)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.dependencyTracker?.resetBBox(t).recordFullPageBBox(t).recordDependencies(t,Bt.transform).recordDependencies(t,Bt.fill).recordOperation(t),this.compose(this.current.getClippedPathBoundingBox()),this.restore(t)}beginInlineImage(){J("Should not call beginInlineImage")}beginImageData(){J("Should not call beginImageData")}paintFormXObjectBegin(t,e,i){if(this.contentVisible&&(this.save(t),this.baseTransformStack.push(this.baseTransform),e&&this.transform(t,...e),this.baseTransform=at(this.ctx),i)){N.axialAlignedBoundingBox(i,this.baseTransform,this.current.minMax);const[s,n,r,a]=i,l=new Path2D;l.rect(s,n,r-s,a-n),this.ctx.clip(l),this.dependencyTracker?.recordClipBox(t,this.ctx,s,r,n,a),this.endPath(t)}}paintFormXObjectEnd(t){this.contentVisible&&(this.restore(t),this.baseTransform=this.baseTransformStack.pop())}beginGroup(t,e){if(!this.contentVisible)return;this.save(t),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const i=this.ctx;e.isolated||Bi("TODO: Support non-isolated groups."),e.knockout&&B("Knockout groups not supported.");const s=at(i);if(e.matrix&&i.transform(...e.matrix),!e.bbox)throw new Error("Bounding box is required.");let n=Te.slice();N.axialAlignedBoundingBox(e.bbox,at(i),n);const r=[0,0,i.canvas.width,i.canvas.height];n=N.intersect(n,r)||[0,0,0,0];const a=Math.floor(n[0]),l=Math.floor(n[1]),c=Math.max(Math.ceil(n[2])-a,1),h=Math.max(Math.ceil(n[3])-l,1);this.current.startNewPathAndClipBox([0,0,c,h]);let d="groupAt"+this.groupLevel;e.smask&&(d+="_smask_"+this.smaskCounter++%2);const u=this.cachedCanvases.getCanvas(d,c,h),p=u.context;p.translate(-a,-l),p.transform(...s);let m=new Path2D;const[g,y,b,v]=e.bbox;if(m.rect(g,y,b-g,v-y),e.matrix){const w=new Path2D;w.addPath(m,new DOMMatrix(e.matrix)),m=w}p.clip(m),e.smask&&this.smaskStack.push({canvas:u.canvas,context:p,offsetX:a,offsetY:l,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}),(!e.smask||this.dependencyTracker)&&(i.setTransform(1,0,0,1,0,0),i.translate(a,l),i.save()),ze(i,p),this.ctx=p,this.dependencyTracker?.inheritSimpleDataAsFutureForcedDependencies(["fillAlpha","strokeAlpha","globalCompositeOperation"]).pushBaseTransform(i),this.setGState(t,[["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(i),this.groupLevel++}endGroup(t,e){if(!this.contentVisible)return;this.groupLevel--;const i=this.ctx,s=this.groupStack.pop();if(this.ctx=s,this.ctx.imageSmoothingEnabled=!1,this.dependencyTracker?.popBaseTransform(),e.smask)this.tempSMask=this.smaskStack.pop(),this.restore(t),this.dependencyTracker&&this.ctx.restore();else{this.ctx.restore();const n=at(this.ctx);this.restore(t),this.ctx.save(),this.ctx.setTransform(...n);const r=Te.slice();N.axialAlignedBoundingBox([0,0,i.canvas.width,i.canvas.height],n,r),this.ctx.drawImage(i.canvas,0,0),this.ctx.restore(),this.compose(r)}}beginAnnotation(t,e,i,s,n,r){if(this.#t(),_i(this.ctx),this.ctx.save(),this.save(t),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),i){const a=i[2]-i[0],l=i[3]-i[1];if(r&&this.annotationCanvasMap){s=s.slice(),s[4]-=i[0],s[5]-=i[1],i=i.slice(),i[0]=i[1]=0,i[2]=a,i[3]=l,N.singularValueDecompose2dScale(at(this.ctx),It);const{viewportScale:c}=this,h=Math.ceil(a*this.outputScaleX*c),d=Math.ceil(l*this.outputScaleY*c);this.annotationCanvas=this.canvasFactory.create(h,d);const{canvas:u,context:p}=this.annotationCanvas;this.annotationCanvasMap.set(e,u),this.annotationCanvas.savedCtx=this.ctx,this.ctx=p,this.ctx.save(),this.ctx.setTransform(It[0],0,0,-It[1],0,l*It[1]),_i(this.ctx)}else{_i(this.ctx),this.endPath(t);const c=new Path2D;c.rect(i[0],i[1],a,l),this.ctx.clip(c)}}this.current=new vn(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(t,...s),this.transform(t,...n)}endAnnotation(t){this.annotationCanvas&&(this.ctx.restore(),this.#e(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(t,e){if(!this.contentVisible)return;const i=e.count;e=this.getObject(t,e.data,e),e.count=i;const s=this.ctx,n=this._createMaskCanvas(t,e),r=n.canvas;s.save(),s.setTransform(1,0,0,1,0,0),s.drawImage(r,n.offsetX,n.offsetY),this.dependencyTracker?.resetBBox(t).recordBBox(t,this.ctx,n.offsetX,n.offsetX+r.width,n.offsetY,n.offsetY+r.height).recordOperation(t),s.restore(),this.compose()}paintImageMaskXObjectRepeat(t,e,i,s=0,n=0,r,a){if(!this.contentVisible)return;e=this.getObject(t,e.data,e);const l=this.ctx;l.save();const c=at(l);l.transform(i,s,n,r,0,0);const h=this._createMaskCanvas(t,e);l.setTransform(1,0,0,1,h.offsetX-c[4],h.offsetY-c[5]),this.dependencyTracker?.resetBBox(t);for(let d=0,u=a.length;d<u;d+=2){const p=N.transform(c,[i,s,n,r,a[d],a[d+1]]);l.drawImage(h.canvas,p[4],p[5]),this.dependencyTracker?.recordBBox(t,this.ctx,p[4],p[4]+h.canvas.width,p[5],p[5]+h.canvas.height)}l.restore(),this.compose(),this.dependencyTracker?.recordOperation(t)}paintImageMaskXObjectGroup(t,e){if(!this.contentVisible)return;const i=this.ctx,s=this.current.fillColor,n=this.current.patternFill;this.dependencyTracker?.resetBBox(t).recordDependencies(t,Bt.transformAndFill);for(const r of e){const{data:a,width:l,height:c,transform:h}=r,d=this.cachedCanvases.getCanvas("maskCanvas",l,c),u=d.context;u.save();const p=this.getObject(t,a,r);An(u,p),u.globalCompositeOperation="source-in",u.fillStyle=n?s.getPattern(u,this,Wt(i),wt.FILL,t):s,u.fillRect(0,0,l,c),u.restore(),i.save(),i.transform(...h),i.scale(1,-1),ki(i,d.canvas,0,0,l,c,0,-1,1,1),this.dependencyTracker?.recordBBox(t,i,0,l,0,c),i.restore()}this.compose(),this.dependencyTracker?.recordOperation(t)}paintImageXObject(t,e){if(!this.contentVisible)return;const i=this.getObject(t,e);if(!i){B("Dependent image isn't ready yet");return}this.paintInlineImageXObject(t,i)}paintImageXObjectRepeat(t,e,i,s,n){if(!this.contentVisible)return;const r=this.getObject(t,e);if(!r){B("Dependent image isn't ready yet");return}const a=r.width,l=r.height,c=[];for(let h=0,d=n.length;h<d;h+=2)c.push({transform:[i,0,0,s,n[h],n[h+1]],x:0,y:0,w:a,h:l});this.paintInlineImageXObjectGroup(t,r,c)}applyTransferMapsToCanvas(t){return this.current.transferMaps!=="none"&&(t.filter=this.current.transferMaps,t.drawImage(t.canvas,0,0),t.filter="none"),t.canvas}applyTransferMapsToBitmap(t){if(this.current.transferMaps==="none")return t.bitmap;const{bitmap:e,width:i,height:s}=t,n=this.cachedCanvases.getCanvas("inlineImage",i,s),r=n.context;return r.filter=this.current.transferMaps,r.drawImage(e,0,0),r.filter="none",n.canvas}paintInlineImageXObject(t,e){if(!this.contentVisible)return;const i=e.width,s=e.height,n=this.ctx;this.save(t);const{filter:r}=n;r!=="none"&&r!==""&&(n.filter="none"),n.scale(1/i,-1/s);let a;if(e.bitmap)a=this.applyTransferMapsToBitmap(e);else if(typeof HTMLElement=="function"&&e instanceof HTMLElement||!e.data)a=e;else{const h=this.cachedCanvases.getCanvas("inlineImage",i,s).context;xn(h,e),a=this.applyTransferMapsToCanvas(h)}const l=this._scaleImage(a,Wt(n));n.imageSmoothingEnabled=Sn(at(n),e.interpolate),this.dependencyTracker?.resetBBox(t).recordBBox(t,n,0,i,-s,0).recordDependencies(t,Bt.imageXObject).recordOperation(t),ki(n,l.img,0,0,l.paintWidth,l.paintHeight,0,-s,i,s),this.compose(),this.restore(t)}paintInlineImageXObjectGroup(t,e,i){if(!this.contentVisible)return;const s=this.ctx;let n;if(e.bitmap)n=e.bitmap;else{const r=e.width,a=e.height,c=this.cachedCanvases.getCanvas("inlineImage",r,a).context;xn(c,e),n=this.applyTransferMapsToCanvas(c)}this.dependencyTracker?.resetBBox(t);for(const r of i)s.save(),s.transform(...r.transform),s.scale(1,-1),ki(s,n,r.x,r.y,r.w,r.h,0,-1,1,1),this.dependencyTracker?.recordBBox(t,s,0,1,-1,0),s.restore();this.dependencyTracker?.recordOperation(t),this.compose()}paintSolidColorImageMask(t){this.contentVisible&&(this.dependencyTracker?.resetBBox(t).recordBBox(t,this.ctx,0,1,0,1).recordDependencies(t,Bt.fill).recordOperation(t),this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(t,e){}markPointProps(t,e,i){}beginMarkedContent(t,e){this.dependencyTracker?.beginMarkedContent(t),this.markedContentStack.push({visible:!0})}beginMarkedContentProps(t,e,i){this.dependencyTracker?.beginMarkedContent(t),e==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(i)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(t){this.dependencyTracker?.endMarkedContent(t),this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(t){}endCompat(t){}consumePath(t,e,i){const s=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(i);const n=this.ctx;this.pendingClip?(s||(this.pendingClip===kn?n.clip(e,"evenodd"):n.clip(e)),this.pendingClip=null,this.dependencyTracker?.bboxToClipBoxDropOperation(t).recordFutureForcedDependency("clipPath",t)):this.dependencyTracker?.recordOperation(t),this.current.startNewPathAndClipBox(this.current.clipBox)}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const t=at(this.ctx);if(t[1]===0&&t[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(t[0]),Math.abs(t[3]));else{const e=Math.abs(t[0]*t[3]-t[2]*t[1]),i=Math.hypot(t[0],t[2]),s=Math.hypot(t[1],t[3]);this._cachedGetSinglePixelWidth=Math.max(i,s)/e}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:t}=this.current,{a:e,b:i,c:s,d:n}=this.ctx.getTransform();let r,a;if(i===0&&s===0){const l=Math.abs(e),c=Math.abs(n);if(l===c)if(t===0)r=a=1/l;else{const h=l*t;r=a=h<1?1/h:1}else if(t===0)r=1/l,a=1/c;else{const h=l*t,d=c*t;r=h<1?1/h:1,a=d<1?1/d:1}}else{const l=Math.abs(e*n-i*s),c=Math.hypot(e,i),h=Math.hypot(s,n);if(t===0)r=h/l,a=c/l;else{const d=t*l;r=h>d?h/d:1,a=c>d?c/d:1}}this._cachedScaleForStroking[0]=r,this._cachedScaleForStroking[1]=a}return this._cachedScaleForStroking}rescaleAndStroke(t,e){const{ctx:i,current:{lineWidth:s}}=this,[n,r]=this.getScaleForStroking();if(n===r){i.lineWidth=(s||1)*n,i.stroke(t);return}const a=i.getLineDash();e&&i.save(),i.scale(n,r),rs.a=1/n,rs.d=1/r;const l=new Path2D;if(l.addPath(t,rs),a.length>0){const c=Math.max(n,r);i.setLineDash(a.map(h=>h/c)),i.lineDashOffset/=c}i.lineWidth=s||1,i.stroke(l),e&&i.restore()}isContentVisible(){for(let t=this.markedContentStack.length-1;t>=0;t--)if(!this.markedContentStack[t].visible)return!1;return!0}}for(const o in Fe)Pe.prototype[o]!==void 0&&(Pe.prototype[Fe[o]]=Pe.prototype[o]);class Me{#t;#e;#s;static strings=["fontFamily","fontWeight","italicAngle"];static write(t){const e=new TextEncoder,i={};let s=0;for(const c of Me.strings){const h=e.encode(t[c]);i[c]=h,s+=4+h.length}const n=new ArrayBuffer(s),r=new Uint8Array(n),a=new DataView(n);let l=0;for(const c of Me.strings){const h=i[c],d=h.length;a.setUint32(l,d),r.set(h,l+4),l+=4+d}return W(l===n.byteLength,"CssFontInfo.write: Buffer overflow"),n}constructor(t){this.#t=t,this.#e=new DataView(this.#t),this.#s=new TextDecoder}#i(t){W(t<Me.strings.length,"Invalid string index");let e=0;for(let s=0;s<t;s++)e+=this.#e.getUint32(e)+4;const i=this.#e.getUint32(e);return this.#s.decode(new Uint8Array(this.#t,e+4,i))}get fontFamily(){return this.#i(0)}get fontWeight(){return this.#i(1)}get italicAngle(){return this.#i(2)}}class Re{#t;#e;#s;static strings=["css","loadedName","baseFontName","src"];static write(t){const e=new TextEncoder,i={};let s=0;for(const u of Re.strings){const p=e.encode(t[u]);i[u]=p,s+=4+p.length}s+=4;let n,r,a=1+s;t.style&&(n=e.encode(t.style.style),r=e.encode(t.style.weight),a+=4+n.length+4+r.length);const l=new ArrayBuffer(a),c=new Uint8Array(l),h=new DataView(l);let d=0;h.setUint8(d++,t.guessFallback?1:0),h.setUint32(d,0),d+=4,s=0;for(const u of Re.strings){const p=i[u],m=p.length;s+=4+m,h.setUint32(d,m),c.set(p,d+4),d+=4+m}return h.setUint32(d-s-4,s),t.style&&(h.setUint32(d,n.length),c.set(n,d+4),d+=4+n.length,h.setUint32(d,r.length),c.set(r,d+4),d+=4+r.length),W(d<=l.byteLength,"SubstitionInfo.write: Buffer overflow"),l.transferToFixedLength(d)}constructor(t){this.#t=t,this.#e=new DataView(this.#t),this.#s=new TextDecoder}get guessFallback(){return this.#e.getUint8(0)!==0}#i(t){W(t<Re.strings.length,"Invalid string index");let e=5;for(let s=0;s<t;s++)e+=this.#e.getUint32(e)+4;const i=this.#e.getUint32(e);return this.#s.decode(new Uint8Array(this.#t,e+4,i))}get css(){return this.#i(0)}get loadedName(){return this.#i(1)}get baseFontName(){return this.#i(2)}get src(){return this.#i(3)}get style(){let t=1;t+=4+this.#e.getUint32(t);const e=this.#e.getUint32(t),i=this.#s.decode(new Uint8Array(this.#t,t+4,e));t+=4+e;const s=this.#e.getUint32(t),n=this.#s.decode(new Uint8Array(this.#t,t+4,s));return{style:i,weight:n}}}class K{static bools=["black","bold","disableFontFace","fontExtraProperties","isInvalidPDFjsFont","isType3Font","italic","missingFile","remeasure","vertical"];static numbers=["ascent","defaultWidth","descent"];static strings=["fallbackName","loadedName","mimetype","name"];static#t=Math.ceil(this.bools.length*2/8);static#e=this.#t+this.numbers.length*8;static#s=this.#e+1+8;static#i=this.#s+1+48;static#a=this.#i+1+6;#n;#r;#o;constructor({data:t,extra:e}){this.#n=t,this.#r=new TextDecoder,this.#o=new DataView(this.#n),e&&Object.assign(this,e)}#c(t){W(t<K.bools.length,"Invalid boolean index");const e=Math.floor(t/4),i=t*2%8,s=this.#o.getUint8(e)>>i&3;return s===0?void 0:s===2}get black(){return this.#c(0)}get bold(){return this.#c(1)}get disableFontFace(){return this.#c(2)}get fontExtraProperties(){return this.#c(3)}get isInvalidPDFjsFont(){return this.#c(4)}get isType3Font(){return this.#c(5)}get italic(){return this.#c(6)}get missingFile(){return this.#c(7)}get remeasure(){return this.#c(8)}get vertical(){return this.#c(9)}#l(t){return W(t<K.numbers.length,"Invalid number index"),this.#o.getFloat64(K.#t+t*8)}get ascent(){return this.#l(0)}get defaultWidth(){return this.#l(1)}get descent(){return this.#l(2)}get bbox(){let t=K.#e;if(this.#o.getUint8(t)===0)return;t+=1;const i=[];for(let s=0;s<4;s++)i.push(this.#o.getInt16(t,!0)),t+=2;return i}get fontMatrix(){let t=K.#s;if(this.#o.getUint8(t)===0)return;t+=1;const i=[];for(let s=0;s<6;s++)i.push(this.#o.getFloat64(t,!0)),t+=8;return i}get defaultVMetrics(){let t=K.#i;if(this.#o.getUint8(t)===0)return;t+=1;const i=[];for(let s=0;s<3;s++)i.push(this.#o.getInt16(t,!0)),t+=2;return i}#u(t){W(t<K.strings.length,"Invalid string index");let e=K.#a+4;for(let n=0;n<t;n++)e+=this.#o.getUint32(e)+4;const i=this.#o.getUint32(e),s=new Uint8Array(i);return s.set(new Uint8Array(this.#n,e+4,i)),this.#r.decode(s)}get fallbackName(){return this.#u(0)}get loadedName(){return this.#u(1)}get mimetype(){return this.#u(2)}get name(){return this.#u(3)}get data(){let t=K.#a;const e=this.#o.getUint32(t);t+=4+e;const i=this.#o.getUint32(t);t+=4+i;const s=this.#o.getUint32(t);t+=4+s;const n=this.#o.getUint32(t);if(n!==0)return new Uint8Array(this.#n,t+4,n)}clearData(){let t=K.#a;const e=this.#o.getUint32(t);t+=4+e;const i=this.#o.getUint32(t);t+=4+i;const s=this.#o.getUint32(t);t+=4+s;const n=this.#o.getUint32(t);new Uint8Array(this.#n,t+4,n).fill(0),this.#o.setUint32(t,0)}get cssFontInfo(){let t=K.#a;const e=this.#o.getUint32(t);t+=4+e;const i=this.#o.getUint32(t);t+=4+i;const s=this.#o.getUint32(t);if(s===0)return null;const n=new Uint8Array(s);return n.set(new Uint8Array(this.#n,t+4,s)),new Me(n.buffer)}get systemFontInfo(){let t=K.#a;const e=this.#o.getUint32(t);t+=4+e;const i=this.#o.getUint32(t);if(i===0)return null;const s=new Uint8Array(i);return s.set(new Uint8Array(this.#n,t+4,i)),new Re(s.buffer)}static write(t){const e=t.systemFontInfo?Re.write(t.systemFontInfo):null,i=t.cssFontInfo?Me.write(t.cssFontInfo):null,s=new TextEncoder,n={};let r=0;for(const g of K.strings)n[g]=s.encode(t[g]),r+=4+n[g].length;const a=K.#a+4+r+4+(e?e.byteLength:0)+4+(i?i.byteLength:0)+4+(t.data?t.data.length:0),l=new ArrayBuffer(a),c=new Uint8Array(l),h=new DataView(l);let d=0;const u=K.bools.length;let p=0,m=0;for(let g=0;g<u;g++){const y=t[K.bools[g]];p|=(y===void 0?0:y?2:1)<<m,m+=2,(m===8||g===u-1)&&(h.setUint8(d++,p),p=0,m=0)}W(d===K.#t,"FontInfo.write: Boolean properties offset mismatch");for(const g of K.numbers)h.setFloat64(d,t[g]),d+=8;if(W(d===K.#e,"FontInfo.write: Number properties offset mismatch"),t.bbox){h.setUint8(d++,4);for(const g of t.bbox)h.setInt16(d,g,!0),d+=2}else h.setUint8(d++,0),d+=8;if(W(d===K.#s,"FontInfo.write: BBox properties offset mismatch"),t.fontMatrix){h.setUint8(d++,6);for(const g of t.fontMatrix)h.setFloat64(d,g,!0),d+=8}else h.setUint8(d++,0),d+=48;if(W(d===K.#i,"FontInfo.write: FontMatrix properties offset mismatch"),t.defaultVMetrics){h.setUint8(d++,1);for(const g of t.defaultVMetrics)h.setInt16(d,g,!0),d+=2}else h.setUint8(d++,0),d+=6;W(d===K.#a,"FontInfo.write: DefaultVMetrics properties offset mismatch"),h.setUint32(K.#a,0),d+=4;for(const g of K.strings){const y=n[g],b=y.length;h.setUint32(d,b),c.set(y,d+4),d+=4+b}if(h.setUint32(K.#a,d-K.#a-4),!e)h.setUint32(d,0),d+=4;else{const g=e.byteLength;h.setUint32(d,g),W(d+4+g<=l.byteLength,"FontInfo.write: Buffer overflow at systemFontInfo"),c.set(new Uint8Array(e),d+4),d+=4+g}if(!i)h.setUint32(d,0),d+=4;else{const g=i.byteLength;h.setUint32(d,g),W(d+4+g<=l.byteLength,"FontInfo.write: Buffer overflow at cssFontInfo"),c.set(new Uint8Array(i),d+4),d+=4+g}return t.data===void 0?(h.setUint32(d,0),d+=4):(h.setUint32(d,t.data.length),c.set(t.data,d+4),d+=4+t.data.length),W(d<=l.byteLength,"FontInfo.write: Buffer overflow"),l.transferToFixedLength(d)}}class le{static#t=null;static#e="";static get workerPort(){return this.#t}static set workerPort(t){if(!(typeof Worker<"u"&&t instanceof Worker)&&t!==null)throw new Error("Invalid `workerPort` type.");this.#t=t}static get workerSrc(){return this.#e}static set workerSrc(t){if(typeof t!="string")throw new Error("Invalid `workerSrc` type.");this.#e=t}}class xl{#t;#e;constructor({parsedData:t,rawData:e}){this.#t=t,this.#e=e}getRaw(){return this.#e}get(t){return this.#t.get(t)??null}[Symbol.iterator](){return this.#t.entries()}}const Ce=Symbol("INTERNAL");class Al{#t=!1;#e=!1;#s=!1;#i=!0;constructor(t,{name:e,intent:i,usage:s,rbGroups:n}){this.#t=!!(t&Dt.DISPLAY),this.#e=!!(t&Dt.PRINT),this.name=e,this.intent=i,this.usage=s,this.rbGroups=n}get visible(){if(this.#s)return this.#i;if(!this.#i)return!1;const{print:t,view:e}=this.usage;return this.#t?e?.viewState!=="OFF":this.#e?t?.printState!=="OFF":!0}_setVisible(t,e,i=!1){t!==Ce&&J("Internal method `_setVisible` called."),this.#s=i,this.#i=e}}class Sl{#t=null;#e=new Map;#s=null;#i=null;constructor(t,e=Dt.DISPLAY){if(this.renderingIntent=e,this.name=null,this.creator=null,t!==null){this.name=t.name,this.creator=t.creator,this.#i=t.order;for(const i of t.groups)this.#e.set(i.id,new Al(e,i));if(t.baseState==="OFF")for(const i of this.#e.values())i._setVisible(Ce,!1);for(const i of t.on)this.#e.get(i)._setVisible(Ce,!0);for(const i of t.off)this.#e.get(i)._setVisible(Ce,!1);this.#s=this.getHash()}}#a(t){const e=t.length;if(e<2)return!0;const i=t[0];for(let s=1;s<e;s++){const n=t[s];let r;if(Array.isArray(n))r=this.#a(n);else if(this.#e.has(n))r=this.#e.get(n).visible;else return B(`Optional content group not found: ${n}`),!0;switch(i){case"And":if(!r)return!1;break;case"Or":if(r)return!0;break;case"Not":return!r;default:return!0}}return i==="And"}isVisible(t){if(this.#e.size===0)return!0;if(!t)return Bi("Optional content group not defined."),!0;if(t.type==="OCG")return this.#e.has(t.id)?this.#e.get(t.id).visible:(B(`Optional content group not found: ${t.id}`),!0);if(t.type==="OCMD"){if(t.expression)return this.#a(t.expression);if(!t.policy||t.policy==="AnyOn"){for(const e of t.ids){if(!this.#e.has(e))return B(`Optional content group not found: ${e}`),!0;if(this.#e.get(e).visible)return!0}return!1}else if(t.policy==="AllOn"){for(const e of t.ids){if(!this.#e.has(e))return B(`Optional content group not found: ${e}`),!0;if(!this.#e.get(e).visible)return!1}return!0}else if(t.policy==="AnyOff"){for(const e of t.ids){if(!this.#e.has(e))return B(`Optional content group not found: ${e}`),!0;if(!this.#e.get(e).visible)return!0}return!1}else if(t.policy==="AllOff"){for(const e of t.ids){if(!this.#e.has(e))return B(`Optional content group not found: ${e}`),!0;if(this.#e.get(e).visible)return!1}return!0}return B(`Unknown optional content policy ${t.policy}.`),!0}return B(`Unknown group type ${t.type}.`),!0}setVisibility(t,e=!0,i=!0){const s=this.#e.get(t);if(!s){B(`Optional content group not found: ${t}`);return}if(i&&e&&s.rbGroups.length)for(const n of s.rbGroups)for(const r of n)r!==t&&this.#e.get(r)?._setVisible(Ce,!1,!0);s._setVisible(Ce,!!e,!0),this.#t=null}setOCGState({state:t,preserveRB:e}){let i;for(const s of t){switch(s){case"ON":case"OFF":case"Toggle":i=s;continue}const n=this.#e.get(s);if(n)switch(i){case"ON":this.setVisibility(s,!0,e);break;case"OFF":this.setVisibility(s,!1,e);break;case"Toggle":this.setVisibility(s,!n.visible,e);break}}this.#t=null}get hasInitialVisibility(){return this.#s===null||this.getHash()===this.#s}getOrder(){return this.#e.size?this.#i?this.#i.slice():[...this.#e.keys()]:null}getGroup(t){return this.#e.get(t)||null}getHash(){if(this.#t!==null)return this.#t;const t=new dr;for(const[e,i]of this.#e)t.update(`${e}:${i.visible}`);return this.#t=t.hexdigest()}[Symbol.iterator](){return this.#e.entries()}}class kl{constructor(t,{disableRange:e=!1,disableStream:i=!1}){W(t,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:s,initialData:n,progressiveDone:r,contentDispositionFilename:a}=t;if(this._queuedChunks=[],this._progressiveDone=r,this._contentDispositionFilename=a,n?.length>0){const l=n instanceof Uint8Array&&n.byteLength===n.buffer.byteLength?n.buffer:new Uint8Array(n).buffer;this._queuedChunks.push(l)}this._pdfDataRangeTransport=t,this._isStreamingSupported=!i,this._isRangeSupported=!e,this._contentLength=s,this._fullRequestReader=null,this._rangeReaders=[],t.addRangeListener((l,c)=>{this._onReceiveData({begin:l,chunk:c})}),t.addProgressListener((l,c)=>{this._onProgress({loaded:l,total:c})}),t.addProgressiveReadListener(l=>{this._onReceiveData({chunk:l})}),t.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),t.transportReady()}_onReceiveData({begin:t,chunk:e}){const i=e instanceof Uint8Array&&e.byteLength===e.buffer.byteLength?e.buffer:new Uint8Array(e).buffer;if(t===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(i):this._queuedChunks.push(i);else{const s=this._rangeReaders.some(function(n){return n._begin!==t?!1:(n._enqueue(i),!0)});W(s,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(t){t.total===void 0?this._rangeReaders[0]?.onProgress?.({loaded:t.loaded}):this._fullRequestReader?.onProgress?.({loaded:t.loaded,total:t.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(t){const e=this._rangeReaders.indexOf(t);e>=0&&this._rangeReaders.splice(e,1)}getFullReader(){W(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const t=this._queuedChunks;return this._queuedChunks=null,new _l(this,t,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const i=new El(this,t,e);return this._pdfDataRangeTransport.requestDataRange(t,e),this._rangeReaders.push(i),i}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeReaders.slice(0))e.cancel(t);this._pdfDataRangeTransport.abort()}}class _l{constructor(t,e,i=!1,s=null){this._stream=t,this._done=i||!1,this._filename=Ui(s)?s:null,this._queuedChunks=e||[],this._loaded=0;for(const n of this._queuedChunks)this._loaded+=n.byteLength;this._requests=[],this._headersReady=Promise.resolve(),t._fullRequestReader=this,this.onProgress=null}_enqueue(t){this._done||(this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunks.push(t),this._loaded+=t.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class El{constructor(t,e,i){this._stream=t,this._begin=e,this._end=i,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(t){if(!this._done){if(this._requests.length===0)this._queuedChunk=t;else{this._requests.shift().resolve({value:t,done:!1});for(const i of this._requests)i.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function Cl(o){let t=!0,e=i("filename\\*","i").exec(o);if(e){e=e[1];let h=a(e);return h=unescape(h),h=l(h),h=c(h),n(h)}if(e=r(o),e){const h=c(e);return n(h)}if(e=i("filename","i").exec(o),e){e=e[1];let h=a(e);return h=c(h),n(h)}function i(h,d){return new RegExp("(?:^|;)\\s*"+h+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',d)}function s(h,d){if(h){if(!/^[\x00-\xFF]+$/.test(d))return d;try{const u=new TextDecoder(h,{fatal:!0}),p=oi(d);d=u.decode(p),t=!1}catch{}}return d}function n(h){return t&&/[\x80-\xff]/.test(h)&&(h=s("utf-8",h),t&&(h=s("iso-8859-1",h))),h}function r(h){const d=[];let u;const p=i("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(u=p.exec(h))!==null;){let[,g,y,b]=u;if(g=parseInt(g,10),g in d){if(g===0)break;continue}d[g]=[y,b]}const m=[];for(let g=0;g<d.length&&g in d;++g){let[y,b]=d[g];b=a(b),y&&(b=unescape(b),g===0&&(b=l(b))),m.push(b)}return m.join("")}function a(h){if(h.startsWith('"')){const d=h.slice(1).split('\\"');for(let u=0;u<d.length;++u){const p=d[u].indexOf('"');p!==-1&&(d[u]=d[u].slice(0,p),d.length=u+1),d[u]=d[u].replaceAll(/\\(.)/g,"$1")}h=d.join('"')}return h}function l(h){const d=h.indexOf("'");if(d===-1)return h;const u=h.slice(0,d),m=h.slice(d+1).replace(/^[^']*'/,"");return s(u,m)}function c(h){return!h.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(h)?h:h.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(d,u,p,m){if(p==="q"||p==="Q")return m=m.replaceAll("_"," "),m=m.replaceAll(/=([0-9a-fA-F]{2})/g,function(g,y){return String.fromCharCode(parseInt(y,16))}),s(u,m);try{m=atob(m)}catch{}return s(u,m)})}return""}function wr(o,t){const e=new Headers;if(!o||!t||typeof t!="object")return e;for(const i in t){const s=t[i];s!==void 0&&e.append(i,s)}return e}function zi(o){return URL.parse(o)?.origin??null}function vr({responseHeaders:o,isHttp:t,rangeChunkSize:e,disableRange:i}){const s={allowRangeRequests:!1,suggestedLength:void 0},n=parseInt(o.get("Content-Length"),10);return!Number.isInteger(n)||(s.suggestedLength=n,n<=2*e)||i||!t||o.get("Accept-Ranges")!=="bytes"||(o.get("Content-Encoding")||"identity")!=="identity"||(s.allowRangeRequests=!0),s}function xr(o){const t=o.get("Content-Disposition");if(t){let e=Cl(t);if(e.includes("%"))try{e=decodeURIComponent(e)}catch{}if(Ui(e))return e}return null}function ui(o,t){return new ti(`Unexpected server response (${o}) while retrieving PDF "${t}".`,o,o===404||o===0&&t.startsWith("file:"))}function Ar(o){return o===200||o===206}function Sr(o,t,e){return{method:"GET",headers:o,signal:e.signal,mode:"cors",credentials:t?"include":"same-origin",redirect:"follow"}}function kr(o){return o instanceof Uint8Array?o.buffer:o instanceof ArrayBuffer?o:(B(`getArrayBuffer - unexpected data format: ${o}`),new Uint8Array(o).buffer)}class Tl{_responseOrigin=null;constructor(t){this.source=t,this.isHttp=/^https?:/i.test(t.url),this.headers=wr(this.isHttp,t.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return W(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new Ll(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const i=new Pl(this,t,e);return this._rangeRequestReaders.push(i),i}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class Ll{constructor(t){this._stream=t,this._reader=null,this._loaded=0,this._filename=null;const e=t.source;this._withCredentials=e.withCredentials||!1,this._contentLength=e.length,this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange;const i=new Headers(t.headers),s=e.url;fetch(s,Sr(i,this._withCredentials,this._abortController)).then(n=>{if(t._responseOrigin=zi(n.url),!Ar(n.status))throw ui(n.status,s);this._reader=n.body.getReader(),this._headersCapability.resolve();const r=n.headers,{allowRangeRequests:a,suggestedLength:l}=vr({responseHeaders:r,isHttp:t.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=a,this._contentLength=l||this._contentLength,this._filename=xr(r),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new se("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:kr(t),done:!1})}cancel(t){this._reader?.cancel(t),this._abortController.abort()}}class Pl{constructor(t,e,i){this._stream=t,this._reader=null,this._loaded=0;const s=t.source;this._withCredentials=s.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!s.disableStream,this._abortController=new AbortController;const n=new Headers(t.headers);n.append("Range",`bytes=${e}-${i-1}`);const r=s.url;fetch(r,Sr(n,this._withCredentials,this._abortController)).then(a=>{const l=zi(a.url);if(l!==t._responseOrigin)throw new Error(`Expected range response-origin "${l}" to match "${t._responseOrigin}".`);if(!Ar(a.status))throw ui(a.status,r);this._readCapability.resolve(),this._reader=a.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,this.onProgress?.({loaded:this._loaded}),{value:kr(t),done:!1})}cancel(t){this._reader?.cancel(t),this._abortController.abort()}}const as=200,os=206;function Ml(o){const t=o.response;return typeof t!="string"?t:oi(t).buffer}class Rl{_responseOrigin=null;constructor({url:t,httpHeaders:e,withCredentials:i}){this.url=t,this.isHttp=/^https?:/i.test(t),this.headers=wr(this.isHttp,e),this.withCredentials=i||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(t){const e=new XMLHttpRequest,i=this.currXhrId++,s=this.pendingRequests[i]={xhr:e};e.open("GET",this.url),e.withCredentials=this.withCredentials;for(const[n,r]of this.headers)e.setRequestHeader(n,r);return this.isHttp&&"begin"in t&&"end"in t?(e.setRequestHeader("Range",`bytes=${t.begin}-${t.end-1}`),s.expectedStatus=os):s.expectedStatus=as,e.responseType="arraybuffer",W(t.onError,"Expected `onError` callback to be provided."),e.onerror=()=>{t.onError(e.status)},e.onreadystatechange=this.onStateChange.bind(this,i),e.onprogress=this.onProgress.bind(this,i),s.onHeadersReceived=t.onHeadersReceived,s.onDone=t.onDone,s.onError=t.onError,s.onProgress=t.onProgress,e.send(null),i}onProgress(t,e){const i=this.pendingRequests[t];i&&i.onProgress?.(e)}onStateChange(t,e){const i=this.pendingRequests[t];if(!i)return;const s=i.xhr;if(s.readyState>=2&&i.onHeadersReceived&&(i.onHeadersReceived(),delete i.onHeadersReceived),s.readyState!==4||!(t in this.pendingRequests))return;if(delete this.pendingRequests[t],s.status===0&&this.isHttp){i.onError(s.status);return}const n=s.status||as;if(!(n===as&&i.expectedStatus===os)&&n!==i.expectedStatus){i.onError(s.status);return}const a=Ml(s);if(n===os){const l=s.getResponseHeader("Content-Range"),c=/bytes (\d+)-(\d+)\/(\d+)/.exec(l);c?i.onDone({begin:parseInt(c[1],10),chunk:a}):(B('Missing or invalid "Content-Range" header.'),i.onError(0))}else a?i.onDone({begin:0,chunk:a}):i.onError(s.status)}getRequestXhr(t){return this.pendingRequests[t].xhr}isPendingRequest(t){return t in this.pendingRequests}abortRequest(t){const e=this.pendingRequests[t].xhr;delete this.pendingRequests[t],e.abort()}}class Dl{constructor(t){this._source=t,this._manager=new Rl(t),this._rangeChunkSize=t.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(t){const e=this._rangeRequestReaders.indexOf(t);e>=0&&this._rangeRequestReaders.splice(e,1)}getFullReader(){return W(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new Nl(this._manager,this._source),this._fullRequestReader}getRangeReader(t,e){const i=new Il(this._manager,t,e);return i.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(i),i}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class Nl{constructor(t,e){this._manager=t,this._url=e.url,this._fullRequestId=t.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._contentLength=e.length,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const t=this._fullRequestId,e=this._manager.getRequestXhr(t);this._manager._responseOrigin=zi(e.responseURL);const i=e.getAllResponseHeaders(),s=new Headers(i?i.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(a=>{const[l,...c]=a.split(": ");return[l,c.join(": ")]}):[]),{allowRangeRequests:n,suggestedLength:r}=vr({responseHeaders:s,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});n&&(this._isRangeSupported=!0),this._contentLength=r||this._contentLength,this._filename=xr(s),this._isRangeSupported&&this._manager.abortRequest(t),this._headersCapability.resolve()}_onDone(t){if(t&&(this._requests.length>0?this._requests.shift().resolve({value:t.chunk,done:!1}):this._cachedChunks.push(t.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(t){this._storedError=ui(t,this._url),this._headersCapability.reject(this._storedError);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(t){this.onProgress?.({loaded:t.loaded,total:t.lengthComputable?t.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0,this._headersCapability.reject(t);for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class Il{constructor(t,e,i){this._manager=t,this._url=t.url,this._requestId=t.request({begin:e,end:i,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){const t=zi(this._manager.getRequestXhr(this._requestId)?.responseURL);t!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${t}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){this.onClosed?.(this)}_onDone(t){const e=t.chunk;this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunk=e,this._done=!0;for(const i of this._requests)i.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(t){this._storedError??=ui(t,this._url);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(t){this.isStreamingSupported||this.onProgress?.({loaded:t.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const Fl=/^[a-z][a-z0-9\-+.]+:/i;function Ol(o){if(Fl.test(o))return new URL(o);const t=process.getBuiltinModule("url");return new URL(t.pathToFileURL(o))}class jl{constructor(t){this.source=t,this.url=Ol(t.url),W(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return W(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new Bl(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const i=new Hl(this,t,e);return this._rangeRequestReaders.push(i),i}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class Bl{constructor(t){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null;const e=t.source;this._contentLength=e.length,this._loaded=0,this._filename=null,this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const i=process.getBuiltinModule("fs");i.promises.lstat(this._url).then(s=>{this._contentLength=s.size,this._setReadableStream(i.createReadStream(this._url)),this._headersCapability.resolve()},s=>{s.code==="ENOENT"&&(s=ui(0,this._url.href)),this._storedError=s,this._headersCapability.reject(s)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new se("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class Hl{constructor(t,e,i){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const s=t.source;this._isStreamingSupported=!s.disableStream;const n=process.getBuiltinModule("fs");this._setReadableStream(n.createReadStream(this._url,{start:e,end:i-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const Ge=Symbol("INITIAL_DATA");class _r{#t=Object.create(null);#e(t){return this.#t[t]||={...Promise.withResolvers(),data:Ge}}get(t,e=null){if(e){const s=this.#e(t);return s.promise.then(()=>e(s.data)),null}const i=this.#t[t];if(!i||i.data===Ge)throw new Error(`Requesting object that isn't resolved yet ${t}.`);return i.data}has(t){const e=this.#t[t];return!!e&&e.data!==Ge}delete(t){const e=this.#t[t];return!e||e.data===Ge?!1:(delete this.#t[t],!0)}resolve(t,e=null){const i=this.#e(t);i.data=e,i.resolve()}clear(){for(const t in this.#t){const{data:e}=this.#t[t];e?.bitmap?.close()}this.#t=Object.create(null)}*[Symbol.iterator](){for(const t in this.#t){const{data:e}=this.#t[t];e!==Ge&&(yield[t,e])}}}const Ul=1e5,_n=30;let ii=class Ht{#t=Promise.withResolvers();#e=null;#s=!1;#i=!!globalThis.FontInspector?.enabled;#a=null;#n=null;#r=0;#o=0;#c=null;#l=null;#u=0;#d=0;#p=Object.create(null);#m=[];#f=null;#h=[];#g=new WeakMap;#b=null;static#w=new Map;static#y=new Map;static#_=new WeakMap;static#S=null;static#v=new Set;constructor({textContentSource:t,container:e,viewport:i}){if(t instanceof ReadableStream)this.#f=t;else if(typeof t=="object")this.#f=new ReadableStream({start(l){l.enqueue(t),l.close()}});else throw new Error('No "textContentSource" parameter specified.');this.#e=this.#l=e,this.#d=i.scale*zt.pixelRatio,this.#u=i.rotation,this.#n={div:null,properties:null,ctx:null};const{pageWidth:s,pageHeight:n,pageX:r,pageY:a}=i.rawDims;this.#b=[1,0,0,-1,-r,a+n],this.#o=s,this.#r=n,Ht.#L(),ce(e,i),this.#t.promise.finally(()=>{Ht.#v.delete(this),this.#n=null,this.#p=null}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:t,isFirefox:e}=bt.platform;return z(this,"fontFamilyMap",new Map([["sans-serif",`${t&&e?"Calibri, ":""}sans-serif`],["monospace",`${t&&e?"Lucida Console, ":""}monospace`]]))}render(){const t=()=>{this.#c.read().then(({value:e,done:i})=>{if(i){this.#t.resolve();return}this.#a??=e.lang,Object.assign(this.#p,e.styles),this.#C(e.items),t()},this.#t.reject)};return this.#c=this.#f.getReader(),Ht.#v.add(this),t(),this.#t.promise}update({viewport:t,onBefore:e=null}){const i=t.scale*zt.pixelRatio,s=t.rotation;if(s!==this.#u&&(e?.(),this.#u=s,ce(this.#l,{rotation:s})),i!==this.#d){e?.(),this.#d=i;const n={div:null,properties:null,ctx:Ht.#P(this.#a)};for(const r of this.#h)n.properties=this.#g.get(r),n.div=r,this.#k(n)}}cancel(){const t=new se("TextLayer task cancelled.");this.#c?.cancel(t).catch(()=>{}),this.#c=null,this.#t.reject(t)}get textDivs(){return this.#h}get textContentItemsStr(){return this.#m}#C(t){if(this.#s)return;this.#n.ctx??=Ht.#P(this.#a);const e=this.#h,i=this.#m;for(const s of t){if(e.length>Ul){B("Ignoring additional textDivs for performance reasons."),this.#s=!0;return}if(s.str===void 0){if(s.type==="beginMarkedContentProps"||s.type==="beginMarkedContent"){const n=this.#e;this.#e=document.createElement("span"),this.#e.classList.add("markedContent"),s.id&&this.#e.setAttribute("id",`${s.id}`),n.append(this.#e)}else s.type==="endMarkedContent"&&(this.#e=this.#e.parentNode);continue}i.push(s.str),this.#A(s)}}#A(t){const e=document.createElement("span"),i={angle:0,canvasWidth:0,hasText:t.str!=="",hasEOL:t.hasEOL,fontSize:0};this.#h.push(e);const s=N.transform(this.#b,t.transform);let n=Math.atan2(s[1],s[0]);const r=this.#p[t.fontName];r.vertical&&(n+=Math.PI/2);let a=this.#i&&r.fontSubstitution||r.fontFamily;a=Ht.fontFamilyMap.get(a)||a;const l=Math.hypot(s[2],s[3]),c=l*Ht.#O(a,r,this.#a);let h,d;n===0?(h=s[4],d=s[5]-c):(h=s[4]+c*Math.sin(n),d=s[5]-c*Math.cos(n));const u="calc(var(--total-scale-factor) *",p=e.style;this.#e===this.#l?(p.left=`${(100*h/this.#o).toFixed(2)}%`,p.top=`${(100*d/this.#r).toFixed(2)}%`):(p.left=`${u}${h.toFixed(2)}px)`,p.top=`${u}${d.toFixed(2)}px)`),p.fontSize=`${u}${(Ht.#S*l).toFixed(2)}px)`,p.fontFamily=a,i.fontSize=l,e.setAttribute("role","presentation"),e.textContent=t.str,e.dir=t.dir,this.#i&&(e.dataset.fontName=r.fontSubstitutionLoadedName||t.fontName),n!==0&&(i.angle=n*(180/Math.PI));let m=!1;if(t.str.length>1)m=!0;else if(t.str!==" "&&t.transform[0]!==t.transform[3]){const g=Math.abs(t.transform[0]),y=Math.abs(t.transform[3]);g!==y&&Math.max(g,y)/Math.min(g,y)>1.5&&(m=!0)}if(m&&(i.canvasWidth=r.vertical?t.height:t.width),this.#g.set(e,i),this.#n.div=e,this.#n.properties=i,this.#k(this.#n),i.hasText&&this.#e.append(e),i.hasEOL){const g=document.createElement("br");g.setAttribute("role","presentation"),this.#e.append(g)}}#k(t){const{div:e,properties:i,ctx:s}=t,{style:n}=e;let r="";if(Ht.#S>1&&(r=`scale(${1/Ht.#S})`),i.canvasWidth!==0&&i.hasText){const{fontFamily:a}=n,{canvasWidth:l,fontSize:c}=i;Ht.#T(s,c*this.#d,a);const{width:h}=s.measureText(e.textContent);h>0&&(r=`scaleX(${l*this.#d/h}) ${r}`)}i.angle!==0&&(r=`rotate(${i.angle}deg) ${r}`),r.length>0&&(n.transform=r)}static cleanup(){if(!(this.#v.size>0)){this.#w.clear();for(const{canvas:t}of this.#y.values())t.remove();this.#y.clear()}}static#P(t=null){let e=this.#y.get(t||="");if(!e){const i=document.createElement("canvas");i.className="hiddenCanvasElement",i.lang=t,document.body.append(i),e=i.getContext("2d",{alpha:!1,willReadFrequently:!0}),this.#y.set(t,e),this.#_.set(e,{size:0,family:""})}return e}static#T(t,e,i){const s=this.#_.get(t);e===s.size&&i===s.family||(t.font=`${e}px ${i}`,s.size=e,s.family=i)}static#L(){if(this.#S!==null)return;const t=document.createElement("div");t.style.opacity=0,t.style.lineHeight=1,t.style.fontSize="1px",t.style.position="absolute",t.textContent="X",document.body.append(t),this.#S=t.getBoundingClientRect().height,t.remove()}static#O(t,e,i){const s=this.#w.get(t);if(s)return s;const n=this.#P(i);n.canvas.width=n.canvas.height=_n,this.#T(n,_n,t);const r=n.measureText(""),a=r.fontBoundingBoxAscent,l=Math.abs(r.fontBoundingBoxDescent);n.canvas.width=n.canvas.height=0;let c=.8;return a?c=a/(a+l):(bt.platform.isFirefox&&B("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),e.ascent?c=e.ascent:e.descent&&(c=1+e.descent)),this.#w.set(t,c),c}};const zl=100;function Os(o={}){typeof o=="string"||o instanceof URL?o={url:o}:(o instanceof ArrayBuffer||ArrayBuffer.isView(o))&&(o={data:o});const t=new js,{docId:e}=t,i=o.url?Ko(o.url):null,s=o.data?Qo(o.data):null,n=o.httpHeaders||null,r=o.withCredentials===!0,a=o.password??null,l=o.range instanceof Bs?o.range:null,c=Number.isInteger(o.rangeChunkSize)&&o.rangeChunkSize>0?o.rangeChunkSize:2**16;let h=o.worker instanceof Oe?o.worker:null;const d=o.verbosity,u=typeof o.docBaseUrl=="string"&&!ci(o.docBaseUrl)?o.docBaseUrl:null,p=vi(o.cMapUrl),m=o.cMapPacked!==!1,g=o.CMapReaderFactory||(Ct?nl:dn),y=vi(o.iccUrl),b=vi(o.standardFontDataUrl),v=o.StandardFontDataFactory||(Ct?rl:un),w=vi(o.wasmUrl),A=o.WasmFactory||(Ct?al:pn),x=o.stopAtErrors!==!0,S=Number.isInteger(o.maxImageSize)&&o.maxImageSize>-1?o.maxImageSize:-1,k=o.isEvalSupported!==!1,_=typeof o.isOffscreenCanvasSupported=="boolean"?o.isOffscreenCanvasSupported:!Ct,E=typeof o.isImageDecoderSupported=="boolean"?o.isImageDecoderSupported:!Ct&&(bt.platform.isFirefox||!globalThis.chrome),L=Number.isInteger(o.canvasMaxAreaInBytes)?o.canvasMaxAreaInBytes:-1,P=typeof o.disableFontFace=="boolean"?o.disableFontFace:Ct,G=o.fontExtraProperties===!0,H=o.enableXfa===!0,O=o.ownerDocument||globalThis.document,$=o.disableRange===!0,M=o.disableStream===!0,R=o.disableAutoFetch===!0,U=o.pdfBug===!0,nt=o.CanvasFactory||(Ct?sl:tl),St=o.FilterFactory||(Ct?il:el),Ot=o.enableHWA===!0,tt=o.useWasm!==!1,X=l?l.length:o.length??NaN,kt=typeof o.useSystemFonts=="boolean"?o.useSystemFonts:!Ct&&!P,Lt=typeof o.useWorkerFetch=="boolean"?o.useWorkerFetch:!!(g===dn&&v===un&&A===pn&&p&&b&&w&&qe(p,document.baseURI)&&qe(b,document.baseURI)&&qe(w,document.baseURI)),_t=null;Mo(d);const Z={canvasFactory:new nt({ownerDocument:O,enableHWA:Ot}),filterFactory:new St({docId:e,ownerDocument:O}),cMapReaderFactory:Lt?null:new g({baseUrl:p,isCompressed:m}),standardFontDataFactory:Lt?null:new v({baseUrl:b}),wasmFactory:Lt?null:new A({baseUrl:w})};h||(h=Oe.create({verbosity:d,port:le.workerPort}),t._worker=h);const Gt={docId:e,apiVersion:"5.4.296",data:s,password:a,disableAutoFetch:R,rangeChunkSize:c,length:X,docBaseUrl:u,enableXfa:H,evaluatorOptions:{maxImageSize:S,disableFontFace:P,ignoreErrors:x,isEvalSupported:k,isOffscreenCanvasSupported:_,isImageDecoderSupported:E,canvasMaxAreaInBytes:L,fontExtraProperties:G,useSystemFonts:kt,useWasm:tt,useWorkerFetch:Lt,cMapUrl:p,iccUrl:y,standardFontDataUrl:b,wasmUrl:w}},Et={ownerDocument:O,pdfBug:U,styleElement:_t,loadingParams:{disableAutoFetch:R,enableXfa:H}};return h.promise.then(function(){if(t.destroyed)throw new Error("Loading aborted");if(h.destroyed)throw new Error("Worker was destroyed");const rt=h.messageHandler.sendWithPromise("GetDocRequest",Gt,s?[s.buffer]:null);let Jt;if(l)Jt=new kl(l,{disableRange:$,disableStream:M});else if(!s){if(!i)throw new Error("getDocument - no `url` parameter provided.");const Zt=qe(i)?Tl:Ct?jl:Dl;Jt=new Zt({url:i,length:X,httpHeaders:n,withCredentials:r,rangeChunkSize:c,disableRange:$,disableStream:M})}return rt.then(Zt=>{if(t.destroyed)throw new Error("Loading aborted");if(h.destroyed)throw new Error("Worker was destroyed");const q=new Xe(e,Zt,h.port),et=new Vl(q,t,Jt,Et,Z,Ot);t._transport=et,q.send("Ready",null)})}).catch(t._capability.reject),t}class js{static#t=0;_capability=Promise.withResolvers();_transport=null;_worker=null;docId=`d${js.#t++}`;destroyed=!1;onPassword=null;onProgress=null;get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await this._transport?.destroy()}catch(t){throw this._worker?.port&&delete this._worker._pendingDestroy,t}this._transport=null,this._worker?.destroy(),this._worker=null}async getData(){return this._transport.getData()}}let Bs=class{#t=Promise.withResolvers();#e=[];#s=[];#i=[];#a=[];constructor(t,e,i=!1,s=null){this.length=t,this.initialData=e,this.progressiveDone=i,this.contentDispositionFilename=s}addRangeListener(t){this.#a.push(t)}addProgressListener(t){this.#i.push(t)}addProgressiveReadListener(t){this.#s.push(t)}addProgressiveDoneListener(t){this.#e.push(t)}onDataRange(t,e){for(const i of this.#a)i(t,e)}onDataProgress(t,e){this.#t.promise.then(()=>{for(const i of this.#i)i(t,e)})}onDataProgressiveRead(t){this.#t.promise.then(()=>{for(const e of this.#s)e(t)})}onDataProgressiveDone(){this.#t.promise.then(()=>{for(const t of this.#e)t()})}transportReady(){this.#t.resolve()}requestDataRange(t,e){J("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}};class Gl{constructor(t,e){this._pdfInfo=t,this._transport=e}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return z(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(t){return this._transport.getPage(t)}getPageIndex(t){return this._transport.getPageIndex(t)}getDestinations(){return this._transport.getDestinations()}getDestination(t){return this._transport.getDestination(t)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getAnnotationsByType(t,e){return this._transport.getAnnotationsByType(t,e)}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getOptionalContentConfig(e)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(t=!1){return this._transport.startCleanup(t||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(t){return this._transport.cachedPageNumber(t)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}class $l{#t=!1;constructor(t,e,i,s=!1){this._pageIndex=t,this._pageInfo=e,this._transport=i,this._stats=s?new nn:null,this._pdfBug=s,this.commonObjs=i.commonObjs,this.objs=new _r,this._intentStates=new Map,this.destroyed=!1,this.recordedBBoxes=null}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:t,rotation:e=this.rotate,offsetX:i=0,offsetY:s=0,dontFlip:n=!1}={}){return new li({viewBox:this.view,userUnit:this.userUnit,scale:t,rotation:e,offsetX:i,offsetY:s,dontFlip:n})}getAnnotations({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getAnnotations(this._pageIndex,e)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return z(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:t,canvas:e=t.canvas,viewport:i,intent:s="display",annotationMode:n=Qt.ENABLE,transform:r=null,background:a=null,optionalContentConfigPromise:l=null,annotationCanvasMap:c=null,pageColors:h=null,printAnnotationStorage:d=null,isEditing:u=!1,recordOperations:p=!1,operationsFilter:m=null}){this._stats?.time("Overall");const g=this._transport.getRenderingIntent(s,n,d,u),{renderingIntent:y,cacheKey:b}=g;this.#t=!1,l||=this._transport.getOptionalContentConfig(y);let v=this._intentStates.get(b);v||(v=Object.create(null),this._intentStates.set(b,v)),v.streamReaderCancelTimeout&&(clearTimeout(v.streamReaderCancelTimeout),v.streamReaderCancelTimeout=null);const w=!!(y&Dt.PRINT);v.displayReadyCapability||(v.displayReadyCapability=Promise.withResolvers(),v.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(g));const A=!!(this._pdfBug&&globalThis.StepperManager?.enabled),x=!this.recordedBBoxes&&(p||A),S=E=>{if(v.renderTasks.delete(k),x){const L=k.gfx?.dependencyTracker.take();L&&(k.stepper&&k.stepper.setOperatorBBoxes(L,k.gfx.dependencyTracker.takeDebugMetadata()),p&&(this.recordedBBoxes=L))}w&&(this.#t=!0),this.#e(),E?(k.capability.reject(E),this._abortOperatorList({intentState:v,reason:E instanceof Error?E:new Error(E)})):k.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),globalThis.Stats?.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},k=new Le({callback:S,params:{canvas:e,canvasContext:t,dependencyTracker:x?new ll(e,v.operatorList.length,A):null,viewport:i,transform:r,background:a},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:c,operatorList:v.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!w,pdfBug:this._pdfBug,pageColors:h,enableHWA:this._transport.enableHWA,operationsFilter:m});(v.renderTasks||=new Set).add(k);const _=k.task;return Promise.all([v.displayReadyCapability.promise,l]).then(([E,L])=>{if(this.destroyed){S();return}if(this._stats?.time("Rendering"),!(L.renderingIntent&y))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");k.initializeGraphics({transparency:E,optionalContentConfig:L}),k.operatorListChanged()}).catch(S),_}getOperatorList({intent:t="display",annotationMode:e=Qt.ENABLE,printAnnotationStorage:i=null,isEditing:s=!1}={}){function n(){a.operatorList.lastChunk&&(a.opListReadCapability.resolve(a.operatorList),a.renderTasks.delete(l))}const r=this._transport.getRenderingIntent(t,e,i,s,!0);let a=this._intentStates.get(r.cacheKey);a||(a=Object.create(null),this._intentStates.set(r.cacheKey,a));let l;return a.opListReadCapability||(l=Object.create(null),l.operatorListChanged=n,a.opListReadCapability=Promise.withResolvers(),(a.renderTasks||=new Set).add(l),a.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(r)),a.opListReadCapability.promise}streamTextContent({includeMarkedContent:t=!1,disableNormalization:e=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:t===!0,disableNormalization:e===!0},{highWaterMark:100,size(s){return s.items.length}})}getTextContent(t={}){if(this._transport._htmlForXfa)return this.getXfa().then(i=>ei.textContent(i));const e=this.streamTextContent(t);return new Promise(function(i,s){function n(){r.read().then(function({value:l,done:c}){if(c){i(a);return}a.lang??=l.lang,Object.assign(a.styles,l.styles),a.items.push(...l.items),n()},s)}const r=e.getReader(),a={items:[],styles:Object.create(null),lang:null};n()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const t=[];for(const e of this._intentStates.values())if(this._abortOperatorList({intentState:e,reason:new Error("Page was destroyed."),force:!0}),!e.opListReadCapability)for(const i of e.renderTasks)t.push(i.completed),i.cancel();return this.objs.clear(),this.#t=!1,Promise.all(t)}cleanup(t=!1){this.#t=!0;const e=this.#e();return t&&e&&(this._stats&&=new nn),e}#e(){if(!this.#t||this.destroyed)return!1;for(const{renderTasks:t,operatorList:e}of this._intentStates.values())if(t.size>0||!e.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#t=!1,!0}_startRenderPage(t,e){const i=this._intentStates.get(e);i&&(this._stats?.timeEnd("Page Request"),i.displayReadyCapability?.resolve(t))}_renderPageChunk(t,e){for(let i=0,s=t.length;i<s;i++)e.operatorList.fnArray.push(t.fnArray[i]),e.operatorList.argsArray.push(t.argsArray[i]);e.operatorList.lastChunk=t.lastChunk,e.operatorList.separateAnnots=t.separateAnnots;for(const i of e.renderTasks)i.operatorListChanged();t.lastChunk&&this.#e()}_pumpOperatorList({renderingIntent:t,cacheKey:e,annotationStorageSerializable:i,modifiedIds:s}){const{map:n,transfer:r}=i,l=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:t,cacheKey:e,annotationStorage:n,modifiedIds:s},r).getReader(),c=this._intentStates.get(e);c.streamReader=l;const h=()=>{l.read().then(({value:d,done:u})=>{if(u){c.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(d,c),h())},d=>{if(c.streamReader=null,!this._transport.destroyed){if(c.operatorList){c.operatorList.lastChunk=!0;for(const u of c.renderTasks)u.operatorListChanged();this.#e()}if(c.displayReadyCapability)c.displayReadyCapability.reject(d);else if(c.opListReadCapability)c.opListReadCapability.reject(d);else throw d}})};h()}_abortOperatorList({intentState:t,reason:e,force:i=!1}){if(t.streamReader){if(t.streamReaderCancelTimeout&&(clearTimeout(t.streamReaderCancelTimeout),t.streamReaderCancelTimeout=null),!i){if(t.renderTasks.size>0)return;if(e instanceof Hi){let s=zl;e.extraDelay>0&&e.extraDelay<1e3&&(s+=e.extraDelay),t.streamReaderCancelTimeout=setTimeout(()=>{t.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:t,reason:e,force:!0})},s);return}}if(t.streamReader.cancel(new se(e.message)).catch(()=>{}),t.streamReader=null,!this._transport.destroyed){for(const[s,n]of this._intentStates)if(n===t){this._intentStates.delete(s);break}this.cleanup()}}}get stats(){return this._stats}}var oe,Ut,ee,pe,Oi,fe,ge,Tt,Ti,Er,Cr,Ye,Ie,Li;const st=class st{constructor({name:t=null,port:e=null,verbosity:i=Ro()}={}){$t(this,Tt);$t(this,oe,Promise.withResolvers());$t(this,Ut,null);$t(this,ee,null);$t(this,pe,null);if(this.name=t,this.destroyed=!1,this.verbosity=i,e){if(it(st,ge).has(e))throw new Error("Cannot use more than one PDFWorker per port.");it(st,ge).set(e,this),Vt(this,Tt,Er).call(this,e)}else Vt(this,Tt,Cr).call(this)}get promise(){return it(this,oe).promise}get port(){return it(this,ee)}get messageHandler(){return it(this,Ut)}destroy(){this.destroyed=!0,it(this,pe)?.terminate(),Pt(this,pe,null),it(st,ge).delete(it(this,ee)),Pt(this,ee,null),it(this,Ut)?.destroy(),Pt(this,Ut,null)}static create(t){const e=it(this,ge).get(t?.port);if(e){if(e._pendingDestroy)throw new Error("PDFWorker.create - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return e}return new st(t)}static get workerSrc(){if(le.workerSrc)return le.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return z(this,"_setupFakeWorkerGlobal",(async()=>it(this,Ie,Li)?it(this,Ie,Li):(await import(this.workerSrc)).WorkerMessageHandler)())}};oe=new WeakMap,Ut=new WeakMap,ee=new WeakMap,pe=new WeakMap,Oi=new WeakMap,fe=new WeakMap,ge=new WeakMap,Tt=new WeakSet,Ti=function(){it(this,oe).resolve(),it(this,Ut).send("configure",{verbosity:this.verbosity})},Er=function(t){Pt(this,ee,t),Pt(this,Ut,new Xe("main","worker",t)),it(this,Ut).on("ready",()=>{}),Vt(this,Tt,Ti).call(this)},Cr=function(){if(it(st,fe)||it(st,Ie,Li)){Vt(this,Tt,Ye).call(this);return}let{workerSrc:t}=st;try{st._isSameOrigin(window.location,t)||(t=st._createCDNWrapper(new URL(t,window.location).href));const e=new Worker(t,{type:"module"}),i=new Xe("main","worker",e),s=()=>{n.abort(),i.destroy(),e.terminate(),this.destroyed?it(this,oe).reject(new Error("Worker was destroyed")):Vt(this,Tt,Ye).call(this)},n=new AbortController;e.addEventListener("error",()=>{it(this,pe)||s()},{signal:n.signal}),i.on("test",a=>{if(n.abort(),this.destroyed||!a){s();return}Pt(this,Ut,i),Pt(this,ee,e),Pt(this,pe,e),Vt(this,Tt,Ti).call(this)}),i.on("ready",a=>{if(n.abort(),this.destroyed){s();return}try{r()}catch{Vt(this,Tt,Ye).call(this)}});const r=()=>{const a=new Uint8Array;i.send("test",a,[a.buffer])};r();return}catch{Bi("The worker has been disabled.")}Vt(this,Tt,Ye).call(this)},Ye=function(){it(st,fe)||(B("Setting up fake worker."),Pt(st,fe,!0)),st._setupFakeWorkerGlobal.then(t=>{if(this.destroyed){it(this,oe).reject(new Error("Worker was destroyed"));return}const e=new Zo;Pt(this,ee,e);const i=`fake${Xs(st,Oi)._++}`,s=new Xe(i+"_worker",i,e);t.setup(s,e),Pt(this,Ut,new Xe(i,i+"_worker",e)),Vt(this,Tt,Ti).call(this)}).catch(t=>{it(this,oe).reject(new Error(`Setting up fake worker failed: "${t.message}".`))})},Ie=new WeakSet,Li=function(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}},$t(st,Ie),$t(st,Oi,0),$t(st,fe,!1),$t(st,ge,new WeakMap),Ct&&(Pt(st,fe,!0),le.workerSrc||="./pdf.worker.mjs"),st._isSameOrigin=(t,e)=>{const i=URL.parse(t);if(!i?.origin||i.origin==="null")return!1;const s=new URL(e,i);return i.origin===s.origin},st._createCDNWrapper=t=>{const e=`await import("${t}");`;return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))},st.fromPort=t=>{if(Uo("`PDFWorker.fromPort` - please use `PDFWorker.create` instead."),!t?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");return st.create(t)};let Oe=st;class Vl{#t=new Map;#e=new Map;#s=new Map;#i=new Map;#a=null;constructor(t,e,i,s,n,r){this.messageHandler=t,this.loadingTask=e,this.commonObjs=new _r,this.fontLoader=new Xo({ownerDocument:s.ownerDocument,styleElement:s.styleElement}),this.loadingParams=s.loadingParams,this._params=s,this.canvasFactory=n.canvasFactory,this.filterFactory=n.filterFactory,this.cMapReaderFactory=n.cMapReaderFactory,this.standardFontDataFactory=n.standardFontDataFactory,this.wasmFactory=n.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=i,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.enableHWA=r,this.setupMessageHandler()}#n(t,e=null){const i=this.#t.get(t);if(i)return i;const s=this.messageHandler.sendWithPromise(t,e);return this.#t.set(t,s),s}get annotationStorage(){return z(this,"annotationStorage",new Ds)}getRenderingIntent(t,e=Qt.ENABLE,i=null,s=!1,n=!1){let r=Dt.DISPLAY,a=ps;switch(t){case"any":r=Dt.ANY;break;case"display":break;case"print":r=Dt.PRINT;break;default:B(`getRenderingIntent - invalid intent: ${t}`)}const l=r&Dt.PRINT&&i instanceof ur?i:this.annotationStorage;switch(e){case Qt.DISABLE:r+=Dt.ANNOTATIONS_DISABLE;break;case Qt.ENABLE:break;case Qt.ENABLE_FORMS:r+=Dt.ANNOTATIONS_FORMS;break;case Qt.ENABLE_STORAGE:r+=Dt.ANNOTATIONS_STORAGE,a=l.serializable;break;default:B(`getRenderingIntent - invalid annotationMode: ${e}`)}s&&(r+=Dt.IS_EDITING),n&&(r+=Dt.OPLIST);const{ids:c,hash:h}=l.modifiedIds,d=[r,a.hash,h];return{renderingIntent:r,cacheKey:d.join("_"),annotationStorageSerializable:a,modifiedIds:c}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),this.#a?.reject(new Error("Worker was destroyed during onPassword callback"));const t=[];for(const i of this.#e.values())t.push(i._destroy());this.#e.clear(),this.#s.clear(),this.#i.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const e=this.messageHandler.sendWithPromise("Terminate",null);return t.push(e),Promise.all(t).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(),ii.cleanup(),this._networkStream?.cancelAllRequests(new se("Worker was terminated.")),this.messageHandler?.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:t,loadingTask:e}=this;t.on("GetReader",(i,s)=>{W(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=n=>{this._lastProgress={loaded:n.loaded,total:n.total}},s.onPull=()=>{this._fullReader.read().then(function({value:n,done:r}){if(r){s.close();return}W(n instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),s.enqueue(new Uint8Array(n),1,[n])}).catch(n=>{s.error(n)})},s.onCancel=n=>{this._fullReader.cancel(n),s.ready.catch(r=>{if(!this.destroyed)throw r})}}),t.on("ReaderHeadersReady",async i=>{await this._fullReader.headersReady;const{isStreamingSupported:s,isRangeSupported:n,contentLength:r}=this._fullReader;return(!s||!n)&&(this._lastProgress&&e.onProgress?.(this._lastProgress),this._fullReader.onProgress=a=>{e.onProgress?.({loaded:a.loaded,total:a.total})}),{isStreamingSupported:s,isRangeSupported:n,contentLength:r}}),t.on("GetRangeReader",(i,s)=>{W(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const n=this._networkStream.getRangeReader(i.begin,i.end);if(!n){s.close();return}s.onPull=()=>{n.read().then(function({value:r,done:a}){if(a){s.close();return}W(r instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),s.enqueue(new Uint8Array(r),1,[r])}).catch(r=>{s.error(r)})},s.onCancel=r=>{n.cancel(r),s.ready.catch(a=>{if(!this.destroyed)throw a})}}),t.on("GetDoc",({pdfInfo:i})=>{this._numPages=i.numPages,this._htmlForXfa=i.htmlForXfa,delete i.htmlForXfa,e._capability.resolve(new Gl(i,this))}),t.on("DocException",i=>{e._capability.reject(Mt(i))}),t.on("PasswordRequest",i=>{this.#a=Promise.withResolvers();try{if(!e.onPassword)throw Mt(i);const s=n=>{n instanceof Error?this.#a.reject(n):this.#a.resolve({password:n})};e.onPassword(s,i.code)}catch(s){this.#a.reject(s)}return this.#a.promise}),t.on("DataLoaded",i=>{e.onProgress?.({loaded:i.length,total:i.length}),this.downloadInfoCapability.resolve(i)}),t.on("StartRenderPage",i=>{if(this.destroyed)return;this.#e.get(i.pageIndex)._startRenderPage(i.transparency,i.cacheKey)}),t.on("commonobj",([i,s,n])=>{if(this.destroyed||this.commonObjs.has(i))return null;switch(s){case"Font":if("error"in n){const h=n.error;B(`Error during font loading: ${h}`),this.commonObjs.resolve(i,h);break}const r=new K(n),a=this._params.pdfBug&&globalThis.FontInspector?.enabled?(h,d)=>globalThis.FontInspector.fontAdded(h,d):null,l=new Yo(r,a,n.extra,n.charProcOperatorList);this.fontLoader.bind(l).catch(()=>t.sendWithPromise("FontFallback",{id:i})).finally(()=>{!l.fontExtraProperties&&l.data&&l.clearData(),this.commonObjs.resolve(i,l)});break;case"CopyLocalImage":const{imageRef:c}=n;W(c,"The imageRef must be defined.");for(const h of this.#e.values())for(const[,d]of h.objs)if(d?.ref===c)return d.dataLen?(this.commonObjs.resolve(i,structuredClone(d)),d.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(i,n);break;default:throw new Error(`Got unknown common object type ${s}`)}return null}),t.on("obj",([i,s,n,r])=>{if(this.destroyed)return;const a=this.#e.get(s);if(!a.objs.has(i)){if(a._intentStates.size===0){r?.bitmap?.close();return}switch(n){case"Image":case"Pattern":a.objs.resolve(i,r);break;default:throw new Error(`Got unknown object type ${n}`)}}}),t.on("DocProgress",i=>{this.destroyed||e.onProgress?.({loaded:i.loaded,total:i.total})}),t.on("FetchBinaryData",async i=>{if(this.destroyed)throw new Error("Worker was destroyed.");const s=this[i.type];if(!s)throw new Error(`${i.type} not initialized, see the \`useWorkerFetch\` parameter.`);return s.fetch(i)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&B("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:t,transfer:e}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:t,filename:this._fullReader?.filename??null},e).finally(()=>{this.annotationStorage.resetModified()})}getPage(t){if(!Number.isInteger(t)||t<=0||t>this._numPages)return Promise.reject(new Error("Invalid page request."));const e=t-1,i=this.#s.get(e);if(i)return i;const s=this.messageHandler.sendWithPromise("GetPage",{pageIndex:e}).then(n=>{if(this.destroyed)throw new Error("Transport destroyed");n.refStr&&this.#i.set(n.refStr,t);const r=new $l(e,n,this,this._params.pdfBug);return this.#e.set(e,r),r});return this.#s.set(e,s),s}getPageIndex(t){return fs(t)?this.messageHandler.sendWithPromise("GetPageIndex",{num:t.num,gen:t.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(t,e){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:t,intent:e})}getFieldObjects(){return this.#n("GetFieldObjects")}hasJSActions(){return this.#n("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(t){return typeof t!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:t})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getAnnotationsByType(t,e){return this.messageHandler.sendWithPromise("GetAnnotationsByType",{types:t,pageIndexesToSkip:e})}getDocJSActions(){return this.#n("GetDocJSActions")}getPageJSActions(t){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:t})}getStructTree(t){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:t})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(t){return this.#n("GetOptionalContentConfig").then(e=>new Sl(e,t))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const t="GetMetadata",e=this.#t.get(t);if(e)return e;const i=this.messageHandler.sendWithPromise(t,null).then(s=>({info:s[0],metadata:s[1]?new xl(s[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null}));return this.#t.set(t,i),i}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(t=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const e of this.#e.values())if(!e.cleanup())throw new Error(`startCleanup: Page ${e.pageNumber} is currently rendering.`);this.commonObjs.clear(),t||this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(!0),ii.cleanup()}}cachedPageNumber(t){if(!fs(t))return null;const e=t.gen===0?`${t.num}R`:`${t.num}R${t.gen}`;return this.#i.get(e)??null}}class Wl{#t=null;onContinue=null;onError=null;constructor(t){this.#t=t}get promise(){return this.#t.capability.promise}cancel(t=0){this.#t.cancel(null,t)}get separateAnnots(){const{separateAnnots:t}=this.#t.operatorList;if(!t)return!1;const{annotationCanvasMap:e}=this.#t;return t.form||t.canvas&&e?.size>0}}class Le{#t=null;static#e=new WeakSet;constructor({callback:t,params:e,objs:i,commonObjs:s,annotationCanvasMap:n,operatorList:r,pageIndex:a,canvasFactory:l,filterFactory:c,useRequestAnimationFrame:h=!1,pdfBug:d=!1,pageColors:u=null,enableHWA:p=!1,operationsFilter:m=null}){this.callback=t,this.params=e,this.objs=i,this.commonObjs=s,this.annotationCanvasMap=n,this.operatorListIdx=null,this.operatorList=r,this._pageIndex=a,this.canvasFactory=l,this.filterFactory=c,this._pdfBug=d,this.pageColors=u,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=h===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new Wl(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=e.canvas,this._canvasContext=e.canvas?null:e.canvasContext,this._enableHWA=p,this._dependencyTracker=e.dependencyTracker,this._operationsFilter=m}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:t=!1,optionalContentConfig:e}){if(this.cancelled)return;if(this._canvas){if(Le.#e.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");Le.#e.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{viewport:i,transform:s,background:n,dependencyTracker:r}=this.params,a=this._canvasContext||this._canvas.getContext("2d",{alpha:!1,willReadFrequently:!this._enableHWA});this.gfx=new Pe(a,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:e},this.annotationCanvasMap,this.pageColors,r),this.gfx.beginDrawing({transform:s,viewport:i,transparency:t,background:n}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(t=null,e=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),this.#t&&(window.cancelAnimationFrame(this.#t),this.#t=null),Le.#e.delete(this._canvas),t||=new Hi(`Rendering cancelled, page ${this._pageIndex+1}`,e),this.callback(t),this.task.onError?.(t)}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||=this._continueBound;return}this.gfx.dependencyTracker?.growOperationsCount(this.operatorList.fnArray.length),this.stepper?.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?this.#t=window.requestAnimationFrame(()=>{this.#t=null,this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper,this._operationsFilter),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),Le.#e.delete(this._canvas),this.callback())))}}const si="5.4.296",Tr="f56dc8601";class Nt{#t=null;#e=null;#s;#i=null;#a=!1;#n=!1;#r=null;#o;#c=null;#l=null;static#u=null;static get _keyboardManager(){return z(this,"_keyboardManager",new hi([[["Escape","mac+Escape"],Nt.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],Nt.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],Nt.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],Nt.prototype._moveToPrevious],[["Home","mac+Home"],Nt.prototype._moveToBeginning],[["End","mac+End"],Nt.prototype._moveToEnd]]))}constructor({editor:t=null,uiManager:e=null}){t?(this.#n=!1,this.#r=t):this.#n=!0,this.#l=t?._uiManager||e,this.#o=this.#l._eventBus,this.#s=t?.color?.toUpperCase()||this.#l?.highlightColors.values().next().value||"#FFFF98",Nt.#u||=Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"})}renderButton(){const t=this.#t=document.createElement("button");t.className="colorPicker",t.tabIndex="0",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),t.ariaHasPopup="true",this.#r&&(t.ariaControls=`${this.#r.id}_colorpicker_dropdown`);const e=this.#l._signal;t.addEventListener("click",this.#f.bind(this),{signal:e}),t.addEventListener("keydown",this.#m.bind(this),{signal:e});const i=this.#e=document.createElement("span");return i.className="swatch",i.ariaHidden="true",i.style.backgroundColor=this.#s,t.append(i),t}renderMainDropdown(){const t=this.#i=this.#d();return t.ariaOrientation="horizontal",t.ariaLabelledBy="highlightColorPickerLabel",t}#d(){const t=document.createElement("div"),e=this.#l._signal;t.addEventListener("contextmenu",Ft,{signal:e}),t.className="dropdown",t.role="listbox",t.ariaMultiSelectable="false",t.ariaOrientation="vertical",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown"),this.#r&&(t.id=`${this.#r.id}_colorpicker_dropdown`);for(const[i,s]of this.#l.highlightColors){const n=document.createElement("button");n.tabIndex="0",n.role="option",n.setAttribute("data-color",s),n.title=i,n.setAttribute("data-l10n-id",Nt.#u[i]);const r=document.createElement("span");n.append(r),r.className="swatch",r.style.backgroundColor=s,n.ariaSelected=s===this.#s,n.addEventListener("click",this.#p.bind(this,s),{signal:e}),t.append(n)}return t.addEventListener("keydown",this.#m.bind(this),{signal:e}),t}#p(t,e){e.stopPropagation(),this.#o.dispatch("switchannotationeditorparams",{source:this,type:V.HIGHLIGHT_COLOR,value:t}),this.updateColor(t)}_colorSelectFromKeyboard(t){if(t.target===this.#t){this.#f(t);return}const e=t.target.getAttribute("data-color");e&&this.#p(e,t)}_moveToNext(t){if(!this.#g){this.#f(t);return}if(t.target===this.#t){this.#i.firstChild?.focus();return}t.target.nextSibling?.focus()}_moveToPrevious(t){if(t.target===this.#i?.firstChild||t.target===this.#t){this.#g&&this._hideDropdownFromKeyboard();return}this.#g||this.#f(t),t.target.previousSibling?.focus()}_moveToBeginning(t){if(!this.#g){this.#f(t);return}this.#i.firstChild?.focus()}_moveToEnd(t){if(!this.#g){this.#f(t);return}this.#i.lastChild?.focus()}#m(t){Nt._keyboardManager.exec(this,t)}#f(t){if(this.#g){this.hideDropdown();return}if(this.#a=t.detail===0,this.#c||(this.#c=new AbortController,window.addEventListener("pointerdown",this.#h.bind(this),{signal:this.#l.combinedSignal(this.#c)})),this.#t.ariaExpanded="true",this.#i){this.#i.classList.remove("hidden");return}const e=this.#i=this.#d();this.#t.append(e)}#h(t){this.#i?.contains(t.target)||this.hideDropdown()}hideDropdown(){this.#i?.classList.add("hidden"),this.#t.ariaExpanded="false",this.#c?.abort(),this.#c=null}get#g(){return this.#i&&!this.#i.classList.contains("hidden")}_hideDropdownFromKeyboard(){if(!this.#n){if(!this.#g){this.#r?.unselect();return}this.hideDropdown(),this.#t.focus({preventScroll:!0,focusVisible:this.#a})}}updateColor(t){if(this.#e&&(this.#e.style.backgroundColor=t),!this.#i)return;const e=this.#l.highlightColors.values();for(const i of this.#i.children)i.ariaSelected=e.next().value===t.toUpperCase()}destroy(){this.#t?.remove(),this.#t=null,this.#e=null,this.#i?.remove(),this.#i=null}}class ni{#t=null;#e=null;#s=null;static#i=null;constructor(t){this.#e=t,this.#s=t._uiManager,ni.#i||=Object.freeze({freetext:"pdfjs-editor-color-picker-free-text-input",ink:"pdfjs-editor-color-picker-ink-input"})}renderButton(){if(this.#t)return this.#t;const{editorType:t,colorType:e,colorValue:i}=this.#e,s=this.#t=document.createElement("input");return s.type="color",s.value=i||"#000000",s.className="basicColorPicker",s.tabIndex=0,s.setAttribute("data-l10n-id",ni.#i[t]),s.addEventListener("input",()=>{this.#s.updateParams(e,s.value)},{signal:this.#s._signal}),s}update(t){this.#t&&(this.#t.value=t)}destroy(){this.#t?.remove(),this.#t=null}hideDropdown(){}}function En(o){return Math.floor(Math.max(0,Math.min(1,o))*255).toString(16).padStart(2,"0")}function $e(o){return Math.max(0,Math.min(255,255*o))}class Cn{static CMYK_G([t,e,i,s]){return["G",1-Math.min(1,.3*t+.59*i+.11*e+s)]}static G_CMYK([t]){return["CMYK",0,0,0,1-t]}static G_RGB([t]){return["RGB",t,t,t]}static G_rgb([t]){return t=$e(t),[t,t,t]}static G_HTML([t]){const e=En(t);return`#${e}${e}${e}`}static RGB_G([t,e,i]){return["G",.3*t+.59*e+.11*i]}static RGB_rgb(t){return t.map($e)}static RGB_HTML(t){return`#${t.map(En).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([t,e,i,s]){return["RGB",1-Math.min(1,t+s),1-Math.min(1,i+s),1-Math.min(1,e+s)]}static CMYK_rgb([t,e,i,s]){return[$e(1-Math.min(1,t+s)),$e(1-Math.min(1,i+s)),$e(1-Math.min(1,e+s))]}static CMYK_HTML(t){const e=this.CMYK_RGB(t).slice(1);return this.RGB_HTML(e)}static RGB_CMYK([t,e,i]){const s=1-t,n=1-e,r=1-i,a=Math.min(s,n,r);return["CMYK",s,n,r,a]}}class ql{create(t,e,i=!1){if(t<=0||e<=0)throw new Error("Invalid SVG dimensions");const s=this._createSVG("svg:svg");return s.setAttribute("version","1.1"),i||(s.setAttribute("width",`${t}px`),s.setAttribute("height",`${e}px`)),s.setAttribute("preserveAspectRatio","none"),s.setAttribute("viewBox",`0 0 ${t} ${e}`),s}createElement(t){if(typeof t!="string")throw new Error("Invalid SVG element type");return this._createSVG(t)}_createSVG(t){J("Abstract method `_createSVG` called.")}}class ri extends ql{_createSVG(t){return document.createElementNS(te,t)}}const Xl=9,ye=new WeakSet,Yl=new Date().getTimezoneOffset()*60*1e3;class Tn{static create(t){switch(t.data.annotationType){case ct.LINK:return new Hs(t);case ct.TEXT:return new Ql(t);case ct.WIDGET:switch(t.data.fieldType){case"Tx":return new Jl(t);case"Btn":return t.data.radioButton?new Lr(t):t.data.checkBox?new tc(t):new ec(t);case"Ch":return new ic(t);case"Sig":return new Zl(t)}return new xe(t);case ct.POPUP:return new bs(t);case ct.FREETEXT:return new Pr(t);case ct.LINE:return new nc(t);case ct.SQUARE:return new rc(t);case ct.CIRCLE:return new ac(t);case ct.POLYLINE:return new Mr(t);case ct.CARET:return new lc(t);case ct.INK:return new Us(t);case ct.POLYGON:return new oc(t);case ct.HIGHLIGHT:return new Rr(t);case ct.UNDERLINE:return new cc(t);case ct.SQUIGGLY:return new hc(t);case ct.STRIKEOUT:return new dc(t);case ct.STAMP:return new Dr(t);case ct.FILEATTACHMENT:return new uc(t);default:return new lt(t)}}}class lt{#t=null;#e=!1;#s=null;constructor(t,{isRenderable:e=!1,ignoreBorder:i=!1,createQuadrilaterals:s=!1}={}){this.isRenderable=e,this.data=t.data,this.layer=t.layer,this.linkService=t.linkService,this.downloadManager=t.downloadManager,this.imageResourcesPath=t.imageResourcesPath,this.renderForms=t.renderForms,this.svgFactory=t.svgFactory,this.annotationStorage=t.annotationStorage,this.enableComment=t.enableComment,this.enableScripting=t.enableScripting,this.hasJSActions=t.hasJSActions,this._fieldObjects=t.fieldObjects,this.parent=t.parent,e&&(this.container=this._createContainer(i)),s&&this._createQuadrilaterals()}static _hasPopupData({contentsObj:t,richText:e}){return!!(t?.str||e?.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return lt._hasPopupData(this.data)||this.enableComment&&!!this.commentText}get commentData(){const{data:t}=this,e=this.annotationStorage?.getEditor(t.id);return e?e.getData():t}get hasCommentButton(){return this.enableComment&&this.hasPopupElement}get commentButtonPosition(){const t=this.annotationStorage?.getEditor(this.data.id);if(t)return t.commentButtonPositionInPage;const{quadPoints:e,inkLists:i,rect:s}=this.data;let n=-1/0,r=-1/0;if(e?.length>=8){for(let a=0;a<e.length;a+=8)e[a+1]>r?(r=e[a+1],n=e[a+2]):e[a+1]===r&&(n=Math.max(n,e[a+2]));return[n,r]}if(i?.length>=1){for(const a of i)for(let l=0,c=a.length;l<c;l+=2)a[l+1]>r?(r=a[l+1],n=a[l]):a[l+1]===r&&(n=Math.max(n,a[l]));if(n!==1/0)return[n,r]}return s?[s[2],s[3]]:null}_normalizePoint(t){const{page:{view:e},viewport:{rawDims:{pageWidth:i,pageHeight:s,pageX:n,pageY:r}}}=this.parent;return t[1]=e[3]-t[1]+e[1],t[0]=100*(t[0]-n)/i,t[1]=100*(t[1]-r)/s,t}get commentText(){const{data:t}=this;return this.annotationStorage.getRawValue(`${Ze}${t.id}`)?.popup?.contents||t.contentsObj?.str||""}set commentText(t){const{data:e}=this,i={deleted:!t,contents:t||""};this.annotationStorage.updateEditor(e.id,{popup:i})||this.annotationStorage.setValue(`${Ze}${e.id}`,{id:e.id,annotationType:e.annotationType,pageIndex:this.parent.page._pageIndex,popup:i,popupRef:e.popupRef,modificationDate:new Date}),t||this.removePopup()}removePopup(){(this.#s?.popup||this.popup)?.remove(),this.#s=this.popup=null}updateEdited(t){if(!this.container)return;t.rect&&(this.#t||={rect:this.data.rect.slice(0)});const{rect:e,popup:i}=t;e&&this.#i(e);let s=this.#s?.popup||this.popup;!s&&i?.text&&(this._createPopup(i),s=this.#s.popup),s&&(s.updateEdited(t),i?.deleted&&(s.remove(),this.#s=null,this.popup=null))}resetEdited(){this.#t&&(this.#i(this.#t.rect),this.#s?.popup.resetEdited(),this.#t=null)}#i(t){const{container:{style:e},data:{rect:i,rotation:s},parent:{viewport:{rawDims:{pageWidth:n,pageHeight:r,pageX:a,pageY:l}}}}=this;i?.splice(0,4,...t),e.left=`${100*(t[0]-a)/n}%`,e.top=`${100*(r-t[3]+l)/r}%`,s===0?(e.width=`${100*(t[2]-t[0])/n}%`,e.height=`${100*(t[3]-t[1])/r}%`):this.setRotation(s)}_createContainer(t){const{data:e,parent:{page:i,viewport:s}}=this,n=document.createElement("section");n.setAttribute("data-annotation-id",e.id),!(this instanceof xe)&&!(this instanceof Hs)&&(n.tabIndex=0);const{style:r}=n;if(r.zIndex=this.parent.zIndex,this.parent.zIndex+=2,e.alternativeText&&(n.title=e.alternativeText),e.noRotate&&n.classList.add("norotate"),!e.rect||this instanceof bs){const{rotation:g}=e;return!e.hasOwnCanvas&&g!==0&&this.setRotation(g,n),n}const{width:a,height:l}=this;if(!t&&e.borderStyle.width>0){r.borderWidth=`${e.borderStyle.width}px`;const g=e.borderStyle.horizontalCornerRadius,y=e.borderStyle.verticalCornerRadius;if(g>0||y>0){const v=`calc(${g}px * var(--total-scale-factor)) / calc(${y}px * var(--total-scale-factor))`;r.borderRadius=v}else if(this instanceof Lr){const v=`calc(${a}px * var(--total-scale-factor)) / calc(${l}px * var(--total-scale-factor))`;r.borderRadius=v}switch(e.borderStyle.style){case Ee.SOLID:r.borderStyle="solid";break;case Ee.DASHED:r.borderStyle="dashed";break;case Ee.BEVELED:B("Unimplemented border style: beveled");break;case Ee.INSET:B("Unimplemented border style: inset");break;case Ee.UNDERLINE:r.borderBottomStyle="solid";break}const b=e.borderColor||null;b?(this.#e=!0,r.borderColor=N.makeHexColor(b[0]|0,b[1]|0,b[2]|0)):r.borderWidth=0}const c=N.normalizeRect([e.rect[0],i.view[3]-e.rect[1]+i.view[1],e.rect[2],i.view[3]-e.rect[3]+i.view[1]]),{pageWidth:h,pageHeight:d,pageX:u,pageY:p}=s.rawDims;r.left=`${100*(c[0]-u)/h}%`,r.top=`${100*(c[1]-p)/d}%`;const{rotation:m}=e;return e.hasOwnCanvas||m===0?(r.width=`${100*a/h}%`,r.height=`${100*l/d}%`):this.setRotation(m,n),n}setRotation(t,e=this.container){if(!this.data.rect)return;const{pageWidth:i,pageHeight:s}=this.parent.viewport.rawDims;let{width:n,height:r}=this;t%180!==0&&([n,r]=[r,n]),e.style.width=`${100*n/i}%`,e.style.height=`${100*r/s}%`,e.setAttribute("data-main-rotation",(360-t)%360)}get _commonActions(){const t=(e,i,s)=>{const n=s.detail[e],r=n[0],a=n.slice(1);s.target.style[i]=Cn[`${r}_HTML`](a),this.annotationStorage.setValue(this.data.id,{[i]:Cn[`${r}_rgb`](a)})};return z(this,"_commonActions",{display:e=>{const{display:i}=e.detail,s=i%2===1;this.container.style.visibility=s?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:s,noPrint:i===1||i===2})},print:e=>{this.annotationStorage.setValue(this.data.id,{noPrint:!e.detail.print})},hidden:e=>{const{hidden:i}=e.detail;this.container.style.visibility=i?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:i,noView:i})},focus:e=>{setTimeout(()=>e.target.focus({preventScroll:!1}),0)},userName:e=>{e.target.title=e.detail.userName},readonly:e=>{e.target.disabled=e.detail.readonly},required:e=>{this._setRequired(e.target,e.detail.required)},bgColor:e=>{t("bgColor","backgroundColor",e)},fillColor:e=>{t("fillColor","backgroundColor",e)},fgColor:e=>{t("fgColor","color",e)},textColor:e=>{t("textColor","color",e)},borderColor:e=>{t("borderColor","borderColor",e)},strokeColor:e=>{t("strokeColor","borderColor",e)},rotation:e=>{const i=e.detail.rotation;this.setRotation(i),this.annotationStorage.setValue(this.data.id,{rotation:i})}})}_dispatchEventFromSandbox(t,e){const i=this._commonActions;for(const s of Object.keys(e.detail))(t[s]||i[s])?.(e)}_setDefaultPropertiesFromJS(t){if(!this.enableScripting)return;const e=this.annotationStorage.getRawValue(this.data.id);if(!e)return;const i=this._commonActions;for(const[s,n]of Object.entries(e)){const r=i[s];if(r){const a={detail:{[s]:n},target:t};r(a),delete e[s]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:t}=this.data;if(!t)return;const[e,i,s,n]=this.data.rect.map(g=>Math.fround(g));if(t.length===8){const[g,y,b,v]=t.subarray(2,6);if(s===g&&n===y&&e===b&&i===v)return}const{style:r}=this.container;let a;if(this.#e){const{borderColor:g,borderWidth:y}=r;r.borderWidth=0,a=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${g}" stroke-width="${y}">`],this.container.classList.add("hasBorder")}const l=s-e,c=n-i,{svgFactory:h}=this,d=h.createElement("svg");d.classList.add("quadrilateralsContainer"),d.setAttribute("width",0),d.setAttribute("height",0),d.role="none";const u=h.createElement("defs");d.append(u);const p=h.createElement("clipPath"),m=`clippath_${this.data.id}`;p.setAttribute("id",m),p.setAttribute("clipPathUnits","objectBoundingBox"),u.append(p);for(let g=2,y=t.length;g<y;g+=8){const b=t[g],v=t[g+1],w=t[g+2],A=t[g+3],x=h.createElement("rect"),S=(w-e)/l,k=(n-v)/c,_=(b-w)/l,E=(v-A)/c;x.setAttribute("x",S),x.setAttribute("y",k),x.setAttribute("width",_),x.setAttribute("height",E),p.append(x),a?.push(`<rect vector-effect="non-scaling-stroke" x="${S}" y="${k}" width="${_}" height="${E}"/>`)}this.#e&&(a.push("</g></svg>')"),r.backgroundImage=a.join("")),this.container.append(d),this.container.style.clipPath=`url(#${m})`}_createPopup(t=null){const{data:e}=this;let i,s;t?(i={str:t.text},s=t.date):(i=e.contentsObj,s=e.modificationDate);const n=this.#s=new bs({data:{color:e.color,titleObj:e.titleObj,modificationDate:s,contentsObj:i,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation,noRotate:!0},linkService:this.linkService,parent:this.parent,elements:[this]});this.parent._commentManager||this.parent.div.append(n.render())}get hasPopupElement(){return!!(this.#s||this.popup||this.data.popupRef)}get extraPopupElement(){return this.#s}render(){J("Abstract method `AnnotationElement.render` called")}_getElementsByName(t,e=null){const i=[];if(this._fieldObjects){const s=this._fieldObjects[t];if(s)for(const{page:n,id:r,exportValues:a}of s){if(n===-1||r===e)continue;const l=typeof a=="string"?a:null,c=document.querySelector(`[data-element-id="${r}"]`);if(c&&!ye.has(c)){B(`_getElementsByName - element not allowed: ${r}`);continue}i.push({id:r,exportValue:l,domElement:c})}return i}for(const s of document.getElementsByName(t)){const{exportValue:n}=s,r=s.getAttribute("data-element-id");r!==e&&ye.has(s)&&i.push({id:r,exportValue:n,domElement:s})}return i}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const t=this.getElementsToTriggerPopup();if(Array.isArray(t))for(const e of t)e.classList.add("highlightArea");else t.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:t,data:{id:e}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:t,editId:e,mustEnterInEditMode:!0})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}}class Kl extends lt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.editor=t.editor}render(){return this.container.className="editorAnnotation",this.container}createOrUpdatePopup(){const{editor:t}=this;t.hasComment&&(this._createPopup(t.comment),this.extraPopupElement.popup.renderCommentButton())}get hasCommentButton(){return this.enableComment&&this.editor.hasComment}get commentButtonPosition(){return this.editor.commentButtonPositionInPage}get commentText(){return this.editor.comment.text}set commentText(t){this.editor.comment=t,t||this.removePopup()}get commentData(){return this.editor.getData()}remove(){this.container.remove(),this.container=null,this.removePopup()}}class Hs extends lt{constructor(t,e=null){super(t,{isRenderable:!0,ignoreBorder:!!e?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=t.data.isTooltipOnly}render(){const{data:t,linkService:e}=this,i=document.createElement("a");i.setAttribute("data-element-id",t.id);let s=!1;return t.url?(e.addLinkAttributes(i,t.url,t.newWindow),s=!0):t.action?(this._bindNamedAction(i,t.action,t.overlaidText),s=!0):t.attachment?(this.#e(i,t.attachment,t.overlaidText,t.attachmentDest),s=!0):t.setOCGState?(this.#s(i,t.setOCGState,t.overlaidText),s=!0):t.dest?(this._bindLink(i,t.dest,t.overlaidText),s=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(i,t),s=!0),t.resetForm?(this._bindResetFormAction(i,t.resetForm),s=!0):this.isTooltipOnly&&!s&&(this._bindLink(i,""),s=!0)),this.container.classList.add("linkAnnotation"),s&&this.container.append(i),this.container}#t(){this.container.setAttribute("data-internal-link","")}_bindLink(t,e,i=""){t.href=this.linkService.getDestinationHash(e),t.onclick=()=>(e&&this.linkService.goToDestination(e),!1),(e||e==="")&&this.#t(),i&&(t.title=i)}_bindNamedAction(t,e,i=""){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(e),!1),i&&(t.title=i),this.#t()}#e(t,e,i="",s=null){t.href=this.linkService.getAnchorUrl(""),e.description?t.title=e.description:i&&(t.title=i),t.onclick=()=>(this.downloadManager?.openOrDownloadData(e.content,e.filename,s),!1),this.#t()}#s(t,e,i=""){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeSetOCGState(e),!1),i&&(t.title=i),this.#t()}_bindJSAction(t,e){t.href=this.linkService.getAnchorUrl("");const i=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const s of Object.keys(e.actions)){const n=i.get(s);n&&(t[n]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e.id,name:s}}),!1))}e.overlaidText&&(t.title=e.overlaidText),t.onclick||(t.onclick=()=>!1),this.#t()}_bindResetFormAction(t,e){const i=t.onclick;if(i||(t.href=this.linkService.getAnchorUrl("")),this.#t(),!this._fieldObjects){B('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),i||(t.onclick=()=>!1);return}t.onclick=()=>{i?.();const{fields:s,refs:n,include:r}=e,a=[];if(s.length!==0||n.length!==0){const h=new Set(n);for(const d of s){const u=this._fieldObjects[d]||[];for(const{id:p}of u)h.add(p)}for(const d of Object.values(this._fieldObjects))for(const u of d)h.has(u.id)===r&&a.push(u)}else for(const h of Object.values(this._fieldObjects))a.push(...h);const l=this.annotationStorage,c=[];for(const h of a){const{id:d}=h;switch(c.push(d),h.type){case"text":{const p=h.defaultValue||"";l.setValue(d,{value:p});break}case"checkbox":case"radiobutton":{const p=h.defaultValue===h.exportValues;l.setValue(d,{value:p});break}case"combobox":case"listbox":{const p=h.defaultValue||"";l.setValue(d,{value:p});break}default:continue}const u=document.querySelector(`[data-element-id="${d}"]`);if(u){if(!ye.has(u)){B(`_bindResetFormAction - element not allowed: ${d}`);continue}}else continue;u.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:c,name:"ResetForm"}}),!1}}}class Ql extends lt{constructor(t){super(t,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const t=document.createElement("img");return t.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",t.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),t.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(t),this.container}}class xe extends lt{render(){return this.container}showElementAndHideCanvas(t){this.data.hasOwnCanvas&&(t.previousSibling?.nodeName==="CANVAS"&&(t.previousSibling.hidden=!0),t.hidden=!1)}_getKeyModifier(t){return bt.platform.isMac?t.metaKey:t.ctrlKey}_setEventListener(t,e,i,s,n){i.includes("mouse")?t.addEventListener(i,r=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:n(r),shift:r.shiftKey,modifier:this._getKeyModifier(r)}})}):t.addEventListener(i,r=>{if(i==="blur"){if(!e.focused||!r.relatedTarget)return;e.focused=!1}else if(i==="focus"){if(e.focused)return;e.focused=!0}n&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:n(r)}})})}_setEventListeners(t,e,i,s){for(const[n,r]of i)(r==="Action"||this.data.actions?.[r])&&((r==="Focus"||r==="Blur")&&(e||={focused:!1}),this._setEventListener(t,e,n,r,s),r==="Focus"&&!this.data.actions?.Blur?this._setEventListener(t,e,"blur","Blur",null):r==="Blur"&&!this.data.actions?.Focus&&this._setEventListener(t,e,"focus","Focus",null))}_setBackgroundColor(t){const e=this.data.backgroundColor||null;t.style.backgroundColor=e===null?"transparent":N.makeHexColor(e[0],e[1],e[2])}_setTextStyle(t){const e=["left","center","right"],{fontColor:i}=this.data.defaultAppearanceData,s=this.data.defaultAppearanceData.fontSize||Xl,n=t.style;let r;const a=2,l=c=>Math.round(10*c)/10;if(this.data.multiLine){const c=Math.abs(this.data.rect[3]-this.data.rect[1]-a),h=Math.round(c/(ts*s))||1,d=c/h;r=Math.min(s,l(d/ts))}else{const c=Math.abs(this.data.rect[3]-this.data.rect[1]-a);r=Math.min(s,l(c/ts))}n.fontSize=`calc(${r}px * var(--total-scale-factor))`,n.color=N.makeHexColor(i[0],i[1],i[2]),this.data.textAlignment!==null&&(n.textAlign=e[this.data.textAlignment])}_setRequired(t,e){e?t.setAttribute("required",!0):t.removeAttribute("required"),t.setAttribute("aria-required",e)}}class Jl extends xe{constructor(t){const e=t.renderForms||t.data.hasOwnCanvas||!t.data.hasAppearance&&!!t.data.fieldValue;super(t,{isRenderable:e})}setPropertyOnSiblings(t,e,i,s){const n=this.annotationStorage;for(const r of this._getElementsByName(t.name,t.id))r.domElement&&(r.domElement[e]=i),n.setValue(r.id,{[s]:i})}render(){const t=this.annotationStorage,e=this.data.id;this.container.classList.add("textWidgetAnnotation");let i=null;if(this.renderForms){const s=t.getValue(e,{value:this.data.fieldValue});let n=s.value||"";const r=t.getValue(e,{charLimit:this.data.maxLen}).charLimit;r&&n.length>r&&(n=n.slice(0,r));let a=s.formattedValue||this.data.textContent?.join(`
`)||null;a&&this.data.comb&&(a=a.replaceAll(/\s+/g,""));const l={userValue:n,formattedValue:a,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(i=document.createElement("textarea"),i.textContent=a??n,this.data.doNotScroll&&(i.style.overflowY="hidden")):(i=document.createElement("input"),i.type=this.data.password?"password":"text",i.setAttribute("value",a??n),this.data.doNotScroll&&(i.style.overflowX="hidden")),this.data.hasOwnCanvas&&(i.hidden=!0),ye.add(i),i.setAttribute("data-element-id",e),i.disabled=this.data.readOnly,i.name=this.data.fieldName,i.tabIndex=0;const{datetimeFormat:c,datetimeType:h,timeStep:d}=this.data,u=!!h&&this.enableScripting;c&&(i.title=c),this._setRequired(i,this.data.required),r&&(i.maxLength=r),i.addEventListener("input",m=>{t.setValue(e,{value:m.target.value}),this.setPropertyOnSiblings(i,"value",m.target.value,"value"),l.formattedValue=null}),i.addEventListener("resetform",m=>{const g=this.data.defaultFieldValue??"";i.value=l.userValue=g,l.formattedValue=null});let p=m=>{const{formattedValue:g}=l;g!=null&&(m.target.value=g),m.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){i.addEventListener("focus",g=>{if(l.focused)return;const{target:y}=g;if(u&&(y.type=h,d&&(y.step=d)),l.userValue){const b=l.userValue;if(u)if(h==="time"){const v=new Date(b),w=[v.getHours(),v.getMinutes(),v.getSeconds()];y.value=w.map(A=>A.toString().padStart(2,"0")).join(":")}else y.value=new Date(b-Yl).toISOString().split(h==="date"?"T":".",1)[0];else y.value=b}l.lastCommittedValue=y.value,l.commitKey=1,this.data.actions?.Focus||(l.focused=!0)}),i.addEventListener("updatefromsandbox",g=>{this.showElementAndHideCanvas(g.target);const y={value(b){l.userValue=b.detail.value??"",u||t.setValue(e,{value:l.userValue.toString()}),b.target.value=l.userValue},formattedValue(b){const{formattedValue:v}=b.detail;l.formattedValue=v,v!=null&&b.target!==document.activeElement&&(b.target.value=v);const w={formattedValue:v};u&&(w.value=v),t.setValue(e,w)},selRange(b){b.target.setSelectionRange(...b.detail.selRange)},charLimit:b=>{const{charLimit:v}=b.detail,{target:w}=b;if(v===0){w.removeAttribute("maxLength");return}w.setAttribute("maxLength",v);let A=l.userValue;!A||A.length<=v||(A=A.slice(0,v),w.value=l.userValue=A,t.setValue(e,{value:A}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:A,willCommit:!0,commitKey:1,selStart:w.selectionStart,selEnd:w.selectionEnd}}))}};this._dispatchEventFromSandbox(y,g)}),i.addEventListener("keydown",g=>{l.commitKey=1;let y=-1;if(g.key==="Escape"?y=0:g.key==="Enter"&&!this.data.multiLine?y=2:g.key==="Tab"&&(l.commitKey=3),y===-1)return;const{value:b}=g.target;l.lastCommittedValue!==b&&(l.lastCommittedValue=b,l.userValue=b,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:b,willCommit:!0,commitKey:y,selStart:g.target.selectionStart,selEnd:g.target.selectionEnd}}))});const m=p;p=null,i.addEventListener("blur",g=>{if(!l.focused||!g.relatedTarget)return;this.data.actions?.Blur||(l.focused=!1);const{target:y}=g;let{value:b}=y;if(u){if(b&&h==="time"){const v=b.split(":").map(w=>parseInt(w,10));b=new Date(2e3,0,1,v[0],v[1],v[2]||0).valueOf(),y.step=""}else b.includes("T")||(b=`${b}T00:00`),b=new Date(b).valueOf();y.type="text"}l.userValue=b,l.lastCommittedValue!==b&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:b,willCommit:!0,commitKey:l.commitKey,selStart:g.target.selectionStart,selEnd:g.target.selectionEnd}}),m(g)}),this.data.actions?.Keystroke&&i.addEventListener("beforeinput",g=>{l.lastCommittedValue=null;const{data:y,target:b}=g,{value:v,selectionStart:w,selectionEnd:A}=b;let x=w,S=A;switch(g.inputType){case"deleteWordBackward":{const k=v.substring(0,w).match(/\w*[^\w]*$/);k&&(x-=k[0].length);break}case"deleteWordForward":{const k=v.substring(w).match(/^[^\w]*\w*/);k&&(S+=k[0].length);break}case"deleteContentBackward":w===A&&(x-=1);break;case"deleteContentForward":w===A&&(S+=1);break}g.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:v,change:y||"",willCommit:!1,selStart:x,selEnd:S}})}),this._setEventListeners(i,l,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],g=>g.target.value)}if(p&&i.addEventListener("blur",p),this.data.comb){const g=(this.data.rect[2]-this.data.rect[0])/r;i.classList.add("comb"),i.style.letterSpacing=`calc(${g}px * var(--total-scale-factor) - 1ch)`}}else i=document.createElement("div"),i.textContent=this.data.fieldValue,i.style.verticalAlign="middle",i.style.display="table-cell",this.data.hasOwnCanvas&&(i.hidden=!0);return this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class Zl extends xe{constructor(t){super(t,{isRenderable:!!t.data.hasOwnCanvas})}}class tc extends xe{constructor(t){super(t,{isRenderable:t.renderForms})}render(){const t=this.annotationStorage,e=this.data,i=e.id;let s=t.getValue(i,{value:e.exportValue===e.fieldValue}).value;typeof s=="string"&&(s=s!=="Off",t.setValue(i,{value:s})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const n=document.createElement("input");return ye.add(n),n.setAttribute("data-element-id",i),n.disabled=e.readOnly,this._setRequired(n,this.data.required),n.type="checkbox",n.name=e.fieldName,s&&n.setAttribute("checked",!0),n.setAttribute("exportValue",e.exportValue),n.tabIndex=0,n.addEventListener("change",r=>{const{name:a,checked:l}=r.target;for(const c of this._getElementsByName(a,i)){const h=l&&c.exportValue===e.exportValue;c.domElement&&(c.domElement.checked=h),t.setValue(c.id,{value:h})}t.setValue(i,{value:l})}),n.addEventListener("resetform",r=>{const a=e.defaultFieldValue||"Off";r.target.checked=a===e.exportValue}),this.enableScripting&&this.hasJSActions&&(n.addEventListener("updatefromsandbox",r=>{const a={value(l){l.target.checked=l.detail.value!=="Off",t.setValue(i,{value:l.target.checked})}};this._dispatchEventFromSandbox(a,r)}),this._setEventListeners(n,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],r=>r.target.checked)),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class Lr extends xe{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const t=this.annotationStorage,e=this.data,i=e.id;let s=t.getValue(i,{value:e.fieldValue===e.buttonValue}).value;if(typeof s=="string"&&(s=s!==e.buttonValue,t.setValue(i,{value:s})),s)for(const r of this._getElementsByName(e.fieldName,i))t.setValue(r.id,{value:!1});const n=document.createElement("input");if(ye.add(n),n.setAttribute("data-element-id",i),n.disabled=e.readOnly,this._setRequired(n,this.data.required),n.type="radio",n.name=e.fieldName,s&&n.setAttribute("checked",!0),n.tabIndex=0,n.addEventListener("change",r=>{const{name:a,checked:l}=r.target;for(const c of this._getElementsByName(a,i))t.setValue(c.id,{value:!1});t.setValue(i,{value:l})}),n.addEventListener("resetform",r=>{const a=e.defaultFieldValue;r.target.checked=a!=null&&a===e.buttonValue}),this.enableScripting&&this.hasJSActions){const r=e.buttonValue;n.addEventListener("updatefromsandbox",a=>{const l={value:c=>{const h=r===c.detail.value;for(const d of this._getElementsByName(c.target.name)){const u=h&&d.id===i;d.domElement&&(d.domElement.checked=u),t.setValue(d.id,{value:u})}}};this._dispatchEventFromSandbox(l,a)}),this._setEventListeners(n,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)}return this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class ec extends Hs{constructor(t){super(t,{ignoreBorder:t.data.hasAppearance})}render(){const t=super.render();t.classList.add("buttonWidgetAnnotation","pushButton");const e=t.lastChild;return this.enableScripting&&this.hasJSActions&&e&&(this._setDefaultPropertiesFromJS(e),e.addEventListener("updatefromsandbox",i=>{this._dispatchEventFromSandbox({},i)})),t}}class ic extends xe{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const t=this.annotationStorage,e=this.data.id,i=t.getValue(e,{value:this.data.fieldValue}),s=document.createElement("select");ye.add(s),s.setAttribute("data-element-id",e),s.disabled=this.data.readOnly,this._setRequired(s,this.data.required),s.name=this.data.fieldName,s.tabIndex=0;let n=this.data.combo&&this.data.options.length>0;this.data.combo||(s.size=this.data.options.length,this.data.multiSelect&&(s.multiple=!0)),s.addEventListener("resetform",h=>{const d=this.data.defaultFieldValue;for(const u of s.options)u.selected=u.value===d});for(const h of this.data.options){const d=document.createElement("option");d.textContent=h.displayValue,d.value=h.exportValue,i.value.includes(h.exportValue)&&(d.setAttribute("selected",!0),n=!1),s.append(d)}let r=null;if(n){const h=document.createElement("option");h.value=" ",h.setAttribute("hidden",!0),h.setAttribute("selected",!0),s.prepend(h),r=()=>{h.remove(),s.removeEventListener("input",r),r=null},s.addEventListener("input",r)}const a=h=>{const d=h?"value":"textContent",{options:u,multiple:p}=s;return p?Array.prototype.filter.call(u,m=>m.selected).map(m=>m[d]):u.selectedIndex===-1?null:u[u.selectedIndex][d]};let l=a(!1);const c=h=>{const d=h.target.options;return Array.prototype.map.call(d,u=>({displayValue:u.textContent,exportValue:u.value}))};return this.enableScripting&&this.hasJSActions?(s.addEventListener("updatefromsandbox",h=>{const d={value(u){r?.();const p=u.detail.value,m=new Set(Array.isArray(p)?p:[p]);for(const g of s.options)g.selected=m.has(g.value);t.setValue(e,{value:a(!0)}),l=a(!1)},multipleSelection(u){s.multiple=!0},remove(u){const p=s.options,m=u.detail.remove;p[m].selected=!1,s.remove(m),p.length>0&&Array.prototype.findIndex.call(p,y=>y.selected)===-1&&(p[0].selected=!0),t.setValue(e,{value:a(!0),items:c(u)}),l=a(!1)},clear(u){for(;s.length!==0;)s.remove(0);t.setValue(e,{value:null,items:[]}),l=a(!1)},insert(u){const{index:p,displayValue:m,exportValue:g}=u.detail.insert,y=s.children[p],b=document.createElement("option");b.textContent=m,b.value=g,y?y.before(b):s.append(b),t.setValue(e,{value:a(!0),items:c(u)}),l=a(!1)},items(u){const{items:p}=u.detail;for(;s.length!==0;)s.remove(0);for(const m of p){const{displayValue:g,exportValue:y}=m,b=document.createElement("option");b.textContent=g,b.value=y,s.append(b)}s.options.length>0&&(s.options[0].selected=!0),t.setValue(e,{value:a(!0),items:c(u)}),l=a(!1)},indices(u){const p=new Set(u.detail.indices);for(const m of u.target.options)m.selected=p.has(m.index);t.setValue(e,{value:a(!0)}),l=a(!1)},editable(u){u.target.disabled=!u.detail.editable}};this._dispatchEventFromSandbox(d,h)}),s.addEventListener("input",h=>{const d=a(!0),u=a(!1);t.setValue(e,{value:d}),h.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:l,change:u,changeEx:d,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(s,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],h=>h.target.value)):s.addEventListener("input",function(h){t.setValue(e,{value:a(!0)})}),this.data.combo&&this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class bs extends lt{constructor(t){const{data:e,elements:i,parent:s}=t,n=!!s._commentManager;if(super(t,{isRenderable:!n&&lt._hasPopupData(e)}),this.elements=i,n&&lt._hasPopupData(e)){const r=this.popup=this.#t();for(const a of i)a.popup=r}else this.popup=null}#t(){return new sc({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate||this.data.creationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open,commentManager:this.parent._commentManager})}render(){const{container:t}=this;t.classList.add("popupAnnotation"),t.role="comment";const e=this.popup=this.#t(),i=[];for(const s of this.elements)s.popup=e,s.container.ariaHasPopup="dialog",i.push(s.data.id),s.addHighlightArea();return this.container.setAttribute("aria-controls",i.map(s=>`${Ts}${s}`).join(",")),this.container}}class sc{#t=null;#e=this.#$.bind(this);#s=this.#B.bind(this);#i=this.#D.bind(this);#a=this.#x.bind(this);#n=null;#r=null;#o=null;#c=null;#l=null;#u=null;#d=null;#p=!1;#m=null;#f=null;#h=null;#g=null;#b=null;#w=null;#y=null;#_=null;#S=null;#v=null;#C=!1;#A=null;#k=null;constructor({container:t,color:e,elements:i,titleObj:s,modificationDate:n,contentsObj:r,richText:a,parent:l,rect:c,parentRect:h,open:d,commentManager:u=null}){this.#r=t,this.#S=s,this.#o=r,this.#_=a,this.#u=l,this.#n=e,this.#y=c,this.#d=h,this.#l=i,this.#t=u,this.#A=i[0],this.#c=Ni.toDateObject(n),this.trigger=i.flatMap(p=>p.getElementsToTriggerPopup()),u?this.renderCommentButton():(this.#P(),this.#r.hidden=!0,d&&this.#x())}#P(){if(this.#f)return;this.#f=new AbortController;const{signal:t}=this.#f;for(const e of this.trigger)e.addEventListener("click",this.#a,{signal:t}),e.addEventListener("pointerenter",this.#i,{signal:t}),e.addEventListener("pointerleave",this.#s,{signal:t}),e.classList.add("popupTriggerArea");for(const e of this.#l)e.container?.addEventListener("keydown",this.#e,{signal:t})}#T(){const t=this.#l.find(e=>e.hasCommentButton);t&&(this.#b=t._normalizePoint(t.commentButtonPosition))}renderCommentButton(){if(this.#g||(this.#b||this.#T(),!this.#b))return;const{signal:t}=this.#f=new AbortController,e=!!this.#A.extraPopupElement,i=()=>{this.#t.toggleCommentPopup(this,!0,void 0,!e)},s=()=>{this.#t.toggleCommentPopup(this,!1,!0,!e)},n=()=>{this.#t.toggleCommentPopup(this,!1,!1)};if(e){this.#g=this.#A.container;for(const r of this.trigger)r.ariaHasPopup="dialog",r.ariaControls="commentPopup",r.addEventListener("keydown",this.#e,{signal:t}),r.addEventListener("click",i,{signal:t}),r.addEventListener("pointerenter",s,{signal:t}),r.addEventListener("pointerleave",n,{signal:t}),r.classList.add("popupTriggerArea")}else{const r=this.#g=document.createElement("button");r.className="annotationCommentButton";const a=this.#A.container;r.style.zIndex=a.style.zIndex+1,r.tabIndex=0,r.ariaHasPopup="dialog",r.ariaControls="commentPopup",r.setAttribute("data-l10n-id","pdfjs-show-comment-button"),this.#O(),this.#L(),r.addEventListener("keydown",this.#e,{signal:t}),r.addEventListener("click",i,{signal:t}),r.addEventListener("pointerenter",s,{signal:t}),r.addEventListener("pointerleave",n,{signal:t}),a.after(r)}}#L(){if(this.#A.extraPopupElement&&!this.#A.editor)return;this.renderCommentButton();const[t,e]=this.#b,{style:i}=this.#g;i.left=`calc(${t}%)`,i.top=`calc(${e}% - var(--comment-button-dim))`}#O(){this.#A.extraPopupElement||(this.renderCommentButton(),this.#g.style.backgroundColor=this.commentButtonColor||"")}get commentButtonColor(){const{color:t,opacity:e}=this.#A.commentData;return t?this.#u._commentManager.makeCommentColor(t,e):null}focusCommentButton(){setTimeout(()=>{this.#g?.focus()},0)}getData(){const{richText:t,color:e,opacity:i,creationDate:s,modificationDate:n}=this.#A.commentData;return{contentsObj:{str:this.comment},richText:t,color:e,opacity:i,creationDate:s,modificationDate:n}}get elementBeforePopup(){return this.#g}get comment(){return this.#k||=this.#A.commentText,this.#k}set comment(t){t!==this.comment&&(this.#A.commentText=this.#k=t)}get parentBoundingClientRect(){return this.#A.layer.getBoundingClientRect()}setCommentButtonStates({selected:t,hasPopup:e}){this.#g&&(this.#g.classList.toggle("selected",t),this.#g.ariaExpanded=e)}setSelectedCommentButton(t){this.#g.classList.toggle("selected",t)}get commentPopupPosition(){if(this.#w)return this.#w;const{x:t,y:e,height:i}=this.#g.getBoundingClientRect(),{x:s,y:n,width:r,height:a}=this.#A.layer.getBoundingClientRect();return[(t-s)/r,(e+i-n)/a]}set commentPopupPosition(t){this.#w=t}hasDefaultPopupPosition(){return this.#w===null}get commentButtonPosition(){return this.#b}get commentButtonWidth(){return this.#g.getBoundingClientRect().width/this.parentBoundingClientRect.width}editComment(t){const[e,i]=this.#w||this.commentButtonPosition.map(c=>c/100),s=this.parentBoundingClientRect,{x:n,y:r,width:a,height:l}=s;this.#t.showDialog(null,this,n+e*a,r+i*l,{...t,parentDimensions:s})}render(){if(this.#m)return;const t=this.#m=document.createElement("div");if(t.className="popup",this.#n){const i=t.style.outlineColor=N.makeHexColor(...this.#n);t.style.backgroundColor=`color-mix(in srgb, ${i} 30%, white)`}const e=document.createElement("span");if(e.className="header",this.#S?.str){const i=document.createElement("span");i.className="title",e.append(i),{dir:i.dir,str:i.textContent}=this.#S}if(t.append(e),this.#c){const i=document.createElement("time");i.className="popupDate",i.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),i.setAttribute("data-l10n-args",JSON.stringify({dateObj:this.#c.valueOf()})),i.dateTime=this.#c.toISOString(),e.append(i)}Ps({html:this.#R||this.#o.str,dir:this.#o?.dir,className:"popupContent"},t),this.#r.append(t)}get#R(){const t=this.#_,e=this.#o;return t?.str&&(!e?.str||e.str===t.str)&&this.#_.html||null}get#N(){return this.#R?.attributes?.style?.fontSize||0}get#j(){return this.#R?.attributes?.style?.color||null}#I(t){const e=[],i={str:t,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:e}]}},s={style:{color:this.#j,fontSize:this.#N?`calc(${this.#N}px * var(--total-scale-factor))`:""}};for(const n of t.split(`
`))e.push({name:"span",value:n,attributes:s});return i}#$(t){t.altKey||t.shiftKey||t.ctrlKey||t.metaKey||(t.key==="Enter"||t.key==="Escape"&&this.#p)&&this.#x()}updateEdited({rect:t,popup:e,deleted:i}){if(this.#t){i?(this.remove(),this.#k=null):e&&(e.deleted?this.remove():(this.#O(),this.#k=e.text)),t&&(this.#b=null,this.#T(),this.#L());return}if(i||e?.deleted){this.remove();return}this.#P(),this.#v||={contentsObj:this.#o,richText:this.#_},t&&(this.#h=null),e&&e.text&&(this.#_=this.#I(e.text),this.#c=Ni.toDateObject(e.date),this.#o=null),this.#m?.remove(),this.#m=null}resetEdited(){this.#v&&({contentsObj:this.#o,richText:this.#_}=this.#v,this.#v=null,this.#m?.remove(),this.#m=null,this.#h=null)}remove(){if(this.#f?.abort(),this.#f=null,this.#m?.remove(),this.#m=null,this.#C=!1,this.#p=!1,this.#g?.remove(),this.#g=null,this.trigger)for(const t of this.trigger)t.classList.remove("popupTriggerArea")}#E(){if(this.#h!==null)return;const{page:{view:t},viewport:{rawDims:{pageWidth:e,pageHeight:i,pageX:s,pageY:n}}}=this.#u;let r=!!this.#d,a=r?this.#d:this.#y;for(const m of this.#l)if(!a||N.intersect(m.data.rect,a)!==null){a=m.data.rect,r=!0;break}const l=N.normalizeRect([a[0],t[3]-a[1]+t[1],a[2],t[3]-a[3]+t[1]]),h=r?a[2]-a[0]+5:0,d=l[0]+h,u=l[1];this.#h=[100*(d-s)/e,100*(u-n)/i];const{style:p}=this.#r;p.left=`${this.#h[0]}%`,p.top=`${this.#h[1]}%`}#x(){if(this.#t){this.#t.toggleCommentPopup(this,!1);return}this.#p=!this.#p,this.#p?(this.#D(),this.#r.addEventListener("click",this.#a),this.#r.addEventListener("keydown",this.#e)):(this.#B(),this.#r.removeEventListener("click",this.#a),this.#r.removeEventListener("keydown",this.#e))}#D(){this.#m||this.render(),this.isVisible?this.#p&&this.#r.classList.add("focused"):(this.#E(),this.#r.hidden=!1,this.#r.style.zIndex=parseInt(this.#r.style.zIndex)+1e3)}#B(){this.#r.classList.remove("focused"),!(this.#p||!this.isVisible)&&(this.#r.hidden=!0,this.#r.style.zIndex=parseInt(this.#r.style.zIndex)-1e3)}forceHide(){this.#C=this.isVisible,this.#C&&(this.#r.hidden=!0)}maybeShow(){this.#t||(this.#P(),this.#C&&(this.#m||this.#D(),this.#C=!1,this.#r.hidden=!1))}get isVisible(){return this.#t?!1:this.#r.hidden===!1}}class Pr extends lt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.textContent=t.data.textContent,this.textPosition=t.data.textPosition,this.annotationEditorType=j.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const t=document.createElement("div");t.classList.add("annotationTextContent"),t.setAttribute("role","comment");for(const e of this.textContent){const i=document.createElement("span");i.textContent=e,t.append(i)}this.container.append(t)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}class nc extends lt{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");const{data:t,width:e,height:i}=this,s=this.svgFactory.create(e,i,!0),n=this.#t=this.svgFactory.createElement("svg:line");return n.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),n.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),n.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),n.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),n.setAttribute("stroke-width",t.borderStyle.width||1),n.setAttribute("stroke","transparent"),n.setAttribute("fill","transparent"),s.append(n),this.container.append(s),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class rc extends lt{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");const{data:t,width:e,height:i}=this,s=this.svgFactory.create(e,i,!0),n=t.borderStyle.width,r=this.#t=this.svgFactory.createElement("svg:rect");return r.setAttribute("x",n/2),r.setAttribute("y",n/2),r.setAttribute("width",e-n),r.setAttribute("height",i-n),r.setAttribute("stroke-width",n||1),r.setAttribute("stroke","transparent"),r.setAttribute("fill","transparent"),s.append(r),this.container.append(s),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class ac extends lt{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");const{data:t,width:e,height:i}=this,s=this.svgFactory.create(e,i,!0),n=t.borderStyle.width,r=this.#t=this.svgFactory.createElement("svg:ellipse");return r.setAttribute("cx",e/2),r.setAttribute("cy",i/2),r.setAttribute("rx",e/2-n/2),r.setAttribute("ry",i/2-n/2),r.setAttribute("stroke-width",n||1),r.setAttribute("stroke","transparent"),r.setAttribute("fill","transparent"),s.append(r),this.container.append(s),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class Mr extends lt{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,vertices:e,borderStyle:i,popupRef:s},width:n,height:r}=this;if(!e)return this.container;const a=this.svgFactory.create(n,r,!0);let l=[];for(let h=0,d=e.length;h<d;h+=2){const u=e[h]-t[0],p=t[3]-e[h+1];l.push(`${u},${p}`)}l=l.join(" ");const c=this.#t=this.svgFactory.createElement(this.svgElementName);return c.setAttribute("points",l),c.setAttribute("stroke-width",i.width||1),c.setAttribute("stroke","transparent"),c.setAttribute("fill","transparent"),a.append(c),this.container.append(a),!s&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class oc extends Mr{constructor(t){super(t),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class lc extends lt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class Us extends lt{#t=null;#e=[];constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?j.HIGHLIGHT:j.INK}#s(t,e){switch(t){case 90:return{transform:`rotate(90) translate(${-e[0]},${e[1]}) scale(1,-1)`,width:e[3]-e[1],height:e[2]-e[0]};case 180:return{transform:`rotate(180) translate(${-e[2]},${e[1]}) scale(1,-1)`,width:e[2]-e[0],height:e[3]-e[1]};case 270:return{transform:`rotate(270) translate(${-e[2]},${e[3]}) scale(1,-1)`,width:e[3]-e[1],height:e[2]-e[0]};default:return{transform:`translate(${-e[0]},${e[3]}) scale(1,-1)`,width:e[2]-e[0],height:e[3]-e[1]}}}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,rotation:e,inkLists:i,borderStyle:s,popupRef:n}}=this,{transform:r,width:a,height:l}=this.#s(e,t),c=this.svgFactory.create(a,l,!0),h=this.#t=this.svgFactory.createElement("svg:g");c.append(h),h.setAttribute("stroke-width",s.width||1),h.setAttribute("stroke-linecap","round"),h.setAttribute("stroke-linejoin","round"),h.setAttribute("stroke-miterlimit",10),h.setAttribute("stroke","transparent"),h.setAttribute("fill","transparent"),h.setAttribute("transform",r);for(let d=0,u=i.length;d<u;d++){const p=this.svgFactory.createElement(this.svgElementName);this.#e.push(p),p.setAttribute("points",i[d].join(",")),h.append(p)}return!n&&this.hasPopupData&&this._createPopup(),this.container.append(c),this._editOnDoubleClick(),this.container}updateEdited(t){super.updateEdited(t);const{thickness:e,points:i,rect:s}=t,n=this.#t;if(e>=0&&n.setAttribute("stroke-width",e||1),i)for(let r=0,a=this.#e.length;r<a;r++)this.#e[r].setAttribute("points",i[r].join(","));if(s){const{transform:r,width:a,height:l}=this.#s(this.data.rotation,s);n.parentElement.setAttribute("viewBox",`0 0 ${a} ${l}`),n.setAttribute("transform",r)}}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class Rr extends lt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=j.HIGHLIGHT}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),t){const i=document.createElement("mark");i.classList.add("overlaidText"),i.textContent=t,this.container.append(i)}return this.container}}class cc extends lt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),t){const i=document.createElement("u");i.classList.add("overlaidText"),i.textContent=t,this.container.append(i)}return this.container}}class hc extends lt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),t){const i=document.createElement("u");i.classList.add("overlaidText"),i.textContent=t,this.container.append(i)}return this.container}}class dc extends lt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),t){const i=document.createElement("s");i.classList.add("overlaidText"),i.textContent=t,this.container.append(i)}return this.container}}class Dr extends lt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=j.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}class uc extends lt{#t=null;constructor(t){super(t,{isRenderable:!0});const{file:e}=this.data;this.filename=e.filename,this.content=e.content,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,...e})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:t,data:e}=this;let i;e.hasAppearance||e.fillAlpha===0?i=document.createElement("div"):(i=document.createElement("img"),i.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(e.name)?"paperclip":"pushpin"}.svg`,e.fillAlpha&&e.fillAlpha<1&&(i.style=`filter: opacity(${Math.round(e.fillAlpha*100)}%);`)),i.addEventListener("dblclick",this.#e.bind(this)),this.#t=i;const{isMac:s}=bt.platform;return t.addEventListener("keydown",n=>{n.key==="Enter"&&(s?n.metaKey:n.ctrlKey)&&this.#e()}),!e.popupRef&&this.hasPopupData?this._createPopup():i.classList.add("popupTriggerArea"),t.append(i),t}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}#e(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}}let zs=class Nr{#t=null;#e=null;#s=null;#i=new Map;#a=null;#n=null;constructor({div:t,accessibilityManager:e,annotationCanvasMap:i,annotationEditorUIManager:s,page:n,viewport:r,structTreeLayer:a,commentManager:l,linkService:c,annotationStorage:h}){this.div=t,this.#t=e,this.#e=i,this.#a=a||null,this.#n=c||null,this.#s=h||new Ds,this.page=n,this.viewport=r,this.zIndex=0,this._annotationEditorUIManager=s,this._commentManager=l||null}hasEditableAnnotations(){return this.#i.size>0}async#r(t,e,i){const s=t.firstChild||t,n=s.id=`${Ts}${e}`,r=await this.#a?.getAriaAttributes(n);if(r)for(const[a,l]of r)s.setAttribute(a,l);i?i.at(-1).container.after(t):(this.div.append(t),this.#t?.moveElementInDOM(this.div,t,s,!1))}async render(t){const{annotations:e}=t,i=this.div;ce(i,this.viewport);const s=new Map,n={data:null,layer:i,linkService:this.#n,downloadManager:t.downloadManager,imageResourcesPath:t.imageResourcesPath||"",renderForms:t.renderForms!==!1,svgFactory:new ri,annotationStorage:this.#s,enableComment:t.enableComment===!0,enableScripting:t.enableScripting===!0,hasJSActions:t.hasJSActions,fieldObjects:t.fieldObjects,parent:this,elements:null};for(const r of e){if(r.noHTML)continue;const a=r.annotationType===ct.POPUP;if(a){const h=s.get(r.id);if(!h)continue;n.elements=h}else if(r.rect[2]===r.rect[0]||r.rect[3]===r.rect[1])continue;n.data=r;const l=Tn.create(n);if(!l.isRenderable)continue;if(!a&&r.popupRef){const h=s.get(r.popupRef);h?h.push(l):s.set(r.popupRef,[l])}const c=l.render();r.hidden&&(c.style.visibility="hidden"),await this.#r(c,r.id,n.elements),l.extraPopupElement?.popup?.renderCommentButton(),l._isEditable&&(this.#i.set(l.data.id,l),this._annotationEditorUIManager?.renderAnnotationElement(l))}this.#o()}async addLinkAnnotations(t){const e={data:null,layer:this.div,linkService:this.#n,svgFactory:new ri,parent:this};for(const i of t){i.borderStyle||=Nr._defaultBorderStyle,e.data=i;const s=Tn.create(e);if(!s.isRenderable)continue;const n=s.render();await this.#r(n,i.id,null)}}update({viewport:t}){const e=this.div;this.viewport=t,ce(e,{rotation:t.rotation}),this.#o(),e.hidden=!1}#o(){if(!this.#e)return;const t=this.div;for(const[e,i]of this.#e){const s=t.querySelector(`[data-annotation-id="${e}"]`);if(!s)continue;i.className="annotationContent";const{firstChild:n}=s;n?n.nodeName==="CANVAS"?n.replaceWith(i):n.classList.contains("annotationContent")?n.after(i):n.before(i):s.append(i);const r=this.#i.get(e);r&&(r._hasNoCanvas?(this._annotationEditorUIManager?.setMissingCanvas(e,s.id,i),r._hasNoCanvas=!1):r.canvas=i)}this.#e.clear()}getEditableAnnotations(){return Array.from(this.#i.values())}getEditableAnnotation(t){return this.#i.get(t)}addFakeAnnotation(t){const{div:e}=this,{id:i,rotation:s}=t,n=new Kl({data:{id:i,rect:t.getPDFRect(),rotation:s},editor:t,layer:e,parent:this,enableComment:!!this._commentManager,linkService:this.#n,annotationStorage:this.#s}),r=n.render();return e.append(r),this.#t?.moveElementInDOM(e,r,r,!1),n.createOrUpdatePopup(),n}static get _defaultBorderStyle(){return z(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:Ee.SOLID,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}};const Ei=/\r\n?|\n/g;class gt extends I{#t="";#e=`${this.id}-editor`;#s=null;#i;_colorPicker=null;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){const t=gt.prototype,e=n=>n.isEmpty(),i=ne.TRANSLATE_SMALL,s=ne.TRANSLATE_BIG;return z(this,"_keyboardManager",new hi([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-i,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-s,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[i,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[s,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-i],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-s],checker:e}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,i],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,s],checker:e}]]))}static _type="freetext";static _editorType=j.FREETEXT;constructor(t){super({...t,name:"freeTextEditor"}),this.color=t.color||gt._defaultColor||I._defaultLineColor,this.#i=t.fontSize||gt._defaultFontSize,this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-freetext-added-alert")}static initialize(t,e){I.initialize(t,e);const i=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(i.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,e){switch(t){case V.FREETEXT_SIZE:gt._defaultFontSize=e;break;case V.FREETEXT_COLOR:gt._defaultColor=e;break}}updateParams(t,e){switch(t){case V.FREETEXT_SIZE:this.#a(e);break;case V.FREETEXT_COLOR:this.#n(e);break}}static get defaultPropertiesToUpdate(){return[[V.FREETEXT_SIZE,gt._defaultFontSize],[V.FREETEXT_COLOR,gt._defaultColor||I._defaultLineColor]]}get propertiesToUpdate(){return[[V.FREETEXT_SIZE,this.#i],[V.FREETEXT_COLOR,this.color]]}get toolbarButtons(){return this._colorPicker||=new ni(this),[["colorPicker",this._colorPicker]]}get colorType(){return V.FREETEXT_COLOR}#a(t){const e=s=>{this.editorDiv.style.fontSize=`calc(${s}px * var(--total-scale-factor))`,this.translate(0,-(s-this.#i)*this.parentScale),this.#i=s,this.#o()},i=this.#i;this.addCommands({cmd:e.bind(this,t),undo:e.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:V.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}onUpdatedColor(){this.editorDiv.style.color=this.color,this._colorPicker?.update(this.color),super.onUpdatedColor()}#n(t){const e=s=>{this.color=s,this.onUpdatedColor()},i=this.color;this.addCommands({cmd:e.bind(this,t),undo:e.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:V.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(t,e){this._uiManager.translateSelectedEditors(t,e,!0)}getInitialTranslation(){const t=this.parentScale;return[-gt._internalPadding*t,-(gt._internalPadding+this.#i)*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(!super.enableEditMode())return!1;this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.#s=new AbortController;const t=this._uiManager.combinedSignal(this.#s);return this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t}),!0}disableEditMode(){return super.disableEditMode()?(this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#e),this._isDraggable=!0,this.#s?.abort(),this.#s=null,this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"),!0):!1}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(t){this.width||(this.enableEditMode(),t&&this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}#r(){const t=[];this.editorDiv.normalize();let e=null;for(const i of this.editorDiv.childNodes)e?.nodeType===Node.TEXT_NODE&&i.nodeName==="BR"||(t.push(gt.#c(i)),e=i);return t.join(`
`)}#o(){const[t,e]=this.parentDimensions;let i;if(this.isAttachedToDOM)i=this.div.getBoundingClientRect();else{const{currentLayer:s,div:n}=this,r=n.style.display,a=n.classList.contains("hidden");n.classList.remove("hidden"),n.style.display="hidden",s.div.append(this.div),i=n.getBoundingClientRect(),n.remove(),n.style.display=r,n.classList.toggle("hidden",a)}this.rotation%180===this.parentRotation%180?(this.width=i.width/t,this.height=i.height/e):(this.width=i.height/t,this.height=i.width/e),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const t=this.#t,e=this.#t=this.#r().trimEnd();if(t===e)return;const i=s=>{if(this.#t=s,!s){this.remove();return}this.#l(),this._uiManager.rebuild(this),this.#o()};this.addCommands({cmd:()=>{i(e)},undo:()=>{i(t)},mustExec:!1}),this.#o()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}keydown(t){t.target===this.div&&t.key==="Enter"&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){gt._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}get canChangeContent(){return!0}render(){if(this.div)return this.div;let t,e;(this._isCopy||this.annotationElementId)&&(t=this.x,e=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#e),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:i}=this.editorDiv;if(i.fontSize=`calc(${this.#i}px * var(--total-scale-factor))`,i.color=this.color,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),this._isCopy||this.annotationElementId){const[s,n]=this.parentDimensions;if(this.annotationElementId){const{position:r}=this._initialData;let[a,l]=this.getInitialTranslation();[a,l]=this.pageTranslationToScreen(a,l);const[c,h]=this.pageDimensions,[d,u]=this.pageTranslation;let p,m;switch(this.rotation){case 0:p=t+(r[0]-d)/c,m=e+this.height-(r[1]-u)/h;break;case 90:p=t+(r[0]-d)/c,m=e-(r[1]-u)/h,[a,l]=[l,-a];break;case 180:p=t-this.width+(r[0]-d)/c,m=e-(r[1]-u)/h,[a,l]=[-a,-l];break;case 270:p=t+(r[0]-d-this.height*h)/c,m=e+(r[1]-u-this.width*c)/h,[a,l]=[-l,a];break}this.setAt(p*s,m*n,a,l)}else this._moveAfterPaste(t,e);this.#l(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}static#c(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(Ei,"")}editorDivPaste(t){const e=t.clipboardData||window.clipboardData,{types:i}=e;if(i.length===1&&i[0]==="text/plain")return;t.preventDefault();const s=gt.#d(e.getData("text")||"").replaceAll(Ei,`
`);if(!s)return;const n=window.getSelection();if(!n.rangeCount)return;this.editorDiv.normalize(),n.deleteFromDocument();const r=n.getRangeAt(0);if(!s.includes(`
`)){r.insertNode(document.createTextNode(s)),this.editorDiv.normalize(),n.collapseToStart();return}const{startContainer:a,startOffset:l}=r,c=[],h=[];if(a.nodeType===Node.TEXT_NODE){const p=a.parentElement;if(h.push(a.nodeValue.slice(l).replaceAll(Ei,"")),p!==this.editorDiv){let m=c;for(const g of this.editorDiv.childNodes){if(g===p){m=h;continue}m.push(gt.#c(g))}}c.push(a.nodeValue.slice(0,l).replaceAll(Ei,""))}else if(a===this.editorDiv){let p=c,m=0;for(const g of this.editorDiv.childNodes)m++===l&&(p=h),p.push(gt.#c(g))}this.#t=`${c.join(`
`)}${s}${h.join(`
`)}`,this.#l();const d=new Range;let u=Math.sumPrecise(c.map(p=>p.length));for(const{firstChild:p}of this.editorDiv.childNodes)if(p.nodeType===Node.TEXT_NODE){const m=p.nodeValue.length;if(u<=m){d.setStart(p,u),d.setEnd(p,u);break}u-=m}n.removeAllRanges(),n.addRange(d)}#l(){if(this.editorDiv.replaceChildren(),!!this.#t)for(const t of this.#t.split(`
`)){const e=document.createElement("div");e.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(e)}}#u(){return this.#t.replaceAll("Â "," ")}static#d(t){return t.replaceAll(" ","Â ")}get contentDiv(){return this.editorDiv}getPDFRect(){const t=gt._internalPadding*this.parentScale;return this.getRect(t,t)}static async deserialize(t,e,i){let s=null;if(t instanceof Pr){const{data:{defaultAppearanceData:{fontSize:r,fontColor:a},rect:l,rotation:c,id:h,popupRef:d,richText:u,contentsObj:p,creationDate:m,modificationDate:g},textContent:y,textPosition:b,parent:{page:{pageNumber:v}}}=t;if(!y||y.length===0)return null;s=t={annotationType:j.FREETEXT,color:Array.from(a),fontSize:r,value:y.join(`
`),position:b,pageIndex:v-1,rect:l.slice(0),rotation:c,annotationElementId:h,id:h,deleted:!1,popupRef:d,comment:p?.str||null,richText:u,creationDate:m,modificationDate:g}}const n=await super.deserialize(t,e,i);return n.#i=t.fontSize,n.color=N.makeHexColor(...t.color),n.#t=gt.#d(t.value),n._initialData=s,t.comment&&n.setCommentData(t),n}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const e=I._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.color),i=Object.assign(super.serialize(t),{color:e,fontSize:this.#i,value:this.#u()});return this.addComment(i),t?(i.isCopy=!0,i):this.annotationElementId&&!this.#p(i)?null:(i.id=this.annotationElementId,i)}#p(t){const{value:e,fontSize:i,color:s,pageIndex:n}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||t.value!==e||t.fontSize!==i||t.color.some((r,a)=>r!==s[a])||t.pageIndex!==n}renderAnnotationElement(t){const e=super.renderAnnotationElement(t);if(!e)return null;const{style:i}=e;i.fontSize=`calc(${this.#i}px * var(--total-scale-factor))`,i.color=this.color,e.replaceChildren();for(const s of this.#t.split(`
`)){const n=document.createElement("div");n.append(s?document.createTextNode(s):document.createElement("br")),e.append(n)}return t.updateEdited({rect:this.getPDFRect(),popup:this._uiManager.hasCommentManager()||this.hasEditedComment?this.comment:{text:this.#t}}),e}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}}class D{static PRECISION=1e-4;toSVGPath(){J("Abstract method `toSVGPath` must be implemented.")}get box(){J("Abstract getter `box` must be implemented.")}serialize(t,e){J("Abstract method `serialize` must be implemented.")}static _rescale(t,e,i,s,n,r){r||=new Float32Array(t.length);for(let a=0,l=t.length;a<l;a+=2)r[a]=e+t[a]*s,r[a+1]=i+t[a+1]*n;return r}static _rescaleAndSwap(t,e,i,s,n,r){r||=new Float32Array(t.length);for(let a=0,l=t.length;a<l;a+=2)r[a]=e+t[a+1]*s,r[a+1]=i+t[a]*n;return r}static _translate(t,e,i,s){s||=new Float32Array(t.length);for(let n=0,r=t.length;n<r;n+=2)s[n]=e+t[n],s[n+1]=i+t[n+1];return s}static svgRound(t){return Math.round(t*1e4)}static _normalizePoint(t,e,i,s,n){switch(n){case 90:return[1-e/i,t/s];case 180:return[1-t/i,1-e/s];case 270:return[e/i,1-t/s];default:return[t/i,e/s]}}static _normalizePagePoint(t,e,i){switch(i){case 90:return[1-e,t];case 180:return[1-t,1-e];case 270:return[e,1-t];default:return[t,e]}}static createBezierPoints(t,e,i,s,n,r){return[(t+5*i)/6,(e+5*s)/6,(5*i+n)/6,(5*s+r)/6,(i+n)/2,(s+r)/2]}}class ue{#t;#e=[];#s;#i;#a=[];#n=new Float32Array(18);#r;#o;#c;#l;#u;#d;#p=[];static#m=8;static#f=2;static#h=ue.#m+ue.#f;constructor({x:t,y:e},i,s,n,r,a=0){this.#t=i,this.#d=n*s,this.#i=r,this.#n.set([NaN,NaN,NaN,NaN,t,e],6),this.#s=a,this.#l=ue.#m*s,this.#c=ue.#h*s,this.#u=s,this.#p.push(t,e)}isEmpty(){return isNaN(this.#n[8])}#g(){const t=this.#n.subarray(4,6),e=this.#n.subarray(16,18),[i,s,n,r]=this.#t;return[(this.#r+(t[0]-e[0])/2-i)/n,(this.#o+(t[1]-e[1])/2-s)/r,(this.#r+(e[0]-t[0])/2-i)/n,(this.#o+(e[1]-t[1])/2-s)/r]}add({x:t,y:e}){this.#r=t,this.#o=e;const[i,s,n,r]=this.#t;let[a,l,c,h]=this.#n.subarray(8,12);const d=t-c,u=e-h,p=Math.hypot(d,u);if(p<this.#c)return!1;const m=p-this.#l,g=m/p,y=g*d,b=g*u;let v=a,w=l;a=c,l=h,c+=y,h+=b,this.#p?.push(t,e);const A=-b/m,x=y/m,S=A*this.#d,k=x*this.#d;return this.#n.set(this.#n.subarray(2,8),0),this.#n.set([c+S,h+k],4),this.#n.set(this.#n.subarray(14,18),12),this.#n.set([c-S,h-k],16),isNaN(this.#n[6])?(this.#a.length===0&&(this.#n.set([a+S,l+k],2),this.#a.push(NaN,NaN,NaN,NaN,(a+S-i)/n,(l+k-s)/r),this.#n.set([a-S,l-k],14),this.#e.push(NaN,NaN,NaN,NaN,(a-S-i)/n,(l-k-s)/r)),this.#n.set([v,w,a,l,c,h],6),!this.isEmpty()):(this.#n.set([v,w,a,l,c,h],6),Math.abs(Math.atan2(w-l,v-a)-Math.atan2(b,y))<Math.PI/2?([a,l,c,h]=this.#n.subarray(2,6),this.#a.push(NaN,NaN,NaN,NaN,((a+c)/2-i)/n,((l+h)/2-s)/r),[a,l,v,w]=this.#n.subarray(14,18),this.#e.push(NaN,NaN,NaN,NaN,((v+a)/2-i)/n,((w+l)/2-s)/r),!0):([v,w,a,l,c,h]=this.#n.subarray(0,6),this.#a.push(((v+5*a)/6-i)/n,((w+5*l)/6-s)/r,((5*a+c)/6-i)/n,((5*l+h)/6-s)/r,((a+c)/2-i)/n,((l+h)/2-s)/r),[c,h,a,l,v,w]=this.#n.subarray(12,18),this.#e.push(((v+5*a)/6-i)/n,((w+5*l)/6-s)/r,((5*a+c)/6-i)/n,((5*l+h)/6-s)/r,((a+c)/2-i)/n,((l+h)/2-s)/r),!0))}toSVGPath(){if(this.isEmpty())return"";const t=this.#a,e=this.#e;if(isNaN(this.#n[6])&&!this.isEmpty())return this.#b();const i=[];i.push(`M${t[4]} ${t[5]}`);for(let s=6;s<t.length;s+=6)isNaN(t[s])?i.push(`L${t[s+4]} ${t[s+5]}`):i.push(`C${t[s]} ${t[s+1]} ${t[s+2]} ${t[s+3]} ${t[s+4]} ${t[s+5]}`);this.#y(i);for(let s=e.length-6;s>=6;s-=6)isNaN(e[s])?i.push(`L${e[s+4]} ${e[s+5]}`):i.push(`C${e[s]} ${e[s+1]} ${e[s+2]} ${e[s+3]} ${e[s+4]} ${e[s+5]}`);return this.#w(i),i.join(" ")}#b(){const[t,e,i,s]=this.#t,[n,r,a,l]=this.#g();return`M${(this.#n[2]-t)/i} ${(this.#n[3]-e)/s} L${(this.#n[4]-t)/i} ${(this.#n[5]-e)/s} L${n} ${r} L${a} ${l} L${(this.#n[16]-t)/i} ${(this.#n[17]-e)/s} L${(this.#n[14]-t)/i} ${(this.#n[15]-e)/s} Z`}#w(t){const e=this.#e;t.push(`L${e[4]} ${e[5]} Z`)}#y(t){const[e,i,s,n]=this.#t,r=this.#n.subarray(4,6),a=this.#n.subarray(16,18),[l,c,h,d]=this.#g();t.push(`L${(r[0]-e)/s} ${(r[1]-i)/n} L${l} ${c} L${h} ${d} L${(a[0]-e)/s} ${(a[1]-i)/n}`)}newFreeDrawOutline(t,e,i,s,n,r){return new Ir(t,e,i,s,n,r)}getOutlines(){const t=this.#a,e=this.#e,i=this.#n,[s,n,r,a]=this.#t,l=new Float32Array((this.#p?.length??0)+2);for(let d=0,u=l.length-2;d<u;d+=2)l[d]=(this.#p[d]-s)/r,l[d+1]=(this.#p[d+1]-n)/a;if(l[l.length-2]=(this.#r-s)/r,l[l.length-1]=(this.#o-n)/a,isNaN(i[6])&&!this.isEmpty())return this.#_(l);const c=new Float32Array(this.#a.length+24+this.#e.length);let h=t.length;for(let d=0;d<h;d+=2){if(isNaN(t[d])){c[d]=c[d+1]=NaN;continue}c[d]=t[d],c[d+1]=t[d+1]}h=this.#v(c,h);for(let d=e.length-6;d>=6;d-=6)for(let u=0;u<6;u+=2){if(isNaN(e[d+u])){c[h]=c[h+1]=NaN,h+=2;continue}c[h]=e[d+u],c[h+1]=e[d+u+1],h+=2}return this.#S(c,h),this.newFreeDrawOutline(c,l,this.#t,this.#u,this.#s,this.#i)}#_(t){const e=this.#n,[i,s,n,r]=this.#t,[a,l,c,h]=this.#g(),d=new Float32Array(36);return d.set([NaN,NaN,NaN,NaN,(e[2]-i)/n,(e[3]-s)/r,NaN,NaN,NaN,NaN,(e[4]-i)/n,(e[5]-s)/r,NaN,NaN,NaN,NaN,a,l,NaN,NaN,NaN,NaN,c,h,NaN,NaN,NaN,NaN,(e[16]-i)/n,(e[17]-s)/r,NaN,NaN,NaN,NaN,(e[14]-i)/n,(e[15]-s)/r],0),this.newFreeDrawOutline(d,t,this.#t,this.#u,this.#s,this.#i)}#S(t,e){const i=this.#e;return t.set([NaN,NaN,NaN,NaN,i[4],i[5]],e),e+=6}#v(t,e){const i=this.#n.subarray(4,6),s=this.#n.subarray(16,18),[n,r,a,l]=this.#t,[c,h,d,u]=this.#g();return t.set([NaN,NaN,NaN,NaN,(i[0]-n)/a,(i[1]-r)/l,NaN,NaN,NaN,NaN,c,h,NaN,NaN,NaN,NaN,d,u,NaN,NaN,NaN,NaN,(s[0]-n)/a,(s[1]-r)/l],e),e+=24}}class Ir extends D{#t;#e=new Float32Array(4);#s;#i;#a;#n;#r;constructor(t,e,i,s,n,r){super(),this.#r=t,this.#a=e,this.#t=i,this.#n=s,this.#s=n,this.#i=r,this.firstPoint=[NaN,NaN],this.lastPoint=[NaN,NaN],this.#o(r);const[a,l,c,h]=this.#e;for(let d=0,u=t.length;d<u;d+=2)t[d]=(t[d]-a)/c,t[d+1]=(t[d+1]-l)/h;for(let d=0,u=e.length;d<u;d+=2)e[d]=(e[d]-a)/c,e[d+1]=(e[d+1]-l)/h}toSVGPath(){const t=[`M${this.#r[4]} ${this.#r[5]}`];for(let e=6,i=this.#r.length;e<i;e+=6){if(isNaN(this.#r[e])){t.push(`L${this.#r[e+4]} ${this.#r[e+5]}`);continue}t.push(`C${this.#r[e]} ${this.#r[e+1]} ${this.#r[e+2]} ${this.#r[e+3]} ${this.#r[e+4]} ${this.#r[e+5]}`)}return t.push("Z"),t.join(" ")}serialize([t,e,i,s],n){const r=i-t,a=s-e;let l,c;switch(n){case 0:l=D._rescale(this.#r,t,s,r,-a),c=D._rescale(this.#a,t,s,r,-a);break;case 90:l=D._rescaleAndSwap(this.#r,t,e,r,a),c=D._rescaleAndSwap(this.#a,t,e,r,a);break;case 180:l=D._rescale(this.#r,i,e,-r,a),c=D._rescale(this.#a,i,e,-r,a);break;case 270:l=D._rescaleAndSwap(this.#r,i,s,-r,-a),c=D._rescaleAndSwap(this.#a,i,s,-r,-a);break}return{outline:Array.from(l),points:[Array.from(c)]}}#o(t){const e=this.#r;let i=e[4],s=e[5];const n=[i,s,i,s];let r=i,a=s,l=i,c=s;const h=t?Math.max:Math.min,d=new Float32Array(4);for(let p=6,m=e.length;p<m;p+=6){const g=e[p+4],y=e[p+5];isNaN(e[p])?(N.pointBoundingBox(g,y,n),a>y?(r=g,a=y):a===y&&(r=h(r,g)),c<y?(l=g,c=y):c===y&&(l=h(l,g))):(d[0]=d[1]=1/0,d[2]=d[3]=-1/0,N.bezierBoundingBox(i,s,...e.slice(p,p+6),d),N.rectBoundingBox(d[0],d[1],d[2],d[3],n),a>d[1]?(r=d[0],a=d[1]):a===d[1]&&(r=h(r,d[0])),c<d[3]?(l=d[2],c=d[3]):c===d[3]&&(l=h(l,d[2]))),i=g,s=y}const u=this.#e;u[0]=n[0]-this.#s,u[1]=n[1]-this.#s,u[2]=n[2]-n[0]+2*this.#s,u[3]=n[3]-n[1]+2*this.#s,this.firstPoint=[r,a],this.lastPoint=[l,c]}get box(){return this.#e}newOutliner(t,e,i,s,n,r=0){return new ue(t,e,i,s,n,r)}getNewOutline(t,e){const[i,s,n,r]=this.#e,[a,l,c,h]=this.#t,d=n*c,u=r*h,p=i*c+a,m=s*h+l,g=this.newOutliner({x:this.#a[0]*d+p,y:this.#a[1]*u+m},this.#t,this.#n,t,this.#i,e??this.#s);for(let y=2;y<this.#a.length;y+=2)g.add({x:this.#a[y]*d+p,y:this.#a[y+1]*u+m});return g.getOutlines()}}class ys{#t;#e;#s;#i=[];#a=[];constructor(t,e=0,i=0,s=!0){const n=[1/0,1/0,-1/0,-1/0],r=10**-4;for(const{x:g,y,width:b,height:v}of t){const w=Math.floor((g-e)/r)*r,A=Math.ceil((g+b+e)/r)*r,x=Math.floor((y-e)/r)*r,S=Math.ceil((y+v+e)/r)*r,k=[w,x,S,!0],_=[A,x,S,!1];this.#i.push(k,_),N.rectBoundingBox(w,x,A,S,n)}const a=n[2]-n[0]+2*i,l=n[3]-n[1]+2*i,c=n[0]-i,h=n[1]-i;let d=s?-1/0:1/0,u=1/0;const p=this.#i.at(s?-1:-2),m=[p[0],p[2]];for(const g of this.#i){const[y,b,v,w]=g;!w&&s?b<u?(u=b,d=y):b===u&&(d=Math.max(d,y)):w&&!s&&(b<u?(u=b,d=y):b===u&&(d=Math.min(d,y))),g[0]=(y-c)/a,g[1]=(b-h)/l,g[2]=(v-h)/l}this.#t=new Float32Array([c,h,a,l]),this.#e=[d,u],this.#s=m}getOutlines(){this.#i.sort((e,i)=>e[0]-i[0]||e[1]-i[1]||e[2]-i[2]);const t=[];for(const e of this.#i)e[3]?(t.push(...this.#l(e)),this.#o(e)):(this.#c(e),t.push(...this.#l(e)));return this.#n(t)}#n(t){const e=[],i=new Set;for(const r of t){const[a,l,c]=r;e.push([a,l,r],[a,c,r])}e.sort((r,a)=>r[1]-a[1]||r[0]-a[0]);for(let r=0,a=e.length;r<a;r+=2){const l=e[r][2],c=e[r+1][2];l.push(c),c.push(l),i.add(l),i.add(c)}const s=[];let n;for(;i.size>0;){const r=i.values().next().value;let[a,l,c,h,d]=r;i.delete(r);let u=a,p=l;for(n=[a,c],s.push(n);;){let m;if(i.has(h))m=h;else if(i.has(d))m=d;else break;i.delete(m),[a,l,c,h,d]=m,u!==a&&(n.push(u,p,a,p===l?l:c),u=a),p=p===l?c:l}n.push(u,p)}return new pc(s,this.#t,this.#e,this.#s)}#r(t){const e=this.#a;let i=0,s=e.length-1;for(;i<=s;){const n=i+s>>1,r=e[n][0];if(r===t)return n;r<t?i=n+1:s=n-1}return s+1}#o([,t,e]){const i=this.#r(t);this.#a.splice(i,0,[t,e])}#c([,t,e]){const i=this.#r(t);for(let s=i;s<this.#a.length;s++){const[n,r]=this.#a[s];if(n!==t)break;if(n===t&&r===e){this.#a.splice(s,1);return}}for(let s=i-1;s>=0;s--){const[n,r]=this.#a[s];if(n!==t)break;if(n===t&&r===e){this.#a.splice(s,1);return}}}#l(t){const[e,i,s]=t,n=[[e,i,s]],r=this.#r(s);for(let a=0;a<r;a++){const[l,c]=this.#a[a];for(let h=0,d=n.length;h<d;h++){const[,u,p]=n[h];if(!(c<=u||p<=l)){if(u>=l){if(p>c)n[h][1]=c;else{if(d===1)return[];n.splice(h,1),h--,d--}continue}n[h][2]=l,p>c&&n.push([e,c,p])}}}return n}}class pc extends D{#t;#e;constructor(t,e,i,s){super(),this.#e=t,this.#t=e,this.firstPoint=i,this.lastPoint=s}toSVGPath(){const t=[];for(const e of this.#e){let[i,s]=e;t.push(`M${i} ${s}`);for(let n=2;n<e.length;n+=2){const r=e[n],a=e[n+1];r===i?(t.push(`V${a}`),s=a):a===s&&(t.push(`H${r}`),i=r)}t.push("Z")}return t.join(" ")}serialize([t,e,i,s],n){const r=[],a=i-t,l=s-e;for(const c of this.#e){const h=new Array(c.length);for(let d=0;d<c.length;d+=2)h[d]=t+c[d]*a,h[d+1]=s-c[d+1]*l;r.push(h)}return r}get box(){return this.#t}get classNamesForOutlining(){return["highlightOutline"]}}class ws extends ue{newFreeDrawOutline(t,e,i,s,n,r){return new fc(t,e,i,s,n,r)}}class fc extends Ir{newOutliner(t,e,i,s,n,r=0){return new ws(t,e,i,s,n,r)}}class ht extends I{#t=null;#e=0;#s;#i=null;#a=null;#n=null;#r=null;#o=0;#c=null;#l=null;#u=null;#d=!1;#p=null;#m=null;#f=null;#h="";#g;#b="";static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=12;static _type="highlight";static _editorType=j.HIGHLIGHT;static _freeHighlightId=-1;static _freeHighlight=null;static _freeHighlightClipId="";static get _keyboardManager(){const t=ht.prototype;return z(this,"_keyboardManager",new hi([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}constructor(t){super({...t,name:"highlightEditor"}),this.color=t.color||ht._defaultColor,this.#g=t.thickness||ht._defaultThickness,this.opacity=t.opacity||ht._defaultOpacity,this.#s=t.boxes||null,this.#b=t.methodOfCreation||"",this.#h=t.text||"",this._isDraggable=!1,this.defaultL10nId="pdfjs-editor-highlight-editor",t.highlightId>-1?(this.#d=!0,this.#y(t),this.#A()):this.#s&&(this.#t=t.anchorNode,this.#e=t.anchorOffset,this.#r=t.focusNode,this.#o=t.focusOffset,this.#w(),this.#A(),this.rotate(this.rotation)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-highlight-added-alert")}get telemetryInitialData(){return{action:"added",type:this.#d?"free_highlight":"highlight",color:this._uiManager.getNonHCMColorName(this.color),thickness:this.#g,methodOfCreation:this.#b}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.getNonHCMColorName(this.color)}}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}#w(){const t=new ys(this.#s,.001);this.#l=t.getOutlines(),[this.x,this.y,this.width,this.height]=this.#l.box;const e=new ys(this.#s,.0025,.001,this._uiManager.direction==="ltr");this.#n=e.getOutlines();const{firstPoint:i}=this.#l;this.#p=[(i[0]-this.x)/this.width,(i[1]-this.y)/this.height];const{lastPoint:s}=this.#n;this.#m=[(s[0]-this.x)/this.width,(s[1]-this.y)/this.height]}#y({highlightOutlines:t,highlightId:e,clipPathId:i}){this.#l=t;const s=1.5;if(this.#n=t.getNewOutline(this.#g/2+s,.0025),e>=0)this.#u=e,this.#i=i,this.parent.drawLayer.finalizeDraw(e,{bbox:t.box,path:{d:t.toSVGPath()}}),this.#f=this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:this.#n.box,path:{d:this.#n.toSVGPath()}},!0);else if(this.parent){const d=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(this.#u,{bbox:ht.#k(this.#l.box,(d-this.rotation+360)%360),path:{d:t.toSVGPath()}}),this.parent.drawLayer.updateProperties(this.#f,{bbox:ht.#k(this.#n.box,d),path:{d:this.#n.toSVGPath()}})}const[n,r,a,l]=t.box;switch(this.rotation){case 0:this.x=n,this.y=r,this.width=a,this.height=l;break;case 90:{const[d,u]=this.parentDimensions;this.x=r,this.y=1-n,this.width=a*u/d,this.height=l*d/u;break}case 180:this.x=1-n,this.y=1-r,this.width=a,this.height=l;break;case 270:{const[d,u]=this.parentDimensions;this.x=1-r,this.y=n,this.width=a*u/d,this.height=l*d/u;break}}const{firstPoint:c}=t;this.#p=[(c[0]-n)/a,(c[1]-r)/l];const{lastPoint:h}=this.#n;this.#m=[(h[0]-n)/a,(h[1]-r)/l]}static initialize(t,e){I.initialize(t,e),ht._defaultColor||=e.highlightColors?.values().next().value||"#fff066"}static updateDefaultParams(t,e){switch(t){case V.HIGHLIGHT_COLOR:ht._defaultColor=e;break;case V.HIGHLIGHT_THICKNESS:ht._defaultThickness=e;break}}translateInPage(t,e){}get toolbarPosition(){return this.#m}get commentButtonPosition(){return this.#p}updateParams(t,e){switch(t){case V.HIGHLIGHT_COLOR:this.#_(e);break;case V.HIGHLIGHT_THICKNESS:this.#S(e);break}}static get defaultPropertiesToUpdate(){return[[V.HIGHLIGHT_COLOR,ht._defaultColor],[V.HIGHLIGHT_THICKNESS,ht._defaultThickness]]}get propertiesToUpdate(){return[[V.HIGHLIGHT_COLOR,this.color||ht._defaultColor],[V.HIGHLIGHT_THICKNESS,this.#g||ht._defaultThickness],[V.HIGHLIGHT_FREE,this.#d]]}onUpdatedColor(){this.parent?.drawLayer.updateProperties(this.#u,{root:{fill:this.color,"fill-opacity":this.opacity}}),this.#a?.updateColor(this.color),super.onUpdatedColor()}#_(t){const e=(n,r)=>{this.color=n,this.opacity=r,this.onUpdatedColor()},i=this.color,s=this.opacity;this.addCommands({cmd:e.bind(this,t,ht._defaultOpacity),undo:e.bind(this,i,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:V.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.getNonHCMColorName(t)},!0)}#S(t){const e=this.#g,i=s=>{this.#g=s,this.#v(s)};this.addCommands({cmd:i.bind(this,t),undo:i.bind(this,e),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:V.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)}get toolbarButtons(){return this._uiManager.highlightColors?[["colorPicker",this.#a=new Nt({editor:this})]]:super.toolbarButtons}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(this.#L())}getBaseTranslation(){return[0,0]}getRect(t,e){return super.getRect(t,e,this.#L())}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),t&&this.div.focus()}remove(){this.#C(),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#A(),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){let e=!1;this.parent&&!t?this.#C():t&&(this.#A(t),e=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(t),this.show(this._isVisible),e&&this.select()}#v(t){this.#d&&(this.#y({highlightOutlines:this.#l.getNewOutline(t/2)}),this.fixAndSetPosition(),this.setDims(this.width,this.height))}#C(){this.#u===null||!this.parent||(this.parent.drawLayer.remove(this.#u),this.#u=null,this.parent.drawLayer.remove(this.#f),this.#f=null)}#A(t=this.parent){this.#u===null&&({id:this.#u,clipPathId:this.#i}=t.drawLayer.draw({bbox:this.#l.box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":this.opacity},rootClass:{highlight:!0,free:this.#d},path:{d:this.#l.toSVGPath()}},!1,!0),this.#f=t.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:this.#d},bbox:this.#n.box,path:{d:this.#n.toSVGPath()}},this.#d),this.#c&&(this.#c.style.clipPath=this.#i))}static#k([t,e,i,s],n){switch(n){case 90:return[1-e-s,t,s,i];case 180:return[1-t-i,1-e-s,i,s];case 270:return[e,1-t-i,s,i]}return[t,e,i,s]}rotate(t){const{drawLayer:e}=this.parent;let i;this.#d?(t=(t-this.rotation+360)%360,i=ht.#k(this.#l.box,t)):i=ht.#k([this.x,this.y,this.width,this.height],t),e.updateProperties(this.#u,{bbox:i,root:{"data-main-rotation":t}}),e.updateProperties(this.#f,{bbox:ht.#k(this.#n.box,t),root:{"data-main-rotation":t}})}render(){if(this.div)return this.div;const t=super.render();this.#h&&(t.setAttribute("aria-label",this.#h),t.setAttribute("role","mark")),this.#d?t.classList.add("free"):this.div.addEventListener("keydown",this.#P.bind(this),{signal:this._uiManager._signal});const e=this.#c=document.createElement("div");return t.append(e),e.setAttribute("aria-hidden","true"),e.className="internal",e.style.clipPath=this.#i,this.setDims(this.width,this.height),hr(this,this.#c,["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#f,{rootClass:{hovered:!0}})}pointerleave(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#f,{rootClass:{hovered:!1}})}#P(t){ht._keyboardManager.exec(this,t)}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:this.#T(!0);break;case 1:case 3:this.#T(!1);break}}#T(t){if(!this.#t)return;const e=window.getSelection();t?e.setPosition(this.#t,this.#e):e.setPosition(this.#r,this.#o)}select(){super.select(),this.#f&&this.parent?.drawLayer.updateProperties(this.#f,{rootClass:{hovered:!1,selected:!0}})}unselect(){super.unselect(),this.#f&&(this.parent?.drawLayer.updateProperties(this.#f,{rootClass:{selected:!1}}),this.#d||this.#T(!1))}get _mustFixPosition(){return!this.#d}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.updateProperties(this.#u,{rootClass:{hidden:!t}}),this.parent.drawLayer.updateProperties(this.#f,{rootClass:{hidden:!t}}))}#L(){return this.#d?this.rotation:0}#O(){if(this.#d)return null;const[t,e]=this.pageDimensions,[i,s]=this.pageTranslation,n=this.#s,r=new Float32Array(n.length*8);let a=0;for(const{x:l,y:c,width:h,height:d}of n){const u=l*t+i,p=(1-c)*e+s;r[a]=r[a+4]=u,r[a+1]=r[a+3]=p,r[a+2]=r[a+6]=u+h*t,r[a+5]=r[a+7]=p-d*e,a+=8}return r}#R(t){return this.#l.serialize(t,this.#L())}static startHighlighting(t,e,{target:i,x:s,y:n}){const{x:r,y:a,width:l,height:c}=i.getBoundingClientRect(),h=new AbortController,d=t.combinedSignal(h),u=p=>{h.abort(),this.#j(t,p)};window.addEventListener("blur",u,{signal:d}),window.addEventListener("pointerup",u,{signal:d}),window.addEventListener("pointerdown",ot,{capture:!0,passive:!1,signal:d}),window.addEventListener("contextmenu",Ft,{signal:d}),i.addEventListener("pointermove",this.#N.bind(this,t),{signal:d}),this._freeHighlight=new ws({x:s,y:n},[r,a,l,c],t.scale,this._defaultThickness/2,e,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static#N(t,e){this._freeHighlight.add(e)&&t.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})}static#j(t,e){this._freeHighlight.isEmpty()?t.drawLayer.remove(this._freeHighlightId):t.createAndAddNewEditor(e,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""}static async deserialize(t,e,i){let s=null;if(t instanceof Rr){const{data:{quadPoints:m,rect:g,rotation:y,id:b,color:v,opacity:w,popupRef:A,richText:x,contentsObj:S,creationDate:k,modificationDate:_},parent:{page:{pageNumber:E}}}=t;s=t={annotationType:j.HIGHLIGHT,color:Array.from(v),opacity:w,quadPoints:m,boxes:null,pageIndex:E-1,rect:g.slice(0),rotation:y,annotationElementId:b,id:b,deleted:!1,popupRef:A,richText:x,comment:S?.str||null,creationDate:k,modificationDate:_}}else if(t instanceof Us){const{data:{inkLists:m,rect:g,rotation:y,id:b,color:v,borderStyle:{rawWidth:w},popupRef:A,richText:x,contentsObj:S,creationDate:k,modificationDate:_},parent:{page:{pageNumber:E}}}=t;s=t={annotationType:j.HIGHLIGHT,color:Array.from(v),thickness:w,inkLists:m,boxes:null,pageIndex:E-1,rect:g.slice(0),rotation:y,annotationElementId:b,id:b,deleted:!1,popupRef:A,richText:x,comment:S?.str||null,creationDate:k,modificationDate:_}}const{color:n,quadPoints:r,inkLists:a,opacity:l}=t,c=await super.deserialize(t,e,i);c.color=N.makeHexColor(...n),c.opacity=l||1,a&&(c.#g=t.thickness),c._initialData=s,t.comment&&c.setCommentData(t);const[h,d]=c.pageDimensions,[u,p]=c.pageTranslation;if(r){const m=c.#s=[];for(let g=0;g<r.length;g+=8)m.push({x:(r[g]-u)/h,y:1-(r[g+1]-p)/d,width:(r[g+2]-r[g])/h,height:(r[g+1]-r[g+5])/d});c.#w(),c.#A(),c.rotate(c.rotation)}else if(a){c.#d=!0;const m=a[0],g={x:m[0]-u,y:d-(m[1]-p)},y=new ws(g,[0,0,h,d],1,c.#g/2,!0,.001);for(let w=0,A=m.length;w<A;w+=2)g.x=m[w]-u,g.y=d-(m[w+1]-p),y.add(g);const{id:b,clipPathId:v}=e.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:c.color,"fill-opacity":c._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:y.toSVGPath()}},!0,!0);c.#y({highlightOutlines:y.getOutlines(),highlightId:b,clipPathId:v}),c.#A(),c.rotate(c.parentRotation)}return c}serialize(t=!1){if(this.isEmpty()||t)return null;if(this.deleted)return this.serializeDeleted();const e=I._colorManager.convert(this._uiManager.getNonHCMColor(this.color)),i=super.serialize(t);return Object.assign(i,{color:e,opacity:this.opacity,thickness:this.#g,quadPoints:this.#O(),outlines:this.#R(i.rect)}),this.addComment(i),this.annotationElementId&&!this.#I(i)?null:(i.id=this.annotationElementId,i)}#I(t){const{color:e}=this._initialData;return this.hasEditedComment||t.color.some((i,s)=>i!==e[s])}renderAnnotationElement(t){return this.deleted?(t.hide(),null):(t.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}static canCreateNewEmptyEditor(){return!1}}class Fr{#t=Object.create(null);updateProperty(t,e){this[t]=e,this.updateSVGProperty(t,e)}updateProperties(t){if(t)for(const[e,i]of Object.entries(t))e.startsWith("_")||this.updateProperty(e,i)}updateSVGProperty(t,e){this.#t[t]=e}toSVGProperties(){const t=this.#t;return this.#t=Object.create(null),{root:t}}reset(){this.#t=Object.create(null)}updateAll(t=this){this.updateProperties(t)}clone(){J("Not implemented")}}class F extends I{#t=null;#e;_colorPicker=null;_drawId=null;static _currentDrawId=-1;static _currentParent=null;static#s=null;static#i=null;static#a=null;static#n=NaN;static#r=null;static#o=null;static#c=NaN;static _INNER_MARGIN=3;constructor(t){super(t),this.#e=t.mustBeCommitted||!1,this._addOutlines(t)}onUpdatedColor(){this._colorPicker?.update(this.color),super.onUpdatedColor()}_addOutlines(t){t.drawOutlines&&(this.#l(t),this.#p())}#l({drawOutlines:t,drawId:e,drawingOptions:i}){this.#t=t,this._drawingOptions||=i,this.annotationElementId||this._uiManager.a11yAlert(`pdfjs-editor-${this.editorType}-added-alert`),e>=0?(this._drawId=e,this.parent.drawLayer.finalizeDraw(e,t.defaultProperties)):this._drawId=this.#u(t,this.parent),this.#h(t.box)}#u(t,e){const{id:i}=e.drawLayer.draw(F._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),!1,!1);return i}static _mergeSVGProperties(t,e){const i=new Set(Object.keys(t));for(const[s,n]of Object.entries(e))i.has(s)?Object.assign(t[s],n):t[s]=n;return t}static getDefaultDrawingOptions(t){J("Not implemented")}static get typesMap(){J("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(t,e){const i=this.typesMap.get(t);i&&this._defaultDrawingOptions.updateProperty(i,e),this._currentParent&&(F.#s.updateProperty(i,e),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(t,e){const i=this.constructor.typesMap.get(t);i&&this._updateProperty(t,i,e)}static get defaultPropertiesToUpdate(){const t=[],e=this._defaultDrawingOptions;for(const[i,s]of this.typesMap)t.push([i,e[s]]);return t}get propertiesToUpdate(){const t=[],{_drawingOptions:e}=this;for(const[i,s]of this.constructor.typesMap)t.push([i,e[s]]);return t}_updateProperty(t,e,i){const s=this._drawingOptions,n=s[e],r=a=>{s.updateProperty(e,a);const l=this.#t.updateProperty(e,a);l&&this.#h(l),this.parent?.drawLayer.updateProperties(this._drawId,s.toSVGProperties()),t===this.colorType&&this.onUpdatedColor()};this.addCommands({cmd:r.bind(this,i),undo:r.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:t,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){this.parent?.drawLayer.updateProperties(this._drawId,F._mergeSVGProperties(this.#t.getPathResizingSVGProperties(this.#f()),{bbox:this.#g()}))}_onResized(){this.parent?.drawLayer.updateProperties(this._drawId,F._mergeSVGProperties(this.#t.getPathResizedSVGProperties(this.#f()),{bbox:this.#g()}))}_onTranslating(t,e){this.parent?.drawLayer.updateProperties(this._drawId,{bbox:this.#g()})}_onTranslated(){this.parent?.drawLayer.updateProperties(this._drawId,F._mergeSVGProperties(this.#t.getPathTranslatedSVGProperties(this.#f(),this.parentDimensions),{bbox:this.#g()}))}_onStartDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,this.#e&&(this.#e=!1,this.commit(),this.parent.setSelected(this),t&&this.isOnScreen&&this.div.focus())}remove(){this.#d(),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#p(),this.#h(this.#t.box),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){let e=!1;this.parent&&!t?(this._uiManager.removeShouldRescale(this),this.#d()):t&&(this._uiManager.addShouldRescale(this),this.#p(t),e=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(t),e&&this.select()}#d(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())}#p(t=this.parent){if(!(this._drawId!==null&&this.parent===t)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,t.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=this.#u(this.#t,t)}}#m([t,e,i,s]){const{parentDimensions:[n,r],rotation:a}=this;switch(a){case 90:return[e,1-t,i*(r/n),s*(n/r)];case 180:return[1-t,1-e,i,s];case 270:return[1-e,t,i*(r/n),s*(n/r)];default:return[t,e,i,s]}}#f(){const{x:t,y:e,width:i,height:s,parentDimensions:[n,r],rotation:a}=this;switch(a){case 90:return[1-e,t,i*(n/r),s*(r/n)];case 180:return[1-t,1-e,i,s];case 270:return[e,1-t,i*(n/r),s*(r/n)];default:return[t,e,i,s]}}#h(t){[this.x,this.y,this.width,this.height]=this.#m(t),this.div&&(this.fixAndSetPosition(),this.setDims()),this._onResized()}#g(){const{x:t,y:e,width:i,height:s,rotation:n,parentRotation:r,parentDimensions:[a,l]}=this;switch((n*4+r)/90){case 1:return[1-e-s,t,s,i];case 2:return[1-t-i,1-e-s,i,s];case 3:return[e,1-t-i,s,i];case 4:return[t,e-i*(a/l),s*(l/a),i*(a/l)];case 5:return[1-e,t,i*(a/l),s*(l/a)];case 6:return[1-t-s*(l/a),1-e,s*(l/a),i*(a/l)];case 7:return[e-i*(a/l),1-t-s*(l/a),i*(a/l),s*(l/a)];case 8:return[t-i,e-s,i,s];case 9:return[1-e,t-i,s,i];case 10:return[1-t,1-e,i,s];case 11:return[e-s,1-t,s,i];case 12:return[t-s*(l/a),e,s*(l/a),i*(a/l)];case 13:return[1-e-i*(a/l),t-s*(l/a),i*(a/l),s*(l/a)];case 14:return[1-t,1-e-i*(a/l),s*(l/a),i*(a/l)];case 15:return[e,1-t,i*(a/l),s*(l/a)];default:return[t,e,i,s]}}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,F._mergeSVGProperties({bbox:this.#g()},this.#t.updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&this.#h(this.#t.updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let t,e;this._isCopy&&(t=this.x,e=this.y);const i=super.render();i.classList.add("draw");const s=document.createElement("div");return i.append(s),s.setAttribute("aria-hidden","true"),s.className="internal",this.setDims(),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(t,e),i}static createDrawerInstance(t,e,i,s,n){J("Not implemented")}static startDrawing(t,e,i,s){const{target:n,offsetX:r,offsetY:a,pointerId:l,pointerType:c}=s;if(F.#r&&F.#r!==c)return;const{viewport:{rotation:h}}=t,{width:d,height:u}=n.getBoundingClientRect(),p=F.#i=new AbortController,m=t.combinedSignal(p);if(F.#n||=l,F.#r??=c,window.addEventListener("pointerup",g=>{F.#n===g.pointerId?this._endDraw(g):F.#o?.delete(g.pointerId)},{signal:m}),window.addEventListener("pointercancel",g=>{F.#n===g.pointerId?this._currentParent.endDrawingSession():F.#o?.delete(g.pointerId)},{signal:m}),window.addEventListener("pointerdown",g=>{F.#r===g.pointerType&&((F.#o||=new Set).add(g.pointerId),F.#s.isCancellable()&&(F.#s.removeLastElement(),F.#s.isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:m}),window.addEventListener("contextmenu",Ft,{signal:m}),n.addEventListener("pointermove",this._drawMove.bind(this),{signal:m}),n.addEventListener("touchmove",g=>{g.timeStamp===F.#c&&ot(g)},{signal:m}),t.toggleDrawing(),e._editorUndoBar?.hide(),F.#s){t.drawLayer.updateProperties(this._currentDrawId,F.#s.startNew(r,a,d,u,h));return}e.updateUIForDefaultProperties(this),F.#s=this.createDrawerInstance(r,a,d,u,h),F.#a=this.getDefaultDrawingOptions(),this._currentParent=t,{id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(F.#a.toSVGProperties(),F.#s.defaultSVGProperties),!0,!1)}static _drawMove(t){if(F.#c=-1,!F.#s)return;const{offsetX:e,offsetY:i,pointerId:s}=t;if(F.#n===s){if(F.#o?.size>=1){this._endDraw(t);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,F.#s.add(e,i)),F.#c=t.timeStamp,ot(t)}}static _cleanup(t){t&&(this._currentDrawId=-1,this._currentParent=null,F.#s=null,F.#a=null,F.#r=null,F.#c=NaN),F.#i&&(F.#i.abort(),F.#i=null,F.#n=NaN,F.#o=null)}static _endDraw(t){const e=this._currentParent;if(e){if(e.toggleDrawing(!0),this._cleanup(!1),t?.target===e.div&&e.drawLayer.updateProperties(this._currentDrawId,F.#s.end(t.offsetX,t.offsetY)),this.supportMultipleDrawings){const i=F.#s,s=this._currentDrawId,n=i.getLastElement();e.addCommands({cmd:()=>{e.drawLayer.updateProperties(s,i.setLastElement(n))},undo:()=>{e.drawLayer.updateProperties(s,i.removeLastElement())},mustExec:!1,type:V.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(t){const e=this._currentParent;if(!e)return null;if(e.toggleDrawing(!0),e.cleanUndoStack(V.DRAW_STEP),!F.#s.isEmpty()){const{pageDimensions:[i,s],scale:n}=e,r=e.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:F.#s.getOutlines(i*n,s*n,n,this._INNER_MARGIN),drawingOptions:F.#a,mustBeCommitted:!t});return this._cleanup(!0),r}return e.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(t){}static deserializeDraw(t,e,i,s,n,r){J("Not implemented")}static async deserialize(t,e,i){const{rawDims:{pageWidth:s,pageHeight:n,pageX:r,pageY:a}}=e.viewport,l=this.deserializeDraw(r,a,s,n,this._INNER_MARGIN,t),c=await super.deserialize(t,e,i);return c.createDrawingOptions(t),c.#l({drawOutlines:l}),c.#p(),c.onScaleChanging(),c.rotate(),c}serializeDraw(t){const[e,i]=this.pageTranslation,[s,n]=this.pageDimensions;return this.#t.serialize([e,i,s,n],t)}renderAnnotationElement(t){return t.updateEdited({rect:this.getPDFRect()}),null}static canCreateNewEmptyEditor(){return!1}}class gc{#t=new Float64Array(6);#e;#s;#i;#a;#n;#r="";#o=0;#c=new pi;#l;#u;constructor(t,e,i,s,n,r){this.#l=i,this.#u=s,this.#i=n,this.#a=r,[t,e]=this.#d(t,e);const a=this.#e=[NaN,NaN,NaN,NaN,t,e];this.#n=[t,e],this.#s=[{line:a,points:this.#n}],this.#t.set(a,0)}updateProperty(t,e){t==="stroke-width"&&(this.#a=e)}#d(t,e){return D._normalizePoint(t,e,this.#l,this.#u,this.#i)}isEmpty(){return!this.#s||this.#s.length===0}isCancellable(){return this.#n.length<=10}add(t,e){[t,e]=this.#d(t,e);const[i,s,n,r]=this.#t.subarray(2,6),a=t-n,l=e-r;return Math.hypot(this.#l*a,this.#u*l)<=2?null:(this.#n.push(t,e),isNaN(i)?(this.#t.set([n,r,t,e],2),this.#e.push(NaN,NaN,NaN,NaN,t,e),{path:{d:this.toSVGPath()}}):(isNaN(this.#t[0])&&this.#e.splice(6,6),this.#t.set([i,s,n,r,t,e],0),this.#e.push(...D.createBezierPoints(i,s,n,r,t,e)),{path:{d:this.toSVGPath()}}))}end(t,e){const i=this.add(t,e);return i||(this.#n.length===2?{path:{d:this.toSVGPath()}}:null)}startNew(t,e,i,s,n){this.#l=i,this.#u=s,this.#i=n,[t,e]=this.#d(t,e);const r=this.#e=[NaN,NaN,NaN,NaN,t,e];this.#n=[t,e];const a=this.#s.at(-1);return a&&(a.line=new Float32Array(a.line),a.points=new Float32Array(a.points)),this.#s.push({line:r,points:this.#n}),this.#t.set(r,0),this.#o=0,this.toSVGPath(),null}getLastElement(){return this.#s.at(-1)}setLastElement(t){return this.#s?(this.#s.push(t),this.#e=t.line,this.#n=t.points,this.#o=0,{path:{d:this.toSVGPath()}}):this.#c.setLastElement(t)}removeLastElement(){if(!this.#s)return this.#c.removeLastElement();this.#s.pop(),this.#r="";for(let t=0,e=this.#s.length;t<e;t++){const{line:i,points:s}=this.#s[t];this.#e=i,this.#n=s,this.#o=0,this.toSVGPath()}return{path:{d:this.#r}}}toSVGPath(){const t=D.svgRound(this.#e[4]),e=D.svgRound(this.#e[5]);if(this.#n.length===2)return this.#r=`${this.#r} M ${t} ${e} Z`,this.#r;if(this.#n.length<=6){const s=this.#r.lastIndexOf("M");this.#r=`${this.#r.slice(0,s)} M ${t} ${e}`,this.#o=6}if(this.#n.length===4){const s=D.svgRound(this.#e[10]),n=D.svgRound(this.#e[11]);return this.#r=`${this.#r} L ${s} ${n}`,this.#o=12,this.#r}const i=[];this.#o===0&&(i.push(`M ${t} ${e}`),this.#o=6);for(let s=this.#o,n=this.#e.length;s<n;s+=6){const[r,a,l,c,h,d]=this.#e.slice(s,s+6).map(D.svgRound);i.push(`C${r} ${a} ${l} ${c} ${h} ${d}`)}return this.#r+=i.join(" "),this.#o=this.#e.length,this.#r}getOutlines(t,e,i,s){const n=this.#s.at(-1);return n.line=new Float32Array(n.line),n.points=new Float32Array(n.points),this.#c.build(this.#s,t,e,i,this.#i,this.#a,s),this.#t=null,this.#e=null,this.#s=null,this.#r=null,this.#c}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}class pi extends D{#t;#e=0;#s;#i;#a;#n;#r;#o;#c;build(t,e,i,s,n,r,a){this.#a=e,this.#n=i,this.#r=s,this.#o=n,this.#c=r,this.#s=a??0,this.#i=t,this.#d()}get thickness(){return this.#c}setLastElement(t){return this.#i.push(t),{path:{d:this.toSVGPath()}}}removeLastElement(){return this.#i.pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const t=[];for(const{line:e}of this.#i){if(t.push(`M${D.svgRound(e[4])} ${D.svgRound(e[5])}`),e.length===6){t.push("Z");continue}if(e.length===12&&isNaN(e[6])){t.push(`L${D.svgRound(e[10])} ${D.svgRound(e[11])}`);continue}for(let i=6,s=e.length;i<s;i+=6){const[n,r,a,l,c,h]=e.subarray(i,i+6).map(D.svgRound);t.push(`C${n} ${r} ${a} ${l} ${c} ${h}`)}}return t.join("")}serialize([t,e,i,s],n){const r=[],a=[],[l,c,h,d]=this.#u();let u,p,m,g,y,b,v,w,A;switch(this.#o){case 0:A=D._rescale,u=t,p=e+s,m=i,g=-s,y=t+l*i,b=e+(1-c-d)*s,v=t+(l+h)*i,w=e+(1-c)*s;break;case 90:A=D._rescaleAndSwap,u=t,p=e,m=i,g=s,y=t+c*i,b=e+l*s,v=t+(c+d)*i,w=e+(l+h)*s;break;case 180:A=D._rescale,u=t+i,p=e,m=-i,g=s,y=t+(1-l-h)*i,b=e+c*s,v=t+(1-l)*i,w=e+(c+d)*s;break;case 270:A=D._rescaleAndSwap,u=t+i,p=e+s,m=-i,g=-s,y=t+(1-c-d)*i,b=e+(1-l-h)*s,v=t+(1-c)*i,w=e+(1-l)*s;break}for(const{line:x,points:S}of this.#i)r.push(A(x,u,p,m,g,n?new Array(x.length):null)),a.push(A(S,u,p,m,g,n?new Array(S.length):null));return{lines:r,points:a,rect:[y,b,v,w]}}static deserialize(t,e,i,s,n,{paths:{lines:r,points:a},rotation:l,thickness:c}){const h=[];let d,u,p,m,g;switch(l){case 0:g=D._rescale,d=-t/i,u=e/s+1,p=1/i,m=-1/s;break;case 90:g=D._rescaleAndSwap,d=-e/s,u=-t/i,p=1/s,m=1/i;break;case 180:g=D._rescale,d=t/i+1,u=-e/s,p=-1/i,m=1/s;break;case 270:g=D._rescaleAndSwap,d=e/s+1,u=t/i+1,p=-1/s,m=-1/i;break}if(!r){r=[];for(const b of a){const v=b.length;if(v===2){r.push(new Float32Array([NaN,NaN,NaN,NaN,b[0],b[1]]));continue}if(v===4){r.push(new Float32Array([NaN,NaN,NaN,NaN,b[0],b[1],NaN,NaN,NaN,NaN,b[2],b[3]]));continue}const w=new Float32Array(3*(v-2));r.push(w);let[A,x,S,k]=b.subarray(0,4);w.set([NaN,NaN,NaN,NaN,A,x],0);for(let _=4;_<v;_+=2){const E=b[_],L=b[_+1];w.set(D.createBezierPoints(A,x,S,k,E,L),(_-2)*3),[A,x,S,k]=[S,k,E,L]}}}for(let b=0,v=r.length;b<v;b++)h.push({line:g(r[b].map(w=>w??NaN),d,u,p,m),points:g(a[b].map(w=>w??NaN),d,u,p,m)});const y=new this.prototype.constructor;return y.build(h,i,s,1,l,c,n),y}#l(t=this.#c){const e=this.#s+t/2*this.#r;return this.#o%180===0?[e/this.#a,e/this.#n]:[e/this.#n,e/this.#a]}#u(){const[t,e,i,s]=this.#t,[n,r]=this.#l(0);return[t+n,e+r,i-2*n,s-2*r]}#d(){const t=this.#t=new Float32Array([1/0,1/0,-1/0,-1/0]);for(const{line:s}of this.#i){if(s.length<=12){for(let a=4,l=s.length;a<l;a+=6)N.pointBoundingBox(s[a],s[a+1],t);continue}let n=s[4],r=s[5];for(let a=6,l=s.length;a<l;a+=6){const[c,h,d,u,p,m]=s.subarray(a,a+6);N.bezierBoundingBox(n,r,c,h,d,u,p,m,t),n=p,r=m}}const[e,i]=this.#l();t[0]=xt(t[0]-e,0,1),t[1]=xt(t[1]-i,0,1),t[2]=xt(t[2]+e,0,1),t[3]=xt(t[3]+i,0,1),t[2]-=t[0],t[3]-=t[1]}get box(){return this.#t}updateProperty(t,e){return t==="stroke-width"?this.#p(e):null}#p(t){const[e,i]=this.#l();this.#c=t;const[s,n]=this.#l(),[r,a]=[s-e,n-i],l=this.#t;return l[0]-=r,l[1]-=a,l[2]+=2*r,l[3]+=2*a,l}updateParentDimensions([t,e],i){const[s,n]=this.#l();this.#a=t,this.#n=e,this.#r=i;const[r,a]=this.#l(),l=r-s,c=a-n,h=this.#t;return h[0]-=l,h[1]-=c,h[2]+=2*l,h[3]+=2*c,h}updateRotation(t){return this.#e=t,{path:{transform:this.rotationTransform}}}get viewBox(){return this.#t.map(D.svgRound).join(" ")}get defaultProperties(){const[t,e]=this.#t;return{root:{viewBox:this.viewBox},path:{"transform-origin":`${D.svgRound(t)} ${D.svgRound(e)}`}}}get rotationTransform(){const[,,t,e]=this.#t;let i=0,s=0,n=0,r=0,a=0,l=0;switch(this.#e){case 90:s=e/t,n=-t/e,a=t;break;case 180:i=-1,r=-1,a=t,l=e;break;case 270:s=-e/t,n=t/e,l=e;break;default:return""}return`matrix(${i} ${s} ${n} ${r} ${D.svgRound(a)} ${D.svgRound(l)})`}getPathResizingSVGProperties([t,e,i,s]){const[n,r]=this.#l(),[a,l,c,h]=this.#t;if(Math.abs(c-n)<=D.PRECISION||Math.abs(h-r)<=D.PRECISION){const g=t+i/2-(a+c/2),y=e+s/2-(l+h/2);return{path:{"transform-origin":`${D.svgRound(t)} ${D.svgRound(e)}`,transform:`${this.rotationTransform} translate(${g} ${y})`}}}const d=(i-2*n)/(c-2*n),u=(s-2*r)/(h-2*r),p=c/i,m=h/s;return{path:{"transform-origin":`${D.svgRound(a)} ${D.svgRound(l)}`,transform:`${this.rotationTransform} scale(${p} ${m}) translate(${D.svgRound(n)} ${D.svgRound(r)}) scale(${d} ${u}) translate(${D.svgRound(-n)} ${D.svgRound(-r)})`}}}getPathResizedSVGProperties([t,e,i,s]){const[n,r]=this.#l(),a=this.#t,[l,c,h,d]=a;if(a[0]=t,a[1]=e,a[2]=i,a[3]=s,Math.abs(h-n)<=D.PRECISION||Math.abs(d-r)<=D.PRECISION){const y=t+i/2-(l+h/2),b=e+s/2-(c+d/2);for(const{line:v,points:w}of this.#i)D._translate(v,y,b,v),D._translate(w,y,b,w);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${D.svgRound(t)} ${D.svgRound(e)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const u=(i-2*n)/(h-2*n),p=(s-2*r)/(d-2*r),m=-u*(l+n)+t+n,g=-p*(c+r)+e+r;if(u!==1||p!==1||m!==0||g!==0)for(const{line:y,points:b}of this.#i)D._rescale(y,m,g,u,p,y),D._rescale(b,m,g,u,p,b);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${D.svgRound(t)} ${D.svgRound(e)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([t,e],i){const[s,n]=i,r=this.#t,a=t-r[0],l=e-r[1];if(this.#a===s&&this.#n===n)for(const{line:c,points:h}of this.#i)D._translate(c,a,l,c),D._translate(h,a,l,h);else{const c=this.#a/s,h=this.#n/n;this.#a=s,this.#n=n;for(const{line:d,points:u}of this.#i)D._rescale(d,a,l,c,h,d),D._rescale(u,a,l,c,h,u);r[2]*=c,r[3]*=h}return r[0]=t,r[1]=e,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${D.svgRound(t)} ${D.svgRound(e)}`}}}get defaultSVGProperties(){const t=this.#t;return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${D.svgRound(t[0])} ${D.svgRound(t[1])}`,transform:this.rotationTransform||null},bbox:t}}}class Gi extends Fr{constructor(t){super(),this._viewParameters=t,super.updateProperties({fill:"none",stroke:I._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(t,e){t==="stroke-width"&&(e??=this["stroke-width"],e*=this._viewParameters.realScale),super.updateSVGProperty(t,e)}clone(){const t=new Gi(this._viewParameters);return t.updateAll(this),t}}class Gs extends F{static _type="ink";static _editorType=j.INK;static _defaultDrawingOptions=null;constructor(t){super({...t,name:"inkEditor"}),this._willKeepAspectRatio=!0,this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(t,e){I.initialize(t,e),this._defaultDrawingOptions=new Gi(e.viewParameters)}static getDefaultDrawingOptions(t){const e=this._defaultDrawingOptions.clone();return e.updateProperties(t),e}static get supportMultipleDrawings(){return!0}static get typesMap(){return z(this,"typesMap",new Map([[V.INK_THICKNESS,"stroke-width"],[V.INK_COLOR,"stroke"],[V.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(t,e,i,s,n){return new gc(t,e,i,s,n,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(t,e,i,s,n,r){return pi.deserialize(t,e,i,s,n,r)}static async deserialize(t,e,i){let s=null;if(t instanceof Us){const{data:{inkLists:r,rect:a,rotation:l,id:c,color:h,opacity:d,borderStyle:{rawWidth:u},popupRef:p,richText:m,contentsObj:g,creationDate:y,modificationDate:b},parent:{page:{pageNumber:v}}}=t;s=t={annotationType:j.INK,color:Array.from(h),thickness:u,opacity:d,paths:{points:r},boxes:null,pageIndex:v-1,rect:a.slice(0),rotation:l,annotationElementId:c,id:c,deleted:!1,popupRef:p,richText:m,comment:g?.str||null,creationDate:y,modificationDate:b}}const n=await super.deserialize(t,e,i);return n._initialData=s,t.comment&&n.setCommentData(t),n}get toolbarButtons(){return this._colorPicker||=new ni(this),[["colorPicker",this._colorPicker]]}get colorType(){return V.INK_COLOR}get color(){return this._drawingOptions.stroke}get opacity(){return this._drawingOptions["stroke-opacity"]}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:t,_drawingOptions:e,parent:i}=this;e.updateSVGProperty("stroke-width"),i.drawLayer.updateProperties(t,e.toSVGProperties())}static onScaleChangingWhenDrawing(){const t=this._currentParent;t&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),t.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:t,thickness:e,opacity:i}){this._drawingOptions=Gs.getDefaultDrawingOptions({stroke:N.makeHexColor(...t),"stroke-width":e,"stroke-opacity":i})}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:e,points:i}=this.serializeDraw(t),{_drawingOptions:{stroke:s,"stroke-opacity":n,"stroke-width":r}}=this,a=Object.assign(super.serialize(t),{color:I._colorManager.convert(s),opacity:n,thickness:r,paths:{lines:e,points:i}});return this.addComment(a),t?(a.isCopy=!0,a):this.annotationElementId&&!this.#t(a)?null:(a.id=this.annotationElementId,a)}#t(t){const{color:e,thickness:i,opacity:s,pageIndex:n}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized||t.color.some((r,a)=>r!==e[a])||t.thickness!==i||t.opacity!==s||t.pageIndex!==n}renderAnnotationElement(t){if(this.deleted)return t.hide(),null;const{points:e,rect:i}=this.serializeDraw(!1);return t.updateEdited({rect:i,thickness:this._drawingOptions["stroke-width"],points:e,popup:this.comment}),null}}class vs extends pi{toSVGPath(){let t=super.toSVGPath();return t.endsWith("Z")||(t+="Z"),t}}const Ci=8,Ve=3;class de{static#t={maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16};static#e(t,e,i,s){return i-=t,s-=e,i===0?s>0?0:4:i===1?s+6:2-s}static#s=new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]);static#i(t,e,i,s,n,r,a){const l=this.#e(i,s,n,r);for(let c=0;c<8;c++){const h=(-c+l-a+16)%8,d=this.#s[2*h],u=this.#s[2*h+1];if(t[(i+d)*e+(s+u)]!==0)return h}return-1}static#a(t,e,i,s,n,r,a){const l=this.#e(i,s,n,r);for(let c=0;c<8;c++){const h=(c+l+a+16)%8,d=this.#s[2*h],u=this.#s[2*h+1];if(t[(i+d)*e+(s+u)]!==0)return h}return-1}static#n(t,e,i,s){const n=t.length,r=new Int32Array(n);for(let h=0;h<n;h++)r[h]=t[h]<=s?1:0;for(let h=1;h<i-1;h++)r[h*e]=r[h*e+e-1]=0;for(let h=0;h<e;h++)r[h]=r[e*i-1-h]=0;let a=1,l;const c=[];for(let h=1;h<i-1;h++){l=1;for(let d=1;d<e-1;d++){const u=h*e+d,p=r[u];if(p===0)continue;let m=h,g=d;if(p===1&&r[u-1]===0)a+=1,g-=1;else if(p>=1&&r[u+1]===0)a+=1,g+=1,p>1&&(l=p);else{p!==1&&(l=Math.abs(p));continue}const y=[d,h],b=g===d+1,v={isHole:b,points:y,id:a,parent:0};c.push(v);let w;for(const P of c)if(P.id===l){w=P;break}w?w.isHole?v.parent=b?w.parent:l:v.parent=b?l:w.parent:v.parent=b?l:0;const A=this.#i(r,e,h,d,m,g,0);if(A===-1){r[u]=-a,r[u]!==1&&(l=Math.abs(r[u]));continue}let x=this.#s[2*A],S=this.#s[2*A+1];const k=h+x,_=d+S;m=k,g=_;let E=h,L=d;for(;;){const P=this.#a(r,e,E,L,m,g,1);x=this.#s[2*P],S=this.#s[2*P+1];const G=E+x,H=L+S;y.push(H,G);const O=E*e+L;if(r[O+1]===0?r[O]=-a:r[O]===1&&(r[O]=a),G===h&&H===d&&E===k&&L===_){r[u]!==1&&(l=Math.abs(r[u]));break}else m=E,g=L,E=G,L=H}}}return c}static#r(t,e,i,s){if(i-e<=4){for(let k=e;k<i-2;k+=2)s.push(t[k],t[k+1]);return}const n=t[e],r=t[e+1],a=t[i-4]-n,l=t[i-3]-r,c=Math.hypot(a,l),h=a/c,d=l/c,u=h*r-d*n,p=l/a,m=1/c,g=Math.atan(p),y=Math.cos(g),b=Math.sin(g),v=m*(Math.abs(y)+Math.abs(b)),w=m*(1-v+v**2),A=Math.max(Math.atan(Math.abs(b+y)*w),Math.atan(Math.abs(b-y)*w));let x=0,S=e;for(let k=e+2;k<i-2;k+=2){const _=Math.abs(u-h*t[k+1]+d*t[k]);_>x&&(S=k,x=_)}x>(c*A)**2?(this.#r(t,e,S+2,s),this.#r(t,S,i,s)):s.push(n,r)}static#o(t){const e=[],i=t.length;return this.#r(t,0,i,e),e.push(t[i-2],t[i-1]),e.length<=4?null:e}static#c(t,e,i,s,n,r){const a=new Float32Array(r**2),l=-2*s**2,c=r>>1;for(let g=0;g<r;g++){const y=(g-c)**2;for(let b=0;b<r;b++)a[g*r+b]=Math.exp((y+(b-c)**2)/l)}const h=new Float32Array(256),d=-2*n**2;for(let g=0;g<256;g++)h[g]=Math.exp(g**2/d);const u=t.length,p=new Uint8Array(u),m=new Uint32Array(256);for(let g=0;g<i;g++)for(let y=0;y<e;y++){const b=g*e+y,v=t[b];let w=0,A=0;for(let S=0;S<r;S++){const k=g+S-c;if(!(k<0||k>=i))for(let _=0;_<r;_++){const E=y+_-c;if(E<0||E>=e)continue;const L=t[k*e+E],P=a[S*r+_]*h[Math.abs(L-v)];w+=L*P,A+=P}}const x=p[b]=Math.round(w/A);m[x]++}return[p,m]}static#l(t){const e=new Uint32Array(256);for(const i of t)e[i]++;return e}static#u(t){const e=t.length,i=new Uint8ClampedArray(e>>2);let s=-1/0,n=1/0;for(let a=0,l=i.length;a<l;a++){const c=i[a]=t[a<<2];s=Math.max(s,c),n=Math.min(n,c)}const r=255/(s-n);for(let a=0,l=i.length;a<l;a++)i[a]=(i[a]-n)*r;return i}static#d(t){let e,i=-1/0,s=-1/0;const n=t.findIndex(l=>l!==0);let r=n,a=n;for(e=n;e<256;e++){const l=t[e];l>i&&(e-r>s&&(s=e-r,a=e-1),i=l,r=e)}for(e=a-1;e>=0&&!(t[e]>t[e+1]);e--);return e}static#p(t){const e=t,{width:i,height:s}=t,{maxDim:n}=this.#t;let r=i,a=s;if(i>n||s>n){let u=i,p=s,m=Math.log2(Math.max(i,s)/n);const g=Math.floor(m);m=m===g?g-1:g;for(let b=0;b<m;b++){r=Math.ceil(u/2),a=Math.ceil(p/2);const v=new OffscreenCanvas(r,a);v.getContext("2d").drawImage(t,0,0,u,p,0,0,r,a),u=r,p=a,t!==e&&t.close(),t=v.transferToImageBitmap()}const y=Math.min(n/r,n/a);r=Math.round(r*y),a=Math.round(a*y)}const c=new OffscreenCanvas(r,a).getContext("2d",{willReadFrequently:!0});c.fillStyle="white",c.fillRect(0,0,r,a),c.filter="grayscale(1)",c.drawImage(t,0,0,t.width,t.height,0,0,r,a);const h=c.getImageData(0,0,r,a).data;return[this.#u(h),r,a]}static extractContoursFromText(t,{fontFamily:e,fontStyle:i,fontWeight:s},n,r,a,l){let c=new OffscreenCanvas(1,1),h=c.getContext("2d",{alpha:!1});const d=200,u=h.font=`${i} ${s} ${d}px ${e}`,{actualBoundingBoxLeft:p,actualBoundingBoxRight:m,actualBoundingBoxAscent:g,actualBoundingBoxDescent:y,fontBoundingBoxAscent:b,fontBoundingBoxDescent:v,width:w}=h.measureText(t),A=1.5,x=Math.ceil(Math.max(Math.abs(p)+Math.abs(m)||0,w)*A),S=Math.ceil(Math.max(Math.abs(g)+Math.abs(y)||d,Math.abs(b)+Math.abs(v)||d)*A);c=new OffscreenCanvas(x,S),h=c.getContext("2d",{alpha:!0,willReadFrequently:!0}),h.font=u,h.filter="grayscale(1)",h.fillStyle="white",h.fillRect(0,0,x,S),h.fillStyle="black",h.fillText(t,x*(A-1)/2,S*(3-A)/2);const k=this.#u(h.getImageData(0,0,x,S).data),_=this.#l(k),E=this.#d(_),L=this.#n(k,x,S,E);return this.processDrawnLines({lines:{curves:L,width:x,height:S},pageWidth:n,pageHeight:r,rotation:a,innerMargin:l,mustSmooth:!0,areContours:!0})}static process(t,e,i,s,n){const[r,a,l]=this.#p(t),[c,h]=this.#c(r,a,l,Math.hypot(a,l)*this.#t.sigmaSFactor,this.#t.sigmaR,this.#t.kernelSize),d=this.#d(h),u=this.#n(c,a,l,d);return this.processDrawnLines({lines:{curves:u,width:a,height:l},pageWidth:e,pageHeight:i,rotation:s,innerMargin:n,mustSmooth:!0,areContours:!0})}static processDrawnLines({lines:t,pageWidth:e,pageHeight:i,rotation:s,innerMargin:n,mustSmooth:r,areContours:a}){s%180!==0&&([e,i]=[i,e]);const{curves:l,width:c,height:h}=t,d=t.thickness??0,u=[],p=Math.min(e/c,i/h),m=p/e,g=p/i,y=[];for(const{points:v}of l){const w=r?this.#o(v):v;if(!w)continue;y.push(w);const A=w.length,x=new Float32Array(A),S=new Float32Array(3*(A===2?2:A-2));if(u.push({line:S,points:x}),A===2){x[0]=w[0]*m,x[1]=w[1]*g,S.set([NaN,NaN,NaN,NaN,x[0],x[1]],0);continue}let[k,_,E,L]=w;k*=m,_*=g,E*=m,L*=g,x.set([k,_,E,L],0),S.set([NaN,NaN,NaN,NaN,k,_],0);for(let P=4;P<A;P+=2){const G=x[P]=w[P]*m,H=x[P+1]=w[P+1]*g;S.set(D.createBezierPoints(k,_,E,L,G,H),(P-2)*3),[k,_,E,L]=[E,L,G,H]}}if(u.length===0)return null;const b=a?new vs:new pi;return b.build(u,e,i,1,s,a?0:d,n),{outline:b,newCurves:y,areContours:a,thickness:d,width:c,height:h}}static async compressSignature({outlines:t,areContours:e,thickness:i,width:s,height:n}){let r=1/0,a=-1/0,l=0;for(const w of t){l+=w.length;for(let A=2,x=w.length;A<x;A++){const S=w[A]-w[A-2];r=Math.min(r,S),a=Math.max(a,S)}}let c;r>=-128&&a<=127?c=Int8Array:r>=-32768&&a<=32767?c=Int16Array:c=Int32Array;const h=t.length,d=Ci+Ve*h,u=new Uint32Array(d);let p=0;u[p++]=d*Uint32Array.BYTES_PER_ELEMENT+(l-2*h)*c.BYTES_PER_ELEMENT,u[p++]=0,u[p++]=s,u[p++]=n,u[p++]=e?0:1,u[p++]=Math.max(0,Math.floor(i??0)),u[p++]=h,u[p++]=c.BYTES_PER_ELEMENT;for(const w of t)u[p++]=w.length-2,u[p++]=w[0],u[p++]=w[1];const m=new CompressionStream("deflate-raw"),g=m.writable.getWriter();await g.ready,g.write(u);const y=c.prototype.constructor;for(const w of t){const A=new y(w.length-2);for(let x=2,S=w.length;x<S;x++)A[x-2]=w[x]-w[x-2];g.write(A)}g.close();const b=await new Response(m.readable).arrayBuffer(),v=new Uint8Array(b);return sr(v)}static async decompressSignature(t){try{const e=Ho(t),{readable:i,writable:s}=new DecompressionStream("deflate-raw"),n=s.getWriter();await n.ready,n.write(e).then(async()=>{await n.ready,await n.close()}).catch(()=>{});let r=null,a=0;for await(const w of i)r||=new Uint8Array(new Uint32Array(w.buffer,0,4)[0]),r.set(w,a),a+=w.length;const l=new Uint32Array(r.buffer,0,r.length>>2),c=l[1];if(c!==0)throw new Error(`Invalid version: ${c}`);const h=l[2],d=l[3],u=l[4]===0,p=l[5],m=l[6],g=l[7],y=[],b=(Ci+Ve*m)*Uint32Array.BYTES_PER_ELEMENT;let v;switch(g){case Int8Array.BYTES_PER_ELEMENT:v=new Int8Array(r.buffer,b);break;case Int16Array.BYTES_PER_ELEMENT:v=new Int16Array(r.buffer,b);break;case Int32Array.BYTES_PER_ELEMENT:v=new Int32Array(r.buffer,b);break}a=0;for(let w=0;w<m;w++){const A=l[Ve*w+Ci],x=new Float32Array(A+2);y.push(x);for(let S=0;S<Ve-1;S++)x[S]=l[Ve*w+Ci+S+1];for(let S=0;S<A;S++)x[S+2]=x[S]+v[a++]}return{areContours:u,thickness:p,outlines:y,width:h,height:d}}catch(e){return B(`decompressSignature: ${e}`),null}}}class $s extends Fr{constructor(){super(),super.updateProperties({fill:I._defaultLineColor,"stroke-width":0})}clone(){const t=new $s;return t.updateAll(this),t}}class Vs extends Gi{constructor(t){super(t),super.updateProperties({stroke:I._defaultLineColor,"stroke-width":1})}clone(){const t=new Vs(this._viewParameters);return t.updateAll(this),t}}class Xt extends F{#t=!1;#e=null;#s=null;#i=null;static _type="signature";static _editorType=j.SIGNATURE;static _defaultDrawingOptions=null;constructor(t){super({...t,mustBeCommitted:!0,name:"signatureEditor"}),this._willKeepAspectRatio=!0,this.#s=t.signatureData||null,this.#e=null,this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(t,e){I.initialize(t,e),this._defaultDrawingOptions=new $s,this._defaultDrawnSignatureOptions=new Vs(e.viewParameters)}static getDefaultDrawingOptions(t){const e=this._defaultDrawingOptions.clone();return e.updateProperties(t),e}static get supportMultipleDrawings(){return!1}static get typesMap(){return z(this,"typesMap",new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:"signature",hasDescription:!!this.#e}}static computeTelemetryFinalData(t){const e=t.get("hasDescription");return{hasAltText:e.get(!0)??0,hasNoAltText:e.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){this._drawId!==null&&super.onScaleChanging()}render(){if(this.div)return this.div;let t,e;const{_isCopy:i}=this;if(i&&(this._isCopy=!1,t=this.x,e=this.y),super.render(),this._drawId===null)if(this.#s){const{lines:s,mustSmooth:n,areContours:r,description:a,uuid:l,heightInPage:c}=this.#s,{rawDims:{pageWidth:h,pageHeight:d},rotation:u}=this.parent.viewport,p=de.processDrawnLines({lines:s,pageWidth:h,pageHeight:d,rotation:u,innerMargin:Xt._INNER_MARGIN,mustSmooth:n,areContours:r});this.addSignature(p,c,a,l)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this);else this.div.setAttribute("data-l10n-args",JSON.stringify({description:this.#e||""}));return i&&(this._isCopy=!0,this._moveAfterPaste(t,e)),this.div}setUuid(t){this.#i=t,this.addEditToolbar()}getUuid(){return this.#i}get description(){return this.#e}set description(t){this.#e=t,this.div&&(this.div.setAttribute("data-l10n-args",JSON.stringify({description:t})),super.addEditToolbar().then(e=>{e?.updateEditSignatureButton(t)}))}getSignaturePreview(){const{newCurves:t,areContours:e,thickness:i,width:s,height:n}=this.#s,r=Math.max(s,n),a=de.processDrawnLines({lines:{curves:t.map(l=>({points:l})),thickness:i,width:s,height:n},pageWidth:r,pageHeight:r,rotation:0,innerMargin:0,mustSmooth:!1,areContours:e});return{areContours:e,outline:a.outline}}get toolbarButtons(){return this._uiManager.signatureManager?[["editSignature",this._uiManager.signatureManager]]:super.toolbarButtons}addSignature(t,e,i,s){const{x:n,y:r}=this,{outline:a}=this.#s=t;this.#t=a instanceof vs,this.description=i;let l;this.#t?l=Xt.getDefaultDrawingOptions():(l=Xt._defaultDrawnSignatureOptions.clone(),l.updateProperties({"stroke-width":a.thickness})),this._addOutlines({drawOutlines:a,drawingOptions:l});const[,c]=this.pageDimensions;let h=e/c;h=h>=1?.5:h,this.width*=h/this.height,this.width>=1&&(h*=.9/this.width,this.width=.9),this.height=h,this.setDims(),this.x=n,this.y=r,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(s),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!s,hasDescription:!!i}}),this.div.hidden=!1}getFromImage(t){const{rawDims:{pageWidth:e,pageHeight:i},rotation:s}=this.parent.viewport;return de.process(t,e,i,s,Xt._INNER_MARGIN)}getFromText(t,e){const{rawDims:{pageWidth:i,pageHeight:s},rotation:n}=this.parent.viewport;return de.extractContoursFromText(t,e,i,s,n,Xt._INNER_MARGIN)}getDrawnSignature(t){const{rawDims:{pageWidth:e,pageHeight:i},rotation:s}=this.parent.viewport;return de.processDrawnLines({lines:t,pageWidth:e,pageHeight:i,rotation:s,innerMargin:Xt._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions({areContours:t,thickness:e}){t?this._drawingOptions=Xt.getDefaultDrawingOptions():(this._drawingOptions=Xt._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":e}))}serialize(t=!1){if(this.isEmpty())return null;const{lines:e,points:i}=this.serializeDraw(t),{_drawingOptions:{"stroke-width":s}}=this,n=Object.assign(super.serialize(t),{isSignature:!0,areContours:this.#t,color:[0,0,0],thickness:this.#t?0:s});return this.addComment(n),t?(n.paths={lines:e,points:i},n.uuid=this.#i,n.isCopy=!0):n.lines=e,this.#e&&(n.accessibilityData={type:"Figure",alt:this.#e}),n}static deserializeDraw(t,e,i,s,n,r){return r.areContours?vs.deserialize(t,e,i,s,n,r):pi.deserialize(t,e,i,s,n,r)}static async deserialize(t,e,i){const s=await super.deserialize(t,e,i);return s.#t=t.areContours,s.description=t.accessibilityData?.alt||"",s.#i=t.uuid,s}}class mc extends I{#t=null;#e=null;#s=null;#i=null;#a=null;#n="";#r=null;#o=!1;#c=null;#l=!1;#u=!1;static _type="stamp";static _editorType=j.STAMP;constructor(t){super({...t,name:"stampEditor"}),this.#i=t.bitmapUrl,this.#a=t.bitmapFile,this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(t,e){I.initialize(t,e)}static isHandlingMimeForPasting(t){return Ii.includes(t)}static paste(t,e){e.pasteEditor({mode:j.STAMP},{bitmapFile:t.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){return{type:"stamp",hasAltText:!!this.altTextData?.altText}}static computeTelemetryFinalData(t){const e=t.get("hasAltText");return{hasAltText:e.get(!0)??0,hasNoAltText:e.get(!1)??0}}#d(t,e=!1){if(!t){this.remove();return}this.#t=t.bitmap,e||(this.#e=t.id,this.#l=t.isSvg),t.file&&(this.#n=t.file.name),this.#f()}#p(){if(this.#s=null,this._uiManager.enableWaiting(!1),!!this.#r){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#t){this.addEditToolbar().then(()=>{this._editToolbar.hide(),this._uiManager.editAltText(this,!0)});return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#t){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}}async mlGuessAltText(t=null,e=!0){if(this.hasAltTextData())return null;const{mlManager:i}=this._uiManager;if(!i)throw new Error("No ML.");if(!await i.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:s,width:n,height:r}=t||this.copyCanvas(null,null,!0).imageData,a=await i.guess({name:"altText",request:{data:s,width:n,height:r,channels:s.length/(n*r)}});if(!a)throw new Error("No response from the AI service.");if(a.error)throw new Error("Error from the AI service.");if(a.cancel)return null;if(!a.output)throw new Error("No valid response from the AI service.");const l=a.output;return await this.setGuessedAltText(l),e&&!this.hasAltTextData()&&(this.altTextData={alt:l,decorative:!1}),l}#m(){if(this.#e){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(this.#e).then(i=>this.#d(i,!0)).finally(()=>this.#p());return}if(this.#i){const i=this.#i;this.#i=null,this._uiManager.enableWaiting(!0),this.#s=this._uiManager.imageManager.getFromUrl(i).then(s=>this.#d(s)).finally(()=>this.#p());return}if(this.#a){const i=this.#a;this.#a=null,this._uiManager.enableWaiting(!0),this.#s=this._uiManager.imageManager.getFromFile(i).then(s=>this.#d(s)).finally(()=>this.#p());return}const t=document.createElement("input");t.type="file",t.accept=Ii.join(",");const e=this._uiManager._signal;this.#s=new Promise(i=>{t.addEventListener("change",async()=>{if(!t.files||t.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const s=await this._uiManager.imageManager.getFromFile(t.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),this.#d(s)}i()},{signal:e}),t.addEventListener("cancel",()=>{this.remove(),i()},{signal:e})}).finally(()=>this.#p()),t.click()}remove(){this.#e&&(this.#t=null,this._uiManager.imageManager.deleteId(this.#e),this.#r?.remove(),this.#r=null,this.#c&&(clearTimeout(this.#c),this.#c=null)),super.remove()}rebuild(){if(!this.parent){this.#e&&this.#m();return}super.rebuild(),this.div!==null&&(this.#e&&this.#r===null&&this.#m(),this.isAttachedToDOM||this.parent.add(this))}onceAdded(t){this._isDraggable=!0,t&&this.div.focus()}isEmpty(){return!(this.#s||this.#t||this.#i||this.#a||this.#e||this.#o)}get toolbarButtons(){return[["altText",this.createAltText()]]}get isResizable(){return!0}render(){if(this.div)return this.div;let t,e;return this._isCopy&&(t=this.x,e=this.y),super.render(),this.div.hidden=!0,this.createAltText(),this.#o||(this.#t?this.#f():this.#m()),this._isCopy&&this._moveAfterPaste(t,e),this._uiManager.addShouldRescale(this),this.div}setCanvas(t,e){const{id:i,bitmap:s}=this._uiManager.imageManager.getFromCanvas(t,e);e.remove(),i&&this._uiManager.imageManager.isValidId(i)&&(this.#e=i,s&&(this.#t=s),this.#o=!1,this.#f())}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;this.#c!==null&&clearTimeout(this.#c);const t=200;this.#c=setTimeout(()=>{this.#c=null,this.#g()},t)}#f(){const{div:t}=this;let{width:e,height:i}=this.#t;const[s,n]=this.pageDimensions,r=.75;if(this.width)e=this.width*s,i=this.height*n;else if(e>r*s||i>r*n){const l=Math.min(r*s/e,r*n/i);e*=l,i*=l}this._uiManager.enableWaiting(!1);const a=this.#r=document.createElement("canvas");a.setAttribute("role","img"),this.addContainer(a),this.width=e/s,this.height=i/n,this.setDims(),this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(t.hidden=!1),this.#g(),this.#u||(this.parent.addUndoableEditor(this),this.#u=!0),this._reportTelemetry({action:"inserted_image"}),this.#n&&this.div.setAttribute("aria-description",this.#n),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-stamp-added-alert")}copyCanvas(t,e,i=!1){t||(t=224);const{width:s,height:n}=this.#t,r=new zt;let a=this.#t,l=s,c=n,h=null;if(e){if(s>e||n>e){const S=Math.min(e/s,e/n);l=Math.floor(s*S),c=Math.floor(n*S)}h=document.createElement("canvas");const u=h.width=Math.ceil(l*r.sx),p=h.height=Math.ceil(c*r.sy);this.#l||(a=this.#h(u,p));const m=h.getContext("2d");m.filter=this._uiManager.hcmFilter;let g="white",y="#cfcfd8";this._uiManager.hcmFilter!=="none"?y="black":Go.isDarkMode&&(g="#8f8f9d",y="#42414d");const b=15,v=b*r.sx,w=b*r.sy,A=new OffscreenCanvas(v*2,w*2),x=A.getContext("2d");x.fillStyle=g,x.fillRect(0,0,v*2,w*2),x.fillStyle=y,x.fillRect(0,0,v,w),x.fillRect(v,w,v,w),m.fillStyle=m.createPattern(A,"repeat"),m.fillRect(0,0,u,p),m.drawImage(a,0,0,a.width,a.height,0,0,u,p)}let d=null;if(i){let u,p;if(r.symmetric&&a.width<t&&a.height<t)u=a.width,p=a.height;else if(a=this.#t,s>t||n>t){const y=Math.min(t/s,t/n);u=Math.floor(s*y),p=Math.floor(n*y),this.#l||(a=this.#h(u,p))}const g=new OffscreenCanvas(u,p).getContext("2d",{willReadFrequently:!0});g.drawImage(a,0,0,a.width,a.height,0,0,u,p),d={width:u,height:p,data:g.getImageData(0,0,u,p).data}}return{canvas:h,width:l,height:c,imageData:d}}#h(t,e){const{width:i,height:s}=this.#t;let n=i,r=s,a=this.#t;for(;n>2*t||r>2*e;){const l=n,c=r;n>2*t&&(n=n>=16384?Math.floor(n/2)-1:Math.ceil(n/2)),r>2*e&&(r=r>=16384?Math.floor(r/2)-1:Math.ceil(r/2));const h=new OffscreenCanvas(n,r);h.getContext("2d").drawImage(a,0,0,l,c,0,0,n,r),a=h.transferToImageBitmap()}return a}#g(){const[t,e]=this.parentDimensions,{width:i,height:s}=this,n=new zt,r=Math.ceil(i*t*n.sx),a=Math.ceil(s*e*n.sy),l=this.#r;if(!l||l.width===r&&l.height===a)return;l.width=r,l.height=a;const c=this.#l?this.#t:this.#h(r,a),h=l.getContext("2d");h.filter=this._uiManager.hcmFilter,h.drawImage(c,0,0,c.width,c.height,0,0,r,a)}#b(t){if(t){if(this.#l){const s=this._uiManager.imageManager.getSvgUrl(this.#e);if(s)return s}const e=document.createElement("canvas");return{width:e.width,height:e.height}=this.#t,e.getContext("2d").drawImage(this.#t,0,0),e.toDataURL()}if(this.#l){const[e,i]=this.pageDimensions,s=Math.round(this.width*e*be.PDF_TO_CSS_UNITS),n=Math.round(this.height*i*be.PDF_TO_CSS_UNITS),r=new OffscreenCanvas(s,n);return r.getContext("2d").drawImage(this.#t,0,0,this.#t.width,this.#t.height,0,0,s,n),r.transferToImageBitmap()}return structuredClone(this.#t)}static async deserialize(t,e,i){let s=null,n=!1;if(t instanceof Dr){const{data:{rect:g,rotation:y,id:b,structParent:v,popupRef:w,richText:A,contentsObj:x,creationDate:S,modificationDate:k},container:_,parent:{page:{pageNumber:E}},canvas:L}=t;let P,G;L?(delete t.canvas,{id:P,bitmap:G}=i.imageManager.getFromCanvas(_.id,L),L.remove()):(n=!0,t._hasNoCanvas=!0);const H=(await e._structTree.getAriaAttributes(`${Ts}${b}`))?.get("aria-label")||"";s=t={annotationType:j.STAMP,bitmapId:P,bitmap:G,pageIndex:E-1,rect:g.slice(0),rotation:y,annotationElementId:b,id:b,deleted:!1,accessibilityData:{decorative:!1,altText:H},isSvg:!1,structParent:v,popupRef:w,richText:A,comment:x?.str||null,creationDate:S,modificationDate:k}}const r=await super.deserialize(t,e,i),{rect:a,bitmap:l,bitmapUrl:c,bitmapId:h,isSvg:d,accessibilityData:u}=t;n?(i.addMissingCanvas(t.id,r),r.#o=!0):h&&i.imageManager.isValidId(h)?(r.#e=h,l&&(r.#t=l)):r.#i=c,r.#l=d;const[p,m]=r.pageDimensions;return r.width=(a[2]-a[0])/p,r.height=(a[3]-a[1])/m,u&&(r.altTextData=u),r._initialData=s,t.comment&&r.setCommentData(t),r.#u=!!s,r}serialize(t=!1,e=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const i=Object.assign(super.serialize(t),{bitmapId:this.#e,isSvg:this.#l});if(this.addComment(i),t)return i.bitmapUrl=this.#b(!0),i.accessibilityData=this.serializeAltText(!0),i.isCopy=!0,i;const{decorative:s,altText:n}=this.serializeAltText(!1);if(!s&&n&&(i.accessibilityData={type:"Figure",alt:n}),this.annotationElementId){const a=this.#w(i);return a.isSame?null:(a.isSameAltText?delete i.accessibilityData:i.accessibilityData.structParent=this._initialData.structParent??-1,i.id=this.annotationElementId,delete i.bitmapId,i)}if(e===null)return i;e.stamps||=new Map;const r=this.#l?(i.rect[2]-i.rect[0])*(i.rect[3]-i.rect[1]):null;if(!e.stamps.has(this.#e))e.stamps.set(this.#e,{area:r,serialized:i}),i.bitmap=this.#b(!1);else if(this.#l){const a=e.stamps.get(this.#e);r>a.area&&(a.area=r,a.serialized.bitmap.close(),a.serialized.bitmap=this.#b(!1))}return i}#w(t){const{pageIndex:e,accessibilityData:{altText:i}}=this._initialData,s=t.pageIndex===e,n=(t.accessibilityData?.alt||"")===i;return{isSame:!this.hasEditedComment&&!this._hasBeenMoved&&!this._hasBeenResized&&s&&n,isSameAltText:n}}renderAnnotationElement(t){return this.deleted?(t.hide(),null):(t.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}}class Kt{#t;#e=!1;#s=null;#i=null;#a=null;#n=new Map;#r=!1;#o=!1;#c=!1;#l=null;#u=null;#d=null;#p=null;#m=null;#f=-1;#h;static _initialized=!1;static#g=new Map([gt,Gs,mc,ht,Xt].map(t=>[t._editorType,t]));constructor({uiManager:t,pageIndex:e,div:i,structTreeLayer:s,accessibilityManager:n,annotationLayer:r,drawLayer:a,textLayer:l,viewport:c,l10n:h}){const d=[...Kt.#g.values()];if(!Kt._initialized){Kt._initialized=!0;for(const u of d)u.initialize(h,t)}t.registerEditorTypes(d),this.#h=t,this.pageIndex=e,this.div=i,this.#t=n,this.#s=r,this.viewport=c,this.#d=l,this.drawLayer=a,this._structTree=s,this.#h.addLayer(this)}get isEmpty(){return this.#n.size===0}get isInvisible(){return this.isEmpty&&this.#h.getMode()===j.NONE}updateToolbar(t){this.#h.updateToolbar(t)}updateMode(t=this.#h.getMode()){switch(this.#v(),t){case j.NONE:this.div.classList.toggle("nonEditing",!0),this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case j.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case j.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:e}=this.div;if(e.toggle("nonEditing",!1),t===j.POPUP)e.toggle("commentEditing",!0);else{e.toggle("commentEditing",!1);for(const i of Kt.#g.values())e.toggle(`${i._type}Editing`,t===i._editorType)}this.div.hidden=!1}hasTextLayer(t){return t===this.#d?.div}setEditingState(t){this.#h.setEditingState(t)}addCommands(t){this.#h.addCommands(t)}cleanUndoStack(t){this.#h.cleanUndoStack(t)}toggleDrawing(t=!1){this.div.classList.toggle("drawing",!t)}togglePointerEvents(t=!1){this.div.classList.toggle("disabled",!t)}toggleAnnotationLayerPointerEvents(t=!1){this.#s?.div.classList.toggle("disabled",!t)}get#b(){return this.#n.size!==0?this.#n.values():this.#h.getEditors(this.pageIndex)}async enable(){this.#c=!0,this.div.tabIndex=0,this.togglePointerEvents(!0),this.div.classList.toggle("nonEditing",!1),this.#m?.abort(),this.#m=null;const t=new Set;for(const i of this.#b)i.enableEditing(),i.show(!0),i.annotationElementId&&(this.#h.removeChangedExistingAnnotation(i),t.add(i.annotationElementId));const e=this.#s;if(e)for(const i of e.getEditableAnnotations()){if(i.hide(),this.#h.isDeletedAnnotationElement(i.data.id)||t.has(i.data.id))continue;const s=await this.deserialize(i);s&&(this.addOrRebuild(s),s.enableEditing())}this.#c=!1,this.#h._eventBus.dispatch("editorsrendered",{source:this,pageNumber:this.pageIndex+1})}disable(){if(this.#o=!0,this.div.tabIndex=-1,this.togglePointerEvents(!1),this.div.classList.toggle("nonEditing",!0),this.#d&&!this.#m){this.#m=new AbortController;const i=this.#h.combinedSignal(this.#m);this.#d.div.addEventListener("pointerdown",s=>{const{clientX:r,clientY:a,timeStamp:l}=s,c=this.#f;if(l-c>500){this.#f=l;return}this.#f=-1;const{classList:h}=this.div;h.toggle("getElements",!0);const d=document.elementsFromPoint(r,a);if(h.toggle("getElements",!1),!this.div.contains(d[0]))return;let u;const p=new RegExp(`^${Ze}[0-9]+$`);for(const g of d)if(p.test(g.id)){u=g.id;break}if(!u)return;const m=this.#n.get(u);m?.annotationElementId===null&&(s.stopPropagation(),s.preventDefault(),m.dblclick(s))},{signal:i,capture:!0})}const t=this.#s;if(t){const i=new Map,s=new Map;for(const r of this.#b){if(r.disableEditing(),!r.annotationElementId){r.updateFakeAnnotationElement(t);continue}if(r.serialize()!==null){i.set(r.annotationElementId,r);continue}else s.set(r.annotationElementId,r);this.getEditableAnnotation(r.annotationElementId)?.show(),r.remove()}const n=t.getEditableAnnotations();for(const r of n){const{id:a}=r.data;if(this.#h.isDeletedAnnotationElement(a)){r.updateEdited({deleted:!0});continue}let l=s.get(a);if(l){l.resetAnnotationElement(r),l.show(!1),r.show();continue}l=i.get(a),l&&(this.#h.addChangedExistingAnnotation(l),l.renderAnnotationElement(r)&&l.show(!1)),r.show()}}this.#v(),this.isEmpty&&(this.div.hidden=!0);const{classList:e}=this.div;for(const i of Kt.#g.values())e.remove(`${i._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),this.#o=!1}getEditableAnnotation(t){return this.#s?.getEditableAnnotation(t)||null}setActiveEditor(t){this.#h.getActive()!==t&&this.#h.setActiveEditor(t)}enableTextSelection(){if(this.div.tabIndex=-1,this.#d?.div&&!this.#p){this.#p=new AbortController;const t=this.#h.combinedSignal(this.#p);this.#d.div.addEventListener("pointerdown",this.#w.bind(this),{signal:t}),this.#d.div.classList.add("highlighting")}}disableTextSelection(){this.div.tabIndex=0,this.#d?.div&&this.#p&&(this.#p.abort(),this.#p=null,this.#d.div.classList.remove("highlighting"))}#w(t){this.#h.unselectAll();const{target:e}=t;if(e===this.#d.div||(e.getAttribute("role")==="img"||e.classList.contains("endOfContent"))&&this.#d.div.contains(e)){const{isMac:i}=bt.platform;if(t.button!==0||t.ctrlKey&&i)return;this.#h.showAllEditors("highlight",!0,!0),this.#d.div.classList.add("free"),this.toggleDrawing(),ht.startHighlighting(this,this.#h.direction==="ltr",{target:this.#d.div,x:t.x,y:t.y}),this.#d.div.addEventListener("pointerup",()=>{this.#d.div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:this.#h._signal}),t.preventDefault()}}enableClick(){if(this.#i)return;this.#i=new AbortController;const t=this.#h.combinedSignal(this.#i);this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:t});const e=this.pointerup.bind(this);this.div.addEventListener("pointerup",e,{signal:t}),this.div.addEventListener("pointercancel",e,{signal:t})}disableClick(){this.#i?.abort(),this.#i=null}attach(t){this.#n.set(t.id,t);const{annotationElementId:e}=t;e&&this.#h.isDeletedAnnotationElement(e)&&this.#h.removeDeletedAnnotationElement(t)}detach(t){this.#n.delete(t.id),this.#t?.removePointerInTextLayer(t.contentDiv),!this.#o&&t.annotationElementId&&this.#h.addDeletedAnnotationElement(t)}remove(t){this.detach(t),this.#h.removeEditor(t),t.div.remove(),t.isAttachedToDOM=!1}changeParent(t){t.parent!==this&&(t.parent&&t.annotationElementId&&(this.#h.addDeletedAnnotationElement(t.annotationElementId),I.deleteAnnotationElement(t),t.annotationElementId=null),this.attach(t),t.parent?.detach(t),t.setParent(this),t.div&&t.isAttachedToDOM&&(t.div.remove(),this.div.append(t.div)))}add(t){if(!(t.parent===this&&t.isAttachedToDOM)){if(this.changeParent(t),this.#h.addEditor(t),this.attach(t),!t.isAttachedToDOM){const e=t.render();this.div.append(e),t.isAttachedToDOM=!0}t.fixAndSetPosition(),t.onceAdded(!this.#c),this.#h.addToAnnotationStorage(t),t._reportTelemetry(t.telemetryInitialData)}}moveEditorInDOM(t){if(!t.isAttachedToDOM)return;const{activeElement:e}=document;t.div.contains(e)&&!this.#a&&(t._focusEventsAllowed=!1,this.#a=setTimeout(()=>{this.#a=null,t.div.contains(document.activeElement)?t._focusEventsAllowed=!0:(t.div.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this.#h._signal}),e.focus())},0)),t._structTreeParentId=this.#t?.moveElementInDOM(this.div,t.div,t.contentDiv,!0)}addOrRebuild(t){t.needsToBeRebuilt()?(t.parent||=this,t.rebuild(),t.show()):this.add(t)}addUndoableEditor(t){const e=()=>t._uiManager.rebuild(t),i=()=>{t.remove()};this.addCommands({cmd:e,undo:i,mustExec:!1})}getEditorByUID(t){for(const e of this.#n.values())if(e.uid===t)return e;return null}getNextId(){return this.#h.getId()}get#y(){return Kt.#g.get(this.#h.getMode())}combinedSignal(t){return this.#h.combinedSignal(t)}#_(t){const e=this.#y;return e?new e.prototype.constructor(t):null}canCreateNewEmptyEditor(){return this.#y?.canCreateNewEmptyEditor()}async pasteEditor(t,e){this.updateToolbar(t),await this.#h.updateMode(t.mode);const{offsetX:i,offsetY:s}=this.#S(),n=this.getNextId(),r=this.#_({parent:this,id:n,x:i,y:s,uiManager:this.#h,isCentered:!0,...e});r&&this.add(r)}async deserialize(t){return await Kt.#g.get(t.annotationType??t.annotationEditorType)?.deserialize(t,this,this.#h)||null}createAndAddNewEditor(t,e,i={}){const s=this.getNextId(),n=this.#_({parent:this,id:s,x:t.offsetX,y:t.offsetY,uiManager:this.#h,isCentered:e,...i});return n&&this.add(n),n}get boundingClientRect(){return this.div.getBoundingClientRect()}#S(){const{x:t,y:e,width:i,height:s}=this.boundingClientRect,n=Math.max(0,t),r=Math.max(0,e),a=Math.min(window.innerWidth,t+i),l=Math.min(window.innerHeight,e+s),c=(n+a)/2-t,h=(r+l)/2-e,[d,u]=this.viewport.rotation%180===0?[c,h]:[h,c];return{offsetX:d,offsetY:u}}addNewEditor(t={}){this.createAndAddNewEditor(this.#S(),!0,t)}setSelected(t){this.#h.setSelected(t)}toggleSelected(t){this.#h.toggleSelected(t)}unselect(t){this.#h.unselect(t)}pointerup(t){const{isMac:e}=bt.platform;if(t.button!==0||t.ctrlKey&&e||t.target!==this.div||!this.#r||(this.#r=!1,this.#y?.isDrawer&&this.#y.supportMultipleDrawings))return;if(!this.#e){this.#e=!0;return}const i=this.#h.getMode();if(i===j.STAMP||i===j.SIGNATURE){this.#h.unselectAll();return}this.createAndAddNewEditor(t,!1)}pointerdown(t){if(this.#h.getMode()===j.HIGHLIGHT&&this.enableTextSelection(),this.#r){this.#r=!1;return}const{isMac:e}=bt.platform;if(t.button!==0||t.ctrlKey&&e||t.target!==this.div)return;if(this.#r=!0,this.#y?.isDrawer){this.startDrawingSession(t);return}const i=this.#h.getActive();this.#e=!i||i.isEmpty()}startDrawingSession(t){if(this.div.focus({preventScroll:!0}),this.#l){this.#y.startDrawing(this,this.#h,!1,t);return}this.#h.setCurrentDrawingSession(this),this.#l=new AbortController;const e=this.#h.combinedSignal(this.#l);this.div.addEventListener("blur",({relatedTarget:i})=>{i&&!this.div.contains(i)&&(this.#u=null,this.commitOrRemove())},{signal:e}),this.#y.startDrawing(this,this.#h,!1,t)}pause(t){if(t){const{activeElement:e}=document;this.div.contains(e)&&(this.#u=e);return}this.#u&&setTimeout(()=>{this.#u?.focus(),this.#u=null},0)}endDrawingSession(t=!1){return this.#l?(this.#h.setCurrentDrawingSession(null),this.#l.abort(),this.#l=null,this.#u=null,this.#y.endDrawing(t)):null}findNewParent(t,e,i){const s=this.#h.findParent(e,i);return s===null||s===this?!1:(s.changeParent(t),!0)}commitOrRemove(){return this.#l?(this.endDrawingSession(),!0):!1}onScaleChanging(){this.#l&&this.#y.onScaleChangingWhenDrawing(this)}destroy(){this.commitOrRemove(),this.#h.getActive()?.parent===this&&(this.#h.commitOrRemove(),this.#h.setActiveEditor(null)),this.#a&&(clearTimeout(this.#a),this.#a=null);for(const t of this.#n.values())this.#t?.removePointerInTextLayer(t.contentDiv),t.setParent(null),t.isAttachedToDOM=!1,t.div.remove();this.div=null,this.#n.clear(),this.#h.removeLayer(this)}#v(){for(const t of this.#n.values())t.isEmpty()&&t.remove()}render({viewport:t}){this.viewport=t,ce(this.div,t);for(const e of this.#h.getEditors(this.pageIndex))this.add(e),e.rebuild();this.updateMode()}update({viewport:t}){this.#h.commitOrRemove(),this.#v();const e=this.viewport.rotation,i=t.rotation;if(this.viewport=t,ce(this.div,{rotation:i}),e!==i)for(const s of this.#n.values())s.rotate(i)}get pageDimensions(){const{pageWidth:t,pageHeight:e}=this.viewport.rawDims;return[t,e]}get scale(){return this.#h.viewParameters.realScale}}class mt{#t=null;#e=new Map;#s=new Map;static#i=0;constructor({pageIndex:t}){this.pageIndex=t}setParent(t){if(!this.#t){this.#t=t;return}if(this.#t!==t){if(this.#e.size>0)for(const e of this.#e.values())e.remove(),t.append(e);this.#t=t}}static get _svgFactory(){return z(this,"_svgFactory",new ri)}static#a(t,[e,i,s,n]){const{style:r}=t;r.top=`${100*i}%`,r.left=`${100*e}%`,r.width=`${100*s}%`,r.height=`${100*n}%`}#n(){const t=mt._svgFactory.create(1,1,!0);return this.#t.append(t),t.setAttribute("aria-hidden",!0),t}#r(t,e){const i=mt._svgFactory.createElement("clipPath");t.append(i);const s=`clip_${e}`;i.setAttribute("id",s),i.setAttribute("clipPathUnits","objectBoundingBox");const n=mt._svgFactory.createElement("use");return i.append(n),n.setAttribute("href",`#${e}`),n.classList.add("clip"),s}#o(t,e){for(const[i,s]of Object.entries(e))s===null?t.removeAttribute(i):t.setAttribute(i,s)}draw(t,e=!1,i=!1){const s=mt.#i++,n=this.#n(),r=mt._svgFactory.createElement("defs");n.append(r);const a=mt._svgFactory.createElement("path");r.append(a);const l=`path_p${this.pageIndex}_${s}`;a.setAttribute("id",l),a.setAttribute("vector-effect","non-scaling-stroke"),e&&this.#s.set(s,a);const c=i?this.#r(r,l):null,h=mt._svgFactory.createElement("use");return n.append(h),h.setAttribute("href",`#${l}`),this.updateProperties(n,t),this.#e.set(s,n),{id:s,clipPathId:`url(#${c})`}}drawOutline(t,e){const i=mt.#i++,s=this.#n(),n=mt._svgFactory.createElement("defs");s.append(n);const r=mt._svgFactory.createElement("path");n.append(r);const a=`path_p${this.pageIndex}_${i}`;r.setAttribute("id",a),r.setAttribute("vector-effect","non-scaling-stroke");let l;if(e){const d=mt._svgFactory.createElement("mask");n.append(d),l=`mask_p${this.pageIndex}_${i}`,d.setAttribute("id",l),d.setAttribute("maskUnits","objectBoundingBox");const u=mt._svgFactory.createElement("rect");d.append(u),u.setAttribute("width","1"),u.setAttribute("height","1"),u.setAttribute("fill","white");const p=mt._svgFactory.createElement("use");d.append(p),p.setAttribute("href",`#${a}`),p.setAttribute("stroke","none"),p.setAttribute("fill","black"),p.setAttribute("fill-rule","nonzero"),p.classList.add("mask")}const c=mt._svgFactory.createElement("use");s.append(c),c.setAttribute("href",`#${a}`),l&&c.setAttribute("mask",`url(#${l})`);const h=c.cloneNode();return s.append(h),c.classList.add("mainOutline"),h.classList.add("secondaryOutline"),this.updateProperties(s,t),this.#e.set(i,s),i}finalizeDraw(t,e){this.#s.delete(t),this.updateProperties(t,e)}updateProperties(t,e){if(!e)return;const{root:i,bbox:s,rootClass:n,path:r}=e,a=typeof t=="number"?this.#e.get(t):t;if(a){if(i&&this.#o(a,i),s&&mt.#a(a,s),n){const{classList:l}=a;for(const[c,h]of Object.entries(n))l.toggle(c,h)}if(r){const c=a.firstChild.firstChild;this.#o(c,r)}}}updateParent(t,e){if(e===this)return;const i=this.#e.get(t);i&&(e.#t.append(i),this.#e.delete(t),e.#e.set(t,i))}remove(t){this.#s.delete(t),this.#t!==null&&(this.#e.get(t).remove(),this.#e.delete(t))}destroy(){this.#t=null;for(const t of this.#e.values())t.remove();this.#e.clear(),this.#s.clear()}}globalThis._pdfjsTestingUtils={HighlightOutliner:ys};globalThis.pdfjsLib={AbortException:se,AnnotationEditorLayer:Kt,AnnotationEditorParamsType:V,AnnotationEditorType:j,AnnotationEditorUIManager:ne,AnnotationLayer:zs,AnnotationMode:Qt,AnnotationType:ct,applyOpacity:lr,build:Tr,ColorPicker:Nt,createValidAbsoluteUrl:_s,CSSConstants:or,DOMSVGFactory:ri,DrawLayer:mt,FeatureTest:bt,fetchData:Be,findContrastColor:cr,getDocument:Os,getFilenameFromUrl:nr,getPdfFilenameFromUrl:rr,getRGB:He,getUuid:Cs,getXfaPageViewport:ar,GlobalWorkerOptions:le,ImageKind:Qe,InvalidPDFException:Di,isDataScheme:ci,isPdfFile:Ui,isValidExplicitDest:pr,MathClamp:xt,noContextMenu:Ft,normalizeUnicode:ir,OPS:Fe,OutputScale:zt,PasswordResponses:tr,PDFDataRangeTransport:Bs,PDFDateString:Ni,PDFWorker:Oe,PermissionFlag:Zn,PixelsPerInch:be,RenderingCancelledException:Hi,renderRichText:Ps,ResponseException:ti,setLayerDimensions:ce,shadow:z,SignatureExtractor:de,stopEvent:ot,SupportedImageMimeTypes:Ii,TextLayer:ii,TouchManager:di,updateUrlHash:Es,Util:N,VerbosityLevel:ai,version:si,XfaLayer:Ls};const bc=Object.freeze(Object.defineProperty({__proto__:null,AbortException:se,AnnotationEditorLayer:Kt,AnnotationEditorParamsType:V,AnnotationEditorType:j,AnnotationEditorUIManager:ne,AnnotationLayer:zs,AnnotationMode:Qt,AnnotationType:ct,CSSConstants:or,ColorPicker:Nt,DOMSVGFactory:ri,DrawLayer:mt,FeatureTest:bt,GlobalWorkerOptions:le,ImageKind:Qe,InvalidPDFException:Di,MathClamp:xt,OPS:Fe,OutputScale:zt,PDFDataRangeTransport:Bs,PDFDateString:Ni,PDFWorker:Oe,PasswordResponses:tr,PermissionFlag:Zn,PixelsPerInch:be,RenderingCancelledException:Hi,ResponseException:ti,SignatureExtractor:de,SupportedImageMimeTypes:Ii,TextLayer:ii,TouchManager:di,Util:N,VerbosityLevel:ai,XfaLayer:Ls,applyOpacity:lr,build:Tr,createValidAbsoluteUrl:_s,fetchData:Be,findContrastColor:cr,getDocument:Os,getFilenameFromUrl:nr,getPdfFilenameFromUrl:rr,getRGB:He,getUuid:Cs,getXfaPageViewport:ar,isDataScheme:ci,isPdfFile:Ui,isValidExplicitDest:pr,noContextMenu:Ft,normalizeUnicode:ir,renderRichText:Ps,setLayerDimensions:ce,shadow:z,stopEvent:ot,updateUrlHash:Es,version:si},Symbol.toStringTag,{value:"Module"}));function Or(o){var t,e,i="";if(typeof o=="string"||typeof o=="number")i+=o;else if(typeof o=="object")if(Array.isArray(o)){var s=o.length;for(t=0;t<s;t++)o[t]&&(e=Or(o[t]))&&(i&&(i+=" "),i+=e)}else for(e in o)o[e]&&(i&&(i+=" "),i+=e);return i}function $i(){for(var o,t,e=0,i="",s=arguments.length;e<s;e++)(o=arguments[e])&&(t=Or(o))&&(i&&(i+=" "),i+=t);return i}var Ln=Object.prototype.hasOwnProperty;function Pn(o,t,e){for(e of o.keys())if(De(e,t))return e}function De(o,t){var e,i,s;if(o===t)return!0;if(o&&t&&(e=o.constructor)===t.constructor){if(e===Date)return o.getTime()===t.getTime();if(e===RegExp)return o.toString()===t.toString();if(e===Array){if((i=o.length)===t.length)for(;i--&&De(o[i],t[i]););return i===-1}if(e===Set){if(o.size!==t.size)return!1;for(i of o)if(s=i,s&&typeof s=="object"&&(s=Pn(t,s),!s)||!t.has(s))return!1;return!0}if(e===Map){if(o.size!==t.size)return!1;for(i of o)if(s=i[0],s&&typeof s=="object"&&(s=Pn(t,s),!s)||!De(i[1],t.get(s)))return!1;return!0}if(e===ArrayBuffer)o=new Uint8Array(o),t=new Uint8Array(t);else if(e===DataView){if((i=o.byteLength)===t.byteLength)for(;i--&&o.getInt8(i)===t.getInt8(i););return i===-1}if(ArrayBuffer.isView(o)){if((i=o.byteLength)===t.byteLength)for(;i--&&o[i]===t[i];);return i===-1}if(!e||typeof o=="object"){i=0;for(e in o)if(Ln.call(o,e)&&++i&&!Ln.call(t,e)||!(e in t)||!De(o[e],t[e]))return!1;return Object.keys(t).length===i}}return o!==o&&t!==t}function fi(o){let t=!1;return{promise:new Promise((i,s)=>{o.then(n=>!t&&i(n)).catch(n=>!t&&s(n))}),cancel(){t=!0}}}const yc=["onCopy","onCut","onPaste"],wc=["onCompositionEnd","onCompositionStart","onCompositionUpdate"],vc=["onFocus","onBlur"],xc=["onInput","onInvalid","onReset","onSubmit"],Ac=["onLoad","onError"],Sc=["onKeyDown","onKeyPress","onKeyUp"],kc=["onAbort","onCanPlay","onCanPlayThrough","onDurationChange","onEmptied","onEncrypted","onEnded","onError","onLoadedData","onLoadedMetadata","onLoadStart","onPause","onPlay","onPlaying","onProgress","onRateChange","onSeeked","onSeeking","onStalled","onSuspend","onTimeUpdate","onVolumeChange","onWaiting"],_c=["onClick","onContextMenu","onDoubleClick","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp"],Ec=["onDrag","onDragEnd","onDragEnter","onDragExit","onDragLeave","onDragOver","onDragStart","onDrop"],Cc=["onSelect"],Tc=["onTouchCancel","onTouchEnd","onTouchMove","onTouchStart"],Lc=["onPointerDown","onPointerMove","onPointerUp","onPointerCancel","onGotPointerCapture","onLostPointerCapture","onPointerEnter","onPointerLeave","onPointerOver","onPointerOut"],Pc=["onScroll"],Mc=["onWheel"],Rc=["onAnimationStart","onAnimationEnd","onAnimationIteration"],Dc=["onTransitionEnd"],Nc=["onToggle"],Ic=["onChange"],Fc=[...yc,...wc,...vc,...xc,...Ac,...Sc,...kc,..._c,...Ec,...Cc,...Tc,...Lc,...Pc,...Mc,...Rc,...Dc,...Ic,...Nc];function jr(o,t){const e={};for(const i of Fc){const s=o[i];s&&(t?e[i]=(n=>s(n,t(i))):e[i]=s)}return e}var Oc="Invariant failed";function Q(o,t){if(!o)throw new Error(Oc)}var ls,Mn;function jc(){if(Mn)return ls;Mn=1;var o=function(){};return ls=o,ls}var Bc=jc();const At=da(Bc),Br=C.createContext(null),Hc="noopener noreferrer nofollow";class Uc{constructor(){this.externalLinkEnabled=!0,this.externalLinkRel=void 0,this.externalLinkTarget=void 0,this.isInPresentationMode=!1,this.pdfDocument=void 0,this.pdfViewer=void 0}setDocument(t){this.pdfDocument=t}setViewer(t){this.pdfViewer=t}setExternalLinkRel(t){this.externalLinkRel=t}setExternalLinkTarget(t){this.externalLinkTarget=t}setHash(){}setHistory(){}get pagesCount(){return this.pdfDocument?this.pdfDocument.numPages:0}get page(){return Q(this.pdfViewer),this.pdfViewer.currentPageNumber||0}set page(t){Q(this.pdfViewer),this.pdfViewer.currentPageNumber=t}get rotation(){return 0}set rotation(t){}addLinkAttributes(t,e,i){t.href=e,t.rel=this.externalLinkRel||Hc,t.target=i?"_blank":this.externalLinkTarget||""}goToDestination(t){return new Promise(e=>{Q(this.pdfDocument),Q(t),typeof t=="string"?this.pdfDocument.getDestination(t).then(e):Array.isArray(t)?e(t):t.then(e)}).then(e=>{Q(Array.isArray(e));const i=e[0];new Promise(s=>{Q(this.pdfDocument),i instanceof Object?this.pdfDocument.getPageIndex(i).then(n=>{s(n)}).catch(()=>{Q(!1)}):typeof i=="number"?s(i):Q(!1)}).then(s=>{const n=s+1;Q(this.pdfViewer),Q(n>=1&&n<=this.pagesCount),this.pdfViewer.scrollPageIntoView({dest:e,pageIndex:s,pageNumber:n})})})}goToPage(t){const e=t-1;Q(this.pdfViewer),Q(t>=1&&t<=this.pagesCount),this.pdfViewer.scrollPageIntoView({pageIndex:e,pageNumber:t})}goToXY(){}cachePageRef(){}getDestinationHash(){return"#"}getAnchorUrl(){return"#"}executeNamedAction(){}executeSetOCGState(){}isPageVisible(){return!0}isPageCached(){return!0}navigateTo(t){this.goToDestination(t)}}function Ne({children:o,type:t}){return f.jsx("div",{className:`react-pdf__message react-pdf__message--${t}`,children:o})}const Rn={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};function zc(o,t){switch(t.type){case"RESOLVE":return{value:t.value,error:void 0};case"REJECT":return{value:!1,error:t.error};case"RESET":return{value:void 0,error:void 0};default:return o}}function je(){return C.useReducer(zc,{value:void 0,error:void 0})}const Vi=typeof window<"u",Hr=Vi&&window.location.protocol==="file:";function Gc(o){return typeof o<"u"}function he(o){return Gc(o)&&o!==null}function $c(o){return typeof o=="string"}function Vc(o){return o instanceof ArrayBuffer}function Wc(o){return Q(Vi),o instanceof Blob}function xs(o){return $c(o)&&/^data:/.test(o)}function Dn(o){Q(xs(o));const[t="",e=""]=o.split(",");return t.split(";").indexOf("base64")!==-1?atob(e):unescape(e)}function qc(){return Vi&&window.devicePixelRatio||1}const Ur="On Chromium based browsers, you can use --allow-file-access-from-files flag for debugging purposes.";function Nn(){At(!Hr,`Loading PDF as base64 strings/URLs may not work on protocols other than HTTP/HTTPS. ${Ur}`)}function Xc(){At(!Hr,`Loading PDF.js worker may not work on protocols other than HTTP/HTTPS. ${Ur}`)}function we(o){o?.cancel&&o.cancel()}function As(o,t){return Object.defineProperty(o,"width",{get(){return this.view[2]*t},configurable:!0}),Object.defineProperty(o,"height",{get(){return this.view[3]*t},configurable:!0}),Object.defineProperty(o,"originalWidth",{get(){return this.view[2]},configurable:!0}),Object.defineProperty(o,"originalHeight",{get(){return this.view[3]},configurable:!0}),o}function Yc(o){return o.name==="RenderingCancelledException"}function Kc(o){return new Promise((t,e)=>{const i=new FileReader;i.onload=()=>{if(!i.result)return e(new Error("Error while reading a file."));t(i.result)},i.onerror=s=>{if(!s.target)return e(new Error("Error while reading a file."));const{error:n}=s.target;if(!n)return e(new Error("Error while reading a file."));switch(n.code){case n.NOT_FOUND_ERR:return e(new Error("Error while reading a file: File not found."));case n.SECURITY_ERR:return e(new Error("Error while reading a file: Security error."));case n.ABORT_ERR:return e(new Error("Error while reading a file: Aborted."));default:return e(new Error("Error while reading a file."))}},i.readAsArrayBuffer(o)})}const{PDFDataRangeTransport:Qc}=bc,Jc=(o,t)=>{switch(t){case Rn.NEED_PASSWORD:{const e=prompt("Enter the password to open this PDF file.");o(e);break}case Rn.INCORRECT_PASSWORD:{const e=prompt("Invalid password. Please try again.");o(e);break}}};function In(o){return typeof o=="object"&&o!==null&&("data"in o||"range"in o||"url"in o)}const Zc=C.forwardRef(function({children:t,className:e,error:i="Failed to load PDF file.",externalLinkRel:s,externalLinkTarget:n,file:r,inputRef:a,imageResourcesPath:l,loading:c="Loading PDFâ€¦",noData:h="No PDF file specified.",onItemClick:d,onLoadError:u,onLoadProgress:p,onLoadSuccess:m,onPassword:g=Jc,onSourceError:y,onSourceSuccess:b,options:v,renderMode:w,rotate:A,scale:x,...S},k){const[_,E]=je(),{value:L,error:P}=_,[G,H]=je(),{value:O,error:$}=G,M=C.useRef(new Uc),R=C.useRef([]),U=C.useRef(void 0),nt=C.useRef(void 0);r&&r!==U.current&&In(r)&&(At(!De(r,U.current),`File prop passed to <Document /> changed, but it's equal to previous one. This might result in unnecessary reloads. Consider memoizing the value passed to "file" prop.`),U.current=r),v&&v!==nt.current&&(At(!De(v,nt.current),`Options prop passed to <Document /> changed, but it's equal to previous one. This might result in unnecessary reloads. Consider memoizing the value passed to "options" prop.`),nt.current=v);const St=C.useRef({scrollPageIntoView:q=>{const{dest:et,pageNumber:pt,pageIndex:ft=pt-1}=q;if(d){d({dest:et,pageIndex:ft,pageNumber:pt});return}const Ae=R.current[ft];if(Ae){Ae.scrollIntoView();return}At(!1,`An internal link leading to page ${pt} was clicked, but neither <Document> was provided with onItemClick nor it was able to find the page within itself. Either provide onItemClick to <Document> and handle navigating by yourself or ensure that all pages are rendered within <Document>.`)}});C.useImperativeHandle(k,()=>({linkService:M,pages:R,viewer:St}),[]);function Ot(){b&&b()}function tt(){P&&(At(!1,P.toString()),y&&y(P))}function X(){E({type:"RESET"})}C.useEffect(X,[r,E]);const kt=C.useCallback(async()=>{if(!r)return null;if(typeof r=="string")return xs(r)?{data:Dn(r)}:(Nn(),{url:r});if(r instanceof Qc)return{range:r};if(Vc(r))return{data:r};if(Vi&&Wc(r))return{data:await Kc(r)};if(Q(typeof r=="object"),Q(In(r)),"url"in r&&typeof r.url=="string"){if(xs(r.url)){const{url:q,...et}=r;return{data:Dn(q),...et}}Nn()}return r},[r]);C.useEffect(()=>{const q=fi(kt());return q.promise.then(et=>{E({type:"RESOLVE",value:et})}).catch(et=>{E({type:"REJECT",error:et})}),()=>{we(q)}},[kt,E]),C.useEffect(()=>{if(!(typeof L>"u")){if(L===!1){tt();return}Ot()}},[L]);function Lt(){O&&(m&&m(O),R.current=new Array(O.numPages),M.current.setDocument(O))}function _t(){$&&(At(!1,$.toString()),u&&u($))}C.useEffect(function(){H({type:"RESET"})},[H,L]),C.useEffect(function(){if(!L)return;const et=v?{...L,...v}:L,pt=Os(et);p&&(pt.onProgress=p),g&&(pt.onPassword=g);const ft=pt,Ae=ft.promise.then(Ue=>{H({type:"RESOLVE",value:Ue})}).catch(Ue=>{ft.destroyed||H({type:"REJECT",error:Ue})});return()=>{Ae.finally(()=>ft.destroy())}},[v,H,L]),C.useEffect(()=>{if(!(typeof O>"u")){if(O===!1){_t();return}Lt()}},[O]),C.useEffect(function(){M.current.setViewer(St.current),M.current.setExternalLinkRel(s),M.current.setExternalLinkTarget(n)},[s,n]);const Z=C.useCallback((q,et)=>{R.current[q]=et},[]),Gt=C.useCallback(q=>{delete R.current[q]},[]),Et=C.useMemo(()=>({imageResourcesPath:l,linkService:M.current,onItemClick:d,pdf:O,registerPage:Z,renderMode:w,rotate:A,scale:x,unregisterPage:Gt}),[l,d,O,Z,w,A,x,Gt]),rt=C.useMemo(()=>jr(S,()=>O),[S,O]);function Jt(){function q(pt){return!!pt?.pdf}if(!q(Et))throw new Error("pdf is undefined");const et=typeof t=="function"?t(Et):t;return f.jsx(Br.Provider,{value:Et,children:et})}function Zt(){return r?O==null?f.jsx(Ne,{type:"loading",children:typeof c=="function"?c():c}):O===!1?f.jsx(Ne,{type:"error",children:typeof i=="function"?i():i}):Jt():f.jsx(Ne,{type:"no-data",children:typeof h=="function"?h():h})}return f.jsx("div",{className:$i("react-pdf__Document",e),ref:a,...rt,children:Zt()})});function zr(){return C.useContext(Br)}function Gr(){for(var o=[],t=0;t<arguments.length;t++)o[t]=arguments[t];var e=o.filter(Boolean);if(e.length<=1){var i=e[0];return i||null}return function(n){for(var r=0,a=e;r<a.length;r++){var l=a[r];typeof l=="function"?l(n):l&&(l.current=n)}}}const $r=C.createContext(null);function Wi(){return C.useContext($r)}function th(){const o=zr(),t=Wi();Q(t);const e={...o,...t},{imageResourcesPath:i,linkService:s,onGetAnnotationsError:n,onGetAnnotationsSuccess:r,onRenderAnnotationLayerError:a,onRenderAnnotationLayerSuccess:l,page:c,pdf:h,renderForms:d,rotate:u,scale:p=1}=e;Q(h),Q(c),Q(s);const[m,g]=je(),{value:y,error:b}=m,v=C.useRef(null);At(Number.parseInt(window.getComputedStyle(document.body).getPropertyValue("--react-pdf-annotation-layer"),10)===1,"AnnotationLayer styles not found. Read more: https://github.com/wojtekmaj/react-pdf#support-for-annotations");function w(){y&&r&&r(y)}function A(){b&&(At(!1,b.toString()),n&&n(b))}C.useEffect(function(){g({type:"RESET"})},[g,c]),C.useEffect(function(){if(!c)return;const E=fi(c.getAnnotations()),L=E;return E.promise.then(P=>{g({type:"RESOLVE",value:P})}).catch(P=>{g({type:"REJECT",error:P})}),()=>{we(L)}},[g,c]),C.useEffect(()=>{if(y!==void 0){if(y===!1){A();return}w()}},[y]);function x(){l&&l()}function S(_){At(!1,`${_}`),a&&a(_)}const k=C.useMemo(()=>c.getViewport({scale:p,rotation:u}),[c,u,p]);return C.useEffect(function(){if(!h||!c||!s||!y)return;const{current:E}=v;if(!E)return;const L=k.clone({dontFlip:!0}),P={accessibilityManager:null,annotationCanvasMap:null,annotationEditorUIManager:null,annotationStorage:h.annotationStorage,commentManager:null,div:E,l10n:null,linkService:s,page:c,structTreeLayer:null,viewport:L},G={annotations:y,annotationStorage:h.annotationStorage,div:E,imageResourcesPath:i,linkService:s,page:c,renderForms:d,viewport:L};E.innerHTML="";try{new zs(P).render(G),x()}catch(H){S(H)}return()=>{}},[y,i,s,c,h,d,k]),f.jsx("div",{className:$i("react-pdf__Page__annotations","annotationLayer"),ref:v})}const Vr={Document:null,DocumentFragment:null,Part:"group",Sect:"group",Div:"group",Aside:"note",NonStruct:"none",P:null,H:"heading",Title:null,FENote:"note",Sub:"group",Lbl:null,Span:null,Em:null,Strong:null,Link:"link",Annot:"note",Form:"form",Ruby:null,RB:null,RT:null,RP:null,Warichu:null,WT:null,WP:null,L:"list",LI:"listitem",LBody:null,Table:"table",TR:"row",TH:"columnheader",TD:"cell",THead:"columnheader",TBody:null,TFoot:null,Caption:null,Figure:"figure",Formula:null,Artifact:null},eh=/^H(\d+)$/;function ih(o){return o in Vr}function qi(o){return"children"in o}function Wr(o){return qi(o)?o.children.length===1&&0 in o.children&&"id"in o.children[0]:!1}function sh(o){const t={};if(qi(o)){const{role:e}=o,i=e.match(eh);if(i)t.role="heading",t["aria-level"]=Number(i[1]);else if(ih(e)){const s=Vr[e];s&&(t.role=s)}}return t}function qr(o){const t={};if(qi(o)){if(o.alt!==void 0&&(t["aria-label"]=o.alt),o.lang!==void 0&&(t.lang=o.lang),Wr(o)){const[e]=o.children;if(e){const i=qr(e);return{...t,...i}}}}else"id"in o&&(t["aria-owns"]=o.id);return t}function nh(o){return o?{...sh(o),...qr(o)}:null}function Xr({className:o,node:t}){const e=C.useMemo(()=>nh(t),[t]),i=C.useMemo(()=>!qi(t)||Wr(t)?null:t.children.map((s,n)=>f.jsx(Xr,{node:s},n)),[t]);return f.jsx("span",{className:o,...e,children:i})}function rh(){const o=Wi();Q(o);const{onGetStructTreeError:t,onGetStructTreeSuccess:e}=o,[i,s]=je(),{value:n,error:r}=i,{customTextRenderer:a,page:l}=o;function c(){n&&e&&e(n)}function h(){r&&(At(!1,r.toString()),t&&t(r))}return C.useEffect(function(){s({type:"RESET"})},[s,l]),C.useEffect(function(){if(a||!l)return;const u=fi(l.getStructTree()),p=u;return u.promise.then(m=>{s({type:"RESOLVE",value:m})}).catch(m=>{s({type:"REJECT",error:m})}),()=>we(p)},[a,l,s]),C.useEffect(()=>{if(n!==void 0){if(n===!1){h();return}c()}},[n]),n?f.jsx(Xr,{className:"react-pdf__Page__structTree structTree",node:n}):null}const Fn=Qt;function ah(o){const t=Wi();Q(t);const e={...t,...o},{_className:i,canvasBackground:s,devicePixelRatio:n=qc(),onRenderError:r,onRenderSuccess:a,page:l,renderForms:c,renderTextLayer:h,rotate:d,scale:u}=e,{canvasRef:p}=o;Q(l);const m=C.useRef(null);function g(){l&&a&&a(As(l,u))}function y(A){Yc(A)||(At(!1,A.toString()),r&&r(A))}const b=C.useMemo(()=>l.getViewport({scale:u*n,rotation:d}),[n,l,d,u]),v=C.useMemo(()=>l.getViewport({scale:u,rotation:d}),[l,d,u]);C.useEffect(function(){if(!l)return;l.cleanup();const{current:x}=m;if(!x)return;x.width=b.width,x.height=b.height,x.style.width=`${Math.floor(v.width)}px`,x.style.height=`${Math.floor(v.height)}px`,x.style.visibility="hidden";const S={annotationMode:c?Fn.ENABLE_FORMS:Fn.ENABLE,canvas:x,canvasContext:x.getContext("2d",{alpha:!1}),viewport:b};s&&(S.background=s);const k=l.render(S),_=k;return k.promise.then(()=>{x.style.visibility="",g()}).catch(y),()=>we(_)},[s,l,c,b,v]);const w=C.useCallback(()=>{const{current:A}=m;A&&(A.width=0,A.height=0)},[]);return C.useEffect(()=>w,[w]),f.jsx("canvas",{className:`${i}__canvas`,dir:"ltr",ref:Gr(p,m),style:{display:"block",userSelect:"none"},children:h?f.jsx(rh,{}):null})}function oh(o){return"str"in o}function lh(){const o=Wi();Q(o);const{customTextRenderer:t,onGetTextError:e,onGetTextSuccess:i,onRenderTextLayerError:s,onRenderTextLayerSuccess:n,page:r,pageIndex:a,pageNumber:l,rotate:c,scale:h}=o;Q(r);const[d,u]=je(),{value:p,error:m}=d,g=C.useRef(null);At(Number.parseInt(window.getComputedStyle(document.body).getPropertyValue("--react-pdf-text-layer"),10)===1,"TextLayer styles not found. Read more: https://github.com/wojtekmaj/react-pdf#support-for-text-layer");function y(){p&&i&&i(p)}function b(){m&&(At(!1,m.toString()),e&&e(m))}C.useEffect(function(){u({type:"RESET"})},[r,u]),C.useEffect(function(){if(!r)return;const _=fi(r.getTextContent()),E=_;return _.promise.then(L=>{u({type:"RESOLVE",value:L})}).catch(L=>{u({type:"REJECT",error:L})}),()=>we(E)},[r,u]),C.useEffect(()=>{if(p!==void 0){if(p===!1){b();return}y()}},[p]);const v=C.useCallback(()=>{n&&n()},[n]),w=C.useCallback(k=>{At(!1,k.toString()),s&&s(k)},[s]);function A(){const k=g.current;k&&k.classList.add("selecting")}function x(){const k=g.current;k&&k.classList.remove("selecting")}const S=C.useMemo(()=>r.getViewport({scale:h,rotation:c}),[r,c,h]);return C.useLayoutEffect(function(){if(!r||!p)return;const{current:_}=g;if(!_)return;_.innerHTML="";const E=r.streamTextContent({includeMarkedContent:!0}),L={container:_,textContentSource:E,viewport:S},P=new ii(L),G=P;return P.render().then(()=>{const H=document.createElement("div");H.className="endOfContent",_.append(H);const O=_.querySelectorAll('[role="presentation"]');if(t){let $=0;p.items.forEach((M,R)=>{if(!oh(M))return;const U=O[$];if(!U)return;const nt=t({pageIndex:a,pageNumber:l,itemIndex:R,...M});U.innerHTML=nt,$+=M.str&&M.hasEOL?2:1})}v()}).catch(w),()=>we(G)},[t,w,v,r,a,l,p,S]),f.jsx("div",{className:$i("react-pdf__Page__textContent","textLayer"),onMouseUp:x,onMouseDown:A,ref:g})}const On=1;function jn(o){const e={...zr(),...o},{_className:i="react-pdf__Page",_enableRegisterUnregisterPage:s=!0,canvasBackground:n,canvasRef:r,children:a,className:l,customRenderer:c,customTextRenderer:h,devicePixelRatio:d,error:u="Failed to load the page.",height:p,inputRef:m,loading:g="Loading pageâ€¦",noData:y="No page specified.",onGetAnnotationsError:b,onGetAnnotationsSuccess:v,onGetStructTreeError:w,onGetStructTreeSuccess:A,onGetTextError:x,onGetTextSuccess:S,onLoadError:k,onLoadSuccess:_,onRenderAnnotationLayerError:E,onRenderAnnotationLayerSuccess:L,onRenderError:P,onRenderSuccess:G,onRenderTextLayerError:H,onRenderTextLayerSuccess:O,pageIndex:$,pageNumber:M,pdf:R,registerPage:U,renderAnnotationLayer:nt=!0,renderForms:St=!1,renderMode:Ot="canvas",renderTextLayer:tt=!0,rotate:X,scale:kt=On,unregisterPage:Lt,width:_t,...Z}=e,[Gt,Et]=je(),{value:rt,error:Jt}=Gt,Zt=C.useRef(null);Q(R);const q=he(M)?M-1:$??null,et=M??(he($)?$+1:null),pt=X??(rt?rt.rotate:null),ft=C.useMemo(()=>{if(!rt)return null;let re=1;const Se=kt??On;if(_t||p){const ae=rt.getViewport({scale:1,rotation:pt});_t?re=_t/ae.width:p&&(re=p/ae.height)}return Se*re},[p,rt,pt,kt,_t]);C.useEffect(function(){return()=>{he(q)&&s&&Lt&&Lt(q)}},[s,R,q,Lt]);function Ae(){if(_){if(!rt||!ft)return;_(As(rt,ft))}if(s&&U){if(!he(q)||!Zt.current)return;U(q,Zt.current)}}function Ue(){Jt&&(At(!1,Jt.toString()),k&&k(Jt))}C.useEffect(function(){Et({type:"RESET"})},[Et,R,q]),C.useEffect(function(){if(!R||!et)return;const Se=fi(R.getPage(et)),ae=Se;return Se.promise.then(Yi=>{Et({type:"RESOLVE",value:Yi})}).catch(Yi=>{Et({type:"REJECT",error:Yi})}),()=>we(ae)},[Et,R,et]),C.useEffect(()=>{if(rt!==void 0){if(rt===!1){Ue();return}Ae()}},[rt,ft]);const Xi=C.useMemo(()=>he(q)&&et&&he(pt)&&he(ft)?{_className:i,canvasBackground:n,customTextRenderer:h,devicePixelRatio:d,onGetAnnotationsError:b,onGetAnnotationsSuccess:v,onGetStructTreeError:w,onGetStructTreeSuccess:A,onGetTextError:x,onGetTextSuccess:S,onRenderAnnotationLayerError:E,onRenderAnnotationLayerSuccess:L,onRenderError:P,onRenderSuccess:G,onRenderTextLayerError:H,onRenderTextLayerSuccess:O,page:rt,pageIndex:q,pageNumber:et,renderForms:St,renderTextLayer:tt,rotate:pt,scale:ft}:null,[i,n,h,d,b,v,w,A,x,S,E,L,P,G,H,O,rt,q,et,St,tt,pt,ft]),sa=C.useMemo(()=>jr(Z,()=>rt&&(ft?As(rt,ft):void 0)),[Z,rt,ft]),mi=`${q}@${ft}/${pt}`;function na(){switch(Ot){case"custom":return Q(c),f.jsx(c,{},`${mi}_custom`);case"none":return null;case"canvas":default:return f.jsx(ah,{canvasRef:r},`${mi}_canvas`)}}function ra(){return tt?f.jsx(lh,{},`${mi}_text`):null}function aa(){return nt?f.jsx(th,{},`${mi}_annotations`):null}function oa(){function re(ae){return!!ae?.page}if(!re(Xi))throw new Error("page is undefined");const Se=typeof a=="function"?a(Xi):a;return f.jsxs($r.Provider,{value:Xi,children:[na(),ra(),aa(),Se]})}function la(){return et?R===null||rt===void 0||rt===null?f.jsx(Ne,{type:"loading",children:typeof g=="function"?g():g}):R===!1||rt===!1?f.jsx(Ne,{type:"error",children:typeof u=="function"?u():u}):oa():f.jsx(Ne,{type:"no-data",children:typeof y=="function"?y():y})}return f.jsx("div",{className:$i(i,l),"data-page-number":et,ref:Gr(m,Zt),style:{"--scale-round-x":"1px","--scale-round-y":"1px","--scale-factor":"1","--user-unit":`${ft}`,"--total-scale-factor":"calc(var(--scale-factor) * var(--user-unit))",backgroundColor:n||"white",position:"relative",minWidth:"min-content",minHeight:"min-content"},...sa,children:la()})}Xc();le.workerSrc="pdf.worker.mjs";le.workerSrc=`https://unpkg.com/pdfjs-dist@${si}/build/pdf.worker.min.mjs`;function ch({pdfPath:o}){const[t,e]=C.useState(null),[i,s]=C.useState(1),[n,r]=C.useState(1),[a,l]=C.useState(null),[c,h]=C.useState(600),[d,u]=C.useState(1),p=C.useMemo(()=>({cMapUrl:`https://unpkg.com/pdfjs-dist@${si}/cmaps/`,cMapPacked:!0,standardFontDataUrl:`https://unpkg.com/pdfjs-dist@${si}/standard_fonts/`}),[]),m=({numPages:x})=>{e(x),l(null)},g=x=>{console.error("Error loading PDF:",x),l("Failed to load PDF preview. Please try downloading it instead.")},y=()=>u(x=>Math.min(x+.25,2.5)),b=()=>u(x=>Math.max(x-.25,.5)),v=()=>u(1);C.useEffect(()=>{const x=()=>h(Math.min(600,window.innerWidth*.9));return x(),window.addEventListener("resize",x),()=>window.removeEventListener("resize",x)},[]);const w=x=>{x!==i&&s(x)},A=i!==n;return f.jsxs("div",{className:"w-full max-w-3xl mx-auto bg-white dark:bg-gray-800 rounded-lg shadow-sm overflow-hidden  border border-gray-200 dark:border-gray-700",children:[f.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700 flex flex-wrap justify-between items-center gap-2",children:[f.jsx("div",{className:"flex items-center space-x-2",children:t&&f.jsxs("span",{className:"text-xs font-medium text-gray-700 dark:text-gray-300",children:["Page ",i," of ",t]})}),f.jsxs("div",{className:"flex items-center space-x-2",children:[f.jsxs("div",{className:"flex items-center border border-gray-300 dark:border-gray-600 rounded-md divide-x divide-gray-300 dark:divide-gray-600",children:[f.jsx("button",{onClick:b,disabled:d<=.5,className:"px-2 py-1 text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600 disabled:opacity-50",title:"Zoom Out",children:f.jsx("svg",{className:"w-4 h-4 text-gray-700 dark:text-gray-200",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:f.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 12H4"})})}),f.jsxs("button",{onClick:v,className:"px-2 py-1 text-xs text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600",title:"Reset Zoom",children:[Math.round(d*100),"%"]}),f.jsx("button",{onClick:y,disabled:d>=2.5,className:"px-2 py-1 text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600 disabled:opacity-50",title:"Zoom In",children:f.jsx("svg",{className:"w-4 h-4 text-gray-700 dark:text-gray-200",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:f.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})})]}),f.jsx("a",{href:o,download:!0,className:"px-3 py-1.5 text-xs font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 transition-colors whitespace-nowrap",children:"Download PDF"})]})]}),f.jsx("div",{className:"overflow-auto h-[70vh] p-3 relative min-h-[500px]",children:a?f.jsxs("div",{className:"text-center p-6",children:[f.jsx("p",{className:"text-red-500 text-sm mb-3",children:a}),f.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-3",children:["Tried to load: ",o]}),f.jsx("a",{href:o,className:"text-blue-600 dark:text-blue-400 hover:underline text-sm",target:"_blank",rel:"noopener noreferrer",children:"Open PDF in new tab"})]}):f.jsx(Zc,{file:o,onLoadSuccess:m,onLoadError:g,options:p,loading:f.jsx("div",{className:"flex justify-center items-center h-48",children:f.jsx("div",{className:"animate-pulse text-gray-500 text-sm",children:"Loading PDF..."})}),children:f.jsxs("div",{className:"relative flex justify-center",children:[f.jsx(jn,{pageNumber:n,width:c*d,renderTextLayer:!0,renderAnnotationLayer:!0}),A&&f.jsxs("div",{className:"absolute inset-0 flex justify-center items-center z-10 bg-white/70 dark:bg-gray-800/70",children:[f.jsx(jn,{pageNumber:i,width:c*d,renderTextLayer:!0,renderAnnotationLayer:!0,onLoadSuccess:()=>r(i)}),f.jsxs("div",{className:"absolute animate-pulse text-gray-500 text-sm",children:["Loading page ",i,"..."]})]})]})})}),t>1&&f.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 flex justify-between items-center",children:[f.jsx("button",{onClick:()=>w(Math.max(i-1,1)),disabled:i<=1||A,className:"px-3 py-1.5 text-xs font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Previous"}),f.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-300",children:[i," / ",t]}),f.jsx("button",{onClick:()=>w(Math.min(i+1,t)),disabled:i>=t||A,className:"px-3 py-1.5 text-xs font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Next"})]})]})}const hh={hidden:{opacity:0},show:{opacity:1,transition:{when:"beforeChildren",staggerChildren:.08,delayChildren:.1}}},dh={hidden:{opacity:0,x:-20,scale:.95},show:{opacity:1,x:0,scale:1,transition:{type:"spring",stiffness:100,damping:15}},exit:{opacity:0,scale:.9,transition:{duration:.15}}},uh={hidden:{opacity:0,scale:.8},show:{opacity:1,scale:1,transition:{type:"spring",stiffness:200,damping:20}}},Bn={hidden:{opacity:0,x:20},show:{opacity:1,x:0,transition:{type:"spring",stiffness:100,damping:15}},exit:{opacity:0,x:20,transition:{duration:.2}}},ph=()=>{const[o,t]=C.useState(null),[e,i]=C.useState(null),[s,n]=C.useState("All"),r=C.useRef(null),a=["All",...new Set(Zi.map(d=>d.category))],l=s==="All"?Zi:Zi.filter(d=>d.category===s),c=d=>{t(d),document.getElementById("pdf-viewer")?.scrollIntoView({behavior:"smooth"})},h=d=>{n(d)};return f.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50/50 via-white to-purple-50/50 dark:from-gray-900/50 dark:via-gray-950 dark:to-purple-900/50 pt-20 pb-12 px-4 sm:px-6",children:f.jsxs(T.div,{className:"max-w-7xl mx-auto",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},ref:r,children:[f.jsxs("div",{className:"space-y-4 mb-8 mt-10",children:[f.jsx(T.h1,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.2,ease:[.25,.46,.45,.94]},className:"text-2xl sm:text-3xl lg:text-4xl font-bold tracking-tight text-center",children:f.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-purple-600 via-blue-600 to-emerald-600 dark:from-purple-400 dark:via-blue-400 dark:to-emerald-400",children:"RESOURCES"})}),f.jsx(T.div,{initial:{opacity:0,y:15},animate:{opacity:1,y:0},transition:{duration:.6,delay:.3,ease:[.25,.46,.45,.94]},className:"space-y-2 text-center",children:f.jsx("h2",{className:"text-lg sm:text-xl font-light text-gray-600 dark:text-gray-400",children:"Valuable Assets & Knowledge Repository"})})]}),f.jsx(T.div,{className:"flex flex-wrap justify-center gap-3 mb-8",variants:hh,initial:"hidden",animate:"show",children:a.map(d=>f.jsx(T.button,{variants:uh,onClick:()=>h(d),whileHover:{scale:1.05},whileTap:{scale:.95},className:`px-4 py-2 rounded-full text-sm font-medium transition-colors ${s===d?"bg-gradient-to-r from-blue-600 to-cyan-500 text-white shadow-lg shadow-blue-500/20":"bg-white dark:bg-gray-800/50 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700/50 border border-gray-200 dark:border-gray-700/50"}`,children:d},d))}),f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[f.jsx(T.div,{className:"md:col-span-1",children:f.jsxs(T.div,{className:"space-y-3 max-h-[70vh] overflow-y-auto pr-2 scrollbar-thin scrollbar-thumb-gray-300 dark:scrollbar-thumb-gray-700 scrollbar-track-transparent",layout:!0,children:[f.jsx(ie,{mode:"popLayout",children:l.map(d=>f.jsxs(T.div,{variants:dh,initial:"hidden",animate:"show",exit:"exit",layout:!0,layoutId:`resource-${d.id}`,onClick:()=>c(d.pdfPath),onHoverStart:()=>i(d.id),onHoverEnd:()=>i(null),whileHover:{y:-2,boxShadow:"0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)",transition:{type:"spring",stiffness:400,damping:10}},whileTap:{scale:.98},className:`relative p-4 rounded-xl cursor-pointer transition-colors ${o===d.pdfPath?"bg-blue-50 dark:bg-blue-900/30 border-l-4 border-blue-500":"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700"}`,children:[f.jsx("h3",{className:"font-medium text-gray-900 dark:text-white text-sm pr-6",children:d.title}),f.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-300 mt-1 line-clamp-2",children:d.description}),f.jsxs("div",{className:"flex justify-between items-center mt-3",children:[f.jsx("span",{className:"text-xs px-2.5 py-1 bg-blue-100 dark:bg-blue-900/50 text-blue-800 dark:text-blue-100 rounded-full",children:d.category}),f.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:new Date(d.date).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})})]}),f.jsx(T.div,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-blue-500",initial:{opacity:0,x:-5},animate:{opacity:o===d.pdfPath?1:0,x:o===d.pdfPath?0:-5},transition:{type:"spring",stiffness:300,damping:20},children:f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:f.jsx("path",{fillRule:"evenodd",d:"M16.707 10.293a1 1 0 010 1.414l-6 6a1 1 0 01-1.414 0l-6-6a1 1 0 111.414-1.414L9 14.586V3a1 1 0 012 0v11.586l4.293-4.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]},d.id))}),l.length===0&&f.jsx(T.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center py-12",children:f.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No resources found in this category"})})]})}),f.jsx(T.div,{id:"pdf-viewer",className:"md:col-span-2 max-w-4xl mx-auto w-full",layout:!0,children:f.jsx(ie,{mode:"wait",children:o?f.jsx(T.div,{variants:Bn,initial:"hidden",animate:"show",exit:"exit",className:"w-[95%] mx-auto",children:f.jsx(ch,{pdfPath:o})},"pdf-content"):f.jsxs(T.div,{variants:Bn,initial:"hidden",animate:"show",exit:"exit",className:"flex flex-col items-center justify-center h-96 text-gray-500 dark:text-gray-400 bg-white dark:bg-gray-800 rounded-xl shadow-sm w-full max-w-2xl mx-auto border-2 border-dashed border-gray-200 dark:border-gray-700",children:[f.jsx(T.div,{className:"w-20 h-20 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center mb-4",animate:{scale:[1,1.05,1],rotate:[0,5,-5,0]},transition:{duration:3,repeat:1/0,repeatType:"reverse"},children:f.jsx("svg",{className:"w-10 h-10 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:f.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),f.jsx(T.h3,{className:"text-xl font-medium text-gray-700 dark:text-gray-300 mb-2",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2},children:"No Resource Selected"}),f.jsx(T.p,{className:"text-gray-500 dark:text-gray-400 text-center max-w-md px-4",initial:{opacity:0,y:10},animate:{opacity:.8,y:0},transition:{delay:.3},children:"Select a resource from the list to view its contents"})]},"empty-state")})})]})]})})},gd=Object.freeze(Object.defineProperty({__proto__:null,default:ph},Symbol.toStringTag,{value:"Module"}));class gi{constructor(t=0,e="Network Error"){this.status=t,this.text=e}}const fh=()=>{if(!(typeof localStorage>"u"))return{get:o=>Promise.resolve(localStorage.getItem(o)),set:(o,t)=>Promise.resolve(localStorage.setItem(o,t)),remove:o=>Promise.resolve(localStorage.removeItem(o))}},vt={origin:"https://api.emailjs.com",blockHeadless:!1,storageProvider:fh()},Ws=o=>o?typeof o=="string"?{publicKey:o}:o.toString()==="[object Object]"?o:{}:{},gh=(o,t="https://api.emailjs.com")=>{if(!o)return;const e=Ws(o);vt.publicKey=e.publicKey,vt.blockHeadless=e.blockHeadless,vt.storageProvider=e.storageProvider,vt.blockList=e.blockList,vt.limitRate=e.limitRate,vt.origin=e.origin||t},Yr=async(o,t,e={})=>{const i=await fetch(vt.origin+o,{method:"POST",headers:e,body:t}),s=await i.text(),n=new gi(i.status,s);if(i.ok)return n;throw n},Kr=(o,t,e)=>{if(!o||typeof o!="string")throw"The public key is required. Visit https://dashboard.emailjs.com/admin/account";if(!t||typeof t!="string")throw"The service ID is required. Visit https://dashboard.emailjs.com/admin";if(!e||typeof e!="string")throw"The template ID is required. Visit https://dashboard.emailjs.com/admin/templates"},mh=o=>{if(o&&o.toString()!=="[object Object]")throw"The template params have to be the object. Visit https://www.emailjs.com/docs/sdk/send/"},Qr=o=>o.webdriver||!o.languages||o.languages.length===0,Jr=()=>new gi(451,"Unavailable For Headless Browser"),bh=(o,t)=>{if(!Array.isArray(o))throw"The BlockList list has to be an array";if(typeof t!="string")throw"The BlockList watchVariable has to be a string"},yh=o=>!o.list?.length||!o.watchVariable,wh=(o,t)=>o instanceof FormData?o.get(t):o[t],Zr=(o,t)=>{if(yh(o))return!1;bh(o.list,o.watchVariable);const e=wh(t,o.watchVariable);return typeof e!="string"?!1:o.list.includes(e)},ta=()=>new gi(403,"Forbidden"),vh=(o,t)=>{if(typeof o!="number"||o<0)throw"The LimitRate throttle has to be a positive number";if(t&&typeof t!="string")throw"The LimitRate ID has to be a non-empty string"},xh=async(o,t,e)=>{const i=Number(await e.get(o)||0);return t-Date.now()+i},ea=async(o,t,e)=>{if(!t.throttle||!e)return!1;vh(t.throttle,t.id);const i=t.id||o;return await xh(i,t.throttle,e)>0?!0:(await e.set(i,Date.now().toString()),!1)},ia=()=>new gi(429,"Too Many Requests"),Ah=async(o,t,e,i)=>{const s=Ws(i),n=s.publicKey||vt.publicKey,r=s.blockHeadless||vt.blockHeadless,a=s.storageProvider||vt.storageProvider,l={...vt.blockList,...s.blockList},c={...vt.limitRate,...s.limitRate};return r&&Qr(navigator)?Promise.reject(Jr()):(Kr(n,o,t),mh(e),e&&Zr(l,e)?Promise.reject(ta()):await ea(location.pathname,c,a)?Promise.reject(ia()):Yr("/api/v1.0/email/send",JSON.stringify({lib_version:"4.4.1",user_id:n,service_id:o,template_id:t,template_params:e}),{"Content-type":"application/json"}))},Sh=o=>{if(!o||o.nodeName!=="FORM")throw"The 3rd parameter is expected to be the HTML form element or the style selector of the form"},kh=o=>typeof o=="string"?document.querySelector(o):o,_h=async(o,t,e,i)=>{const s=Ws(i),n=s.publicKey||vt.publicKey,r=s.blockHeadless||vt.blockHeadless,a=vt.storageProvider||s.storageProvider,l={...vt.blockList,...s.blockList},c={...vt.limitRate,...s.limitRate};if(r&&Qr(navigator))return Promise.reject(Jr());const h=kh(e);Kr(n,o,t),Sh(h);const d=new FormData(h);return Zr(l,d)?Promise.reject(ta()):await ea(location.pathname,c,a)?Promise.reject(ia()):(d.append("lib_version","4.4.1"),d.append("service_id",o),d.append("template_id",t),d.append("user_id",n),Yr("/api/v1.0/email/send-form",d))},Eh={init:gh,send:Ah,sendForm:_h,EmailJSResponseStatus:gi},Ch=["badword1","badword2"],Hn={MAX_REQUESTS:3,WINDOW_MS:600*1e3},Un=2,zn=20,Gn=500,Th={hidden:{opacity:0},visible:{opacity:1,transition:{duration:.4,ease:"easeOut"}}},_e={hidden:{opacity:0,y:25},visible:(o=0)=>({opacity:1,y:0,transition:{delay:o*.15,type:"spring",stiffness:80,damping:14}})},cs=()=>{const o=Math.floor(Math.random()*10)+1,t=Math.floor(Math.random()*5)+1;return{question:`What is ${o} + ${t}?`,answer:o+t}},$n=o=>o.trim().split(/\s+/).filter(t=>t.length>0).length;function Lh(){const[o,t]=C.useState({name:"",email:"",subject:"",message:"",website:"",botCheck:""}),[e,i]=C.useState(!1),[s,n]=C.useState({success:null,message:""}),[r,a]=C.useState(cs()),[l,c]=C.useState(0),h=C.useRef(null),[d,u]=C.useState(()=>{const w=localStorage.getItem("contactFormTimestamps");return w?JSON.parse(w):[]});C.useEffect(()=>{localStorage.setItem("contactFormTimestamps",JSON.stringify(d))},[d]),C.useEffect(()=>()=>{h.current&&clearTimeout(h.current)},[]);const p=w=>w?String(w).replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"):"",m=w=>{const A=w.toLowerCase();return Ch.some(x=>A.includes(x))},g=()=>{const w=Date.now();return d.filter(x=>w-x<Hn.WINDOW_MS).length>=Hn.MAX_REQUESTS},y=w=>{const{name:A,value:x}=w.target;t(S=>({...S,[A]:p(x)}))},b=w=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(String(w).toLowerCase()),v=async w=>{w.preventDefault();const A=Date.now();if(A-l<5e3){n({success:!1,message:"Please wait a moment before sending another message."});return}if(o.website){console.log("Bot detected (honeypot)");return}if(parseInt(o.botCheck,10)!==r.answer){n({success:!1,message:"Please answer the math question correctly."}),a(cs());return}if(!o.name||!o.email||!o.message){n({success:!1,message:"Please fill in all required fields."});return}if(!b(o.email)){n({success:!1,message:"Please enter a valid email address."});return}const x=o.message.split(/\n/).filter(k=>k.trim().length>0),S=$n(o.message);if(x.length<Un){n({success:!1,message:`Your message must contain at least ${Un} paragraphs (use a blank line to separate).`});return}if(S<zn){n({success:!1,message:`Message too short â€“ please write at least ${zn} words (you have ${S}).`});return}if(S>Gn){n({success:!1,message:`Message too long â€“ keep it under ${Gn} words.`});return}if(g()){n({success:!1,message:"Too many requests. Try again later."});return}if(m(o.name)||m(o.message)||m(o.subject)){n({success:!1,message:"Your message contains inappropriate language."});return}i(!0),n({success:null,message:""}),c(A),u(k=>[...k,A]);try{const{website:k,botCheck:_,...E}=o;await Eh.send("service_73sgf1a","template_nqfno4q",E,"H-ggagzVwQ5xyXv-z"),n({success:!0,message:"Your message has been sent! I'll reply soon."}),t({name:"",email:"",subject:"",message:"",website:"",botCheck:""}),a(cs())}catch(k){console.error(k),n({success:!1,message:"Failed to send. Try again later or email me directly."})}finally{i(!1),s.success&&(h.current=setTimeout(()=>{n({success:null,message:""})},5e3))}};return f.jsx(T.div,{className:"min-h-screen mt-10 bg-gradient-to-br from-gray-50 via-white to-gray-50 dark:from-gray-950 dark:via-gray-900 dark:to-gray-950 flex items-center justify-center",variants:Th,initial:"hidden",animate:"visible",children:f.jsxs("div",{className:"flex flex-col items-center justify-center w-full px-4 sm:px-6 lg:px-8 py-8",children:[f.jsxs("div",{className:"w-full max-w-4xl text-center mb-12",children:[f.jsx(T.h1,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.2,ease:[.25,.46,.45,.94]},className:"text-2xl sm:text-3xl lg:text-4xl font-bold tracking-tight",children:f.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-purple-600 via-blue-600 to-emerald-600 dark:from-purple-400 dark:via-blue-400 dark:to-emerald-400",children:"GET IN TOUCH"})}),f.jsxs(T.div,{initial:{opacity:0,y:15},animate:{opacity:1,y:0},transition:{duration:.6,delay:.3,ease:[.25,.46,.45,.94]},className:"space-y-2",children:[f.jsx("p",{className:"text-lg sm:text-xl font-light text-gray-600 dark:text-gray-400",children:"Have a project in mind or want to discuss potential opportunities?"}),f.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"I'll get back to you as soon as possible."})]})]}),f.jsxs(T.div,{initial:"hidden",animate:"visible",variants:{visible:{opacity:1,y:0,transition:{duration:.5}},hidden:{opacity:0,y:20}},className:"w-full max-w-3xl bg-white dark:bg-gray-800 rounded-2xl p-6 sm:p-8 shadow-lg dark:shadow-gray-800/10",children:[s.message&&f.jsx(T.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{type:"spring",stiffness:80,damping:12},className:`mb-4 p-3 rounded-lg text-sm ${s.success?"bg-green-50 dark:bg-green-900/30 text-green-700 dark:text-green-200":"bg-red-50 dark:bg-red-900/30 text-red-700 dark:text-red-200"}`,children:s.message}),f.jsxs("form",{onSubmit:v,className:"space-y-4 relative",children:[f.jsxs("div",{style:{position:"absolute",left:"-5000px"},"aria-hidden":"true",children:[f.jsx("label",{htmlFor:"website",children:"Leave blank if human"}),f.jsx("input",{type:"text",id:"website",name:"website",tabIndex:"-1",value:o.website,onChange:y})]}),f.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[f.jsxs(T.div,{variants:_e,custom:0,whileHover:{scale:1.02},children:[f.jsxs("label",{htmlFor:"name",className:"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1",children:["Name ",f.jsx("span",{className:"text-red-500",children:"*"})]}),f.jsx("input",{type:"text",id:"name",name:"name",required:!0,value:o.name,onChange:y,placeholder:"John Doe",className:"block w-full px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-600 focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white/50 dark:bg-gray-800/80 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-500 transition-all duration-200"})]}),f.jsxs(T.div,{variants:_e,custom:1,whileHover:{scale:1.02},children:[f.jsxs("label",{htmlFor:"email",className:"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1",children:["Email ",f.jsx("span",{className:"text-red-500",children:"*"})]}),f.jsx("input",{type:"email",id:"email",name:"email",required:!0,value:o.email,onChange:y,placeholder:"you@example.com",className:"block w-full px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-600 focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white/50 dark:bg-gray-800/80 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-500 transition-all duration-200"})]}),f.jsxs(T.div,{variants:_e,custom:2,className:"sm:col-span-2",children:[f.jsx("label",{htmlFor:"subject",className:"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1",children:"Subject"}),f.jsx("input",{type:"text",id:"subject",name:"subject",value:o.subject,onChange:y,placeholder:"How can I help?",className:"block w-full px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-600 focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white/50 dark:bg-gray-800/80 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-500 transition-all duration-200"})]}),f.jsxs(T.div,{variants:_e,custom:3,className:"sm:col-span-2",children:[f.jsxs("label",{htmlFor:"message",className:"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1",children:["Message ",f.jsx("span",{className:"text-red-500",children:"*"})]}),f.jsx("textarea",{id:"message",name:"message",rows:5,required:!0,value:o.message,onChange:y,placeholder:"Write your message...",className:"block w-full px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-600 focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white/50 dark:bg-gray-800/80 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-500 transition-all duration-200 resize-none"}),f.jsxs("div",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:[$n(o.message)," words â€¢"," ",o.message.split(/\n/).filter(w=>w.trim()).length," ","paragraph(s)"]})]}),f.jsxs(T.div,{variants:_e,custom:4,className:"sm:col-span-2 space-y-2",children:[f.jsxs("label",{htmlFor:"botCheck",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[r.question," ",f.jsx("span",{className:"text-red-500",children:"*"})]}),f.jsx("input",{type:"number",id:"botCheck",name:"botCheck",required:!0,value:o.botCheck,onChange:y,placeholder:"Answer",className:"block w-full px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-600 focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white/50 dark:bg-gray-800/80 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-500 transition-all duration-200"}),f.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 flex items-center gap-1",children:[f.jsx(Ba,{className:"w-3 h-3"}),"Spam protection"]})]})]}),f.jsx(T.div,{variants:_e,custom:5,className:"pt-2",children:f.jsx(T.button,{type:"submit",disabled:e,whileHover:e?{}:{scale:1.02},whileTap:e?{}:{scale:.98},className:`relative w-full flex items-center justify-center px-5 py-2.5 rounded-xl text-sm font-medium text-white bg-gradient-to-r from-blue-600 to-cyan-500 hover:from-blue-700 hover:to-cyan-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all duration-200 shadow-sm hover:shadow-md ${e?"opacity-85 cursor-not-allowed":""}`,children:e?f.jsxs(f.Fragment,{children:[f.jsx(Ia,{className:"animate-spin -ml-1 mr-2 h-4 w-4"}),"Sendingâ€¦"]}):f.jsxs(f.Fragment,{children:["Send Message",f.jsx(Ss,{className:"ml-2 h-4 w-4"})]})})})]})]})]})})}const md=Object.freeze(Object.defineProperty({__proto__:null,default:Lh},Symbol.toStringTag,{value:"Module"}));export{Dh as A,Wn as B,Uh as C,Xn as D,oo as E,no as F,dt as G,nd as H,ad as I,sd as J,rd as K,hd as L,$h as M,td as N,od as O,ld as P,Jn as Q,gd as R,Xh as S,Kh as T,md as U,Jh as X,Zh as Z,Gh as a,zh as b,Fh as c,Wh as d,cd as e,dd as f,ud as g,pd as h,Yh as i,Ih as j,Oh as k,Hh as l,Qh as m,jh as n,Bh as o,Ss as p,Yn as q,qn as r,Vh as s,Nh as t,Ca as u,qh as v,ho as w,ed as x,lo as y,id as z};
