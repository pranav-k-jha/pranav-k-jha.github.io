var Yi=o=>{throw TypeError(o)};var Js=(o,t,e)=>t.has(o)||Yi("Cannot "+e);var st=(o,t,e)=>(Js(o,t,"read from private field"),e?e.call(o):t.get(o)),$t=(o,t,e)=>t.has(o)?Yi("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(o):t.set(o,e),Pt=(o,t,e,s)=>(Js(o,t,"write to private field"),s?s.call(o,e):t.set(o,e),e),Vt=(o,t,e)=>(Js(o,t,"access private method"),e);var Ki=(o,t,e,s)=>({set _(i){Pt(o,t,i,e)},get _(){return st(o,t,s)}});import{r as C,R as me,L as Te,u as ua,a as pa,g as fa}from"./react-CM8CWKx_.js";import{j as p,m as P,A as se,u as ga}from"./animations-CfQA6OJG.js";const ma=o=>o.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),ba=o=>o.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,e,s)=>s?s.toUpperCase():e.toLowerCase()),Qi=o=>{const t=ba(o);return t.charAt(0).toUpperCase()+t.slice(1)},Wn=(...o)=>o.filter((t,e,s)=>!!t&&t.trim()!==""&&s.indexOf(t)===e).join(" ").trim(),ya=o=>{for(const t in o)if(t.startsWith("aria-")||t==="role"||t==="title")return!0};var wa={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const xa=C.forwardRef(({color:o="currentColor",size:t=24,strokeWidth:e=2,absoluteStrokeWidth:s,className:i="",children:n,iconNode:r,...a},l)=>C.createElement("svg",{ref:l,...wa,width:t,height:t,stroke:o,strokeWidth:s?Number(e)*24/Number(t):e,className:Wn("lucide",i),...!n&&!ya(a)&&{"aria-hidden":"true"},...a},[...r.map(([c,h])=>C.createElement(c,h)),...Array.isArray(n)?n:[n]]));const Y=(o,t)=>{const e=C.forwardRef(({className:s,...i},n)=>C.createElement(xa,{ref:n,iconNode:t,className:Wn(`lucide-${ma(Qi(o))}`,`lucide-${o}`,s),...i}));return e.displayName=Qi(o),e};const va=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],Bh=Y("activity",va);const Aa=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],Hh=Y("arrow-left",Aa);const ka=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],_i=Y("arrow-right",ka);const Sa=[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]],Uh=Y("book-open",Sa);const _a=[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]],zh=Y("bot",_a);const Ea=[["path",{d:"M12 18V5",key:"adv99a"}],["path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4",key:"1e3is1"}],["path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5",key:"1gqd8o"}],["path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77",key:"iwvgf7"}],["path",{d:"M18 18a4 4 0 0 0 2-7.464",key:"efp6ie"}],["path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517",key:"1gq6am"}],["path",{d:"M6 18a4 4 0 0 1-2-7.464",key:"k1g0md"}],["path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77",key:"q97ue3"}]],qn=Y("brain",Ea);const Ca=[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]],Gh=Y("briefcase",Ca);const Ta=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],$h=Y("calendar",Ta);const La=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Pa=Y("circle-check-big",La);const Ma=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Vh=Y("clock",Ma);const Ra=[["path",{d:"m18 16 4-4-4-4",key:"1inbqp"}],["path",{d:"m6 8-4 4 4 4",key:"15zrgr"}],["path",{d:"m14.5 4-5 16",key:"e7oirm"}]],Wh=Y("code-xml",Ra);const Na=[["path",{d:"m16 18 6-6-6-6",key:"eg8j8"}],["path",{d:"m8 6-6 6 6 6",key:"ppft3o"}]],Xn=Y("code",Na);const Da=[["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M17 20v2",key:"1rnc9c"}],["path",{d:"M17 2v2",key:"11trls"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M2 17h2",key:"7oei6x"}],["path",{d:"M2 7h2",key:"asdhe0"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"M20 17h2",key:"1fpfkl"}],["path",{d:"M20 7h2",key:"1o8tra"}],["path",{d:"M7 20v2",key:"4gnj0m"}],["path",{d:"M7 2v2",key:"1i4yhu"}],["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"8",y:"8",width:"8",height:"8",rx:"1",key:"z9xiuo"}]],qh=Y("cpu",Da);const Ia=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]],Yn=Y("database",Ia);const Fa=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],Xh=Y("globe",Fa);const Oa=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],ja=Y("loader-circle",Oa);const Ba=[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]],Yh=Y("menu",Ba);const Ha=[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]],Kh=Y("moon",Ha);const Ua=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],za=Y("shield-alert",Ua);const Ga=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],Qh=Y("shield",Ga);const $a=[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]],Kn=Y("smartphone",$a);const Va=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],Jh=Y("sparkles",Va);const Wa=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],Zh=Y("star",Wa);const qa=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],td=Y("sun",qa);const Xa=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],ed=Y("target",Xa);const Ya=[["path",{d:"M12 19h8",key:"baeox8"}],["path",{d:"m4 17 6-6-6-6",key:"1yngyt"}]],sd=Y("terminal",Ya);const Ka=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],id=Y("trending-up",Ka);const Qa=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],nd=Y("x",Qa);const Ja=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],Za=Y("zap",Ja);var Qn={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},Ji=me.createContext&&me.createContext(Qn),to=["attr","size","title"];function eo(o,t){if(o==null)return{};var e=so(o,t),s,i;if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(o);for(i=0;i<n.length;i++)s=n[i],!(t.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(o,s)&&(e[s]=o[s])}return e}function so(o,t){if(o==null)return{};var e={};for(var s in o)if(Object.prototype.hasOwnProperty.call(o,s)){if(t.indexOf(s)>=0)continue;e[s]=o[s]}return e}function Rs(){return Rs=Object.assign?Object.assign.bind():function(o){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(o[s]=e[s])}return o},Rs.apply(this,arguments)}function Zi(o,t){var e=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(o,i).enumerable})),e.push.apply(e,s)}return e}function Ns(o){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?Zi(Object(e),!0).forEach(function(s){io(o,s,e[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(e)):Zi(Object(e)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(e,s))})}return o}function io(o,t,e){return t=no(t),t in o?Object.defineProperty(o,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):o[t]=e,o}function no(o){var t=ro(o,"string");return typeof t=="symbol"?t:t+""}function ro(o,t){if(typeof o!="object"||!o)return o;var e=o[Symbol.toPrimitive];if(e!==void 0){var s=e.call(o,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(o)}function Jn(o){return o&&o.map((t,e)=>me.createElement(t.tag,Ns({key:e},t.attr),Jn(t.child)))}function ct(o){return t=>me.createElement(ao,Rs({attr:Ns({},o.attr)},t),Jn(o.child))}function ao(o){var t=e=>{var{attr:s,size:i,title:n}=o,r=eo(o,to),a=i||e.size||"1em",l;return e.className&&(l=e.className),o.className&&(l=(l?l+" ":"")+o.className),me.createElement("svg",Rs({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},e.attr,s,r,{className:l,style:Ns(Ns({color:o.color||e.color},e.style),o.style),height:a,width:a,xmlns:"http://www.w3.org/2000/svg"}),n&&me.createElement("title",null,n),o.children)};return Ji!==void 0?me.createElement(Ji.Consumer,null,e=>t(e)):t(Qn)}function oo(o){return ct({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"19",y1:"12",x2:"5",y2:"12"},child:[]},{tag:"polyline",attr:{points:"12 19 5 12 12 5"},child:[]}]})(o)}function Zs(o){return ct({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"5",y1:"12",x2:"19",y2:"12"},child:[]},{tag:"polyline",attr:{points:"12 5 19 12 12 19"},child:[]}]})(o)}function lo(o){return ct({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"12",y1:"19",x2:"12",y2:"5"},child:[]},{tag:"polyline",attr:{points:"5 12 12 5 19 12"},child:[]}]})(o)}function co(o){return ct({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"12",y1:"20",x2:"12",y2:"10"},child:[]},{tag:"line",attr:{x1:"18",y1:"20",x2:"18",y2:"4"},child:[]},{tag:"line",attr:{x1:"6",y1:"20",x2:"6",y2:"16"},child:[]}]})(o)}function Zn(o){return ct({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"},child:[]},{tag:"path",attr:{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"},child:[]}]})(o)}function ho(o){return ct({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"},child:[]},{tag:"line",attr:{x1:"16",y1:"2",x2:"16",y2:"6"},child:[]},{tag:"line",attr:{x1:"8",y1:"2",x2:"8",y2:"6"},child:[]},{tag:"line",attr:{x1:"3",y1:"10",x2:"21",y2:"10"},child:[]}]})(o)}function tr(o){return ct({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"6 9 12 15 18 9"},child:[]}]})(o)}function uo(o){return ct({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"},child:[]},{tag:"polyline",attr:{points:"12 6 12 12 16 14"},child:[]}]})(o)}function rd(o){return ct({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"},child:[]}]})(o)}function po(o){return ct({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"16 18 22 12 16 6"},child:[]},{tag:"polyline",attr:{points:"8 6 2 12 8 18"},child:[]}]})(o)}function fo(o){return ct({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"4",y:"4",width:"16",height:"16",rx:"2",ry:"2"},child:[]},{tag:"rect",attr:{x:"9",y:"9",width:"6",height:"6"},child:[]},{tag:"line",attr:{x1:"9",y1:"1",x2:"9",y2:"4"},child:[]},{tag:"line",attr:{x1:"15",y1:"1",x2:"15",y2:"4"},child:[]},{tag:"line",attr:{x1:"9",y1:"20",x2:"9",y2:"23"},child:[]},{tag:"line",attr:{x1:"15",y1:"20",x2:"15",y2:"23"},child:[]},{tag:"line",attr:{x1:"20",y1:"9",x2:"23",y2:"9"},child:[]},{tag:"line",attr:{x1:"20",y1:"14",x2:"23",y2:"14"},child:[]},{tag:"line",attr:{x1:"1",y1:"9",x2:"4",y2:"9"},child:[]},{tag:"line",attr:{x1:"1",y1:"14",x2:"4",y2:"14"},child:[]}]})(o)}function ad(o){return ct({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"ellipse",attr:{cx:"12",cy:"5",rx:"9",ry:"3"},child:[]},{tag:"path",attr:{d:"M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"},child:[]},{tag:"path",attr:{d:"M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"},child:[]}]})(o)}function Ds(o){return ct({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"},child:[]},{tag:"polyline",attr:{points:"15 3 21 3 21 9"},child:[]},{tag:"line",attr:{x1:"10",y1:"14",x2:"21",y2:"3"},child:[]}]})(o)}function od(o){return ct({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"},child:[]},{tag:"polyline",attr:{points:"14 2 14 8 20 8"},child:[]},{tag:"line",attr:{x1:"16",y1:"13",x2:"8",y2:"13"},child:[]},{tag:"line",attr:{x1:"16",y1:"17",x2:"8",y2:"17"},child:[]},{tag:"polyline",attr:{points:"10 9 9 9 8 9"},child:[]}]})(o)}function ld(o){return ct({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"},child:[]},{tag:"polyline",attr:{points:"13 2 13 9 20 9"},child:[]}]})(o)}function go(o){return ct({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"},child:[]}]})(o)}function cd(o){return ct({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"6",y1:"3",x2:"6",y2:"15"},child:[]},{tag:"circle",attr:{cx:"18",cy:"6",r:"3"},child:[]},{tag:"circle",attr:{cx:"6",cy:"18",r:"3"},child:[]},{tag:"path",attr:{d:"M18 9a9 9 0 0 1-9 9"},child:[]}]})(o)}function ui(o){return ct({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"},child:[]}]})(o)}function er(o){return ct({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"12 2 2 7 12 12 22 7 12 2"},child:[]},{tag:"polyline",attr:{points:"2 17 12 22 22 17"},child:[]},{tag:"polyline",attr:{points:"2 12 12 17 22 12"},child:[]}]})(o)}function hd(o){return ct({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"},child:[]}]})(o)}function mo(o){return ct({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"5 3 19 12 5 21 5 3"},child:[]}]})(o)}function dd(o){return ct({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"},child:[]}]})(o)}function ud(o){return ct({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2"},child:[]}]})(o)}const ti=[{id:1,title:"Ecole De Conduite Educar",startDate:"August 2025",endDate:"September 2025",associatedWith:"",description:"Designed, developed, and currently maintain the Ecole De Conduite Educar website using Next.js, React, Tailwind CSS, and TypeScript.",skills:["Next.js","React","Tailwind CSS","TypeScript","Web Development","Responsive Design"],link:"https://educar-ecoledeconduite.ca/",notes:"Featured Project",imageUrl:"/images/projects/project-1.png",category:"web",isFeatured:!0},{id:2,title:"MKJHA Consulting Website",startDate:"April 2025",endDate:"May 2025",associatedWith:"MKJHA CONSULTING",description:"Designed, developed, and currently maintain the MKJHA Consulting website using Next.js, React, Tailwind CSS, and TypeScript. The site features a modern, responsive design with an emphasis on user experience and accessibility.",skills:["Next.js","Tailwind CSS","TypeScript","Web Development","Website Design","Website Development"],link:"https://www.mkjhaconsult.com",notes:null,imageUrl:"/images/projects/project-2.png",category:"web"},{id:3,title:"4C Research Lab Website",startDate:"May 2025",endDate:"Present",associatedWith:"Western University",description:"Designed, developed, and currently maintain the 4C Research Lab website using Next.js, React, Tailwind CSS, and TypeScript. The site features a modern, responsive design with database integration.",skills:["Next.js","React","Tailwind CSS","TypeScript","Database Design","Analytics","Web Development","Research Data Management","Data Visualization"],link:"https://4c-research.vercel.app/",notes:null,imageUrl:"/images/projects/project-3.png",category:"web"},{id:4,title:"Beaut-AI Mobile Application",startDate:"December 2025",endDate:"January 2025",associatedWith:"Beaut Ai",description:"Developed a comprehensive mobile application with React Native and Expo Router, featuring advanced backend authentication, GraphQL API integration, and NestJS microservices architecture. The app provides AI-powered beauty and wellness solutions with secure user management, real-time data synchronization, and seamless cross-platform performance.",skills:["React Native","Expo Router","GraphQL","NestJS","Mobile Development","Backend Authentication","JWT","Microservices","API Development","Cross-Platform Development","TypeScript","Node.js","Database Design","Real-time Sync","Mobile UI/UX"],link:null,notes:"Full-stack mobile application with advanced authentication and AI integration",imageUrl:"https://images.unsplash.com/photo-1512941937669-90a1b58e7e9c?auto=format&fit=crop&q=80",videoUrl:"https://drive.google.com/file/d/1FIjJpagUK7Lwc64iPaNmUl8VIEEiPBP3/view?usp=drive_link",category:"app"},{id:5,title:"Chat Interface",startDate:"March 2023",endDate:"April 2023",associatedWith:"Western University",description:"Developed an interactive chat interface using React, Tailwind CSS, and Framer Motion. The application features real-time communication with multiple LLMs through a FastAPI backend. Key features include real-time chat with streaming responses, file upload and processing with RAG for document analysis, animated loading states with a 'thinking' indicator, and responsive UI with smooth animations. The application is containerized with Docker and deployed on UBC's HPC infrastructure.",skills:["React","FastAPI","LLM Integration","RAG","Docker","Tailwind CSS","Framer Motion","Redux","React-Query","Web Development","Real-time Chat","API Integration","State Management","Data Fetching"],notes:null,imageUrl:"/images/projects/project-4.png",category:"web"},{id:6,title:"REST Countries API with Color Theme Switcher and Dark Mode",startDate:"March 2024",endDate:"March 2024",associatedWith:"Frontend Mentor",description:"This project is a solution to the REST Countries API with Color Theme Switcher and Dark Mode challenge from Frontend Mentor.",challengeLink:{url:"https://www.frontendmentor.io/challenges/rest-countries-api-with-color-theme-switcher-5cacc469fec04111f7b848ca",text:"View Challenge on Frontend Mentor"},skills:["React","Tailwind CSS","Web Development","Responsive Design","Dark Mode","Color Theme Switcher"],notes:null,imageUrl:"/images/projects/project-6.png",category:"personal",link:"https://countries-api-react-gray.vercel.app/"}],bo={hidden:{opacity:0,y:30},visible:o=>({opacity:1,y:0,transition:{delay:o*.1,duration:.5,ease:[.25,.1,.25,1],when:"beforeChildren",staggerChildren:.1}}),exit:{opacity:0,y:-20,transition:{duration:.3}}},tn={hidden:{opacity:0,y:10},visible:{opacity:1,y:0,transition:{duration:.4,ease:"easeOut"}}},yo=({project:o,index:t})=>p.jsxs(P.article,{className:`group relative flex flex-col ${t%2===0?"md:flex-row":"md:flex-row-reverse"} items-center gap-8 mb-24 last:mb-0`,variants:bo,initial:"hidden",animate:"visible",exit:"exit",custom:t%5,layout:!0,children:[p.jsxs(P.div,{className:"w-full md:w-1/2 relative",variants:tn,children:[p.jsxs(P.div,{whileHover:{scale:1.02,boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)"},whileTap:{scale:.98},transition:{type:"spring",stiffness:300,damping:15},className:"overflow-hidden rounded-2xl shadow-lg relative group bg-gray-50 dark:bg-gray-800",children:[p.jsx(P.div,{className:"relative w-full h-64 md:h-80 overflow-hidden",whileHover:{scale:1.05,transition:{duration:.5,ease:[.4,0,.2,1]}},children:p.jsx(P.img,{src:o.imageUrl,alt:o.title,className:"w-full h-full object-cover",loading:t<3?"eager":"lazy",initial:{scale:1.1},animate:{scale:1},transition:{duration:.7,ease:[.4,0,.2,1]}})}),p.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/70 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end p-6",children:p.jsxs("div",{className:"translate-y-4 group-hover:translate-y-0 transition-transform duration-300 space-y-3",children:[p.jsx("h3",{className:"text-xl font-bold text-white",children:o.title}),p.jsxs("div",{className:"flex gap-3",children:[o.link&&p.jsxs("a",{href:o.link,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center px-4 py-2 bg-white text-gray-900 rounded-lg font-medium hover:bg-gray-100",onClick:e=>e.stopPropagation(),children:[p.jsx(Ds,{className:"mr-2"})," Live Demo"]}),o.github&&p.jsxs("a",{href:o.github,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center px-4 py-2 bg-gray-900 text-white rounded-lg font-medium hover:bg-gray-800",onClick:e=>e.stopPropagation(),children:[p.jsx(ui,{className:"mr-2"})," View Code"]})]})]})})]}),p.jsx("span",{className:"absolute -top-3 right-4 bg-gradient-to-r from-blue-600 to-cyan-500 text-white text-xs font-medium px-3 py-1 rounded-full shadow-md z-10",children:o.category.charAt(0).toUpperCase()+o.category.slice(1)})]}),p.jsx(P.div,{className:"w-full md:w-1/2",variants:tn,children:p.jsxs(P.div,{className:`${t%2===0?"md:pl-8":"md:pr-8"}`,initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},children:[p.jsx("h3",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors",children:o.title}),o.associatedWith&&p.jsx("p",{className:"text-blue-600 dark:text-blue-400 text-sm font-medium mb-3",children:o.associatedWith}),p.jsxs("div",{className:"flex items-center text-sm text-gray-500 dark:text-gray-400 mb-4 gap-4 flex-wrap",children:[p.jsxs("span",{className:"flex items-center",children:[p.jsx(ho,{className:"mr-1.5"}),o.startDate," - ",o.endDate||"Present"]}),o.notes&&p.jsx("span",{className:"px-2 py-1 bg-amber-100 dark:bg-amber-900/30 text-amber-800 dark:text-amber-300 text-xs rounded-full",children:o.notes})]}),p.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-5 leading-relaxed",children:o.description}),p.jsxs("div",{className:"flex flex-wrap gap-2 mb-6",children:[o.skills.slice(0,6).map(e=>p.jsx("span",{className:"px-3 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300 text-xs font-medium rounded-full",children:e},e)),o.skills.length>6&&p.jsxs("span",{className:"px-3 py-1 bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300 text-xs font-medium rounded-full",children:["+",o.skills.length-6," more"]})]}),p.jsxs("div",{className:"flex flex-wrap gap-3",children:[o.link&&p.jsxs("a",{href:o.link,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center px-5 py-2.5 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors",children:[p.jsx(Ds,{className:"mr-2"})," View Project"]}),o.github&&p.jsxs("a",{href:o.github,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center px-5 py-2.5 bg-gray-200 hover:bg-gray-300 dark:bg-gray-800 dark:hover:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg font-medium transition-colors",children:[p.jsx(ui,{className:"mr-2"})," Source Code"]}),o.videoUrl&&p.jsxs("a",{href:o.videoUrl,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center px-5 py-2.5 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-medium transition-colors",children:[p.jsx(mo,{className:"mr-2"})," Watch Demo"]})]})]})})]}),wo=({count:o=3})=>p.jsx("div",{className:"space-y-12",children:Array.from({length:o}).map((t,e)=>p.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-8 animate-pulse",children:[p.jsx("div",{className:"w-full md:w-1/2 h-64 bg-gray-200 dark:bg-gray-800 rounded-xl"}),p.jsxs("div",{className:"w-full md:w-1/2 space-y-4",children:[p.jsx("div",{className:"h-8 bg-gray-200 dark:bg-gray-800 rounded w-3/4"}),p.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-800 rounded w-1/2"}),p.jsxs("div",{className:"space-y-2",children:[p.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-800 rounded w-full"}),p.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-800 rounded w-5/6"}),p.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-800 rounded w-4/6"})]}),p.jsx("div",{className:"flex gap-2 flex-wrap",children:[1,2,3].map(s=>p.jsx("div",{className:"h-6 bg-gray-200 dark:bg-gray-800 rounded-full w-20"},s))}),p.jsxs("div",{className:"flex gap-3 pt-2",children:[p.jsx("div",{className:"h-10 bg-gray-200 dark:bg-gray-800 rounded-lg w-32"}),p.jsx("div",{className:"h-10 bg-gray-200 dark:bg-gray-800 rounded-lg w-32"})]})]})]},e))}),xo=(o=400)=>{const[t,e]=C.useState(!1),s=C.useCallback(()=>{e(window.pageYOffset>o)},[o]),i=C.useCallback(()=>{window.scrollTo({top:0,behavior:"smooth"})},[]);return C.useEffect(()=>(window.addEventListener("scroll",s,{passive:!0}),()=>{window.removeEventListener("scroll",s)}),[s]),{isVisible:t,scrollToTop:i}},vo={hidden:{opacity:0},show:{opacity:1,transition:{staggerChildren:.15}}},Ao={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.6,delay:.2,ease:[.25,.46,.45,.94]}}},ko={hidden:{opacity:0,scale:.8},visible:{opacity:1,scale:1,transition:{duration:.3}},exit:{opacity:0,scale:.8,transition:{duration:.2}}},pd=()=>{const[o,t]=C.useState("all"),[e,s]=C.useState(!0),{isVisible:i,scrollToTop:n}=xo(400),r=C.useMemo(()=>["all",...new Set(ti.map(l=>l.category))],[]),a=C.useMemo(()=>o==="all"?ti:ti.filter(l=>l.category===o),[o]);return C.useEffect(()=>{const l=setTimeout(()=>{s(!1)},500);return()=>clearTimeout(l)},[o]),p.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50/50 via-white to-purple-50/50 dark:from-gray-900/50 dark:via-gray-950 dark:to-purple-900/50 py-12 px-4 sm:px-6",children:[p.jsxs("div",{className:"max-w-7xl mt-8 mx-auto px-4 sm:px-6 lg:px-8 py-12",children:[p.jsxs("div",{className:"space-y-4 mb-12",children:[p.jsx(P.h1,{variants:Ao,initial:"hidden",animate:"visible",className:"text-2xl sm:text-3xl lg:text-4xl font-bold tracking-tight text-center",children:p.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-purple-600 via-blue-600 to-emerald-600 dark:from-purple-400 dark:via-blue-400 dark:to-emerald-400",children:"MY PROJECTS"})}),p.jsx(P.p,{className:"text-lg text-center text-gray-600 dark:text-gray-400 max-w-2xl mx-auto",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.6,delay:.3},children:"A collection of my recent work and personal projects"}),p.jsx(P.div,{className:"flex flex-wrap justify-center gap-3 mt-6",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.6,delay:.4},children:r.map(l=>p.jsxs("button",{onClick:()=>{t(l),s(!0)},className:`px-4 py-2 rounded-full text-sm font-medium transition-all duration-200 flex items-center gap-2 ${o===l?"bg-gradient-to-r from-blue-600 to-cyan-500 text-white shadow-md":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700/50 border border-gray-200 dark:border-gray-700"}`,"aria-label":`Filter by ${l}`,"aria-pressed":o===l,children:[o===l&&p.jsx(go,{className:"w-3.5 h-3.5"}),l.charAt(0).toUpperCase()+l.slice(1)]},l))})]}),p.jsxs("div",{className:"relative min-h-[400px]",children:[p.jsx(se,{children:e&&p.jsx(P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"space-y-24",children:p.jsx(wo,{count:3})},"skeleton")}),p.jsx(se,{children:!e&&a.length>0&&p.jsx(P.div,{variants:vo,initial:"hidden",animate:"show",className:"space-y-24",children:a.map((l,c)=>p.jsx(yo,{project:l,index:c},l.id))},"projects")}),p.jsx(se,{children:!e&&a.length===0&&p.jsx(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0},className:"absolute inset-0 flex items-center justify-center text-center py-16",children:p.jsxs("div",{children:[p.jsx("h3",{className:"text-xl font-medium text-gray-600 dark:text-gray-400",children:"No projects found in this category."}),p.jsx("p",{className:"mt-2 text-gray-500 dark:text-gray-500",children:"Try selecting a different filter."})]})},"empty")})]})]}),p.jsx(se,{children:i&&p.jsx(P.button,{variants:ko,initial:"hidden",animate:"visible",exit:"exit",onClick:n,className:"fixed bottom-8 right-8 w-14 h-14 bg-blue-600 hover:bg-blue-700 text-white rounded-full shadow-2xl flex items-center justify-center z-50 transition-all duration-200","aria-label":"Scroll to top",children:p.jsx(lo,{className:"w-6 h-6"})})})]})},Qe=[{id:1,isActive:!0,title:"AI & Machine Learning Solutions",slug:"ai-ml",description:"Custom AI models, machine learning pipelines, and intelligent automation solutions tailored to your business needs.",image:"https://images.unsplash.com/photo-1677442136019-21780ecad995?auto=format&fit=crop&q=80&w=1000",icon:qn,category:"AI & ML",features:["Custom ML Model Development","Natural Language Processing","Computer Vision Solutions","Predictive Analytics","AI Strategy Consulting"],technologies:["Python","TensorFlow","PyTorch","Scikit-learn","OpenAI API"],color:"from-purple-600 to-pink-600"},{id:2,isActive:!0,title:"Web Development",slug:"web-development",description:"Modern, scalable web applications built with cutting-edge technologies and best practices.",image:"https://images.unsplash.com/photo-1461749280684-dccba630e2f6?auto=format&fit=crop&q=80&w=1000",icon:Xn,category:"Web Development",features:["React & Next.js Applications","Backend API Development","Database Design & Optimization","Cloud Deployment","Performance Optimization"],technologies:["React","Next.js","Node.js","PostgreSQL","AWS"],color:"from-blue-600 to-cyan-600"},{id:3,title:"Data Engineering & Analytics",slug:"data-engineering",description:"Robust data pipelines, ETL processes, and analytics platforms to unlock insights from your data.",image:"https://images.unsplash.com/photo-1551288049-bebda4e38f71?auto=format&fit=crop&q=80&w=1000",icon:Yn,category:"Data Engineering",features:["Data Pipeline Development","ETL/ELT Processes","Data Warehousing","Real-time Analytics","Data Visualization"],technologies:["Python","Apache Airflow","PostgreSQL","Redis","Docker"],color:"from-orange-600 to-red-600"},{id:4,title:"Mobile App Development",slug:"mobile-app-development",description:"Cross-platform mobile applications built with React Native and Expo Router, powered by a robust Node.js and GraphQL backend.",image:"https://images.unsplash.com/photo-1614680376573-df3480f0c6ff?auto=format&fit=crop&q=80&w=1000",icon:Kn,category:"Mobile Development",features:["Cross-platform iOS & Android Apps","Expo Router for Navigation","GraphQL API Integration","Offline-First Capabilities","Push Notifications"],technologies:["React Native","Expo Router","Node.js","GraphQL","TypeScript"],color:"from-teal-600 to-emerald-700"}],So={initial:{opacity:0},animate:{opacity:1,transition:{duration:.3,ease:[.22,1,.36,1]}},exit:{opacity:0,transition:{duration:.2}}},en={animate:{transition:{staggerChildren:.08,delayChildren:.1}}},_o={initial:{opacity:0,y:20},animate:{opacity:1,y:0,transition:{duration:.5,ease:[.22,1,.36,1]}}},Eo={"AI & ML":{name:"AI & ML",icon:qn,description:"Artificial Intelligence and Machine Learning solutions",color:"from-purple-500 to-pink-500"},"Web Development":{name:"Web Development",icon:Xn,description:"Full-stack web applications and platforms",color:"from-blue-500 to-cyan-500"},"Data Engineering":{name:"Data Engineering",icon:Yn,description:"Data pipelines and analytics platforms",color:"from-orange-500 to-red-500"},"Mobile Development":{name:"Mobile Development",icon:Kn,description:"Cross-platform mobile applications",color:"from-teal-500 to-emerald-600"}},Co=()=>{const[o,t]=C.useState({isLoading:!0,progress:0,imagesLoaded:!1});return C.useEffect(()=>{const e=Qe.length;if(e===0){t({isLoading:!1,progress:100,imagesLoaded:!0});return}let s=0;const i=Qe.map(n=>{const r=new Image,a=()=>{s++;const l=Math.round(s/e*100);t(c=>({...c,progress:l})),s===e&&t({isLoading:!1,progress:100,imagesLoaded:!0})};return r.onload=a,r.onerror=a,r.src=n.image,r});return()=>{i.forEach(n=>{n.onload=null,n.onerror=null})}},[]),o},To=()=>{const[o,t]=C.useState(null),e=C.useMemo(()=>o?Qe.filter(n=>n.category===o):Qe,[o]),s=C.useMemo(()=>Object.keys(Eo).reduce((n,r)=>(n[r]=Qe.filter(a=>a.category===r).length,n),{}),[]),i=C.useCallback(n=>{t(r=>r===n?null:n)},[]);return{activeCategory:o,filteredServices:e,categoryStats:s,handleCategoryChange:i}},Lo=({service:o,index:t})=>{const e=o.icon,s=C.useRef(null),i=ga(s,{once:!0,amount:.15}),n=t%2!==0;return p.jsx(P.article,{ref:s,initial:{opacity:0,y:30},animate:i?{opacity:1,y:0}:{opacity:0,y:30},transition:{duration:.6,ease:[.22,1,.36,1],delay:t*.1},className:"group relative",children:p.jsx(Te,{to:`/services/${o.slug}`,className:"block relative bg-white dark:bg-slate-900 rounded-xl sm:rounded-2xl border border-gray-100 dark:border-blue-900/50 overflow-hidden transition-all duration-300 hover:shadow-xl hover:-translate-y-1",style:{transform:"translate3d(0,0,0)",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden"},children:p.jsxs("div",{className:`flex flex-col ${n?"md:flex-row-reverse":"md:flex-row"} gap-0`,children:[p.jsx("div",{className:"relative md:w-5/12 lg:w-4/12 flex-shrink-0",children:p.jsxs("div",{className:"relative w-full h-48 sm:h-64 md:h-full overflow-hidden rounded-lg sm:rounded-xl shadow-xl",children:[p.jsx("img",{src:o.image,alt:o.title,className:"w-full h-full object-cover",loading:"lazy",style:{transform:"translate3d(0,0,0)",WebkitTransform:"translate3d(0,0,0)",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden",WebkitFontSmoothing:"subpixel-antialiased"}}),p.jsx("div",{className:`absolute inset-0 bg-gradient-to-t ${o.color} transition-opacity duration-300`,style:{opacity:.4,transform:"translate3d(0,0,0)",backfaceVisibility:"hidden"}}),p.jsx("div",{className:"absolute top-4 left-4",children:p.jsx("div",{className:`p-3 rounded-xl bg-gradient-to-r ${o.color} shadow-2xl`,style:{transform:"translate3d(0,0,0)",backfaceVisibility:"hidden"},children:p.jsx(e,{className:"w-6 h-6 text-white"})})}),o.isActive&&p.jsxs("div",{className:"absolute top-4 right-4 flex items-center px-2 py-1 text-xs font-bold text-yellow-300 bg-black/50 rounded-full border border-yellow-300/30",style:{transform:"translate3d(0,0,0)",backfaceVisibility:"hidden"},children:[p.jsx(Za,{className:"w-3 h-3 mr-1 text-yellow-300 flex-shrink-0"}),p.jsx("span",{children:"Active"})]})]})}),p.jsxs("div",{className:"md:w-7/12 lg:w-8/12 flex flex-col justify-center p-4 sm:p-6 lg:p-8",children:[p.jsx("h3",{className:`text-2xl sm:text-3xl font-extrabold mb-3 leading-snug bg-clip-text text-transparent bg-gradient-to-r ${o.color}`,style:{transform:"translate3d(0,0,0)",backfaceVisibility:"hidden"},children:o.title}),p.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6 text-base sm:text-lg font-light leading-relaxed",children:o.description}),p.jsxs("div",{className:`flex flex-col sm:flex-row gap-6 ${n?"sm:justify-end":"sm:justify-start"}`,children:[p.jsxs("div",{className:"w-full sm:w-1/2",children:[p.jsx("h4",{className:"text-sm font-bold text-gray-800 dark:text-gray-200 mb-2",children:"Key Deliverables:"}),p.jsx("ul",{className:"space-y-2",children:o.features.slice(0,3).map((r,a)=>p.jsxs("li",{className:"flex items-start text-sm text-gray-700 dark:text-gray-400",children:[p.jsx(Pa,{className:"w-4 h-4 text-green-500 mr-2 mt-0.5 flex-shrink-0"}),p.jsx("span",{className:"leading-snug",children:r})]},a))})]}),p.jsxs("div",{className:"w-full sm:w-1/2",children:[p.jsx("h4",{className:"text-sm font-bold text-gray-800 dark:text-gray-200 mb-2",children:"Core Technologies:"}),p.jsx("div",{className:"flex flex-wrap gap-2",children:o.technologies.slice(0,4).map((r,a)=>p.jsx("span",{className:"px-3 py-1 text-xs font-semibold bg-blue-50 dark:bg-blue-900/40 text-blue-600 dark:text-blue-300 rounded-full shadow-sm",children:r},a))}),p.jsx("div",{className:"mt-6",children:p.jsxs("div",{className:`inline-flex items-center py-2.5 sm:py-3 px-5 sm:px-6 rounded-xl bg-gradient-to-r ${o.color} text-white font-semibold text-sm shadow-md transition-all duration-300 group-hover:shadow-xl`,style:{transform:"translate3d(0,0,0)",backfaceVisibility:"hidden"},children:[p.jsxs("span",{className:"mr-2",children:["Explore ",o.category]}),p.jsx(_i,{className:"w-4 h-4 transition-transform duration-200 group-hover:translate-x-1"})]})})]})]})]})]})})})},Po=()=>p.jsx("div",{className:"space-y-12 sm:space-y-16 mt-8",children:[1,2,3,4].map(o=>p.jsx("div",{className:"h-64 w-full bg-gray-100 dark:bg-gray-800 rounded-xl animate-pulse"},o))});function fd(){const{filteredServices:o}=To(),{isLoading:t,progress:e,imagesLoaded:s}=Co();return p.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-white to-blue-50/30 dark:from-gray-950 dark:via-slate-900 dark:to-blue-950/30",children:p.jsx(se,{mode:"wait",children:p.jsxs(P.div,{...So,className:"relative",children:[p.jsx("section",{className:"container max-w-7xl mt-10 mx-auto px-4 sm:px-6 pt-16 sm:pt-20 pb-10",children:p.jsxs(P.div,{className:"text-center",children:[p.jsx(P.h1,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.2,ease:[.25,.46,.45,.94]},className:"text-2xl sm:text-3xl font-bold tracking-tight text-center mb-3",children:p.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-purple-600 via-blue-600 to-emerald-600 dark:from-purple-400 dark:via-blue-400 dark:to-emerald-400",children:"SPECIALIZED SERVICES"})}),p.jsx(P.div,{className:"space-y-2 text-center",initial:{opacity:0,y:15},animate:{opacity:1,y:0},transition:{duration:.6,delay:.3,ease:[.25,.46,.45,.94]},children:p.jsx("h2",{className:"text-base sm:text-lg font-light text-gray-600 dark:text-gray-400 max-w-3xl mx-auto",children:"End-to-end technology solutions in AI, full-stack development, and data engineering to power your next big idea."})})]})}),p.jsxs("section",{className:"container max-w-7xl mx-auto px-4 sm:px-6 pb-10",children:[t&&p.jsxs("div",{className:"text-center py-12",children:[p.jsx("div",{className:"w-full max-w-md mx-auto bg-gray-100 dark:bg-gray-800 rounded-full h-2.5 mb-4",children:p.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full transition-all duration-300 ease-out",style:{width:`${e}%`}})}),p.jsxs("p",{className:"text-gray-600 dark:text-gray-400",children:["Loading services... ",e,"%"]}),p.jsx(Po,{})]}),!t&&s&&p.jsx(P.div,{variants:en,initial:"initial",animate:"animate",className:"space-y-12 sm:space-y-12",children:o.map((i,n)=>p.jsx(Lo,{service:i,index:n},i.id))}),!t&&o.length===0&&p.jsx(P.p,{initial:{opacity:0},animate:{opacity:1},className:"text-center text-gray-500 dark:text-gray-400 py-12 text-lg",children:"No services found in this category."})]}),p.jsx(P.section,{initial:"initial",whileInView:"animate",viewport:{once:!0,margin:"-100px"},variants:en,className:"py-16 sm:py-20 bg-gradient-to-br from-gray-50/50 via-white to-blue-50/50 dark:from-gray-900/50 dark:via-gray-950 dark:to-blue-900/50",children:p.jsx("div",{className:"container max-w-4xl mx-auto px-4 sm:px-6 text-center",children:p.jsxs(P.div,{variants:_o,children:[p.jsxs("h2",{className:"text-2xl sm:text-3xl font-light tracking-tight mb-3 sm:mb-4 text-gray-900 dark:text-white",children:["Ready to ",p.jsx("span",{className:"font-bold",children:"Transform"})," Your Ideas?"]}),p.jsx("p",{className:"text-gray-700 dark:text-gray-400 max-w-2xl mx-auto mb-6 sm:mb-8 text-sm sm:text-base",children:"Let's discuss how my services can help you achieve your goals and drive innovation in your organization."}),p.jsx(Te,{to:"/contact",children:p.jsxs(P.div,{whileHover:{scale:1.02},whileTap:{scale:.98},className:"inline-flex items-center py-2.5 sm:py-3 px-5 sm:px-6 rounded-xl bg-gradient-to-r from-blue-600 to-purple-600 dark:from-blue-500 dark:to-purple-500 text-white font-semibold text-sm sm:text-base shadow-md hover:shadow-xl transition-all duration-300",style:{transform:"translate3d(0,0,0)",backfaceVisibility:"hidden"},children:["Get Started",p.jsx(P.div,{whileHover:{x:4},transition:{duration:.2},className:"ml-1.5 sm:ml-2",children:p.jsx(_i,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]})})]})})})]},"services-page")})})}const Mo=[{title:"LLM Fundamentals",icon:p.jsx(er,{className:"w-6 h-6"}),description:"Core concepts for understanding LLMs",overview:"Master the essential building blocks of machine learning and deep learning that power modern LLMs. This section covers the mathematical foundations, programming skills, and neural network concepts required to work effectively with large language models.",topics:[{title:"Mathematics for Machine Learning",content:["Linear Algebra: Vectors, matrices, eigenvalues, and transformations","Calculus: Derivatives, gradients, and optimization","Probability & Statistics: Distributions, MLE, and Bayesian inference","Key Resources: 3Blue1Brown, StatQuest, Khan Academy"]},{title:"Python for Machine Learning",content:["Python fundamentals and data structures","Data Science Stack: NumPy, Pandas, Matplotlib/Seaborn","Data Preprocessing and Feature Engineering","Scikit-learn for traditional ML algorithms"]},{title:"Neural Networks",content:["Neural Network Fundamentals: Architecture and training","Activation Functions and Backpropagation","Optimization: SGD, Adam, RMSprop","Regularization: Dropout, L1/L2, Early Stopping"]},{title:"Natural Language Processing (NLP)",content:["Text Preprocessing: Tokenization, stemming, lemmatization","Feature Extraction: BoW, TF-IDF, n-grams","Word Embeddings: Word2Vec, GloVe, FastText","Sequence Models: RNNs, LSTMs, GRUs"]}]},{title:"The LLM Scientist",icon:p.jsx(fo,{className:"w-6 h-6"}),description:"Mastering LLM development",overview:"Dive deep into building state-of-the-art language models. This section covers everything from architecture design to training optimization, evaluation, and the latest research trends in LLM development.",topics:[{title:"LLM Architecture",content:["Transformer architecture and attention mechanisms","Tokenization strategies and their impact","Self-attention and its variants","Sampling techniques for text generation"]},{title:"Pre-training Models",content:["Data preparation and cleaning at scale","Distributed training strategies","Training optimization techniques","Performance monitoring and profiling"]},{title:"Post-training & SFT",content:["Dataset preparation and chat templates","Synthetic data generation","Supervised Fine-Tuning techniques","Parameter-efficient fine-tuning (LoRA, QLoRA)"]},{title:"Preference Alignment",content:["Rejection sampling and data curation","Direct Preference Optimization (DPO)","Reward modeling and RLHF","GRPO and PPO for alignment"]},{title:"Evaluation & Optimization",content:["Automated benchmarks and human evaluation","Model-based evaluation techniques","Quantization methods (GGUF, GPTQ, AWQ)","Performance optimization strategies"]},{title:"Emerging Trends",content:["Model merging techniques","Multimodal model architectures","Interpretability and mechanistic analysis","Test-time compute scaling"]}]},{title:"The LLM Engineer",icon:p.jsx(po,{className:"w-6 h-6"}),description:"Building production LLM applications",overview:"Master the end-to-end development of LLM-powered applications, from prototyping to production deployment. Learn to build robust, scalable, and secure applications with modern LLM technologies.",topics:[{title:"Running LLMs",content:["LLM APIs vs. open-source models","Local deployment options","Advanced prompt engineering","Structured output generation"]},{title:"Vector Storage & RAG",content:["Document ingestion and processing","Text splitting strategies","Embedding models and vector DBs","Retrieval Augmented Generation"]},{title:"Advanced RAG & Agents",content:["Query construction and rewriting","Multi-vector and hybrid retrieval","Agent frameworks (LangGraph, LlamaIndex)","Multi-agent systems"]},{title:"Deployment & Scaling",content:["Local and demo deployment","Server deployment at scale","Inference optimization techniques","Edge deployment options"]},{title:"Security & Production",content:["Prompt injection and jailbreaking","Data privacy and compliance","Monitoring and observability","Performance optimization"]}]}],ys={author:"Maxime Labonne",url:"https://github.com/mlabonne/llm-course",license:"Apache License 2.0",book:{url:"https://www.amazon.ca/dp/1836200072"}},gd=()=>{const[o,t]=C.useState(null),e=ua();C.useEffect(()=>{e.state?.scrollPosition&&window.scrollTo(0,e.state.scrollPosition)},[e]),C.useEffect(()=>{const i=()=>{sessionStorage.setItem("llmCourseScrollPosition",window.scrollY)};return window.addEventListener("beforeunload",i),()=>{window.removeEventListener("beforeunload",i)}},[]),C.useEffect(()=>{if(performance.navigation?.type===1){const i=sessionStorage.getItem("llmCourseScrollPosition");i&&(window.scrollTo(0,parseInt(i,10)),sessionStorage.removeItem("llmCourseScrollPosition"))}},[]);const s=i=>{sessionStorage.setItem("llmCourseScroll",window.scrollY),t(o===i?null:i)};return p.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-white to-gray-50 dark:from-gray-950 dark:via-gray-900 dark:to-gray-950",children:[p.jsxs("div",{className:"container max-w-7xl mt-10 mx-auto px-4 sm:px-6 py-16 sm:py-20",children:[p.jsxs("div",{className:"space-y-3 sm:space-y-4 mb-12 sm:mb-16",children:[p.jsx(P.h1,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.2,ease:[.25,.46,.45,.94]},className:"text-2xl sm:text-3xl font-bold tracking-tight text-center",children:p.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-purple-600 via-blue-600 to-emerald-600 dark:from-purple-400 dark:via-blue-400 dark:to-emerald-400",children:"LARGE LANGUAGE MODELS"})}),p.jsx(P.div,{className:"space-y-2 text-center",initial:{opacity:0,y:15},animate:{opacity:1,y:0},transition:{duration:.6,delay:.3,ease:[.25,.46,.45,.94]},children:p.jsx("h2",{className:"text-base sm:text-lg font-light text-gray-600 dark:text-gray-400 max-w-3xl mx-auto",children:"A comprehensive guide to understanding and working with Large Language Models"})}),p.jsxs(P.div,{className:"flex flex-wrap justify-center gap-2 sm:gap-3 mt-4 sm:mt-5",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.4,duration:.5},children:[p.jsx("span",{className:"px-3 py-1.5 bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300 rounded-full text-xs sm:text-sm font-medium",children:"Natural Language Processing"}),p.jsx("span",{className:"px-3 py-1.5 bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300 rounded-full text-xs sm:text-sm font-medium",children:"AI Assistants"}),p.jsx("span",{className:"px-3 py-1.5 bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300 rounded-full text-xs sm:text-sm font-medium",children:"Content Generation"})]})]}),p.jsx(P.div,{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-100 dark:border-blue-800 rounded-xl p-6 mb-12 shadow-sm text-xs",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,ease:"easeOut"},children:p.jsxs("div",{className:"max-w-4xl mx-auto",children:[p.jsxs(P.p,{className:"text-gray-700 dark:text-gray-300 mb-4",initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.1,duration:.5},children:[p.jsx("span",{className:"font-medium",children:"Note:"})," This course is based on the excellent work by"," ",p.jsx("a",{href:"https://www.linkedin.com/in/maxime-labonne/",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:underline",children:ys.author}),". The LLM course is available under the"," ",p.jsx("a",{href:"https://github.com/mlabonne/llm-course/blob/main/LICENSE",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:underline",children:ys.license})," ","and will always stay free."]}),p.jsxs(P.div,{className:"bg-white dark:bg-gray-800/50 p-5 rounded-lg my-4 border-l-4 border-blue-500 dark:border-blue-400",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2,duration:.5},children:[p.jsx(P.p,{className:"text-gray-800 dark:text-gray-200 mb-3 font-medium",initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},children:"From the original author:"}),p.jsxs(P.p,{className:"text-gray-800 dark:text-gray-200 mb-4",initial:{opacity:0},animate:{opacity:1},transition:{delay:.4},children:['"Based on this course, I wrote the'," ",p.jsx("a",{href:"https://www.llmhandbook.com",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:underline",children:"LLM Engineer's Handbook"})," ","with"," ",p.jsx("a",{href:"https://www.linkedin.com/in/pauliusztin/",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:underline",children:"Paul Iuzstin"}),`. It's a hands-on and detailed book that covers an end-to-end LLM application from design to deployment. The LLM course will always stay free but feel free to support my work by purchasing the book."`]}),p.jsxs(P.p,{className:"text-gray-800 dark:text-gray-200",initial:{opacity:0},animate:{opacity:1},transition:{delay:.5},children:["For an interactive version of this course, I created an LLM assistant that will answer questions and test your knowledge in a personalized way on"," ",p.jsx("a",{href:"https://huggingface.co/chat/assistant/66029d2e5f4a884f7aabc9d1",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:underline",children:"HuggingChat"})," ","or"," ",p.jsx("a",{href:"https://chatgpt.com/g/g-yviLuLqvI-llm-course",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:underline",children:"ChatGPT"}),"."]})]}),p.jsxs(P.div,{className:"flex flex-wrap gap-4 mt-5",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.6},children:[p.jsxs(P.a,{whileHover:{scale:1.03},whileTap:{scale:.98},href:ys.url,target:"_blank",rel:"noopener noreferrer",className:`group inline-flex items-center px-4 py-2 border border-transparent text-xs font-medium rounded-md text-white 
             bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-600 hover:to-blue-800 hover:text-white
             focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition shadow-md hover:shadow-lg`,children:[p.jsx(ui,{className:"mr-2 h-4 w-4 group-hover:translate-x-0.5 transition-transform"}),"View on GitHub",p.jsx("svg",{className:"ml-2 w-4 h-4 group-hover:translate-x-1 transition-transform",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14 5l7 7m0 0l-7 7m7-7H3"})})]}),p.jsxs(P.a,{whileHover:{scale:1.03},whileTap:{scale:.98},href:ys.book.url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 text-xs font-medium rounded-md text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors",children:[p.jsx(Zn,{className:"mr-2 h-4 w-4"}),"View Book"]})]})]})}),p.jsxs(P.div,{className:"text-center mb-8 sm:mb-10",initial:{opacity:0,y:15},animate:{opacity:1,y:0},transition:{duration:.6,ease:[.16,1,.3,1]},children:[p.jsx("h2",{className:"text-lg sm:text-2xl font-bold text-gray-800 dark:text-white mb-2",children:"Course Modules"}),p.jsx("p",{className:"text-sm sm:text-base text-gray-600 dark:text-gray-400 max-w-3xl mx-auto",children:"A structured learning path from LLM fundamentals to advanced applications."})]}),p.jsxs(P.div,{className:"grid grid-cols-1 md:grid-cols-3 gap-6 my-12",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},children:[p.jsx(Te,{to:"/llm-fundamentals",className:"group block h-full",children:p.jsx("div",{className:"h-full bg-white dark:bg-gray-800 rounded-xl shadow-md overflow-hidden border border-gray-200 dark:border-gray-700 hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1",children:p.jsxs("div",{className:"p-6",children:[p.jsxs("div",{className:"flex items-center justify-between mb-4",children:[p.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-white",children:"LLM Fundamentals"}),p.jsx(Zs,{className:"text-blue-600 dark:text-blue-400 group-hover:translate-x-1 transition-transform"})]}),p.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-4",children:"Master the core concepts and practical applications of Large Language Models"}),p.jsx("div",{className:"flex items-center text-sm text-blue-600 dark:text-blue-400 font-medium",children:p.jsx("span",{children:"Start Learning"})})]})})}),p.jsx(Te,{to:"/llm-scientist",className:"group block h-full",children:p.jsx("div",{className:"h-full bg-white dark:bg-gray-800 rounded-xl shadow-md overflow-hidden border border-gray-200 dark:border-gray-700 hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1",children:p.jsxs("div",{className:"p-6",children:[p.jsxs("div",{className:"flex items-center justify-between mb-4",children:[p.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-white",children:"LLM Scientist"}),p.jsx(Zs,{className:"text-purple-600 dark:text-purple-400 group-hover:translate-x-1 transition-transform"})]}),p.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-4",children:"Advanced techniques and research in Large Language Models for AI researchers"}),p.jsx("div",{className:"flex items-center text-sm text-purple-600 dark:text-purple-400 font-medium",children:p.jsx("span",{children:"Explore Research"})})]})})}),p.jsx(Te,{to:"/llm-engineer",className:"group block h-full",children:p.jsx("div",{className:"h-full bg-white dark:bg-gray-800 rounded-xl shadow-md overflow-hidden border border-gray-200 dark:border-gray-700 hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1",children:p.jsxs("div",{className:"p-6",children:[p.jsxs("div",{className:"flex items-center justify-between mb-4",children:[p.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-white",children:"LLM Engineer"}),p.jsx(Zs,{className:"text-green-600 dark:text-green-400 group-hover:translate-x-1 transition-transform"})]}),p.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-4",children:"Build and deploy production-grade LLM applications at scale"}),p.jsx("div",{className:"flex items-center text-sm text-green-600 dark:text-green-400 font-medium",children:p.jsx("span",{children:"Start Building"})})]})})})]}),p.jsx("div",{className:"space-y-4",children:Mo.map((i,n)=>p.jsxs(P.div,{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm hover:shadow-md transition-shadow duration-200 overflow-hidden border border-gray-200 dark:border-gray-700",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*n},children:[p.jsxs("button",{className:`w-full px-6 py-4 flex items-center justify-between text-left focus:outline-none transition-colors ${o===n?"bg-gray-50 dark:bg-gray-800/50":"hover:bg-gray-50 dark:hover:bg-gray-800/30"}`,onClick:()=>s(n),children:[p.jsxs("div",{className:"flex items-center space-x-4",children:[p.jsx("div",{className:`p-2 rounded-lg transition-colors ${o===n?"bg-blue-100 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400":"bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400"}`,children:i.icon}),p.jsxs("div",{children:[p.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:i.title}),p.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:i.description})]})]}),p.jsx(P.div,{animate:{rotate:o===n?180:0},transition:{duration:.3},children:p.jsx(tr,{className:"w-5 h-5 text-gray-400"})})]}),p.jsx(se,{children:o===n&&p.jsx(P.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3,ease:"easeInOut"},className:"overflow-hidden",children:p.jsxs("div",{className:"px-6 pb-6 pt-4 border-t border-gray-200 dark:border-gray-700 bg-gray-50/30 dark:bg-gray-800/30",children:[p.jsx("p",{className:"text-gray-700 dark:text-gray-300 mb-4",children:i.overview}),p.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6 mt-6",children:i.topics.map((r,a)=>p.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm border border-gray-100 dark:border-gray-700",children:[p.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-3",children:r.title}),p.jsx("ul",{className:"space-y-2",children:r.content.map((l,c)=>p.jsxs("li",{className:"flex items-start",children:[p.jsx("svg",{className:"h-5 w-5 text-green-500 dark:text-green-400 mr-2 mt-0.5 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),p.jsx("span",{className:"text-gray-600 dark:text-gray-300 text-sm",children:l})]},c))})]},a))})]})})})]},n))})]}),p.jsx(P.div,{className:"mt-16 mb-24 p-6 bg-blue-50 dark:bg-blue-900/20 rounded-xl border border-blue-100 dark:border-blue-800",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:p.jsxs("div",{className:"max-w-3xl mx-auto text-center",children:[p.jsx("h3",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-4",children:"Explore More LLM Resources"}),p.jsx("p",{className:"text-gray-700 dark:text-gray-300 mb-6",children:"A collection of Jupyter notebooks and articles about LLMs, covering fine-tuning, quantization, and deployment."}),p.jsxs("div",{className:"flex flex-col space-y-4 md:space-y-0 md:space-x-4 md:flex-row justify-center mt-6",children:[p.jsxs(Te,{to:"/llm-notebooks",className:"inline-flex items-center justify-center px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white hover:text-white rounded-lg font-medium transition-colors",children:["Explore LLM Notebooks",p.jsx("svg",{className:"w-4 h-4 ml-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14 5l7 7m0 0l-7 7m7-7H3"})})]}),p.jsxs("a",{href:"https://github.com/decodingai-magazine/llm-twin-course",className:"inline-flex items-center justify-center px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white hover:text-white rounded-lg font-medium transition-colors",children:["Explore LLM Twin Course",p.jsx("svg",{className:"w-4 h-4 ml-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14 5l7 7m0 0l-7 7m7-7H3"})})]})]})]})})]})},Ro=[{id:1,title:"Mathematics for Machine Learning",description:"Before mastering machine learning, it is important to understand the fundamental mathematical concepts that power these algorithms.",topics:[{name:"Linear Algebra",details:"This is crucial for understanding many algorithms, especially those used in deep learning. Key concepts include vectors, matrices, determinants, eigenvalues and eigenvectors, vector spaces, and linear transformations."},{name:"Calculus",details:"Many machine learning algorithms involve the optimization of continuous functions, which requires an understanding of derivatives, integrals, limits, and series. Multivariable calculus and the concept of gradients are also important."},{name:"Probability and Statistics",details:"These are crucial for understanding how models learn from data and make predictions. Key concepts include probability theory, random variables, probability distributions, expectations, variance, covariance, correlation, hypothesis testing, confidence intervals, maximum likelihood estimation, and Bayesian inference."}],resources:[{name:"3Blue1Brown - The Essence of Linear Algebra",url:"https://www.youtube.com/watch?v=fNk_zzaMoSs&list=PLZHQObOWTQDPD3MizzM2xVFitgF8hE_ab"},{name:"StatQuest with Josh Starmer - Statistics Fundamentals",url:"https://www.youtube.com/watch?v=qBigTkBLU6g&list=PLblh5JKOoLUK0FLuzwntyYI10UQFUhsY9"},{name:"AP Statistics Intuition by Ms Aerin",url:"https://automata88.medium.com/list/cacc224d5e7d"},{name:"Immersive Linear Algebra",url:"https://immersivemath.com/ila/learnmore.html"},{name:"Khan Academy - Linear Algebra",url:"https://www.khanacademy.org/math/linear-algebra"},{name:"Khan Academy - Calculus",url:"https://www.khanacademy.org/math/calculus-1"},{name:"Khan Academy - Probability and Statistics",url:"https://www.khanacademy.org/math/statistics-probability"}]},{id:2,title:"Python for Machine Learning",description:"Python is a powerful and flexible programming language that's particularly good for machine learning, thanks to its readability, consistency, and robust ecosystem of data science libraries.",topics:[{name:"Python Basics",details:"Python programming requires a good understanding of the basic syntax, data types, error handling, and object-oriented programming."},{name:"Data Science Libraries",details:"It includes familiarity with NumPy for numerical operations, Pandas for data manipulation and analysis, Matplotlib and Seaborn for data visualization."},{name:"Data Preprocessing",details:"This involves feature scaling and normalization, handling missing data, outlier detection, categorical data encoding, and splitting data into training, validation, and test sets."},{name:"Machine Learning Libraries",details:"Proficiency with Scikit-learn, a library providing a wide selection of supervised and unsupervised learning algorithms, is vital. Understanding how to implement algorithms like linear regression, logistic regression, decision trees, random forests, k-nearest neighbors (K-NN), and K-means clustering is important. Dimensionality reduction techniques like PCA and t-SNE are also helpful for visualizing high-dimensional data."}],resources:[{name:"Real Python",url:"https://realpython.com/"},{name:"freeCodeCamp - Learn Python",url:"https://www.youtube.com/watch?v=rfscVS0vtbw"},{name:"Python Data Science Handbook",url:"https://jakevdp.github.io/PythonDataScienceHandbook/"},{name:"freeCodeCamp - Machine Learning for Everybody",url:"https://youtu.be/i_LwzRVP7bg"},{name:"Udacity - Intro to Machine Learning",url:"https://www.udacity.com/course/intro-to-machine-learning--ud120"}]},{id:3,title:"Neural Networks",description:"Neural networks are a fundamental part of many machine learning models, particularly in the realm of deep learning. To utilize them effectively, a comprehensive understanding of their design and mechanics is essential.",topics:[{name:"Fundamentals",details:"This includes understanding the structure of a neural network, such as layers, weights, biases, and activation functions (sigmoid, tanh, ReLU, etc.)"},{name:"Training and Optimization",details:"Familiarize yourself with backpropagation and different types of loss functions, like Mean Squared Error (MSE) and Cross-Entropy. Understand various optimization algorithms like Gradient Descent, Stochastic Gradient Descent, RMSprop, and Adam."},{name:"Overfitting",details:"Understand the concept of overfitting (where a model performs well on training data but poorly on unseen data) and learn various regularization techniques (dropout, L1/L2 regularization, early stopping, data augmentation) to prevent it."},{name:"Implement a Multilayer Perceptron (MLP)",details:"Build an MLP, also known as a fully connected network, using PyTorch."}],resources:[{name:"3Blue1Brown - But what is a Neural Network?",url:"https://www.youtube.com/watch?v=aircAruvnKk"},{name:"freeCodeCamp - Deep Learning Crash Course",url:"https://www.youtube.com/watch?v=VyWAvY2CF9c"},{name:"Fast.ai - Practical Deep Learning",url:"https://course.fast.ai/"},{name:"Patrick Loeber - PyTorch Tutorials",url:"https://www.youtube.com/playlist?list=PLqnslRFeH2UrcDBWF5mfPGpqQDSta6VK4"}]},{id:4,title:"Natural Language Processing (NLP)",description:"NLP is a fascinating branch of artificial intelligence that bridges the gap between human language and machine understanding. From simple text processing to understanding linguistic nuances, NLP plays a crucial role in many applications like translation, sentiment analysis, chatbots, and much more.",topics:[{name:"Text Preprocessing",details:"Learn various text preprocessing steps like tokenization (splitting text into words or sentences), stemming (reducing words to their root form), lemmatization (similar to stemming but considers the context), stop word removal, etc."},{name:"Feature Extraction Techniques",details:"Become familiar with techniques to convert text data into a format that can be understood by machine learning algorithms. Key methods include Bag-of-words (BoW), Term Frequency-Inverse Document Frequency (TF-IDF), and n-grams."},{name:"Word Embeddings",details:"Word embeddings are a type of word representation that allows words with similar meanings to have similar representations. Key methods include Word2Vec, GloVe, and FastText."},{name:"Recurrent Neural Networks (RNNs)",details:"Understand the working of RNNs, a type of neural network designed to work with sequence data. Explore LSTMs and GRUs, two RNN variants that are capable of learning long-term dependencies."}],resources:[{name:"Lena Voita - Word Embeddings",url:"https://lena-voita.github.io/nlp_course/word_embeddings.html"},{name:"RealPython - NLP with spaCy in Python",url:"https://realpython.com/natural-language-processing-spacy-python/"},{name:"Kaggle - NLP Guide",url:"https://www.kaggle.com/learn-guide/natural-language-processing"},{name:"Jay Alammar - The Illustration Word2Vec",url:"https://jalammar.github.io/illustrated-word2vec/"},{name:"Jake Tae - PyTorch RNN from Scratch",url:"https://jaketae.github.io/study/pytorch-rnn/"},{name:"colah's blog - Understanding LSTM Networks",url:"https://colah.github.io/posts/2015-08-Understanding-LSTMs/"}]}],No=({module:o,index:t,resources:e=[],details:s=[]})=>{const[i,n]=C.useState(!1);return p.jsx(P.div,{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm hover:shadow-md transition-shadow duration-200 overflow-hidden border border-gray-200 dark:border-gray-700",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*t},children:p.jsxs("div",{className:"p-6",children:[p.jsxs("div",{className:"flex items-center justify-between mb-4",children:[p.jsxs("div",{className:"flex items-center",children:[p.jsx("span",{className:"flex items-center justify-center w-10 h-10 rounded-full bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 font-medium text-lg mr-4",children:t+1}),p.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:o.title})]}),p.jsx("span",{className:"px-3 py-1 text-sm font-medium rounded-full bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400",children:o.duration})]}),p.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:o.description}),p.jsxs("div",{className:"mt-4",children:[p.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Topics Covered:"}),p.jsx("div",{className:"space-y-2",children:s.map((r,a)=>p.jsxs("div",{className:"border-b border-gray-100 dark:border-gray-700 pb-2",children:[p.jsx("div",{className:"font-medium text-gray-800 dark:text-gray-200",children:r.name}),p.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:r.description})]},a))})]}),e.length>0&&p.jsxs("div",{className:"mt-6 pt-4 border-t border-gray-100 dark:border-gray-700",children:[p.jsxs("button",{onClick:()=>n(!i),className:"flex items-center text-sm font-medium text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 transition-colors",children:[i?"Hide":"Show"," Resources",p.jsx(tr,{className:`ml-1 transition-transform ${i?"rotate-180":""}`})]}),p.jsx(se,{children:i&&p.jsx(P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},className:"overflow-hidden",children:p.jsxs("div",{className:"mt-3 space-y-2",children:[p.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Recommended Resources:"}),p.jsx("ul",{className:"space-y-2",children:e.map((r,a)=>p.jsx("li",{className:"text-sm",children:p.jsxs("a",{href:r.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center text-blue-600 dark:text-blue-400 hover:underline",children:[r.name,p.jsx(Ds,{className:"ml-1 w-3 h-3"})]})},a))})]})})})]})]})},t)},Do={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1,delayChildren:.2}}},Ge={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{type:"spring",stiffness:50}}},Ei=({courseData:o})=>{const t=pa(),{courseModules:e,totalDuration:s,totalResources:i}=C.useMemo(()=>{const n=o.sections.map(l=>({title:l.title,duration:l.topics.length>3?"2 weeks":"1 week",description:l.description,topics:l.topics.map(c=>c.name),resources:l.resources||[],details:l.topics.map(c=>({name:c.name,description:c.details}))})),r=n.reduce((l,c)=>l+(c.duration.includes("week")?1:0),0),a=n.reduce((l,c)=>l+(c.resources?.length||0),0);return{courseModules:n,totalDuration:r,totalResources:a}},[o]);return p.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-[#0B1120] text-gray-900 dark:text-gray-100 font-sans selection:bg-blue-500/30",children:[p.jsxs("div",{className:"fixed inset-0 z-0 pointer-events-none overflow-hidden",children:[p.jsx("div",{className:"absolute top-0 left-1/4 w-96 h-96 bg-blue-500/20 rounded-full blur-3xl mix-blend-multiply dark:mix-blend-screen opacity-70 animate-blob"}),p.jsx("div",{className:"absolute top-0 right-1/4 w-96 h-96 bg-purple-500/20 rounded-full blur-3xl mix-blend-multiply dark:mix-blend-screen opacity-70 animate-blob animation-delay-2000"}),p.jsx("div",{className:"absolute -bottom-32 left-1/3 w-96 h-96 bg-emerald-500/20 rounded-full blur-3xl mix-blend-multiply dark:mix-blend-screen opacity-70 animate-blob animation-delay-4000"})]}),p.jsxs("div",{className:"relative z-10 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:[p.jsx(P.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:"mb-10",children:p.jsxs("button",{onClick:()=>t("/llm-course"),className:"group flex items-center px-4 py-2 mt-10 text-sm font-medium text-gray-600 dark:text-gray-400 bg-white/50 dark:bg-gray-800/50 backdrop-blur-sm border border-gray-200 dark:border-gray-700 rounded-full hover:bg-white dark:hover:bg-gray-800 hover:text-blue-600 dark:hover:text-blue-400 transition-all shadow-sm hover:shadow-md",children:[p.jsx(oo,{className:"mr-2 group-hover:-translate-x-1 transition-transform"}),"Back to LLM Courses"]})}),p.jsxs(P.div,{variants:Do,initial:"hidden",animate:"visible",className:"space-y-12",children:[p.jsxs(P.div,{variants:Ge,className:"space-y-3 sm:space-y-4 mb-12 sm:mb-16 mt-10 text-center max-w-4xl mx-auto",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.2,ease:[.25,.46,.45,.94]},children:[p.jsx("div",{className:"inline-flex items-center px-3 py-1 rounded-full bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 text-xs font-semibold tracking-wide uppercase border border-blue-200 dark:border-blue-800",children:"Learning Path"}),p.jsx("h1",{className:"text-3xl sm:text-4xl font-bold tracking-tight text-center",children:p.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-purple-600 via-blue-600 to-emerald-600 dark:from-purple-400 dark:via-blue-400 dark:to-emerald-400",children:o.title.toUpperCase()})}),o.subtitle&&p.jsx("p",{className:"text-lg sm:text-xl font-light text-gray-600 dark:text-gray-400 max-w-2xl mx-auto leading-relaxed",children:o.subtitle})]}),p.jsxs(P.div,{variants:Ge,className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[p.jsx(ws,{icon:uo,label:"Duration",value:`${s} Weeks`,color:"blue"}),p.jsx(ws,{icon:co,label:"Level",value:o.level||"All Levels",color:"purple"}),p.jsx(ws,{icon:er,label:"Modules",value:`${o.sections.length} Sections`,color:"emerald"}),p.jsx(ws,{icon:Zn,label:"Resources",value:`${i}+ Links`,color:"orange"})]}),p.jsxs(P.div,{variants:Ge,className:"bg-white/60 dark:bg-gray-800/40 backdrop-blur-xl rounded-2xl border border-gray-200 dark:border-gray-700 p-8 shadow-sm",children:[p.jsxs("h2",{className:"text-2xl font-bold mb-4 text-gray-900 dark:text-white flex items-center",children:[p.jsx("span",{className:"w-1 h-8 bg-blue-500 rounded-full mr-3"}),"Course Overview"]}),p.jsx("p",{className:"text-gray-600 dark:text-gray-300 leading-relaxed text-lg",children:o.intro})]}),p.jsxs("div",{className:"space-y-8",children:[p.jsx(P.div,{variants:Ge,className:"flex flex-col md:flex-row md:items-end justify-between gap-4 border-b border-gray-200 dark:border-gray-800 pb-4",children:p.jsxs("div",{children:[p.jsx("h2",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:o.modulesTitle||"Curriculum"}),p.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-2",children:o.modulesDescription||"Follow the structured path below to master the concepts."})]})}),p.jsx("div",{className:"space-y-6",children:e.map((n,r)=>p.jsx(P.div,{variants:Ge,whileInView:{opacity:1,y:0},viewport:{once:!0,margin:"-50px"},children:p.jsx(No,{module:n,index:r,resources:n.resources,details:n.details})},r))})]}),p.jsxs(P.div,{className:"mt-16 p-6 bg-blue-50 dark:bg-blue-900/20 rounded-lg border-l-4 border-blue-400 dark:border-blue-600",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},children:[p.jsx("h3",{className:"text-lg font-semibold text-blue-800 dark:text-blue-200 mb-2",children:"Note from the Original Author"}),p.jsx("p",{className:"text-blue-700 dark:text-blue-300 text-sm mb-3",children:"The following acknowledgments are from the original author of this learning path:"}),p.jsxs("div",{className:"bg-white dark:bg-gray-800/50 p-4 rounded-lg",children:[p.jsxs("p",{className:"text-gray-700 dark:text-gray-300 text-sm mb-3",children:["This roadmap was inspired by the excellent"," ",p.jsxs("a",{href:"https://github.com/milanm/DevOps-Roadmap",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:underline inline-flex items-center",children:["DevOps Roadmap ",p.jsx(Ds,{className:"ml-1",size:14})]})," ","from Milan Milanovi and Romano Roth."]}),p.jsx("p",{className:"text-gray-700 dark:text-gray-300 text-sm mb-3",children:"Special thanks to:"}),p.jsxs("ul",{className:"list-disc list-inside text-gray-700 dark:text-gray-300 text-sm space-y-1 pl-4",children:[p.jsx("li",{children:"Thomas Thelen for motivating me to create a roadmap"}),p.jsx("li",{children:"Andr Frade for his input and review of the first draft"}),p.jsx("li",{children:"Dino Dunn for providing resources about LLM security"}),p.jsx("li",{children:'Magdalena Kuhn for improving the "human evaluation" part'}),p.jsx("li",{children:"Odoverdose for suggesting 3Blue1Brown's video about Transformers"}),p.jsx("li",{children:"Everyone who contributed to the educational references in this course :)"})]}),p.jsx("p",{className:"text-gray-700 dark:text-gray-300 text-sm mt-3 italic",children:"Disclaimer: I am not affiliated with any sources listed here."})]}),p.jsx("p",{className:"text-blue-700 dark:text-blue-300 text-xs mt-3 italic",children:"This note is included to properly credit the original authors and contributors of this learning path."})]})]})]})]})},ws=({icon:o,label:t,value:e,color:s})=>{const i={blue:"text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20",purple:"text-purple-600 dark:text-purple-400 bg-purple-50 dark:bg-purple-900/20",emerald:"text-emerald-600 dark:text-emerald-400 bg-emerald-50 dark:bg-emerald-900/20",orange:"text-orange-600 dark:text-orange-400 bg-orange-50 dark:bg-orange-900/20"};return p.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-5 border border-gray-100 dark:border-gray-700 shadow-sm hover:shadow-md transition-shadow",children:[p.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center mb-3 ${i[s]}`,children:p.jsx(o,{size:20})}),p.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:t}),p.jsx("p",{className:"text-lg font-bold text-gray-900 dark:text-white mt-1",children:e})]})},md=()=>{const o={title:"LLM Fundamentals",subtitle:"Build a strong foundation in Large Language Models",intro:"This section introduces essential knowledge about mathematics, Python, and neural networks. You might not want to start here but refer to it as needed.",level:"Beginner",modulesTitle:"Course Modules",modulesDescription:"A structured learning path covering all aspects of LLM fundamentals",sections:Ro};return p.jsx(Ei,{courseData:o})},Io=[{id:1,title:"The LLM architecture",description:"An in-depth knowledge of the Transformer architecture is not required, but it's important to understand the main steps of modern LLMs: converting text into numbers through tokenization, processing these tokens through layers including attention mechanisms, and finally generating new text through various sampling strategies.",topics:[{name:"Architectural Overview",details:"Understand the evolution from encoder-decoder Transformers to decoder-only architectures like GPT, which form the basis of modern LLMs. Focus on how these models process and generate text at a high level."},{name:"Tokenization",details:"Learn the principles of tokenization - how text is converted into numerical representations that LLMs can process. Explore different tokenization strategies and their impact on model performance and output quality."},{name:"Attention mechanisms",details:"Master the core concepts of attention mechanisms, particularly self-attention and its variants. Understand how these mechanisms enable LLMs to process long-range dependencies and maintain context throughout sequences."},{name:"Sampling techniques",details:"Explore various text generation approaches and their tradeoffs. Compare deterministic methods like greedy search and beam search with probabilistic approaches like temperature sampling and nucleus sampling."}],resources:[{name:"Visual intro to Transformers",url:"https://www.youtube.com/watch?v=wjZofJX0v4M"},{name:"LLM Visualization",url:"https://bbycroft.net/llm"},{name:"nanoGPT",url:"https://www.youtube.com/watch?v=kCc8FmEb1nY"},{name:"Attention? Attention!",url:"https://lilianweng.github.io/posts/2018-06-24-attention/"},{name:"Decoding Strategies in LLMs",url:"https://mlabonne.github.io/blog/posts/2023-06-07-Decoding_strategies.html"}]},{id:2,title:"Pre-training models",description:"Pre-training is a computationally intensive and expensive process. While it's not the focus of this course, it's important to have a solid understanding of how models are pre-trained, especially in terms of data and parameters. Pre-training can also be performed by hobbyists at a small scale with <1B models.",topics:[{name:"Data preparation",details:"Pre-training requires massive datasets (e.g., Llama 3.1 was trained on 15 trillion tokens) that need careful curation, cleaning, deduplication, and tokenization. Modern pre-training pipelines implement sophisticated filtering to remove low-quality or problematic content."},{name:"Distributed training",details:"Combine different parallelization strategies: data parallel (batch distribution), pipeline parallel (layer distribution), and tensor parallel (operation splitting). These strategies require optimized network communication and memory management across GPU clusters."},{name:"Training optimization",details:"Use adaptive learning rates with warm-up, gradient clipping, and normalization to prevent explosions, mixed-precision training for memory efficiency, and modern optimizers (AdamW, Lion) with tuned hyperparameters."},{name:"Monitoring",details:"Track key metrics (loss, gradients, GPU stats) using dashboards, implement targeted logging for distributed training issues, and set up performance profiling to identify bottlenecks in computation and communication across devices."}],resources:[{name:"FineWeb",url:"https://huggingface.co/spaces/HuggingFaceFW/blogpost-fineweb-v1"},{name:"RedPajama v2",url:"https://www.together.ai/blog/redpajama-data-v2"},{name:"nanotron",url:"https://github.com/huggingface/nanotron"},{name:"Parallel training",url:"https://www.andrew.cmu.edu/course/11-667/lectures/W10L2%20Scaling%20Up%20Parallel%20Training.pdf"},{name:"Distributed training",url:"https://arxiv.org/abs/2407.20018"},{name:"OLMo 2",url:"https://allenai.org/olmo"},{name:"LLM360",url:"https://www.llm360.ai/"}]},{id:3,title:"Post-training datasets",description:"Post-training datasets have a precise structure with instructions and answers (supervised fine-tuning) or instructions and chosen/rejected answers (preference alignment). Conversational structures are a lot rarer than the raw text used for pre-training, which is why we often need to process seed data and refine it to improve the accuracy, diversity, and complexity of the samples. More information and examples are available in my repo  LLM Datasets.",topics:[{name:"Storage & chat templates",details:"Because of the conversational structure, post-training datasets are stored in a specific format like ShareGPT or OpenAI/HF. Then, these formats are mapped to a chat template like ChatML or Alpaca to produce the final samples the model is trained on."},{name:"Synthetic data generation",details:"Create instruction-response pairs based on seed data using frontier models like GPT-4o. This approach allows for flexible and scalable dataset creation with high-quality answers. Key considerations include designing diverse seed tasks and effective system prompts."},{name:"Data enhancement",details:"Enhance existing samples using techniques like verified outputs (using unit tests or solvers), multiple answers with rejection sampling, Auto-Evol, Chain-of-Thought, Branch-Solve-Merge, personas, etc."},{name:"Quality filtering",details:"Traditional techniques involve rule-based filtering, removing duplicates or near-duplicates (with MinHash or embeddings), and n-gram decontamination. Reward models and judge LLMs complement this step with fine-grained and customizable quality control."}],resources:[{name:"Synthetic Data Generator",url:"https://huggingface.co/spaces/argilla/synthetic-data-generator"},{name:"LLM Datasets",url:"https://github.com/mlabonne/llm-datasets"},{name:"NeMo-Curator",url:"https://github.com/NVIDIA/NeMo-Curator"},{name:"Distilabel",url:"https://distilabel.argilla.io/dev/sections/pipeline_samples/"},{name:"Semhash",url:"https://github.com/MinishLab/semhash"},{name:"Chat Template",url:"https://huggingface.co/docs/transformers/main/en/chat_templating"}]},{id:4,title:"Supervised Fine-Tuning",description:"SFT turns base models into helpful assistants, capable of answering questions and following instructions. During this process, they learn how to structure answers and reactivate a subset of knowledge learned during pre-training. Instilling new knowledge is possible but superficial: it cannot be used to learn a completely new language. Always prioritize data quality over parameter optimization.",topics:[{name:"Training techniques",details:"Full fine-tuning updates all model parameters but requires significant compute. Parameter-efficient fine-tuning techniques like LoRA and QLoRA reduce memory requirements by training a small number of adapter parameters while keeping base weights frozen. QLoRA combines 4-bit quantization with LoRA to reduce VRAM usage. These techniques are all implemented in the most popular fine-tuning frameworks: TRL, Unsloth, and Axolotl."},{name:"Training parameters",details:"Key parameters include learning rate with schedulers, batch size, gradient accumulation, number of epochs, optimizer (like 8-bit AdamW), weight decay for regularization, and warmup steps for training stability. LoRA also adds three parameters: rank (typically 16-128), alpha (1-2x rank), and target modules."},{name:"Distributed training",details:"Scale training across multiple GPUs using DeepSpeed or FSDP. DeepSpeed provides three ZeRO optimization stages with increasing levels of memory efficiency through state partitioning. Both methods support gradient checkpointing for memory efficiency."},{name:"Monitoring",details:"Track training metrics including loss curves, learning rate schedules, and gradient norms. Monitor for common issues like loss spikes, gradient explosions, or performance degradation."}],resources:[{name:"Fine-tune Llama 3.1 Ultra-Efficiently with Unsloth",url:"https://huggingface.co/blog/mlabonne/sft-llama3"},{name:"Axolotl - Documentation",url:"https://axolotl-ai-cloud.github.io/axolotl/"},{name:"Mastering LLMs",url:"https://parlance-labs.com/education/"},{name:"LoRA insights",url:"https://lightning.ai/pages/community/lora-insights/"}]},{id:5,title:"Preference Alignment",description:"Preference alignment is a second stage in the post-training pipeline, focused on aligning generated answers with human preferences. This stage was designed to tune the tone of LLMs and reduce toxicity and hallucinations. However, it has become increasingly important to also boost their performance and improve usefulness. Unlike SFT, there are many preference alignment algorithms. Here, we'll focus on the three most important ones: DPO, GRPO, and PPO.",topics:[{name:"Rejection sampling",details:"For each prompt, use the trained model to generate multiple responses, and score them to infer chosen/rejected answers. This creates on-policy data, where both responses come from the model being trained, improving alignment stability."},{name:"Direct Preference Optimization",details:"Directly optimizes the policy to maximize the likelihood of chosen responses over rejected ones. It doesn't require reward modeling, which makes it more computationally efficient than RL techniques but slightly worse in terms of quality. Great for creating chat models.",url:"https://arxiv.org/abs/2305.18290"},{name:"Reward model",details:"Train a reward model with human feedback to predict metrics like human preferences. It can leverage frameworks like TRL, verl, and OpenRLHF for scalable training.",urls:["https://huggingface.co/docs/trl/en/index","https://github.com/volcengine/verl","https://github.com/OpenRLHF/OpenRLHF"]},{name:"Reinforcement Learning",details:"RL techniques like GRPO and PPO iteratively update a policy to maximize rewards while staying close to the initial behavior. They can use a reward model or reward functions to score responses. They tend to be computationally expensive and require careful tuning of hyperparameters, including learning rate, batch size, and clip range. Ideal for creating reasoning models.",urls:["https://arxiv.org/abs/2402.03300","https://arxiv.org/abs/1707.06347"]}],resources:[{name:"Illustrating RLHF",url:"https://huggingface.co/blog/rlhf"},{name:"LLM Training: RLHF and Its Alternatives",url:"https://magazine.sebastianraschka.com/p/llm-training-rlhf-and-its-alternatives"},{name:"Preference Tuning LLMs",url:"https://huggingface.co/blog/pref-tuning"},{name:"Fine-tune with DPO",url:"https://mlabonne.github.io/blog/posts/Fine_tune_Mistral_7b_with_DPO.html"},{name:"Fine-tune with GRPO",url:"https://huggingface.co/learn/llm-course/en/chapter12/5"},{name:"DPO Wandb logs",url:"https://wandb.ai/alexander-vishnevskiy/dpo/reports/TRL-Original-DPO--Vmlldzo1NjI4MTc4"}]},{id:6,title:"Evaluation",description:"Reliably evaluating LLMs is a complex but essential task guiding data generation and training. It provides invaluable feedback about areas of improvement, which can be leveraged to modify the data mixture, quality, and training parameters. However, it's always good to remember Goodhart's law: 'When a measure becomes a target, it ceases to be a good measure.'",topics:[{name:"Automated benchmarks",details:"Evaluate models on specific tasks using curated datasets and metrics, like MMLU. It works well for concrete tasks but struggles with abstract and creative capabilities. It is also prone to data contamination."},{name:"Human evaluation",details:"It involves humans prompting models and grading responses. Methods range from vibe checks to systematic annotations with specific guidelines and large-scale community voting (arena). It is more suited for subjective tasks and less reliable for factual accuracy."},{name:"Model-based evaluation",details:"Use judge and reward models to evaluate model outputs. It highly correlates with human preferences but suffers from bias toward their own outputs and inconsistent scoring."},{name:"Feedback signal",details:"Analyze error patterns to identify specific weaknesses, such as limitations in following complex instructions, lack of specific knowledge, or susceptibility to adversarial prompts. This can be improved with better data generation and training parameters."}],resources:[{name:"Evaluation guidebook",url:"https://github.com/huggingface/evaluation-guidebook"},{name:"Open LLM Leaderboard",url:"https://huggingface.co/spaces/open-llm-leaderboard/open_llm_leaderboard"},{name:"Language Model Evaluation Harness",url:"https://github.com/EleutherAI/lm-evaluation-harness"},{name:"Lighteval",url:"https://github.com/huggingface/lighteval"},{name:"Chatbot Arena",url:"https://lmarena.ai/"}]},{id:7,title:"Quantization",description:"Quantization is the process of converting the parameters and activations of a model using a lower precision. For example, weights stored using 16 bits can be converted into a 4-bit representation. This technique has become increasingly important to reduce the computational and memory costs associated with LLMs.",topics:[{name:"Base techniques",details:"Learn the different levels of precision (FP32, FP16, INT8, etc.) and how to perform nave quantization with absmax and zero-point techniques."},{name:"GGUF & llama.cpp",details:"Originally designed to run on CPUs, llama.cpp and the GGUF format have become the most popular tools to run LLMs on consumer-grade hardware. It supports storing special tokens, vocabulary, and metadata in a single file.",urls:["https://github.com/ggerganov/llama.cpp"]},{name:"GPTQ & AWQ",details:"Techniques like GPTQ/EXL2 and AWQ introduce layer-by-layer calibration that retains performance at extremely low bitwidths. They reduce catastrophic outliers using dynamic scaling, selectively skipping or re-centering the heaviest parameters.",urls:["https://arxiv.org/abs/2210.17323","https://github.com/turboderp/exllamav2","https://arxiv.org/abs/2306.00978"]},{name:"SmoothQuant & ZeroQuant",details:"New quantization-friendly transformations (SmoothQuant) and compiler-based optimizations (ZeroQuant) help mitigate outliers before quantization. They also reduce hardware overhead by fusing certain ops and optimizing dataflow.",urls:["https://github.com/mit-han-lab/smoothquant/blob/main/examples/smoothquant_llama_demo.ipynb","https://www.deepspeed.ai/tutorials/model-compression/"]}],resources:[{name:"Introduction to quantization",url:"https://mlabonne.github.io/blog/posts/Introduction_to_Weight_Quantization.html"},{name:"Quantize Llama models with llama.cpp",url:"https://mlabonne.github.io/blog/posts/Quantize_Llama_2_models_using_ggml.html"},{name:"4-bit LLM Quantization with GPTQ",url:"https://mlabonne.github.io/blog/posts/4_bit_Quantization_with_GPTQ.html"},{name:"Understanding Activation-Aware Weight Quantization",url:"https://medium.com/friendliai/understanding-activation-aware-weight-quantization-awq-boosting-inference-serving-efficiency-in-10bb0faf63a8"}]},{id:8,title:"New Trends",description:"Here are notable topics that didn't fit into other categories. Some are established (model merging, multimodal) techniques, but others are more experimental (interpretability, test-time compute scaling) and the focus of numerous research papers.",topics:[{name:"Model merging",details:"Merging trained models has become a popular way of creating performant models without any fine-tuning. The popular mergekit library implements the most popular merging methods, like SLERP, DARE, and TIES.",urls:["https://github.com/cg123/mergekit","https://arxiv.org/abs/2311.03099"]},{name:"Multimodal models",details:"These models (like CLIP, Stable Diffusion, or LLaVA) process multiple types of inputs (text, images, audio, etc.) with a unified embedding space, which unlocks powerful applications like text-to-image.",urls:["https://openai.com/research/clip","https://stability.ai/stable-image","https://llava-vl.github.io/"]},{name:"Interpretability",details:"Mechanistic interpretability techniques like Sparse Autoencoders (SAEs) have made remarkable progress to provide insights about the inner workings of LLMs. This has also been applied with techniques such as abliteration, which allow you to modify the behavior of models without training.",urls:["https://huggingface.co/blog/mlabonne/abliteration","https://adamkarvonen.github.io/machine_learning/2024/06/11/sae-intuitions.html"]},{name:"Test-time compute",details:"Reasoning models trained with RL techniques can be further improved by scaling the compute budget during test time. It can involve multiple calls, MCTS, or specialized models like a Process Reward Model (PRM). Iterative steps with precise scoring significantly improve performance for complex reasoning tasks.",urls:["https://huggingface.co/spaces/HuggingFaceH4/blogpost-scaling-test-time-compute"]}],resources:[{name:"Merge LLMs with mergekit",url:"https://mlabonne.github.io/blog/posts/2024-01-08_Merge_LLMs_with_mergekit.html"},{name:"Smol Vision",url:"https://github.com/merveenoyan/smol-vision"},{name:"Large Multimodal Models",url:"https://huyenchip.com/2023/10/10/multimodal.html"},{name:"Unsensor any LLM with abliteration",url:"https://huggingface.co/blog/mlabonne/abliteration"},{name:"Scaling test-time compute",url:"https://huggingface.co/spaces/HuggingFaceH4/blogpost-scaling-test-time-compute"}]}],bd=()=>{const o={title:"LLM Scientist",subtitle:"Dive deep into LLM research and development",intro:"This section of the course focuses on learning how to build the best possible LLMs using the latest techniques.",level:"Advanced",modulesTitle:"Research Tracks",modulesDescription:"Advanced modules for LLM research and development",sections:Io};return p.jsx(Ei,{courseData:o})},Fo=[{id:1,title:"Running LLMs",description:"Running LLMs can be difficult due to high hardware requirements. Depending on your use case, you might want to simply consume a model through an API (like GPT-4) or run it locally. In any case, additional prompting and guidance techniques can improve and constrain the output for your applications.",topics:[{name:"LLM APIs",details:"APIs are a convenient way to deploy LLMs. This space is divided between private LLMs (OpenAI, Google, Anthropic, etc.) and open-source LLMs (OpenRouter, Hugging Face, Together AI, etc.).",urls:["https://platform.openai.com/","https://cloud.google.com/vertex-ai/docs/generative-ai/learn/overview","https://docs.anthropic.com/claude/reference/getting-started-with-the-api","https://openrouter.ai/","https://huggingface.co/inference-api","https://www.together.ai/"]},{name:"Open-source LLMs",details:"The Hugging Face Hub is a great place to find LLMs. You can directly run some of them in Hugging Face Spaces, or download and run them locally in apps like LM Studio or through the CLI with llama.cpp or ollama.",urls:["https://huggingface.co/models","https://huggingface.co/spaces","https://lmstudio.ai/","https://github.com/ggerganov/llama.cpp","https://ollama.ai/"]},{name:"Prompt engineering",details:"Common techniques include zero-shot prompting, few-shot prompting, chain of thought, and ReAct. They work better with bigger models, but can be adapted to smaller ones."},{name:"Structuring outputs",details:"Many tasks require a structured output, like a strict template or a JSON format. Libraries like Outlines can be used to guide the generation and respect a given structure. Some APIs also support structured output generation natively using JSON schemas.",urls:["https://github.com/outlines-dev/outlines"]}],resources:[{name:"Run an LLM locally with LM Studio",url:"https://www.kdnuggets.com/run-an-llm-locally-with-lm-studio"},{name:"Prompt engineering guide",url:"https://www.promptingguide.ai/"},{name:"Outlines - Quickstart",url:"https://dottxt-ai.github.io/outlines/latest/quickstart/"},{name:"LMQL - Overview",url:"https://lmql.ai/docs/language/overview.html"}]},{id:2,title:"Building a Vector Storage",description:"Creating a vector storage is the first step to building a Retrieval Augmented Generation (RAG) pipeline. Documents are loaded, split, and relevant chunks are used to produce vector representations (embeddings) that are stored for future use during inference.",topics:[{name:"Ingesting documents",details:"Document loaders are convenient wrappers that can handle many formats: PDF, JSON, HTML, Markdown, etc. They can also directly retrieve data from some databases and APIs (GitHub, Reddit, Google Drive, etc.)."},{name:"Splitting documents",details:"Text splitters break down documents into smaller, semantically meaningful chunks. Instead of splitting text after n characters, it's often better to split by header or recursively, with some additional metadata."},{name:"Embedding models",details:"Embedding models convert text into vector representations. Picking task-specific models significantly improves performance for semantic search and RAG."},{name:"Vector databases",details:"Vector databases (like Chroma, Pinecone, Milvus, FAISS, Annoy, etc.) are designed to store embedding vectors. They enable efficient retrieval of data that is 'most similar' to a query based on vector similarity.",urls:["https://www.trychroma.com/","https://www.pinecone.io/","https://milvus.io/","https://faiss.ai/","https://github.com/spotify/annoy"]}],resources:[{name:"LangChain - Text splitters",url:"https://python.langchain.com/docs/how_to/#text-splitters"},{name:"Sentence Transformers library",url:"https://www.sbert.net/"},{name:"MTEB Leaderboard",url:"https://huggingface.co/spaces/mteb/leaderboard"},{name:"The Top 7 Vector Databases",url:"https://www.datacamp.com/blog/the-top-5-vector-databases"}]},{id:3,title:"Retrieval Augmented Generation",description:"With RAG, LLMs retrieve contextual documents from a database to improve the accuracy of their answers. RAG is a popular way of augmenting the model's knowledge without any fine-tuning.",topics:[{name:"Orchestrators",details:"Orchestrators like LangChain and LlamaIndex are popular frameworks to connect your LLMs with tools and databases. The Model Context Protocol (MCP) introduces a new standard to pass data and context to models across providers.",urls:["https://python.langchain.com/docs/get_started/introduction","https://docs.llamaindex.ai/en/stable/","https://modelcontextprotocol.io/introduction"]},{name:"Retrievers",details:"Query rewriters and generative retrievers like CoRAG and HyDE enhance search by transforming user queries. Multi-vector and hybrid retrieval methods combine embeddings with keyword signals to improve recall and precision."},{name:"Memory",details:"To remember previous instructions and answers, LLMs and chatbots like ChatGPT add this history to their context window. This buffer can be improved with summarization (e.g., using a smaller LLM), a vector store + RAG, etc."},{name:"Evaluation",details:"We need to evaluate both the document retrieval (context precision and recall) and generation stages (faithfulness and answer relevancy). It can be simplified with tools Ragas and DeepEval (assessing quality).",urls:["https://github.com/explodinggradients/ragas/tree/main","https://github.com/confident-ai/deepeval"]}],resources:[{name:"Llamaindex - High-level concepts",url:"https://docs.llamaindex.ai/en/stable/getting_started/concepts.html"},{name:"Model Context Protocol",url:"https://modelcontextprotocol.io/introduction"},{name:"Pinecone - Retrieval Augmentation",url:"https://www.pinecone.io/learn/series/langchain/langchain-retrieval-augmentation/"},{name:"LangChain - Q&A with RAG",url:"https://python.langchain.com/docs/tutorials/rag/"},{name:"LangChain - Memory types",url:"https://python.langchain.com/docs/how_to/chatbots_memory/"},{name:"RAG pipeline - Metrics",url:"https://docs.ragas.io/en/stable/concepts/metrics/index.html"}]},{id:4,title:"Advanced RAG",description:"Real-life applications can require complex pipelines, including SQL or graph databases, as well as automatically selecting relevant tools and APIs. These advanced techniques can improve a baseline solution and provide additional features.",topics:[{name:"Query construction",details:"Structured data stored in traditional databases requires a specific query language like SQL, Cypher, metadata, etc. We can directly translate the user instruction into a query to access the data with query construction."},{name:"Tools",details:"Agents augment LLMs by automatically selecting the most relevant tools to provide an answer. These tools can be as simple as using Google or Wikipedia, or more complex like a Python interpreter or Jira.",urls:["https://www.pinecone.io/learn/series/langchain/langchain-agents/","https://lilianweng.github.io/posts/2023-06-23-agent/"]},{name:"Post-processing",details:"Final step that processes the inputs that are fed to the LLM. It enhances the relevance and diversity of documents retrieved with re-ranking, RAG-fusion, and classification.",urls:["https://github.com/Raudaschl/rag-fusion"]},{name:"Program LLMs",details:"Frameworks like DSPy allow you to optimize prompts and weights based on automated evaluations in a programmatic way.",urls:["https://github.com/stanfordnlp/dspy","https://dspy-docs.vercel.app/docs/building-blocks/solving_your_task"]}],resources:[{name:"LangChain - Query Construction",url:"https://blog.langchain.dev/query-construction/"},{name:"LangChain - SQL",url:"https://python.langchain.com/docs/tutorials/sql_qa/"},{name:"Pinecone - LLM agents",url:"https://www.pinecone.io/learn/series/langchain/langchain-agents/"},{name:"LLM Powered Autonomous Agents",url:"https://lilianweng.github.io/posts/2023-06-23-agent/"},{name:"LangChain - OpenAI's RAG",url:"https://blog.langchain.dev/applying-openai-rag/"},{name:"DSPy in 8 Steps",url:"https://dspy-docs.vercel.app/docs/building-blocks/solving_your_task"}]},{id:5,title:"Agents",description:"An LLM agent can autonomously perform tasks by taking actions based on reasoning about its environment, typically through the use of tools or functions to interact with external systems.",topics:[{name:"Agent fundamentals",details:"Agents operate using thoughts (internal reasoning to decide what to do next), action (executing tasks, often by interacting with external tools), and observation (analyzing feedback or results to refine the next step)."},{name:"Agent frameworks",details:"Agent development can be streamlined using different frameworks like LangGraph (design and visualization of workflows), LlamaIndex (data-augmented agents with RAG), or smolagents (beginner-friendly, lightweight option).",urls:["https://www.langchain.com/langgraph","https://docs.llamaindex.ai/en/stable/use_cases/agents/","https://github.com/huggingface/smolagents"]},{name:"Multi-agents",details:"More experimental frameworks include collaboration between different agents, such as CrewAI (role-based team orchestration), AutoGen (conversation-driven multi-agent systems), and OpenAI Agents SDK (production-ready with strong OpenAI model integration).",urls:["https://docs.crewai.com/introduction","https://github.com/microsoft/autogen","https://github.com/openai/openai-agents-python"]}],resources:[{name:"Agents Course",url:"https://huggingface.co/learn/agents-course/unit0/introduction"},{name:"AI Agents Comparison",url:"https://langfuse.com/blog/2025-03-19-ai-agent-comparison"},{name:"LangGraph",url:"https://langchain-ai.github.io/langgraph/concepts/why-langgraph/"},{name:"LlamaIndex Agents",url:"https://docs.llamaindex.ai/en/stable/use_cases/agents/"},{name:"smolagents",url:"https://huggingface.co/docs/smolagents/index"}]},{id:6,title:"Inference optimization",description:"Text generation is a costly process that requires expensive hardware. In addition to quantization, various techniques have been proposed to maximize throughput and reduce inference costs.",topics:[{name:"Flash Attention",details:"Optimization of the attention mechanism to transform its complexity from quadratic to linear, speeding up both training and inference."},{name:"Key-value cache",details:"Understand the key-value cache and the improvements introduced in Multi-Query Attention (MQA) and Grouped-Query Attention (GQA).",urls:["https://arxiv.org/abs/1911.02150","https://arxiv.org/abs/2305.13245"]},{name:"Speculative decoding",details:"Use a small model to produce drafts that are then reviewed by a larger model to speed up text generation."}],resources:[{name:"GPU Inference",url:"https://huggingface.co/docs/transformers/main/en/perf_infer_gpu_one"},{name:"LLM Inference",url:"https://www.databricks.com/blog/llm-inference-performance-engineering-best-practices"},{name:"Optimizing LLMs for Speed and Memory",url:"https://huggingface.co/docs/transformers/main/en/llm_tutorial_optimization"},{name:"Assisted Generation",url:"https://huggingface.co/blog/assisted-generation"}]},{id:7,title:"Deploying LLMs",description:"Deploying LLMs at scale is an engineering feat that can require multiple clusters of GPUs. In other scenarios, demos and local apps can be achieved with a much lower complexity.",topics:[{name:"Local deployment",details:"Privacy is an important advantage that open-source LLMs have over private ones. Local LLM servers (LM Studio, Ollama, oobabooga, kobold.cpp, etc.) capitalize on this advantage to power local apps.",urls:["https://lmstudio.ai/","https://ollama.ai/","https://github.com/oobabooga/text-generation-webui","https://github.com/LostRuins/koboldcpp"]},{name:"Demo deployment",details:"Frameworks like Gradio and Streamlit are helpful to prototype applications and share demos. You can also easily host them online using Hugging Face Spaces.",urls:["https://www.gradio.app/","https://docs.streamlit.io/","https://huggingface.co/spaces"]},{name:"Server deployment",details:"Deploy LLMs at scale requires cloud (SkyPilot) or on-prem infrastructure and often leverages optimized text generation frameworks like TGI or vLLM.",urls:["https://skypilot.readthedocs.io/en/latest/","https://github.com/huggingface/text-generation-inference","https://github.com/vllm-project/vllm/tree/main"]},{name:"Edge deployment",details:"High-performance frameworks like MLC LLM and mnn-llm can deploy LLMs in web browsers, Android, and iOS for constrained environments.",urls:["https://github.com/mlc-ai/mlc-llm","https://github.com/wangzhaode/mnn-llm/blob/master/README_en.md"]}],resources:[{name:"Streamlit - Build a basic LLM app",url:"https://docs.streamlit.io/knowledge-base/tutorials/build-conversational-apps"},{name:"HF LLM Inference Container",url:"https://huggingface.co/blog/sagemaker-huggingface-llm"},{name:"Philschmid blog",url:"https://www.philschmid.de/"},{name:"Optimizing latence",url:"https://hamel.dev/notes/llm/inference/03_inference.html"}]},{id:8,title:"Securing LLMs",description:"In addition to traditional security problems associated with software, LLMs have unique weaknesses due to the way they are trained and prompted.",topics:[{name:"Prompt hacking",details:"Different techniques related to prompt engineering, including prompt injection (additional instruction to hijack the model's answer), data/prompt leaking (retrieve its original data/prompt), and jailbreaking (craft prompts to bypass safety features)."},{name:"Backdoors",details:"Attack vectors can target the training data itself, by poisoning the training data or creating backdoors (secret triggers to change the model's behavior during inference)."},{name:"Defensive measures",details:"The best way to protect your LLM applications is to test them against these vulnerabilities (e.g., using red teaming and checks like garak) and observe them in production (with a framework like langfuse).",urls:["https://github.com/leondz/garak/","https://github.com/langfuse/langfuse"]}],resources:[{name:"OWASP LLM Top 10",url:"https://owasp.org/www-project-top-10-for-large-language-model-applications/"},{name:"Prompt Injection Primer",url:"https://github.com/jthack/PIPE"},{name:"LLM Security",url:"https://llmsecurity.net/"},{name:"Red teaming LLMs",url:"https://learn.microsoft.com/en-us/azure/ai-services/openai/concepts/red-teaming"}]}],yd=()=>{const o={title:"LLM Engineer",subtitle:"Build and deploy production-grade LLM applications",intro:"This course focuses on building and deploying production-grade LLM applications. Learn to optimize, scale, and maintain LLM applications with industry best practices.",level:"Advanced",modulesTitle:"Engineering Tracks",modulesDescription:"Comprehensive modules covering the full LLM engineering lifecycle",sections:Fo};return p.jsx(Ei,{courseData:o})},ei=[{id:1,title:"Natural Language for Machine Learning",description:"Comprehensive guide on applying natural language processing techniques in machine learning, covering text processing, feature extraction, and model architectures.",pdfPath:"/resources/pdfs/1756170671202.pdf",category:"Machine Learning",date:"2025-07-05"},{id:2,title:"Python Programming Guide",description:"Comprehensive guide to Python programming, covering fundamental concepts to advanced topics including data structures, OOP, and best practices.",pdfPath:"/resources/pdfs/1755575602183.pdf",category:"Programming",date:"2025-06-05"},{id:3,title:"Mathematical Foundations of Gradient Descent and Backpropagation",description:"Comprehensive guide on mathematical foundations of gradient descent and backpropagation, covering linear algebra, calculus, and optimization techniques.",pdfPath:"/resources/pdfs/1727144999481.pdf",category:"Machine Learning",date:"2024-06-26"},{id:4,title:"SQL: Structured Query Language in Modern Data Management",description:"Comprehensive guide on SQL in modern data management.",pdfPath:"/resources/pdfs/1727490596359.pdf",category:"Database",date:"2024-06-26"},{id:5,title:"Neural Networks Solved Questions",description:"Solved questions on neural networks.",pdfPath:"/resources/pdfs/1727493473454.pdf",category:"Neural Networks",date:"2025-11-02"},{id:6,title:"Designing GraphQL APIs for Modular Table Queries Using NestJS",description:"A detailed guide on building modular GraphQL APIs with NestJS for efficient data querying.",pdfPath:"/resources/pdfs/1731868617730.pdf",category:"Programming",date:"2025-11-02"},{id:7,title:"Understanding Data Normalization in Database Design",description:"Comprehensive notes on database normalization forms and their applications.",pdfPath:"/resources/pdfs/1731361247545.pdf",category:"Database",date:"2025-11-02"},{id:8,title:"Data Structures and Algorithms (DSA) Topics",description:"Essential topics and explanations covering key DSA concepts and problem-solving techniques.",pdfPath:"/resources/pdfs/1737831281395.pdf",category:"Programming",date:"2025-11-02"},{id:9,title:"Implementation and Maintenance of MySQL Databases",description:"Best practices and procedures for implementing and maintaining MySQL databases effectively.",pdfPath:"/resources/pdfs/1731950182853.pdf",category:"Database",date:"2025-11-02"}],Ct=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),pi=[.001,0,0,.001,0,0],si=1.35,Nt={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},Qt={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},ts="pdfjs_internal_editor_",j={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,POPUP:16,SIGNATURE:101,COMMENT:102},V={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_THICKNESS:32,HIGHLIGHT_FREE:33,HIGHLIGHT_SHOW_ALL:34,DRAW_STEP:41},sr={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},yt={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},Je={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},ht={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},Ee={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},os={ERRORS:0,WARNINGS:1,INFOS:5},Oe={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93,rawFillPath:94},xs={moveTo:0,lineTo:1,curveTo:2,closePath:3},ir={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let Hs=os.WARNINGS;function Oo(o){Number.isInteger(o)&&(Hs=o)}function jo(){return Hs}function Us(o){Hs>=os.INFOS&&console.info(`Info: ${o}`)}function B(o){Hs>=os.WARNINGS&&console.warn(`Warning: ${o}`)}function J(o){throw new Error(o)}function W(o,t){o||J(t)}function Bo(o){switch(o?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function Ci(o,t=null,e=null){if(!o)return null;if(e&&typeof o=="string"&&(e.addDefaultProtocol&&o.startsWith("www.")&&o.match(/\./g)?.length>=2&&(o=`http://${o}`),e.tryConvertEncoding))try{o=$o(o)}catch{}const s=t?URL.parse(o,t):URL.parse(o);return Bo(s)?s:null}function Ti(o,t,e=!1){const s=URL.parse(o);return s?(s.hash=t,s.href):e&&Ci(o,"http://example.com")?o.split("#",1)[0]+`${t?`#${t}`:""}`:""}function z(o,t,e,s=!1){return Object.defineProperty(o,t,{value:e,enumerable:!s,configurable:!0,writable:!1}),e}const xe=(function(){function t(e,s){this.message=e,this.name=s}return t.prototype=new Error,t.constructor=t,t})();class sn extends xe{constructor(t,e){super(t,"PasswordException"),this.code=e}}class ii extends xe{constructor(t,e){super(t,"UnknownErrorException"),this.details=e}}class Is extends xe{constructor(t){super(t,"InvalidPDFException")}}class es extends xe{constructor(t,e,s){super(t,"ResponseException"),this.status=e,this.missing=s}}class Ho extends xe{constructor(t){super(t,"FormatError")}}class ie extends xe{constructor(t){super(t,"AbortException")}}function nr(o){(typeof o!="object"||o?.length===void 0)&&J("Invalid argument for bytesToString");const t=o.length,e=8192;if(t<e)return String.fromCharCode.apply(null,o);const s=[];for(let i=0;i<t;i+=e){const n=Math.min(i+e,t),r=o.subarray(i,n);s.push(String.fromCharCode.apply(null,r))}return s.join("")}function ls(o){typeof o!="string"&&J("Invalid argument for stringToBytes");const t=o.length,e=new Uint8Array(t);for(let s=0;s<t;++s)e[s]=o.charCodeAt(s)&255;return e}function Uo(o){return String.fromCharCode(o>>24&255,o>>16&255,o>>8&255,o&255)}function zo(){const o=new Uint8Array(4);return o[0]=1,new Uint32Array(o.buffer,0,1)[0]===1}function Go(){try{return new Function(""),!0}catch{return!1}}class bt{static get isLittleEndian(){return z(this,"isLittleEndian",zo())}static get isEvalSupported(){return z(this,"isEvalSupported",Go())}static get isOffscreenCanvasSupported(){return z(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return z(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get platform(){const{platform:t,userAgent:e}=navigator;return z(this,"platform",{isAndroid:e.includes("Android"),isLinux:t.includes("Linux"),isMac:t.includes("Mac"),isWindows:t.includes("Win"),isFirefox:e.includes("Firefox")})}static get isCSSRoundSupported(){return z(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}const ni=Array.from(Array(256).keys(),o=>o.toString(16).padStart(2,"0"));class D{static makeHexColor(t,e,s){return`#${ni[t]}${ni[e]}${ni[s]}`}static domMatrixToTransform(t){return[t.a,t.b,t.c,t.d,t.e,t.f]}static scaleMinMax(t,e){let s;t[0]?(t[0]<0&&(s=e[0],e[0]=e[2],e[2]=s),e[0]*=t[0],e[2]*=t[0],t[3]<0&&(s=e[1],e[1]=e[3],e[3]=s),e[1]*=t[3],e[3]*=t[3]):(s=e[0],e[0]=e[1],e[1]=s,s=e[2],e[2]=e[3],e[3]=s,t[1]<0&&(s=e[1],e[1]=e[3],e[3]=s),e[1]*=t[1],e[3]*=t[1],t[2]<0&&(s=e[0],e[0]=e[2],e[2]=s),e[0]*=t[2],e[2]*=t[2]),e[0]+=t[4],e[1]+=t[5],e[2]+=t[4],e[3]+=t[5]}static transform(t,e){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],t[0]*e[4]+t[2]*e[5]+t[4],t[1]*e[4]+t[3]*e[5]+t[5]]}static multiplyByDOMMatrix(t,e){return[t[0]*e.a+t[2]*e.b,t[1]*e.a+t[3]*e.b,t[0]*e.c+t[2]*e.d,t[1]*e.c+t[3]*e.d,t[0]*e.e+t[2]*e.f+t[4],t[1]*e.e+t[3]*e.f+t[5]]}static applyTransform(t,e,s=0){const i=t[s],n=t[s+1];t[s]=i*e[0]+n*e[2]+e[4],t[s+1]=i*e[1]+n*e[3]+e[5]}static applyTransformToBezier(t,e,s=0){const i=e[0],n=e[1],r=e[2],a=e[3],l=e[4],c=e[5];for(let h=0;h<6;h+=2){const d=t[s+h],u=t[s+h+1];t[s+h]=d*i+u*r+l,t[s+h+1]=d*n+u*a+c}}static applyInverseTransform(t,e){const s=t[0],i=t[1],n=e[0]*e[3]-e[1]*e[2];t[0]=(s*e[3]-i*e[2]+e[2]*e[5]-e[4]*e[3])/n,t[1]=(-s*e[1]+i*e[0]+e[4]*e[1]-e[5]*e[0])/n}static axialAlignedBoundingBox(t,e,s){const i=e[0],n=e[1],r=e[2],a=e[3],l=e[4],c=e[5],h=t[0],d=t[1],u=t[2],f=t[3];let m=i*h+l,g=m,y=i*u+l,b=y,x=a*d+c,w=x,A=a*f+c,v=A;if(n!==0||r!==0){const k=n*h,S=n*u,_=r*d,E=r*f;m+=_,b+=_,y+=E,g+=E,x+=k,v+=k,A+=S,w+=S}s[0]=Math.min(s[0],m,y,g,b),s[1]=Math.min(s[1],x,A,w,v),s[2]=Math.max(s[2],m,y,g,b),s[3]=Math.max(s[3],x,A,w,v)}static inverseTransform(t){const e=t[0]*t[3]-t[1]*t[2];return[t[3]/e,-t[1]/e,-t[2]/e,t[0]/e,(t[2]*t[5]-t[4]*t[3])/e,(t[4]*t[1]-t[5]*t[0])/e]}static singularValueDecompose2dScale(t,e){const s=t[0],i=t[1],n=t[2],r=t[3],a=s**2+i**2,l=s*n+i*r,c=n**2+r**2,h=(a+c)/2,d=Math.sqrt(h**2-(a*c-l**2));e[0]=Math.sqrt(h+d||1),e[1]=Math.sqrt(h-d||1)}static normalizeRect(t){const e=t.slice(0);return t[0]>t[2]&&(e[0]=t[2],e[2]=t[0]),t[1]>t[3]&&(e[1]=t[3],e[3]=t[1]),e}static intersect(t,e){const s=Math.max(Math.min(t[0],t[2]),Math.min(e[0],e[2])),i=Math.min(Math.max(t[0],t[2]),Math.max(e[0],e[2]));if(s>i)return null;const n=Math.max(Math.min(t[1],t[3]),Math.min(e[1],e[3])),r=Math.min(Math.max(t[1],t[3]),Math.max(e[1],e[3]));return n>r?null:[s,n,i,r]}static pointBoundingBox(t,e,s){s[0]=Math.min(s[0],t),s[1]=Math.min(s[1],e),s[2]=Math.max(s[2],t),s[3]=Math.max(s[3],e)}static rectBoundingBox(t,e,s,i,n){n[0]=Math.min(n[0],t,s),n[1]=Math.min(n[1],e,i),n[2]=Math.max(n[2],t,s),n[3]=Math.max(n[3],e,i)}static#t(t,e,s,i,n,r,a,l,c,h){if(c<=0||c>=1)return;const d=1-c,u=c*c,f=u*c,m=d*(d*(d*t+3*c*e)+3*u*s)+f*i,g=d*(d*(d*n+3*c*r)+3*u*a)+f*l;h[0]=Math.min(h[0],m),h[1]=Math.min(h[1],g),h[2]=Math.max(h[2],m),h[3]=Math.max(h[3],g)}static#e(t,e,s,i,n,r,a,l,c,h,d,u){if(Math.abs(c)<1e-12){Math.abs(h)>=1e-12&&this.#t(t,e,s,i,n,r,a,l,-d/h,u);return}const f=h**2-4*d*c;if(f<0)return;const m=Math.sqrt(f),g=2*c;this.#t(t,e,s,i,n,r,a,l,(-h+m)/g,u),this.#t(t,e,s,i,n,r,a,l,(-h-m)/g,u)}static bezierBoundingBox(t,e,s,i,n,r,a,l,c){c[0]=Math.min(c[0],t,a),c[1]=Math.min(c[1],e,l),c[2]=Math.max(c[2],t,a),c[3]=Math.max(c[3],e,l),this.#e(t,s,n,a,e,i,r,l,3*(-t+3*(s-n)+a),6*(t-2*s+n),3*(s-t),c),this.#e(t,s,n,a,e,i,r,l,3*(-e+3*(i-r)+l),6*(e-2*i+r),3*(i-e),c)}}function $o(o){return decodeURIComponent(escape(o))}let ri=null,nn=null;function rr(o){return ri||(ri=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,nn=new Map([["","t"]])),o.replaceAll(ri,(t,e,s)=>e?e.normalize("NFKC"):nn.get(s))}function Li(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const o=new Uint8Array(32);return crypto.getRandomValues(o),nr(o)}const Pi="pdfjs_internal_id_";function Vo(o,t,e){if(!Array.isArray(e)||e.length<2)return!1;const[s,i,...n]=e;if(!o(s)&&!Number.isInteger(s)||!t(i))return!1;const r=n.length;let a=!0;switch(i.name){case"XYZ":if(r<2||r>3)return!1;break;case"Fit":case"FitB":return r===0;case"FitH":case"FitBH":case"FitV":case"FitBV":if(r>1)return!1;break;case"FitR":if(r!==4)return!1;a=!1;break;default:return!1}for(const l of n)if(!(typeof l=="number"||a&&l===null))return!1;return!0}function vt(o,t,e){return Math.min(Math.max(o,t),e)}function ar(o){return Uint8Array.prototype.toBase64?o.toBase64():btoa(nr(o))}function Wo(o){return Uint8Array.fromBase64?Uint8Array.fromBase64(o):ls(atob(o))}typeof Promise.try!="function"&&(Promise.try=function(o,...t){return new Promise(e=>{e(o(...t))})});typeof Math.sumPrecise!="function"&&(Math.sumPrecise=function(o){return o.reduce((t,e)=>t+e,0)});class ss{static textContent(t){const e=[],s={items:e,styles:Object.create(null)};function i(n){if(!n)return;let r=null;const a=n.name;if(a==="#text")r=n.value;else if(ss.shouldBuildText(a))n?.attributes?.textContent?r=n.attributes.textContent:n.value&&(r=n.value);else return;if(r!==null&&e.push({str:r}),!!n.children)for(const l of n.children)i(l)}return i(t),s}static shouldBuildText(t){return!(t==="textarea"||t==="input"||t==="option"||t==="select")}}class Mi{static setupStorage(t,e,s,i,n){const r=i.getValue(e,{value:null});switch(s.name){case"textarea":if(r.value!==null&&(t.textContent=r.value),n==="print")break;t.addEventListener("input",a=>{i.setValue(e,{value:a.target.value})});break;case"input":if(s.attributes.type==="radio"||s.attributes.type==="checkbox"){if(r.value===s.attributes.xfaOn?t.setAttribute("checked",!0):r.value===s.attributes.xfaOff&&t.removeAttribute("checked"),n==="print")break;t.addEventListener("change",a=>{i.setValue(e,{value:a.target.checked?a.target.getAttribute("xfaOn"):a.target.getAttribute("xfaOff")})})}else{if(r.value!==null&&t.setAttribute("value",r.value),n==="print")break;t.addEventListener("input",a=>{i.setValue(e,{value:a.target.value})})}break;case"select":if(r.value!==null){t.setAttribute("value",r.value);for(const a of s.children)a.attributes.value===r.value?a.attributes.selected=!0:a.attributes.hasOwnProperty("selected")&&delete a.attributes.selected}t.addEventListener("input",a=>{const l=a.target.options,c=l.selectedIndex===-1?"":l[l.selectedIndex].value;i.setValue(e,{value:c})});break}}static setAttributes({html:t,element:e,storage:s=null,intent:i,linkService:n}){const{attributes:r}=e,a=t instanceof HTMLAnchorElement;r.type==="radio"&&(r.name=`${r.name}-${i}`);for(const[l,c]of Object.entries(r))if(c!=null)switch(l){case"class":c.length&&t.setAttribute(l,c.join(" "));break;case"dataId":break;case"id":t.setAttribute("data-element-id",c);break;case"style":Object.assign(t.style,c);break;case"textContent":t.textContent=c;break;default:(!a||l!=="href"&&l!=="newWindow")&&t.setAttribute(l,c)}a&&n.addLinkAttributes(t,r.href,r.newWindow),s&&r.dataId&&this.setupStorage(t,r.dataId,e,s)}static render(t){const e=t.annotationStorage,s=t.linkService,i=t.xfaHtml,n=t.intent||"display",r=document.createElement(i.name);i.attributes&&this.setAttributes({html:r,element:i,intent:n,linkService:s});const a=n!=="richText",l=t.div;if(l.append(r),t.viewport){const d=`matrix(${t.viewport.transform.join(",")})`;l.style.transform=d}a&&l.setAttribute("class","xfaLayer xfaFont");const c=[];if(i.children.length===0){if(i.value){const d=document.createTextNode(i.value);r.append(d),a&&ss.shouldBuildText(i.name)&&c.push(d)}return{textDivs:c}}const h=[[i,-1,r]];for(;h.length>0;){const[d,u,f]=h.at(-1);if(u+1===d.children.length){h.pop();continue}const m=d.children[++h.at(-1)[1]];if(m===null)continue;const{name:g}=m;if(g==="#text"){const b=document.createTextNode(m.value);c.push(b),f.append(b);continue}const y=m?.attributes?.xmlns?document.createElementNS(m.attributes.xmlns,g):document.createElement(g);if(f.append(y),m.attributes&&this.setAttributes({html:y,element:m,storage:e,intent:n,linkService:s}),m.children?.length>0)h.push([m,-1,y]);else if(m.value){const b=document.createTextNode(m.value);a&&ss.shouldBuildText(g)&&c.push(b),y.append(b)}}for(const d of l.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))d.setAttribute("readOnly",!0);return{textDivs:c}}static update(t){const e=`matrix(${t.viewport.transform.join(",")})`;t.div.style.transform=e,t.div.hidden=!1}}const te="http://www.w3.org/2000/svg";class be{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}async function He(o,t="text"){if(Xe(o,document.baseURI)){const e=await fetch(o);if(!e.ok)throw new Error(e.statusText);switch(t){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"json":return e.json()}return e.text()}return new Promise((e,s)=>{const i=new XMLHttpRequest;i.open("GET",o,!0),i.responseType=t,i.onreadystatechange=()=>{if(i.readyState===XMLHttpRequest.DONE){if(i.status===200||i.status===0){switch(t){case"arraybuffer":case"blob":case"json":e(i.response);return}e(i.responseText);return}s(new Error(i.statusText))}},i.send(null)})}class cs{constructor({viewBox:t,userUnit:e,scale:s,rotation:i,offsetX:n=0,offsetY:r=0,dontFlip:a=!1}){this.viewBox=t,this.userUnit=e,this.scale=s,this.rotation=i,this.offsetX=n,this.offsetY=r,s*=e;const l=(t[2]+t[0])/2,c=(t[3]+t[1])/2;let h,d,u,f;switch(i%=360,i<0&&(i+=360),i){case 180:h=-1,d=0,u=0,f=1;break;case 90:h=0,d=1,u=1,f=0;break;case 270:h=0,d=-1,u=-1,f=0;break;case 0:h=1,d=0,u=0,f=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}a&&(u=-u,f=-f);let m,g,y,b;h===0?(m=Math.abs(c-t[1])*s+n,g=Math.abs(l-t[0])*s+r,y=(t[3]-t[1])*s,b=(t[2]-t[0])*s):(m=Math.abs(l-t[0])*s+n,g=Math.abs(c-t[1])*s+r,y=(t[2]-t[0])*s,b=(t[3]-t[1])*s),this.transform=[h*s,d*s,u*s,f*s,m-h*s*l-u*s*c,g-d*s*l-f*s*c],this.width=y,this.height=b}get rawDims(){const t=this.viewBox;return z(this,"rawDims",{pageWidth:t[2]-t[0],pageHeight:t[3]-t[1],pageX:t[0],pageY:t[1]})}clone({scale:t=this.scale,rotation:e=this.rotation,offsetX:s=this.offsetX,offsetY:i=this.offsetY,dontFlip:n=!1}={}){return new cs({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:t,rotation:e,offsetX:s,offsetY:i,dontFlip:n})}convertToViewportPoint(t,e){const s=[t,e];return D.applyTransform(s,this.transform),s}convertToViewportRectangle(t){const e=[t[0],t[1]];D.applyTransform(e,this.transform);const s=[t[2],t[3]];return D.applyTransform(s,this.transform),[e[0],e[1],s[0],s[1]]}convertToPdfPoint(t,e){const s=[t,e];return D.applyInverseTransform(s,this.transform),s}}class zs extends xe{constructor(t,e=0){super(t,"RenderingCancelledException"),this.extraDelay=e}}function hs(o){const t=o.length;let e=0;for(;e<t&&o[e].trim()==="";)e++;return o.substring(e,e+5).toLowerCase()==="data:"}function Gs(o){return typeof o=="string"&&/\.pdf$/i.test(o)}function or(o){return[o]=o.split(/[#?]/,1),o.substring(o.lastIndexOf("/")+1)}function lr(o,t="document.pdf"){if(typeof o!="string")return t;if(hs(o))return B('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),t;const s=(a=>{try{return new URL(a)}catch{try{return new URL(decodeURIComponent(a))}catch{try{return new URL(a,"https://foo.bar")}catch{try{return new URL(decodeURIComponent(a),"https://foo.bar")}catch{return null}}}}})(o);if(!s)return t;const i=a=>{try{let l=decodeURIComponent(a);return l.includes("/")?(l=l.split("/").at(-1),l.test(/^\.pdf$/i)?l:a):l}catch{return a}},n=/\.pdf$/i,r=s.pathname.split("/").at(-1);if(n.test(r))return i(r);if(s.searchParams.size>0){const a=Array.from(s.searchParams.values()).reverse();for(const c of a)if(n.test(c))return i(c);const l=Array.from(s.searchParams.keys()).reverse();for(const c of l)if(n.test(c))return i(c)}if(s.hash){const l=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i.exec(s.hash);if(l)return i(l[0])}return t}class rn{started=Object.create(null);times=[];time(t){t in this.started&&B(`Timer is already running for ${t}`),this.started[t]=Date.now()}timeEnd(t){t in this.started||B(`Timer has not been started for ${t}`),this.times.push({name:t,start:this.started[t],end:Date.now()}),delete this.started[t]}toString(){const t=[];let e=0;for(const{name:s}of this.times)e=Math.max(s.length,e);for(const{name:s,start:i,end:n}of this.times)t.push(`${s.padEnd(e)} ${n-i}ms
`);return t.join("")}}function Xe(o,t){const e=t?URL.parse(o,t):URL.parse(o);return e?.protocol==="http:"||e?.protocol==="https:"}function Ft(o){o.preventDefault()}function ot(o){o.preventDefault(),o.stopPropagation()}function qo(o){console.log("Deprecated API usage: "+o)}class Fs{static#t;static toDateObject(t){if(t instanceof Date)return t;if(!t||typeof t!="string")return null;this.#t||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");const e=this.#t.exec(t);if(!e)return null;const s=parseInt(e[1],10);let i=parseInt(e[2],10);i=i>=1&&i<=12?i-1:0;let n=parseInt(e[3],10);n=n>=1&&n<=31?n:1;let r=parseInt(e[4],10);r=r>=0&&r<=23?r:0;let a=parseInt(e[5],10);a=a>=0&&a<=59?a:0;let l=parseInt(e[6],10);l=l>=0&&l<=59?l:0;const c=e[7]||"Z";let h=parseInt(e[8],10);h=h>=0&&h<=23?h:0;let d=parseInt(e[9],10)||0;return d=d>=0&&d<=59?d:0,c==="-"?(r+=h,a+=d):c==="+"&&(r-=h,a-=d),new Date(Date.UTC(s,i,n,r,a,l))}}function cr(o,{scale:t=1,rotation:e=0}){const{width:s,height:i}=o.attributes.style,n=[0,0,parseInt(s),parseInt(i)];return new cs({viewBox:n,userUnit:1,scale:t,rotation:e})}function Ue(o){if(o.startsWith("#")){const t=parseInt(o.slice(1),16);return[(t&16711680)>>16,(t&65280)>>8,t&255]}return o.startsWith("rgb(")?o.slice(4,-1).split(",").map(t=>parseInt(t)):o.startsWith("rgba(")?o.slice(5,-1).split(",").map(t=>parseInt(t)).slice(0,3):(B(`Not a valid color format: "${o}"`),[0,0,0])}function Xo(o){const t=document.createElement("span");t.style.visibility="hidden",t.style.colorScheme="only light",document.body.append(t);for(const e of o.keys()){t.style.color=e;const s=window.getComputedStyle(t).color;o.set(e,Ue(s))}t.remove()}function at(o){const{a:t,b:e,c:s,d:i,e:n,f:r}=o.getTransform();return[t,e,s,i,n,r]}function Wt(o){const{a:t,b:e,c:s,d:i,e:n,f:r}=o.getTransform().invertSelf();return[t,e,s,i,n,r]}function ce(o,t,e=!1,s=!0){if(t instanceof cs){const{pageWidth:i,pageHeight:n}=t.rawDims,{style:r}=o,a=bt.isCSSRoundSupported,l=`var(--total-scale-factor) * ${i}px`,c=`var(--total-scale-factor) * ${n}px`,h=a?`round(down, ${l}, var(--scale-round-x))`:`calc(${l})`,d=a?`round(down, ${c}, var(--scale-round-y))`:`calc(${c})`;!e||t.rotation%180===0?(r.width=h,r.height=d):(r.width=d,r.height=h)}s&&o.setAttribute("data-main-rotation",t.rotation)}class zt{constructor(){const{pixelRatio:t}=zt;this.sx=t,this.sy=t}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}limitCanvas(t,e,s,i,n=-1){let r=1/0,a=1/0,l=1/0;s=zt.capPixels(s,n),s>0&&(r=Math.sqrt(s/(t*e))),i!==-1&&(a=i/t,l=i/e);const c=Math.min(r,a,l);return this.sx>c||this.sy>c?(this.sx=c,this.sy=c,!0):!1}static get pixelRatio(){return globalThis.devicePixelRatio||1}static capPixels(t,e){if(e>=0){const s=Math.ceil(window.screen.availWidth*window.screen.availHeight*this.pixelRatio**2*(1+e/100));return t>0?Math.min(t,s):s}return t}}const Os=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];class Yo{static get isDarkMode(){return z(this,"isDarkMode",!!window?.matchMedia?.("(prefers-color-scheme: dark)").matches)}}class hr{static get commentForegroundColor(){const t=document.createElement("span");t.classList.add("comment","sidebar");const{style:e}=t;e.width=e.height="0",e.display="none",e.color="var(--comment-fg-color)",document.body.append(t);const{color:s}=window.getComputedStyle(t);return t.remove(),z(this,"commentForegroundColor",Ue(s))}}function dr(o,t,e,s){s=Math.min(Math.max(s??1,0),1);const i=255*(1-s);return o=Math.round(o*s+i),t=Math.round(t*s+i),e=Math.round(e*s+i),[o,t,e]}function an(o,t){const e=o[0]/255,s=o[1]/255,i=o[2]/255,n=Math.max(e,s,i),r=Math.min(e,s,i),a=(n+r)/2;if(n===r)t[0]=t[1]=0;else{const l=n-r;switch(t[1]=a<.5?l/(n+r):l/(2-n-r),n){case e:t[0]=((s-i)/l+(s<i?6:0))*60;break;case s:t[0]=((i-e)/l+2)*60;break;case i:t[0]=((e-s)/l+4)*60;break}}t[2]=a}function fi(o,t){const e=o[0],s=o[1],i=o[2],n=(1-Math.abs(2*i-1))*s,r=n*(1-Math.abs(e/60%2-1)),a=i-n/2;switch(Math.floor(e/60)){case 0:t[0]=n+a,t[1]=r+a,t[2]=a;break;case 1:t[0]=r+a,t[1]=n+a,t[2]=a;break;case 2:t[0]=a,t[1]=n+a,t[2]=r+a;break;case 3:t[0]=a,t[1]=r+a,t[2]=n+a;break;case 4:t[0]=r+a,t[1]=a,t[2]=n+a;break;case 5:case 6:t[0]=n+a,t[1]=a,t[2]=r+a;break}}function on(o){return o<=.03928?o/12.92:((o+.055)/1.055)**2.4}function ln(o,t,e){fi(o,e),e.map(on);const s=.2126*e[0]+.7152*e[1]+.0722*e[2];fi(t,e),e.map(on);const i=.2126*e[0]+.7152*e[1]+.0722*e[2];return s>i?(s+.05)/(i+.05):(i+.05)/(s+.05)}const cn=new Map;function ur(o,t){const e=o[0]+o[1]*256+o[2]*65536+t[0]*16777216+t[1]*4294967296+t[2]*1099511627776;let s=cn.get(e);if(s)return s;const i=new Float32Array(9),n=i.subarray(0,3),r=i.subarray(3,6);an(o,r);const a=i.subarray(6,9);an(t,a);const l=a[2]<.5,c=l?12:4.5;if(r[2]=l?Math.sqrt(r[2]):1-Math.sqrt(1-r[2]),ln(r,a,n)<c){let h,d;l?(h=r[2],d=1):(h=0,d=r[2]);const u=.005;for(;d-h>u;){const f=r[2]=(h+d)/2;l===ln(r,a,n)<c?h=f:d=f}r[2]=l?d:h}return fi(r,n),s=D.makeHexColor(Math.round(n[0]*255),Math.round(n[1]*255),Math.round(n[2]*255)),cn.set(e,s),s}function Ri({html:o,dir:t,className:e},s){const i=document.createDocumentFragment();if(typeof o=="string"){const n=document.createElement("p");n.dir=t||"auto";const r=o.split(/(?:\r\n?|\n)/);for(let a=0,l=r.length;a<l;++a){const c=r[a];n.append(document.createTextNode(c)),a<l-1&&n.append(document.createElement("br"))}i.append(n)}else Mi.render({xfaHtml:o,div:i,intent:"richText"});i.firstChild.classList.add("richText",e),s.append(i)}class Ze{#t=null;#e=null;#i;#s=null;#a=null;#n=null;#r=null;#o=null;static#c=null;constructor(t){this.#i=t,Ze.#c||=Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"})}render(){const t=this.#t=document.createElement("div");t.classList.add("editToolbar","hidden"),t.setAttribute("role","toolbar");const e=this.#i._uiManager._signal;e instanceof AbortSignal&&!e.aborted&&(t.addEventListener("contextmenu",Ft,{signal:e}),t.addEventListener("pointerdown",Ze.#l,{signal:e}));const s=this.#s=document.createElement("div");s.className="buttons",t.append(s);const i=this.#i.toolbarPosition;if(i){const{style:n}=t,r=this.#i._uiManager.direction==="ltr"?1-i[0]:i[0];n.insetInlineEnd=`${100*r}%`,n.top=`calc(${100*i[1]}% + var(--editor-toolbar-vert-offset))`}return t}get div(){return this.#t}static#l(t){t.stopPropagation()}#u(t){this.#i._focusEventsAllowed=!1,ot(t)}#d(t){this.#i._focusEventsAllowed=!0,ot(t)}#p(t){const e=this.#i._uiManager._signal;return!(e instanceof AbortSignal)||e.aborted?!1:(t.addEventListener("focusin",this.#u.bind(this),{capture:!0,signal:e}),t.addEventListener("focusout",this.#d.bind(this),{capture:!0,signal:e}),t.addEventListener("contextmenu",Ft,{signal:e}),!0)}hide(){this.#t.classList.add("hidden"),this.#e?.hideDropdown()}show(){this.#t.classList.remove("hidden"),this.#a?.shown(),this.#n?.shown()}addDeleteButton(){const{editorType:t,_uiManager:e}=this.#i,s=document.createElement("button");s.classList.add("basic","deleteButton"),s.tabIndex=0,s.setAttribute("data-l10n-id",Ze.#c[t]),this.#p(s)&&s.addEventListener("click",i=>{e.delete()},{signal:e._signal}),this.#s.append(s)}get#m(){const t=document.createElement("div");return t.className="divider",t}async addAltText(t){const e=await t.render();this.#p(e),this.#s.append(e,this.#m),this.#a=t}addComment(t,e=null){if(this.#n)return;const s=t.renderForToolbar();if(!s)return;this.#p(s);const i=this.#r=this.#m;e?(this.#s.insertBefore(s,e),this.#s.insertBefore(i,e)):this.#s.append(s,i),this.#n=t,t.toolbar=this}addColorPicker(t){if(this.#e)return;this.#e=t;const e=t.renderButton();this.#p(e),this.#s.append(e,this.#m)}async addEditSignatureButton(t){const e=this.#o=await t.renderEditButton(this.#i);this.#p(e),this.#s.append(e,this.#m)}removeButton(t){switch(t){case"comment":this.#n?.removeToolbarCommentButton(),this.#n=null,this.#r?.remove(),this.#r=null;break}}async addButton(t,e){switch(t){case"colorPicker":this.addColorPicker(e);break;case"altText":await this.addAltText(e);break;case"editSignature":await this.addEditSignatureButton(e);break;case"delete":this.addDeleteButton();break;case"comment":this.addComment(e);break}}async addButtonBefore(t,e,s){const i=this.#s.querySelector(s);i&&t==="comment"&&this.addComment(e,i)}updateEditSignatureButton(t){this.#o&&(this.#o.title=t)}remove(){this.#t.remove(),this.#e?.destroy(),this.#e=null}}class Ko{#t=null;#e=null;#i;constructor(t){this.#i=t}#s(){const t=this.#e=document.createElement("div");t.className="editToolbar",t.setAttribute("role","toolbar");const e=this.#i._signal;e instanceof AbortSignal&&!e.aborted&&t.addEventListener("contextmenu",Ft,{signal:e});const s=this.#t=document.createElement("div");return s.className="buttons",t.append(s),this.#i.hasCommentManager()&&this.#n("commentButton","pdfjs-comment-floating-button","pdfjs-comment-floating-button-label",()=>{this.#i.commentSelection("floating_button")}),this.#n("highlightButton","pdfjs-highlight-floating-button1","pdfjs-highlight-floating-button-label",()=>{this.#i.highlightSelection("floating_button")}),t}#a(t,e){let s=0,i=0;for(const n of t){const r=n.y+n.height;if(r<s)continue;const a=n.x+(e?n.width:0);if(r>s){i=a,s=r;continue}e?a>i&&(i=a):a<i&&(i=a)}return[e?1-i:i,s]}show(t,e,s){const[i,n]=this.#a(e,s),{style:r}=this.#e||=this.#s();t.append(this.#e),r.insetInlineEnd=`${100*i}%`,r.top=`calc(${100*n}% + var(--editor-toolbar-vert-offset))`}hide(){this.#e.remove()}#n(t,e,s,i){const n=document.createElement("button");n.classList.add("basic",t),n.tabIndex=0,n.setAttribute("data-l10n-id",e);const r=document.createElement("span");n.append(r),r.className="visuallyHidden",r.setAttribute("data-l10n-id",s);const a=this.#i._signal;a instanceof AbortSignal&&!a.aborted&&(n.addEventListener("contextmenu",Ft,{signal:a}),n.addEventListener("click",i,{signal:a})),this.#t.append(n)}}function pr(o,t,e){for(const s of e)t.addEventListener(s,o[s].bind(o))}class Qo{#t=0;get id(){return`${ts}${this.#t++}`}}class Ni{#t=Li();#e=0;#i=null;static get _isSVGFittingCanvas(){const t='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',s=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),i=new Image;i.src=t;const n=i.decode().then(()=>(s.drawImage(i,0,0,1,1,0,0,1,3),new Uint32Array(s.getImageData(0,0,1,1).data.buffer)[0]===0));return z(this,"_isSVGFittingCanvas",n)}async#s(t,e){this.#i||=new Map;let s=this.#i.get(t);if(s===null)return null;if(s?.bitmap)return s.refCounter+=1,s;try{s||={bitmap:null,id:`image_${this.#t}_${this.#e++}`,refCounter:0,isSvg:!1};let i;if(typeof e=="string"?(s.url=e,i=await He(e,"blob")):e instanceof File?i=s.file=e:e instanceof Blob&&(i=e),i.type==="image/svg+xml"){const n=Ni._isSVGFittingCanvas,r=new FileReader,a=new Image,l=new Promise((c,h)=>{a.onload=()=>{s.bitmap=a,s.isSvg=!0,c()},r.onload=async()=>{const d=s.svgUrl=r.result;a.src=await n?`${d}#svgView(preserveAspectRatio(none))`:d},a.onerror=r.onerror=h});r.readAsDataURL(i),await l}else s.bitmap=await createImageBitmap(i);s.refCounter=1}catch(i){B(i),s=null}return this.#i.set(t,s),s&&this.#i.set(s.id,s),s}async getFromFile(t){const{lastModified:e,name:s,size:i,type:n}=t;return this.#s(`${e}_${s}_${i}_${n}`,t)}async getFromUrl(t){return this.#s(t,t)}async getFromBlob(t,e){const s=await e;return this.#s(t,s)}async getFromId(t){this.#i||=new Map;const e=this.#i.get(t);if(!e)return null;if(e.bitmap)return e.refCounter+=1,e;if(e.file)return this.getFromFile(e.file);if(e.blobPromise){const{blobPromise:s}=e;return delete e.blobPromise,this.getFromBlob(e.id,s)}return this.getFromUrl(e.url)}getFromCanvas(t,e){this.#i||=new Map;let s=this.#i.get(t);if(s?.bitmap)return s.refCounter+=1,s;const i=new OffscreenCanvas(e.width,e.height);return i.getContext("2d").drawImage(e,0,0),s={bitmap:i.transferToImageBitmap(),id:`image_${this.#t}_${this.#e++}`,refCounter:1,isSvg:!1},this.#i.set(t,s),this.#i.set(s.id,s),s}getSvgUrl(t){const e=this.#i.get(t);return e?.isSvg?e.svgUrl:null}deleteId(t){this.#i||=new Map;const e=this.#i.get(t);if(!e||(e.refCounter-=1,e.refCounter!==0))return;const{bitmap:s}=e;if(!e.url&&!e.file){const i=new OffscreenCanvas(s.width,s.height);i.getContext("bitmaprenderer").transferFromImageBitmap(s),e.blobPromise=i.convertToBlob()}s.close?.(),e.bitmap=null}isValidId(t){return t.startsWith(`image_${this.#t}_`)}}class Jo{#t=[];#e=!1;#i;#s=-1;constructor(t=128){this.#i=t}add({cmd:t,undo:e,post:s,mustExec:i,type:n=NaN,overwriteIfSameType:r=!1,keepUndo:a=!1}){if(i&&t(),this.#e)return;const l={cmd:t,undo:e,post:s,type:n};if(this.#s===-1){this.#t.length>0&&(this.#t.length=0),this.#s=0,this.#t.push(l);return}if(r&&this.#t[this.#s].type===n){a&&(l.undo=this.#t[this.#s].undo),this.#t[this.#s]=l;return}const c=this.#s+1;c===this.#i?this.#t.splice(0,1):(this.#s=c,c<this.#t.length&&this.#t.splice(c)),this.#t.push(l)}undo(){if(this.#s===-1)return;this.#e=!0;const{undo:t,post:e}=this.#t[this.#s];t(),e?.(),this.#e=!1,this.#s-=1}redo(){if(this.#s<this.#t.length-1){this.#s+=1,this.#e=!0;const{cmd:t,post:e}=this.#t[this.#s];t(),e?.(),this.#e=!1}}hasSomethingToUndo(){return this.#s!==-1}hasSomethingToRedo(){return this.#s<this.#t.length-1}cleanType(t){if(this.#s!==-1){for(let e=this.#s;e>=0;e--)if(this.#t[e].type!==t){this.#t.splice(e+1,this.#s-e),this.#s=e;return}this.#t.length=0,this.#s=-1}}destroy(){this.#t=null}}class ds{constructor(t){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:e}=bt.platform;for(const[s,i,n={}]of t)for(const r of s){const a=r.startsWith("mac+");e&&a?(this.callbacks.set(r.slice(4),{callback:i,options:n}),this.allKeys.add(r.split("+").at(-1))):!e&&!a&&(this.callbacks.set(r,{callback:i,options:n}),this.allKeys.add(r.split("+").at(-1)))}}#t(t){t.altKey&&this.buffer.push("alt"),t.ctrlKey&&this.buffer.push("ctrl"),t.metaKey&&this.buffer.push("meta"),t.shiftKey&&this.buffer.push("shift"),this.buffer.push(t.key);const e=this.buffer.join("+");return this.buffer.length=0,e}exec(t,e){if(!this.allKeys.has(e.key))return;const s=this.callbacks.get(this.#t(e));if(!s)return;const{callback:i,options:{bubbles:n=!1,args:r=[],checker:a=null}}=s;a&&!a(t,e)||(i.bind(t,...r,e)(),n||ot(e))}}class Di{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){const t=new Map([["CanvasText",null],["Canvas",null]]);return Xo(t),z(this,"_colors",t)}convert(t){const e=Ue(t);if(!window.matchMedia("(forced-colors: active)").matches)return e;for(const[s,i]of this._colors)if(i.every((n,r)=>n===e[r]))return Di._colorsMapping.get(s);return e}getHexCode(t){const e=this._colors.get(t);return e?D.makeHexColor(...e):t}}class ne{#t=new AbortController;#e=null;#i=null;#s=new Map;#a=new Map;#n=null;#r=null;#o=null;#c=new Jo;#l=null;#u=null;#d=null;#p=0;#m=new Set;#f=null;#h=null;#g=new Set;_editorUndoBar=null;#b=!1;#w=!1;#y=!1;#_=null;#k=null;#x=null;#C=null;#A=!1;#S=null;#P=new Qo;#T=!1;#L=!1;#O=!1;#R=null;#D=null;#j=null;#I=null;#$=null;#E=j.NONE;#v=new Set;#N=null;#B=null;#U=null;#q=null;#W=null;#X={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1};#z=[0,0];#F=null;#V=null;#J=null;#Z=null;#H=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){const t=ne.prototype,e=r=>r.#V.contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&r.hasSomethingToControl(),s=(r,{target:a})=>{if(a instanceof HTMLInputElement){const{type:l}=a;return l!=="text"&&l!=="number"}return!0},i=this.TRANSLATE_SMALL,n=this.TRANSLATE_BIG;return z(this,"_keyboardManager",new ds([[["ctrl+a","mac+meta+a"],t.selectAll,{checker:s}],[["ctrl+z","mac+meta+z"],t.undo,{checker:s}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],t.redo,{checker:s}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],t.delete,{checker:s}],[["Enter","mac+Enter"],t.addNewEditorFromKeyboard,{checker:(r,{target:a})=>!(a instanceof HTMLButtonElement)&&r.#V.contains(a)&&!r.isEnterHandled}],[[" ","mac+ "],t.addNewEditorFromKeyboard,{checker:(r,{target:a})=>!(a instanceof HTMLButtonElement)&&r.#V.contains(document.activeElement)}],[["Escape","mac+Escape"],t.unselectAll],[["ArrowLeft","mac+ArrowLeft"],t.translateSelectedEditors,{args:[-i,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t.translateSelectedEditors,{args:[-n,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t.translateSelectedEditors,{args:[i,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t.translateSelectedEditors,{args:[n,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t.translateSelectedEditors,{args:[0,-i],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t.translateSelectedEditors,{args:[0,-n],checker:e}],[["ArrowDown","mac+ArrowDown"],t.translateSelectedEditors,{args:[0,i],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t.translateSelectedEditors,{args:[0,n],checker:e}]]))}constructor(t,e,s,i,n,r,a,l,c,h,d,u,f,m,g,y){const b=this._signal=this.#t.signal;this.#V=t,this.#J=e,this.#Z=s,this.#n=i,this.#l=n,this.#B=r,this.#W=l,this._eventBus=a,a._on("editingaction",this.onEditingAction.bind(this),{signal:b}),a._on("pagechanging",this.onPageChanging.bind(this),{signal:b}),a._on("scalechanging",this.onScaleChanging.bind(this),{signal:b}),a._on("rotationchanging",this.onRotationChanging.bind(this),{signal:b}),a._on("setpreference",this.onSetPreference.bind(this),{signal:b}),a._on("switchannotationeditorparams",x=>this.updateParams(x.type,x.value),{signal:b}),window.addEventListener("pointerdown",()=>{this.#L=!0},{capture:!0,signal:b}),window.addEventListener("pointerup",()=>{this.#L=!1},{capture:!0,signal:b}),this.#lt(),this.#ut(),this.#et(),this.#r=l.annotationStorage,this.#_=l.filterFactory,this.#U=c,this.#C=h||null,this.#b=d,this.#w=u,this.#y=f,this.#$=m||null,this.viewParameters={realScale:be.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=g||null,this._supportsPinchToZoom=y!==!1,n?.setSidebarUiManager(this)}destroy(){this.#H?.resolve(),this.#H=null,this.#t?.abort(),this.#t=null,this._signal=null;for(const t of this.#a.values())t.destroy();this.#a.clear(),this.#s.clear(),this.#g.clear(),this.#I?.clear(),this.#e=null,this.#v.clear(),this.#c.destroy(),this.#n?.destroy(),this.#l?.destroy(),this.#B?.destroy(),this.#S?.hide(),this.#S=null,this.#j?.destroy(),this.#j=null,this.#i=null,this.#k&&(clearTimeout(this.#k),this.#k=null),this.#F&&(clearTimeout(this.#F),this.#F=null),this._editorUndoBar?.destroy(),this.#W=null}combinedSignal(t){return AbortSignal.any([this._signal,t.signal])}get mlManager(){return this.#$}get useNewAltTextFlow(){return this.#w}get useNewAltTextWhenAddingImage(){return this.#y}get hcmFilter(){return z(this,"hcmFilter",this.#U?this.#_.addHCMFilter(this.#U.foreground,this.#U.background):"none")}get direction(){return z(this,"direction",getComputedStyle(this.#V).direction)}get _highlightColors(){return z(this,"_highlightColors",this.#C?new Map(this.#C.split(",").map(t=>(t=t.split("=").map(e=>e.trim()),t[1]=t[1].toUpperCase(),t))):null)}get highlightColors(){const{_highlightColors:t}=this;if(!t)return z(this,"highlightColors",null);const e=new Map,s=!!this.#U;for(const[i,n]of t){const r=i.endsWith("_HCM");if(s&&r){e.set(i.replace("_HCM",""),n);continue}!s&&!r&&e.set(i,n)}return z(this,"highlightColors",e)}get highlightColorNames(){return z(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,t=>t.reverse())):null)}getNonHCMColor(t){if(!this._highlightColors)return t;const e=this.highlightColorNames.get(t);return this._highlightColors.get(e)||t}getNonHCMColorName(t){return this.highlightColorNames.get(t)||t}setCurrentDrawingSession(t){t?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),this.#d=t}setMainHighlightColorPicker(t){this.#j=t}editAltText(t,e=!1){this.#n?.editAltText(this,t,e)}hasCommentManager(){return!!this.#l}editComment(t,e,s,i){this.#l?.showDialog(this,t,e,s,i)}selectComment(t,e){this.#a.get(t)?.getEditorByUID(e)?.toggleComment(!0,!0)}updateComment(t){this.#l?.updateComment(t.getData())}updatePopupColor(t){this.#l?.updatePopupColor(t)}removeComment(t){this.#l?.removeComments([t.uid])}toggleComment(t,e,s=void 0){this.#l?.toggleCommentPopup(t,e,s)}makeCommentColor(t,e){return t&&this.#l?.makeCommentColor(t,e)||null}getCommentDialogElement(){return this.#l?.dialogElement||null}async waitForEditorsRendered(t){if(this.#a.has(t-1))return;const{resolve:e,promise:s}=Promise.withResolvers(),i=n=>{n.pageNumber===t&&(this._eventBus._off("editorsrendered",i),e())};this._eventBus.on("editorsrendered",i),await s}getSignature(t){this.#B?.getSignature({uiManager:this,editor:t})}get signatureManager(){return this.#B}switchToMode(t,e){this._eventBus.on("annotationeditormodechanged",e,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:t})}setPreference(t,e){this._eventBus.dispatch("setpreference",{source:this,name:t,value:e})}onSetPreference({name:t,value:e}){switch(t){case"enableNewAltTextWhenAddingImage":this.#y=e;break}}onPageChanging({pageNumber:t}){this.#p=t-1}focusMainContainer(){this.#V.focus()}findParent(t,e){for(const s of this.#a.values()){const{x:i,y:n,width:r,height:a}=s.div.getBoundingClientRect();if(t>=i&&t<=i+r&&e>=n&&e<=n+a)return s}return null}disableUserSelect(t=!1){this.#J.classList.toggle("noUserSelect",t)}addShouldRescale(t){this.#g.add(t)}removeShouldRescale(t){this.#g.delete(t)}onScaleChanging({scale:t}){this.commitOrRemove(),this.viewParameters.realScale=t*be.PDF_TO_CSS_UNITS;for(const e of this.#g)e.onScaleChanging();this.#d?.onScaleChanging()}onRotationChanging({pagesRotation:t}){this.commitOrRemove(),this.viewParameters.rotation=t}#Q({anchorNode:t}){return t.nodeType===Node.TEXT_NODE?t.parentElement:t}#tt(t){const{currentLayer:e}=this;if(e.hasTextLayer(t))return e;for(const s of this.#a.values())if(s.hasTextLayer(t))return s;return null}highlightSelection(t="",e=!1){const s=document.getSelection();if(!s||s.isCollapsed)return;const{anchorNode:i,anchorOffset:n,focusNode:r,focusOffset:a}=s,l=s.toString(),h=this.#Q(s).closest(".textLayer"),d=this.getSelectionBoxes(h);if(!d)return;s.empty();const u=this.#tt(h),f=this.#E===j.NONE,m=()=>{const g=u?.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:t,boxes:d,anchorNode:i,anchorOffset:n,focusNode:r,focusOffset:a,text:l});f&&this.showAllEditors("highlight",!0,!0),e&&g?.editComment()};if(f){this.switchToMode(j.HIGHLIGHT,m);return}m()}commentSelection(t=""){this.highlightSelection(t,!0)}#at(){const t=document.getSelection();if(!t||t.isCollapsed)return;const s=this.#Q(t).closest(".textLayer"),i=this.getSelectionBoxes(s);i&&(this.#S||=new Ko(this),this.#S.show(s,i,this.direction==="ltr"))}getAndRemoveDataFromAnnotationStorage(t){if(!this.#r)return null;const e=`${ts}${t}`,s=this.#r.getRawValue(e);return s&&this.#r.remove(e),s}addToAnnotationStorage(t){!t.isEmpty()&&this.#r&&!this.#r.has(t.id)&&this.#r.setValue(t.id,t)}a11yAlert(t,e=null){const s=this.#Z;s&&(s.setAttribute("data-l10n-id",t),e?s.setAttribute("data-l10n-args",JSON.stringify(e)):s.removeAttribute("data-l10n-args"))}#ot(){const t=document.getSelection();if(!t||t.isCollapsed){this.#N&&(this.#S?.hide(),this.#N=null,this.#M({hasSelectedText:!1}));return}const{anchorNode:e}=t;if(e===this.#N)return;const i=this.#Q(t).closest(".textLayer");if(!i){this.#N&&(this.#S?.hide(),this.#N=null,this.#M({hasSelectedText:!1}));return}if(this.#S?.hide(),this.#N=e,this.#M({hasSelectedText:!0}),!(this.#E!==j.HIGHLIGHT&&this.#E!==j.NONE)&&(this.#E===j.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),this.#A=this.isShiftKeyDown,!this.isShiftKeyDown)){const n=this.#E===j.HIGHLIGHT?this.#tt(i):null;if(n?.toggleDrawing(),this.#L){const r=new AbortController,a=this.combinedSignal(r),l=c=>{c.type==="pointerup"&&c.button!==0||(r.abort(),n?.toggleDrawing(!0),c.type==="pointerup"&&this.#Y("main_toolbar"))};window.addEventListener("pointerup",l,{signal:a}),window.addEventListener("blur",l,{signal:a})}else n?.toggleDrawing(!0),this.#Y("main_toolbar")}}#Y(t=""){this.#E===j.HIGHLIGHT?this.highlightSelection(t):this.#b&&this.#at()}#lt(){document.addEventListener("selectionchange",this.#ot.bind(this),{signal:this._signal})}#ct(){if(this.#x)return;this.#x=new AbortController;const t=this.combinedSignal(this.#x);window.addEventListener("focus",this.focus.bind(this),{signal:t}),window.addEventListener("blur",this.blur.bind(this),{signal:t})}#ht(){this.#x?.abort(),this.#x=null}blur(){if(this.isShiftKeyDown=!1,this.#A&&(this.#A=!1,this.#Y("main_toolbar")),!this.hasSelection)return;const{activeElement:t}=document;for(const e of this.#v)if(e.div.contains(t)){this.#D=[e,t],e._focusEventsAllowed=!1;break}}focus(){if(!this.#D)return;const[t,e]=this.#D;this.#D=null,e.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this._signal}),e.focus()}#et(){if(this.#R)return;this.#R=new AbortController;const t=this.combinedSignal(this.#R);window.addEventListener("keydown",this.keydown.bind(this),{signal:t}),window.addEventListener("keyup",this.keyup.bind(this),{signal:t})}#dt(){this.#R?.abort(),this.#R=null}#st(){if(this.#u)return;this.#u=new AbortController;const t=this.combinedSignal(this.#u);document.addEventListener("copy",this.copy.bind(this),{signal:t}),document.addEventListener("cut",this.cut.bind(this),{signal:t}),document.addEventListener("paste",this.paste.bind(this),{signal:t})}#it(){this.#u?.abort(),this.#u=null}#ut(){const t=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:t}),document.addEventListener("drop",this.drop.bind(this),{signal:t})}addEditListeners(){this.#et(),this.#st()}removeEditListeners(){this.#dt(),this.#it()}dragOver(t){for(const{type:e}of t.dataTransfer.items)for(const s of this.#h)if(s.isHandlingMimeForPasting(e)){t.dataTransfer.dropEffect="copy",t.preventDefault();return}}drop(t){for(const e of t.dataTransfer.items)for(const s of this.#h)if(s.isHandlingMimeForPasting(e.type)){s.paste(e,this.currentLayer),t.preventDefault();return}}copy(t){if(t.preventDefault(),this.#e?.commitOrRemove(),!this.hasSelection)return;const e=[];for(const s of this.#v){const i=s.serialize(!0);i&&e.push(i)}e.length!==0&&t.clipboardData.setData("application/pdfjs",JSON.stringify(e))}cut(t){this.copy(t),this.delete()}async paste(t){t.preventDefault();const{clipboardData:e}=t;for(const n of e.items)for(const r of this.#h)if(r.isHandlingMimeForPasting(n.type)){r.paste(n,this.currentLayer);return}let s=e.getData("application/pdfjs");if(!s)return;try{s=JSON.parse(s)}catch(n){B(`paste: "${n.message}".`);return}if(!Array.isArray(s))return;this.unselectAll();const i=this.currentLayer;try{const n=[];for(const l of s){const c=await i.deserialize(l);if(!c)return;n.push(c)}const r=()=>{for(const l of n)this.#nt(l);this.#rt(n)},a=()=>{for(const l of n)l.remove()};this.addCommands({cmd:r,undo:a,mustExec:!0})}catch(n){B(`paste: "${n.message}".`)}}keydown(t){!this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!0),this.#E!==j.NONE&&!this.isEditorHandlingKeyboard&&ne._keyboardManager.exec(this,t)}keyup(t){this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!1,this.#A&&(this.#A=!1,this.#Y("main_toolbar")))}onEditingAction({name:t}){switch(t){case"undo":case"redo":case"delete":case"selectAll":this[t]();break;case"highlightSelection":this.highlightSelection("context_menu");break;case"commentSelection":this.commentSelection("context_menu");break}}#M(t){Object.entries(t).some(([s,i])=>this.#X[s]!==i)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#X,t)}),this.#E===j.HIGHLIGHT&&t.hasSelectedEditor===!1&&this.#G([[V.HIGHLIGHT_FREE,!0]]))}#G(t){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:t})}setEditingState(t){t?(this.#ct(),this.#st(),this.#M({isEditing:this.#E!==j.NONE,isEmpty:this.#K(),hasSomethingToUndo:this.#c.hasSomethingToUndo(),hasSomethingToRedo:this.#c.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#ht(),this.#it(),this.#M({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(t){if(!this.#h){this.#h=t;for(const e of this.#h)this.#G(e.defaultPropertiesToUpdate)}}getId(){return this.#P.id}get currentLayer(){return this.#a.get(this.#p)}getLayer(t){return this.#a.get(t)}get currentPageIndex(){return this.#p}addLayer(t){this.#a.set(t.pageIndex,t),this.#T?t.enable():t.disable()}removeLayer(t){this.#a.delete(t.pageIndex)}async updateMode(t,e=null,s=!1,i=!1,n=!1){if(this.#E!==t&&!(this.#H&&(await this.#H.promise,!this.#H))){if(this.#H=Promise.withResolvers(),this.#d?.commitOrRemove(),this.#E===j.POPUP&&this.#l?.hideSidebar(),this.#l?.destroyPopup(),this.#E=t,t===j.NONE){this.setEditingState(!1),this.#ft();for(const r of this.#s.values())r.hideStandaloneCommentButton();this._editorUndoBar?.hide(),this.toggleComment(null),this.#H.resolve();return}for(const r of this.#s.values())r.addStandaloneCommentButton();t===j.SIGNATURE&&await this.#B?.loadSignatures(),this.setEditingState(!0),await this.#pt(),this.unselectAll();for(const r of this.#a.values())r.updateMode(t);if(t===j.POPUP){this.#i||=await this.#W.getAnnotationsByType(new Set(this.#h.map(l=>l._editorType)));const r=new Set,a=[];for(const l of this.#s.values()){const{annotationElementId:c,hasComment:h,deleted:d}=l;c&&r.add(c),h&&!d&&a.push(l.getData())}for(const l of this.#i){const{id:c,popupRef:h,contentsObj:d}=l;h&&d?.str&&!r.has(c)&&!this.#m.has(c)&&a.push(l)}this.#l?.showSidebar(a)}if(!e){s&&this.addNewEditorFromKeyboard(),this.#H.resolve();return}for(const r of this.#s.values())r.uid===e?(this.setSelected(r),n?r.editComment():i?r.enterInEditMode():r.focus()):r.unselect();this.#H.resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(t){t.mode!==this.#E&&this._eventBus.dispatch("switchannotationeditormode",{source:this,...t})}updateParams(t,e){if(this.#h){switch(t){case V.CREATE:this.currentLayer.addNewEditor(e);return;case V.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(this.#q||=new Map).set(t,e),this.showAllEditors("highlight",e);break}if(this.hasSelection)for(const s of this.#v)s.updateParams(t,e);else for(const s of this.#h)s.updateDefaultParams(t,e)}}showAllEditors(t,e,s=!1){for(const n of this.#s.values())n.editorType===t&&n.show(e);(this.#q?.get(V.HIGHLIGHT_SHOW_ALL)??!0)!==e&&this.#G([[V.HIGHLIGHT_SHOW_ALL,e]])}enableWaiting(t=!1){if(this.#O!==t){this.#O=t;for(const e of this.#a.values())t?e.disableClick():e.enableClick(),e.div.classList.toggle("waiting",t)}}async#pt(){if(!this.#T){this.#T=!0;const t=[];for(const e of this.#a.values())t.push(e.enable());await Promise.all(t);for(const e of this.#s.values())e.enable()}}#ft(){if(this.unselectAll(),this.#T){this.#T=!1;for(const t of this.#a.values())t.disable();for(const t of this.#s.values())t.disable()}}*getEditors(t){for(const e of this.#s.values())e.pageIndex===t&&(yield e)}getEditor(t){return this.#s.get(t)}addEditor(t){this.#s.set(t.id,t)}removeEditor(t){t.div.contains(document.activeElement)&&(this.#k&&clearTimeout(this.#k),this.#k=setTimeout(()=>{this.focusMainContainer(),this.#k=null},0)),this.#s.delete(t.id),t.annotationElementId&&this.#I?.delete(t.annotationElementId),this.unselect(t),(!t.annotationElementId||!this.#m.has(t.annotationElementId))&&this.#r?.remove(t.id)}addDeletedAnnotationElement(t){this.#m.add(t.annotationElementId),this.addChangedExistingAnnotation(t),t.deleted=!0}isDeletedAnnotationElement(t){return this.#m.has(t)}removeDeletedAnnotationElement(t){this.#m.delete(t.annotationElementId),this.removeChangedExistingAnnotation(t),t.deleted=!1}#nt(t){const e=this.#a.get(t.pageIndex);e?e.addOrRebuild(t):(this.addEditor(t),this.addToAnnotationStorage(t))}setActiveEditor(t){this.#e!==t&&(this.#e=t,t&&this.#G(t.propertiesToUpdate))}get#gt(){let t=null;for(t of this.#v);return t}updateUI(t){this.#gt===t&&this.#G(t.propertiesToUpdate)}updateUIForDefaultProperties(t){this.#G(t.defaultPropertiesToUpdate)}toggleSelected(t){if(this.#v.has(t)){this.#v.delete(t),t.unselect(),this.#M({hasSelectedEditor:this.hasSelection});return}this.#v.add(t),t.select(),this.#G(t.propertiesToUpdate),this.#M({hasSelectedEditor:!0})}setSelected(t){this.updateToolbar({mode:t.mode,editId:t.id}),this.#d?.commitOrRemove();for(const e of this.#v)e!==t&&e.unselect();this.#v.clear(),this.#v.add(t),t.select(),this.#G(t.propertiesToUpdate),this.#M({hasSelectedEditor:!0})}isSelected(t){return this.#v.has(t)}get firstSelectedEditor(){return this.#v.values().next().value}unselect(t){t.unselect(),this.#v.delete(t),this.#M({hasSelectedEditor:this.hasSelection})}get hasSelection(){return this.#v.size!==0}get isEnterHandled(){return this.#v.size===1&&this.firstSelectedEditor.isEnterHandled}undo(){this.#c.undo(),this.#M({hasSomethingToUndo:this.#c.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#K()}),this._editorUndoBar?.hide()}redo(){this.#c.redo(),this.#M({hasSomethingToUndo:!0,hasSomethingToRedo:this.#c.hasSomethingToRedo(),isEmpty:this.#K()})}addCommands(t){this.#c.add(t),this.#M({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#K()})}cleanUndoStack(t){this.#c.cleanType(t)}#K(){if(this.#s.size===0)return!0;if(this.#s.size===1)for(const t of this.#s.values())return t.isEmpty();return!1}delete(){this.commitOrRemove();const t=this.currentLayer?.endDrawingSession(!0);if(!this.hasSelection&&!t)return;const e=t?[t]:[...this.#v],s=()=>{this._editorUndoBar?.show(i,e.length===1?e[0].editorType:e.length);for(const n of e)n.remove()},i=()=>{for(const n of e)this.#nt(n)};this.addCommands({cmd:s,undo:i,mustExec:!0})}commitOrRemove(){this.#e?.commitOrRemove()}hasSomethingToControl(){return this.#e||this.hasSelection}#rt(t){for(const e of this.#v)e.unselect();this.#v.clear();for(const e of t)e.isEmpty()||(this.#v.add(e),e.select());this.#M({hasSelectedEditor:this.hasSelection})}selectAll(){for(const t of this.#v)t.commit();this.#rt(this.#s.values())}unselectAll(){if(!(this.#e&&(this.#e.commitOrRemove(),this.#E!==j.NONE))&&!this.#d?.commitOrRemove()&&this.hasSelection){for(const t of this.#v)t.unselect();this.#v.clear(),this.#M({hasSelectedEditor:!1})}}translateSelectedEditors(t,e,s=!1){if(s||this.commitOrRemove(),!this.hasSelection)return;this.#z[0]+=t,this.#z[1]+=e;const[i,n]=this.#z,r=[...this.#v],a=1e3;this.#F&&clearTimeout(this.#F),this.#F=setTimeout(()=>{this.#F=null,this.#z[0]=this.#z[1]=0,this.addCommands({cmd:()=>{for(const l of r)this.#s.has(l.id)&&(l.translateInPage(i,n),l.translationDone())},undo:()=>{for(const l of r)this.#s.has(l.id)&&(l.translateInPage(-i,-n),l.translationDone())},mustExec:!1})},a);for(const l of r)l.translateInPage(t,e),l.translationDone()}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#f=new Map;for(const t of this.#v)this.#f.set(t,{savedX:t.x,savedY:t.y,savedPageIndex:t.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#f)return!1;this.disableUserSelect(!1);const t=this.#f;this.#f=null;let e=!1;for(const[{x:i,y:n,pageIndex:r},a]of t)a.newX=i,a.newY=n,a.newPageIndex=r,e||=i!==a.savedX||n!==a.savedY||r!==a.savedPageIndex;if(!e)return!1;const s=(i,n,r,a)=>{if(this.#s.has(i.id)){const l=this.#a.get(a);l?i._setParentAndPosition(l,n,r):(i.pageIndex=a,i.x=n,i.y=r)}};return this.addCommands({cmd:()=>{for(const[i,{newX:n,newY:r,newPageIndex:a}]of t)s(i,n,r,a)},undo:()=>{for(const[i,{savedX:n,savedY:r,savedPageIndex:a}]of t)s(i,n,r,a)},mustExec:!0}),!0}dragSelectedEditors(t,e){if(this.#f)for(const s of this.#f.keys())s.drag(t,e)}rebuild(t){if(t.parent===null){const e=this.getLayer(t.pageIndex);e?(e.changeParent(t),e.addOrRebuild(t)):(this.addEditor(t),this.addToAnnotationStorage(t),t.rebuild())}else t.parent.addOrRebuild(t)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||this.#v.size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(t){return this.#e===t}getActive(){return this.#e}getMode(){return this.#E}isEditingMode(){return this.#E!==j.NONE}get imageManager(){return z(this,"imageManager",new Ni)}getSelectionBoxes(t){if(!t)return null;const e=document.getSelection();for(let c=0,h=e.rangeCount;c<h;c++)if(!t.contains(e.getRangeAt(c).commonAncestorContainer))return null;const{x:s,y:i,width:n,height:r}=t.getBoundingClientRect();let a;switch(t.getAttribute("data-main-rotation")){case"90":a=(c,h,d,u)=>({x:(h-i)/r,y:1-(c+d-s)/n,width:u/r,height:d/n});break;case"180":a=(c,h,d,u)=>({x:1-(c+d-s)/n,y:1-(h+u-i)/r,width:d/n,height:u/r});break;case"270":a=(c,h,d,u)=>({x:1-(h+u-i)/r,y:(c-s)/n,width:u/r,height:d/n});break;default:a=(c,h,d,u)=>({x:(c-s)/n,y:(h-i)/r,width:d/n,height:u/r});break}const l=[];for(let c=0,h=e.rangeCount;c<h;c++){const d=e.getRangeAt(c);if(!d.collapsed)for(const{x:u,y:f,width:m,height:g}of d.getClientRects())m===0||g===0||l.push(a(u,f,m,g))}return l.length===0?null:l}addChangedExistingAnnotation({annotationElementId:t,id:e}){(this.#o||=new Map).set(t,e)}removeChangedExistingAnnotation({annotationElementId:t}){this.#o?.delete(t)}renderAnnotationElement(t){const e=this.#o?.get(t.data.id);if(!e)return;const s=this.#r.getRawValue(e);s&&(this.#E===j.NONE&&!s.hasBeenModified||s.renderAnnotationElement(t))}setMissingCanvas(t,e,s){const i=this.#I?.get(t);i&&(i.setCanvas(e,s),this.#I.delete(t))}addMissingCanvas(t,e){(this.#I||=new Map).set(t,e)}}class Yt{#t=null;#e=!1;#i=null;#s=null;#a=null;#n=null;#r=!1;#o=null;#c=null;#l=null;#u=null;#d=!1;static#p=null;static _l10n=null;constructor(t){this.#c=t,this.#d=t._uiManager.useNewAltTextFlow,Yt.#p||=Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"})}static initialize(t){Yt._l10n??=t}async render(){const t=this.#i=document.createElement("button");t.className="altText",t.tabIndex="0";const e=this.#s=document.createElement("span");t.append(e),this.#d?(t.classList.add("new"),t.setAttribute("data-l10n-id",Yt.#p.missing),e.setAttribute("data-l10n-id",Yt.#p["missing-label"])):(t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const s=this.#c._uiManager._signal;t.addEventListener("contextmenu",Ft,{signal:s}),t.addEventListener("pointerdown",n=>n.stopPropagation(),{signal:s});const i=n=>{n.preventDefault(),this.#c._uiManager.editAltText(this.#c),this.#d&&this.#c._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:this.#m}})};return t.addEventListener("click",i,{capture:!0,signal:s}),t.addEventListener("keydown",n=>{n.target===t&&n.key==="Enter"&&(this.#r=!0,i(n))},{signal:s}),await this.#f(),t}get#m(){return this.#t&&"added"||this.#t===null&&this.guessedText&&"review"||"missing"}finish(){this.#i&&(this.#i.focus({focusVisible:this.#r}),this.#r=!1)}isEmpty(){return this.#d?this.#t===null:!this.#t&&!this.#e}hasData(){return this.#d?this.#t!==null||!!this.#l:this.isEmpty()}get guessedText(){return this.#l}async setGuessedText(t){this.#t===null&&(this.#l=t,this.#u=await Yt._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:t}),this.#f())}toggleAltTextBadge(t=!1){if(!this.#d||this.#t){this.#o?.remove(),this.#o=null;return}if(!this.#o){const e=this.#o=document.createElement("div");e.className="noAltTextBadge",this.#c.div.append(e)}this.#o.classList.toggle("hidden",!t)}serialize(t){let e=this.#t;return!t&&this.#l===e&&(e=this.#u),{altText:e,decorative:this.#e,guessedText:this.#l,textWithDisclaimer:this.#u}}get data(){return{altText:this.#t,decorative:this.#e}}set data({altText:t,decorative:e,guessedText:s,textWithDisclaimer:i,cancel:n=!1}){s&&(this.#l=s,this.#u=i),!(this.#t===t&&this.#e===e)&&(n||(this.#t=t,this.#e=e),this.#f())}toggle(t=!1){this.#i&&(!t&&this.#n&&(clearTimeout(this.#n),this.#n=null),this.#i.disabled=!t)}shown(){this.#c._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:this.#m}})}destroy(){this.#i?.remove(),this.#i=null,this.#s=null,this.#a=null,this.#o?.remove(),this.#o=null}async#f(){const t=this.#i;if(!t)return;if(this.#d){if(t.classList.toggle("done",!!this.#t),t.setAttribute("data-l10n-id",Yt.#p[this.#m]),this.#s?.setAttribute("data-l10n-id",Yt.#p[`${this.#m}-label`]),!this.#t){this.#a?.remove();return}}else{if(!this.#t&&!this.#e){t.classList.remove("done"),this.#a?.remove();return}t.classList.add("done"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let e=this.#a;if(!e){this.#a=e=document.createElement("span"),e.className="tooltip",e.setAttribute("role","tooltip"),e.id=`alt-text-tooltip-${this.#c.id}`;const i=100,n=this.#c._uiManager._signal;n.addEventListener("abort",()=>{clearTimeout(this.#n),this.#n=null},{once:!0}),t.addEventListener("mouseenter",()=>{this.#n=setTimeout(()=>{this.#n=null,this.#a.classList.add("show"),this.#c._reportTelemetry({action:"alt_text_tooltip"})},i)},{signal:n}),t.addEventListener("mouseleave",()=>{this.#n&&(clearTimeout(this.#n),this.#n=null),this.#a?.classList.remove("show")},{signal:n})}this.#e?e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(e.removeAttribute("data-l10n-id"),e.textContent=this.#t),e.parentNode||t.append(e),this.#c.getElementForAltText()?.setAttribute("aria-describedby",e.id)}}class vs{#t=null;#e=null;#i=!1;#s=null;#a=null;#n=null;#r=null;#o=null;#c=!1;#l=null;constructor(t){this.#s=t}renderForToolbar(){const t=this.#e=document.createElement("button");return t.className="comment",this.#u(t,!1)}renderForStandalone(){const t=this.#t=document.createElement("button");t.className="annotationCommentButton";const e=this.#s.commentButtonPosition;if(e){const{style:s}=t;s.insetInlineEnd=`calc(${100*(this.#s._uiManager.direction==="ltr"?1-e[0]:e[0])}% - var(--comment-button-dim))`,s.top=`calc(${100*e[1]}% - var(--comment-button-dim))`;const i=this.#s.commentButtonColor;i&&(s.backgroundColor=i)}return this.#u(t,!0)}focusButton(){setTimeout(()=>{(this.#t??this.#e)?.focus()},0)}onUpdatedColor(){if(!this.#t)return;const t=this.#s.commentButtonColor;t&&(this.#t.style.backgroundColor=t),this.#s._uiManager.updatePopupColor(this.#s)}get commentButtonWidth(){return(this.#t?.getBoundingClientRect().width??0)/this.#s.parent.boundingClientRect.width}get commentPopupPositionInLayer(){if(this.#l)return this.#l;if(!this.#t)return null;const{x:t,y:e,height:s}=this.#t.getBoundingClientRect(),{x:i,y:n,width:r,height:a}=this.#s.parent.boundingClientRect;return[(t-i)/r,(e+s-n)/a]}set commentPopupPositionInLayer(t){this.#l=t}hasDefaultPopupPosition(){return this.#l===null}removeStandaloneCommentButton(){this.#t?.remove(),this.#t=null}removeToolbarCommentButton(){this.#e?.remove(),this.#e=null}setCommentButtonStates({selected:t,hasPopup:e}){this.#t&&(this.#t.classList.toggle("selected",t),this.#t.ariaExpanded=e)}#u(t,e){if(!this.#s._uiManager.hasCommentManager())return null;t.tabIndex="0",t.ariaHasPopup="dialog",e?(t.ariaControls="commentPopup",t.setAttribute("data-l10n-id","pdfjs-show-comment-button")):(t.ariaControlsElements=[this.#s._uiManager.getCommentDialogElement()],t.setAttribute("data-l10n-id","pdfjs-editor-edit-comment-button"));const s=this.#s._uiManager._signal;if(!(s instanceof AbortSignal)||s.aborted)return t;t.addEventListener("contextmenu",Ft,{signal:s}),e&&(t.addEventListener("focusin",n=>{this.#s._focusEventsAllowed=!1,ot(n)},{capture:!0,signal:s}),t.addEventListener("focusout",n=>{this.#s._focusEventsAllowed=!0,ot(n)},{capture:!0,signal:s})),t.addEventListener("pointerdown",n=>n.stopPropagation(),{signal:s});const i=n=>{n.preventDefault(),t===this.#e?this.edit():this.#s.toggleComment(!0)};return t.addEventListener("click",i,{capture:!0,signal:s}),t.addEventListener("keydown",n=>{n.target===t&&n.key==="Enter"&&(this.#i=!0,i(n))},{signal:s}),t.addEventListener("pointerenter",()=>{this.#s.toggleComment(!1,!0)},{signal:s}),t.addEventListener("pointerleave",()=>{this.#s.toggleComment(!1,!1)},{signal:s}),t}edit(t){const e=this.commentPopupPositionInLayer;let s,i;if(e)[s,i]=e;else{[s,i]=this.#s.commentButtonPosition;const{width:h,height:d,x:u,y:f}=this.#s;s=u+s*h,i=f+i*d}const n=this.#s.parent.boundingClientRect,{x:r,y:a,width:l,height:c}=n;this.#s._uiManager.editComment(this.#s,r+s*l,a+i*c,{...t,parentDimensions:n})}finish(){this.#e&&(this.#e.focus({focusVisible:this.#i}),this.#i=!1)}isDeleted(){return this.#c||this.#r===""}isEmpty(){return this.#r===null}hasBeenEdited(){return this.isDeleted()||this.#r!==this.#a}serialize(){return this.data}get data(){return{text:this.#r,richText:this.#n,date:this.#o,deleted:this.isDeleted()}}set data(t){if(t!==this.#r&&(this.#n=null),t===null){this.#r="",this.#c=!0;return}this.#r=t,this.#o=new Date,this.#c=!1}setInitialText(t,e=null){this.#a=t,this.data=t,this.#o=null,this.#n=e}shown(){}destroy(){this.#e?.remove(),this.#e=null,this.#t?.remove(),this.#t=null,this.#r="",this.#n=null,this.#o=null,this.#s=null,this.#i=!1,this.#c=!1}}class us{#t;#e=!1;#i=null;#s;#a;#n;#r;#o=null;#c;#l=null;#u;#d=null;constructor({container:t,isPinchingDisabled:e=null,isPinchingStopped:s=null,onPinchStart:i=null,onPinching:n=null,onPinchEnd:r=null,signal:a}){this.#t=t,this.#i=s,this.#s=e,this.#a=i,this.#n=n,this.#r=r,this.#u=new AbortController,this.#c=AbortSignal.any([a,this.#u.signal]),t.addEventListener("touchstart",this.#p.bind(this),{passive:!1,signal:this.#c})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/zt.pixelRatio}#p(t){if(this.#s?.())return;if(t.touches.length===1){if(this.#o)return;const i=this.#o=new AbortController,n=AbortSignal.any([this.#c,i.signal]),r=this.#t,a={capture:!0,signal:n,passive:!1},l=c=>{c.pointerType==="touch"&&(this.#o?.abort(),this.#o=null)};r.addEventListener("pointerdown",c=>{c.pointerType==="touch"&&(ot(c),l(c))},a),r.addEventListener("pointerup",l,a),r.addEventListener("pointercancel",l,a);return}if(!this.#d){this.#d=new AbortController;const i=AbortSignal.any([this.#c,this.#d.signal]),n=this.#t,r={signal:i,capture:!1,passive:!1};n.addEventListener("touchmove",this.#m.bind(this),r);const a=this.#f.bind(this);n.addEventListener("touchend",a,r),n.addEventListener("touchcancel",a,r),r.capture=!0,n.addEventListener("pointerdown",ot,r),n.addEventListener("pointermove",ot,r),n.addEventListener("pointercancel",ot,r),n.addEventListener("pointerup",ot,r),this.#a?.()}if(ot(t),t.touches.length!==2||this.#i?.()){this.#l=null;return}let[e,s]=t.touches;e.identifier>s.identifier&&([e,s]=[s,e]),this.#l={touch0X:e.screenX,touch0Y:e.screenY,touch1X:s.screenX,touch1Y:s.screenY}}#m(t){if(!this.#l||t.touches.length!==2)return;ot(t);let[e,s]=t.touches;e.identifier>s.identifier&&([e,s]=[s,e]);const{screenX:i,screenY:n}=e,{screenX:r,screenY:a}=s,l=this.#l,{touch0X:c,touch0Y:h,touch1X:d,touch1Y:u}=l,f=d-c,m=u-h,g=r-i,y=a-n,b=Math.hypot(g,y)||1,x=Math.hypot(f,m)||1;if(!this.#e&&Math.abs(x-b)<=us.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(l.touch0X=i,l.touch0Y=n,l.touch1X=r,l.touch1Y=a,!this.#e){this.#e=!0;return}const w=[(i+r)/2,(n+a)/2];this.#n?.(w,x,b)}#f(t){t.touches.length>=2||(this.#d&&(this.#d.abort(),this.#d=null,this.#r?.()),this.#l&&(ot(t),this.#l=null,this.#e=!1))}destroy(){this.#u?.abort(),this.#u=null,this.#o?.abort(),this.#o=null}}class I{#t=null;#e=null;#i=null;#s=null;#a=null;#n=!1;#r=null;#o="";#c=null;#l=null;#u=null;#d=null;#p=null;#m="";#f=!1;#h=null;#g=!1;#b=!1;#w=!1;#y=null;#_=0;#k=0;#x=null;#C=null;isSelected=!1;_isCopy=!1;_editToolbar=null;_initialOptions=Object.create(null);_initialData=null;_isVisible=!0;_uiManager=null;_focusEventsAllowed=!0;static _l10n=null;static _l10nResizer=null;#A=!1;#S=I._zIndex++;static _borderLineWidth=-1;static _colorManager=new Di;static _zIndex=1;static _telemetryTimeout=1e3;static get _resizerKeyboardManager(){const t=I.prototype._resizeWithKeyboard,e=ne.TRANSLATE_SMALL,s=ne.TRANSLATE_BIG;return z(this,"_resizerKeyboardManager",new ds([[["ArrowLeft","mac+ArrowLeft"],t,{args:[-e,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t,{args:[-s,0]}],[["ArrowRight","mac+ArrowRight"],t,{args:[e,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t,{args:[s,0]}],[["ArrowUp","mac+ArrowUp"],t,{args:[0,-e]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t,{args:[0,-s]}],[["ArrowDown","mac+ArrowDown"],t,{args:[0,e]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t,{args:[0,s]}],[["Escape","mac+Escape"],I.prototype._stopResizingWithKeyboard]]))}constructor(t){this.parent=t.parent,this.id=t.id,this.width=this.height=null,this.pageIndex=t.parent.pageIndex,this.name=t.name,this.div=null,this._uiManager=t.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=t.isCentered,this._structTreeParentId=null,this.annotationElementId=t.annotationElementId||null,this.creationDate=t.creationDate||new Date,this.modificationDate=t.modificationDate||null;const{rotation:e,rawDims:{pageWidth:s,pageHeight:i,pageX:n,pageY:r}}=this.parent.viewport;this.rotation=e,this.pageRotation=(360+e-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[s,i],this.pageTranslation=[n,r];const[a,l]=this.parentDimensions;this.x=t.x/a,this.y=t.y/l,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}get mode(){return Object.getPrototypeOf(this).constructor._editorType}static get isDrawer(){return!1}static get _defaultLineColor(){return z(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(t){const e=new Zo({id:t.parent.getNextId(),parent:t.parent,uiManager:t._uiManager});e.annotationElementId=t.annotationElementId,e.deleted=!0,e._uiManager.addToAnnotationStorage(e)}static initialize(t,e){if(I._l10n??=t,I._l10nResizer||=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"}),I._borderLineWidth!==-1)return;const s=getComputedStyle(document.documentElement);I._borderLineWidth=parseFloat(s.getPropertyValue("--outline-width"))||0}static updateDefaultParams(t,e){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(t){return!1}static paste(t,e){J("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#A}set _isDraggable(t){this.#A=t,this.div?.classList.toggle("draggable",t)}get uid(){return this.annotationElementId||this.id}get isEnterHandled(){return!0}center(){const[t,e]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*e/(t*2),this.y+=this.width*t/(e*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*e/(t*2),this.y-=this.width*t/(e*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(t){this._uiManager.addCommands(t)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#S}setParent(t){t!==null?(this.pageIndex=t.pageIndex,this.pageDimensions=t.pageDimensions):(this.#F(),this.#d?.remove(),this.#d=null),this.parent=t}focusin(t){this._focusEventsAllowed&&(this.#f?this.#f=!1:this.parent.setSelected(this))}focusout(t){!this._focusEventsAllowed||!this.isAttachedToDOM||t.relatedTarget?.closest(`#${this.id}`)||(t.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.isInEditMode()&&this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(t,e,s,i){const[n,r]=this.parentDimensions;[s,i]=this.screenToPageTranslation(s,i),this.x=(t+s)/n,this.y=(e+i)/r,this.fixAndSetPosition()}_moveAfterPaste(t,e){const[s,i]=this.parentDimensions;this.setAt(t*s,e*i,this.width*s,this.height*i),this._onTranslated()}#P([t,e],s,i){[s,i]=this.screenToPageTranslation(s,i),this.x+=s/t,this.y+=i/e,this._onTranslating(this.x,this.y),this.fixAndSetPosition()}translate(t,e){this.#P(this.parentDimensions,t,e)}translateInPage(t,e){this.#h||=[this.x,this.y,this.width,this.height],this.#P(this.pageDimensions,t,e),this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(t,e){this.#h||=[this.x,this.y,this.width,this.height];const{div:s,parentDimensions:[i,n]}=this;if(this.x+=t/i,this.y+=e/n,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:d,y:u}=this.div.getBoundingClientRect();this.parent.findNewParent(this,d,u)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:r,y:a}=this;const[l,c]=this.getBaseTranslation();r+=l,a+=c;const{style:h}=s;h.left=`${(100*r).toFixed(2)}%`,h.top=`${(100*a).toFixed(2)}%`,this._onTranslating(r,a),s.scrollIntoView({block:"nearest"})}_onTranslating(t,e){}_onTranslated(t,e){}get _hasBeenMoved(){return!!this.#h&&(this.#h[0]!==this.x||this.#h[1]!==this.y)}get _hasBeenResized(){return!!this.#h&&(this.#h[2]!==this.width||this.#h[3]!==this.height)}getBaseTranslation(){const[t,e]=this.parentDimensions,{_borderLineWidth:s}=I,i=s/t,n=s/e;switch(this.rotation){case 90:return[-i,n];case 180:return[i,n];case 270:return[i,-n];default:return[-i,-n]}}get _mustFixPosition(){return!0}fixAndSetPosition(t=this.rotation){const{div:{style:e},pageDimensions:[s,i]}=this;let{x:n,y:r,width:a,height:l}=this;if(a*=s,l*=i,n*=s,r*=i,this._mustFixPosition)switch(t){case 0:n=vt(n,0,s-a),r=vt(r,0,i-l);break;case 90:n=vt(n,0,s-l),r=vt(r,a,i);break;case 180:n=vt(n,a,s),r=vt(r,l,i);break;case 270:n=vt(n,l,s),r=vt(r,0,i-a);break}this.x=n/=s,this.y=r/=i;const[c,h]=this.getBaseTranslation();n+=c,r+=h,e.left=`${(100*n).toFixed(2)}%`,e.top=`${(100*r).toFixed(2)}%`,this.moveInDOM()}static#T(t,e,s){switch(s){case 90:return[e,-t];case 180:return[-t,-e];case 270:return[-e,t];default:return[t,e]}}screenToPageTranslation(t,e){return I.#T(t,e,this.parentRotation)}pageTranslationToScreen(t,e){return I.#T(t,e,360-this.parentRotation)}#L(t){switch(t){case 90:{const[e,s]=this.pageDimensions;return[0,-e/s,s/e,0]}case 180:return[-1,0,0,-1];case 270:{const[e,s]=this.pageDimensions;return[0,e/s,-s/e,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:t,pageDimensions:[e,s]}=this;return[e*t,s*t]}setDims(){const{div:{style:t},width:e,height:s}=this;t.width=`${(100*e).toFixed(2)}%`,t.height=`${(100*s).toFixed(2)}%`}getInitialTranslation(){return[0,0]}#O(){if(this.#c)return;this.#c=document.createElement("div"),this.#c.classList.add("resizers");const t=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],e=this._uiManager._signal;for(const s of t){const i=document.createElement("div");this.#c.append(i),i.classList.add("resizer",s),i.setAttribute("data-resizer-name",s),i.addEventListener("pointerdown",this.#R.bind(this,s),{signal:e}),i.addEventListener("contextmenu",Ft,{signal:e}),i.tabIndex=-1}this.div.prepend(this.#c)}#R(t,e){e.preventDefault();const{isMac:s}=bt.platform;if(e.button!==0||e.ctrlKey&&s)return;this.#i?.toggle(!1);const i=this._isDraggable;this._isDraggable=!1,this.#l=[e.screenX,e.screenY];const n=new AbortController,r=this._uiManager.combinedSignal(n);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",this.#I.bind(this,t),{passive:!0,capture:!0,signal:r}),window.addEventListener("touchmove",ot,{passive:!1,signal:r}),window.addEventListener("contextmenu",Ft,{signal:r}),this.#u={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const a=this.parent.div.style.cursor,l=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(e.target).cursor;const c=()=>{n.abort(),this.parent.togglePointerEvents(!0),this.#i?.toggle(!0),this._isDraggable=i,this.parent.div.style.cursor=a,this.div.style.cursor=l,this.#j()};window.addEventListener("pointerup",c,{signal:r}),window.addEventListener("blur",c,{signal:r})}#D(t,e,s,i){this.width=s,this.height=i,this.x=t,this.y=e,this.setDims(),this.fixAndSetPosition(),this._onResized()}_onResized(){}#j(){if(!this.#u)return;const{savedX:t,savedY:e,savedWidth:s,savedHeight:i}=this.#u;this.#u=null;const n=this.x,r=this.y,a=this.width,l=this.height;n===t&&r===e&&a===s&&l===i||this.addCommands({cmd:this.#D.bind(this,n,r,a,l),undo:this.#D.bind(this,t,e,s,i),mustExec:!0})}static _round(t){return Math.round(t*1e4)/1e4}#I(t,e){const[s,i]=this.parentDimensions,n=this.x,r=this.y,a=this.width,l=this.height,c=I.MIN_SIZE/s,h=I.MIN_SIZE/i,d=this.#L(this.rotation),u=(M,R)=>[d[0]*M+d[2]*R,d[1]*M+d[3]*R],f=this.#L(360-this.rotation),m=(M,R)=>[f[0]*M+f[2]*R,f[1]*M+f[3]*R];let g,y,b=!1,x=!1;switch(t){case"topLeft":b=!0,g=(M,R)=>[0,0],y=(M,R)=>[M,R];break;case"topMiddle":g=(M,R)=>[M/2,0],y=(M,R)=>[M/2,R];break;case"topRight":b=!0,g=(M,R)=>[M,0],y=(M,R)=>[0,R];break;case"middleRight":x=!0,g=(M,R)=>[M,R/2],y=(M,R)=>[0,R/2];break;case"bottomRight":b=!0,g=(M,R)=>[M,R],y=(M,R)=>[0,0];break;case"bottomMiddle":g=(M,R)=>[M/2,R],y=(M,R)=>[M/2,0];break;case"bottomLeft":b=!0,g=(M,R)=>[0,R],y=(M,R)=>[M,0];break;case"middleLeft":x=!0,g=(M,R)=>[0,R/2],y=(M,R)=>[M,R/2];break}const w=g(a,l),A=y(a,l);let v=u(...A);const k=I._round(n+v[0]),S=I._round(r+v[1]);let _=1,E=1,T,L;if(e.fromKeyboard)({deltaX:T,deltaY:L}=e);else{const{screenX:M,screenY:R}=e,[U,nt]=this.#l;[T,L]=this.screenToPageTranslation(M-U,R-nt),this.#l[0]=M,this.#l[1]=R}if([T,L]=m(T/s,L/i),b){const M=Math.hypot(a,l);_=E=Math.max(Math.min(Math.hypot(A[0]-w[0]-T,A[1]-w[1]-L)/M,1/a,1/l),c/a,h/l)}else x?_=vt(Math.abs(A[0]-w[0]-T),c,1)/a:E=vt(Math.abs(A[1]-w[1]-L),h,1)/l;const G=I._round(a*_),H=I._round(l*E);v=u(...y(G,H));const O=k-v[0],$=S-v[1];this.#h||=[this.x,this.y,this.width,this.height],this.width=G,this.height=H,this.x=O,this.y=$,this.setDims(),this.fixAndSetPosition(),this._onResizing()}_onResizing(){}altTextFinish(){this.#i?.finish()}get toolbarButtons(){return null}async addEditToolbar(){if(this._editToolbar||this.#b)return this._editToolbar;this._editToolbar=new Ze(this),this.div.append(this._editToolbar.render());const{toolbarButtons:t}=this;if(t)for(const[e,s]of t)await this._editToolbar.addButton(e,s);return this.hasComment||this._editToolbar.addButton("comment",this.addCommentButton()),this._editToolbar.addButton("delete"),this._editToolbar}addCommentButtonInToolbar(){this._editToolbar?.addButtonBefore("comment",this.addCommentButton(),".deleteButton")}removeCommentButtonFromToolbar(){this._editToolbar?.removeButton("comment")}removeEditToolbar(){this._editToolbar?.remove(),this._editToolbar=null,this.#i?.destroy()}addContainer(t){const e=this._editToolbar?.div;e?e.before(t):this.div.append(t)}getClientDimensions(){return this.div.getBoundingClientRect()}createAltText(){return this.#i||(Yt.initialize(I._l10n),this.#i=new Yt(this),this.#t&&(this.#i.data=this.#t,this.#t=null)),this.#i}get altTextData(){return this.#i?.data}set altTextData(t){this.#i&&(this.#i.data=t)}get guessedAltText(){return this.#i?.guessedText}async setGuessedAltText(t){await this.#i?.setGuessedText(t)}serializeAltText(t){return this.#i?.serialize(t)}hasAltText(){return!!this.#i&&!this.#i.isEmpty()}hasAltTextData(){return this.#i?.hasData()??!1}focusCommentButton(){this.#s?.focusButton()}addCommentButton(){return this.#s||=new vs(this)}addStandaloneCommentButton(){if(this.#a){this._uiManager.isEditingMode()&&this.#a.classList.remove("hidden");return}this.hasComment&&(this.#a=this.#s.renderForStandalone(),this.div.append(this.#a))}removeStandaloneCommentButton(){this.#s.removeStandaloneCommentButton(),this.#a=null}hideStandaloneCommentButton(){this.#a?.classList.add("hidden")}get comment(){const{data:{richText:t,text:e,date:s,deleted:i}}=this.#s;return{text:e,richText:t,date:s,deleted:i,color:this.getNonHCMColor(),opacity:this.opacity??1}}set comment(t){this.#s||=new vs(this),this.#s.data=t,this.hasComment?(this.removeCommentButtonFromToolbar(),this.addStandaloneCommentButton(),this._uiManager.updateComment(this)):(this.addCommentButtonInToolbar(),this.removeStandaloneCommentButton(),this._uiManager.removeComment(this))}setCommentData({comment:t,popupRef:e,richText:s}){if(!e||(this.#s||=new vs(this),this.#s.setInitialText(t,s),!this.annotationElementId))return;const i=this._uiManager.getAndRemoveDataFromAnnotationStorage(this.annotationElementId);i&&this.updateFromAnnotationLayer(i)}get hasEditedComment(){return this.#s?.hasBeenEdited()}get hasDeletedComment(){return this.#s?.isDeleted()}get hasComment(){return!!this.#s&&!this.#s.isEmpty()&&!this.#s.isDeleted()}async editComment(t){this.#s||=new vs(this),this.#s.edit(t)}toggleComment(t,e=void 0){this.hasComment&&this._uiManager.toggleComment(this,t,e)}setSelectedCommentButton(t){this.#s.setSelectedButton(t)}addComment(t){if(this.hasEditedComment){const[,,,i]=t.rect,[n]=this.pageDimensions,[r]=this.pageTranslation,a=r+n+1,l=i-100,c=a+180;t.popup={contents:this.comment.text,deleted:this.comment.deleted,rect:[a,l,c,i]}}}updateFromAnnotationLayer({popup:{contents:t,deleted:e}}){this.#s.data=e?null:t}get parentBoundingClientRect(){return this.parent.boundingClientRect}render(){const t=this.div=document.createElement("div");t.setAttribute("data-editor-rotation",(360-this.rotation)%360),t.className=this.name,t.setAttribute("id",this.id),t.tabIndex=this.#n?-1:0,t.setAttribute("role","application"),this.defaultL10nId&&t.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||t.classList.add("hidden"),this.setInForeground(),this.#U();const[e,s]=this.parentDimensions;this.parentRotation%180!==0&&(t.style.maxWidth=`${(100*s/e).toFixed(2)}%`,t.style.maxHeight=`${(100*e/s).toFixed(2)}%`);const[i,n]=this.getInitialTranslation();return this.translate(i,n),pr(this,t,["keydown","pointerdown","dblclick"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(this.#C||=new us({container:t,isPinchingDisabled:()=>!this.isSelected,onPinchStart:this.#$.bind(this),onPinching:this.#E.bind(this),onPinchEnd:this.#v.bind(this),signal:this._uiManager._signal})),this.addStandaloneCommentButton(),this._uiManager._editorUndoBar?.hide(),t}#$(){this.#u={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height},this.#i?.toggle(!1),this.parent.togglePointerEvents(!1)}#E(t,e,s){let n=.7*(s/e)+1-.7;if(n===1)return;const r=this.#L(this.rotation),a=(k,S)=>[r[0]*k+r[2]*S,r[1]*k+r[3]*S],[l,c]=this.parentDimensions,h=this.x,d=this.y,u=this.width,f=this.height,m=I.MIN_SIZE/l,g=I.MIN_SIZE/c;n=Math.max(Math.min(n,1/u,1/f),m/u,g/f);const y=I._round(u*n),b=I._round(f*n);if(y===u&&b===f)return;this.#h||=[h,d,u,f];const x=a(u/2,f/2),w=I._round(h+x[0]),A=I._round(d+x[1]),v=a(y/2,b/2);this.x=w-v[0],this.y=A-v[1],this.width=y,this.height=b,this.setDims(),this.fixAndSetPosition(),this._onResizing()}#v(){this.#i?.toggle(!0),this.parent.togglePointerEvents(!0),this.#j()}pointerdown(t){const{isMac:e}=bt.platform;if(t.button!==0||t.ctrlKey&&e){t.preventDefault();return}if(this.#f=!0,this._isDraggable){this.#B(t);return}this.#N(t)}#N(t){const{isMac:e}=bt.platform;t.ctrlKey&&!e||t.shiftKey||t.metaKey&&e?this.parent.toggleSelected(this):this.parent.setSelected(this)}#B(t){const{isSelected:e}=this;this._uiManager.setUpDragSession();let s=!1;const i=new AbortController,n=this._uiManager.combinedSignal(i),r={capture:!0,passive:!1,signal:n},a=c=>{i.abort(),this.#r=null,this.#f=!1,this._uiManager.endDragSession()||this.#N(c),s&&this._onStopDragging()};e&&(this.#_=t.clientX,this.#k=t.clientY,this.#r=t.pointerId,this.#o=t.pointerType,window.addEventListener("pointermove",c=>{s||(s=!0,this._uiManager.toggleComment(this,!0,!1),this._onStartDragging());const{clientX:h,clientY:d,pointerId:u}=c;if(u!==this.#r){ot(c);return}const[f,m]=this.screenToPageTranslation(h-this.#_,d-this.#k);this.#_=h,this.#k=d,this._uiManager.dragSelectedEditors(f,m)},r),window.addEventListener("touchmove",ot,r),window.addEventListener("pointerdown",c=>{c.pointerType===this.#o&&(this.#C||c.isPrimary)&&a(c),ot(c)},r));const l=c=>{if(!this.#r||this.#r===c.pointerId){a(c);return}ot(c)};window.addEventListener("pointerup",l,{signal:n}),window.addEventListener("blur",l,{signal:n})}_onStartDragging(){}_onStopDragging(){}moveInDOM(){this.#y&&clearTimeout(this.#y),this.#y=setTimeout(()=>{this.#y=null,this.parent?.moveEditorInDOM(this)},0)}_setParentAndPosition(t,e,s){t.changeParent(this),this.x=e,this.y=s,this.fixAndSetPosition(),this._onTranslated()}getRect(t,e,s=this.rotation){const i=this.parentScale,[n,r]=this.pageDimensions,[a,l]=this.pageTranslation,c=t/i,h=e/i,d=this.x*n,u=this.y*r,f=this.width*n,m=this.height*r;switch(s){case 0:return[d+c+a,r-u-h-m+l,d+c+f+a,r-u-h+l];case 90:return[d+h+a,r-u+c+l,d+h+m+a,r-u+c+f+l];case 180:return[d-c-f+a,r-u+h+l,d-c+a,r-u+h+m+l];case 270:return[d-h-m+a,r-u-c-f+l,d-h+a,r-u-c+l];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(t,e){const[s,i,n,r]=t,a=n-s,l=r-i;switch(this.rotation){case 0:return[s,e-r,a,l];case 90:return[s,e-i,l,a];case 180:return[n,e-i,a,l];case 270:return[n,e-r,l,a];default:throw new Error("Invalid rotation")}}getPDFRect(){return this.getRect(0,0)}getNonHCMColor(){return this.color&&I._colorManager.convert(this._uiManager.getNonHCMColor(this.color))}onUpdatedColor(){this.#s?.onUpdatedColor()}getData(){const{comment:{text:t,color:e,date:s,opacity:i,deleted:n,richText:r},uid:a,pageIndex:l,creationDate:c,modificationDate:h}=this;return{id:a,pageIndex:l,rect:this.getPDFRect(),richText:r,contentsObj:{str:t},creationDate:c,modificationDate:s||h,popupRef:!n,color:e,opacity:i}}onceAdded(t){}isEmpty(){return!1}enableEditMode(){return this.isInEditMode()?!1:(this.parent.setEditingState(!1),this.#b=!0,!0)}disableEditMode(){return this.isInEditMode()?(this.parent.setEditingState(!0),this.#b=!1,!0):!1}isInEditMode(){return this.#b}shouldGetKeyboardEvents(){return this.#w}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:t,left:e,bottom:s,right:i}=this.getClientDimensions(),{innerHeight:n,innerWidth:r}=window;return e<r&&i>0&&t<n&&s>0}#U(){if(this.#p||!this.div)return;this.#p=new AbortController;const t=this._uiManager.combinedSignal(this.#p);this.div.addEventListener("focusin",this.focusin.bind(this),{signal:t}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:t})}rebuild(){this.#U()}rotate(t){}resize(){}serializeDeleted(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:this._initialData?.popupRef||""}}serialize(t=!1,e=null){return{annotationType:this.mode,pageIndex:this.pageIndex,rect:this.getPDFRect(),rotation:this.rotation,structTreeParentId:this._structTreeParentId,popupRef:this._initialData?.popupRef||""}}static async deserialize(t,e,s){const i=new this.prototype.constructor({parent:e,id:e.getNextId(),uiManager:s,annotationElementId:t.annotationElementId,creationDate:t.creationDate,modificationDate:t.modificationDate});i.rotation=t.rotation,i.#t=t.accessibilityData,i._isCopy=t.isCopy||!1;const[n,r]=i.pageDimensions,[a,l,c,h]=i.getRectInCurrentCoords(t.rect,r);return i.x=a/n,i.y=l/r,i.width=c/n,i.height=h/r,i}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){if(this.#p?.abort(),this.#p=null,this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.#y&&(clearTimeout(this.#y),this.#y=null),this.#F(),this.removeEditToolbar(),this.#x){for(const t of this.#x.values())clearTimeout(t);this.#x=null}this.parent=null,this.#C?.destroy(),this.#C=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#O(),this.#c.classList.remove("hidden"))}get toolbarPosition(){return null}get commentButtonPosition(){return this._uiManager.direction==="ltr"?[1,0]:[0,0]}get commentButtonPositionInPage(){const{commentButtonPosition:[t,e]}=this,[s,i,n,r]=this.getPDFRect();return[I._round(s+(n-s)*t),I._round(i+(r-i)*(1-e))]}get commentButtonColor(){return this._uiManager.makeCommentColor(this.getNonHCMColor(),this.opacity)}get commentPopupPosition(){return this.#s.commentPopupPositionInLayer}set commentPopupPosition(t){this.#s.commentPopupPositionInLayer=t}hasDefaultPopupPosition(){return this.#s.hasDefaultPopupPosition()}get commentButtonWidth(){return this.#s.commentButtonWidth}get elementBeforePopup(){return this.div}setCommentButtonStates(t){this.#s.setCommentButtonStates(t)}keydown(t){if(!this.isResizable||t.target!==this.div||t.key!=="Enter")return;this._uiManager.setSelected(this),this.#u={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const e=this.#c.children;if(!this.#e){this.#e=Array.from(e);const r=this.#q.bind(this),a=this.#W.bind(this),l=this._uiManager._signal;for(const c of this.#e){const h=c.getAttribute("data-resizer-name");c.setAttribute("role","spinbutton"),c.addEventListener("keydown",r,{signal:l}),c.addEventListener("blur",a,{signal:l}),c.addEventListener("focus",this.#X.bind(this,h),{signal:l}),c.setAttribute("data-l10n-id",I._l10nResizer[h])}}const s=this.#e[0];let i=0;for(const r of e){if(r===s)break;i++}const n=(360-this.rotation+this.parentRotation)%360/90*(this.#e.length/4);if(n!==i){if(n<i)for(let a=0;a<i-n;a++)this.#c.append(this.#c.firstChild);else if(n>i)for(let a=0;a<n-i;a++)this.#c.firstChild.before(this.#c.lastChild);let r=0;for(const a of e){const c=this.#e[r++].getAttribute("data-resizer-name");a.setAttribute("data-l10n-id",I._l10nResizer[c])}}this.#z(0),this.#w=!0,this.#c.firstChild.focus({focusVisible:!0}),t.preventDefault(),t.stopImmediatePropagation()}#q(t){I._resizerKeyboardManager.exec(this,t)}#W(t){this.#w&&t.relatedTarget?.parentNode!==this.#c&&this.#F()}#X(t){this.#m=this.#w?t:""}#z(t){if(this.#e)for(const e of this.#e)e.tabIndex=t}_resizeWithKeyboard(t,e){this.#w&&this.#I(this.#m,{deltaX:t,deltaY:e,fromKeyboard:!0})}#F(){this.#w=!1,this.#z(-1),this.#j()}_stopResizingWithKeyboard(){this.#F(),this.div.focus()}select(){if(this.isSelected&&this._editToolbar){this._editToolbar.show();return}if(this.isSelected=!0,this.makeResizable(),this.div?.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{this.div?.classList.contains("selectedEditor")&&this._editToolbar?.show()});return}this._editToolbar?.show(),this.#i?.toggleAltTextBadge(!1)}focus(){this.div&&!this.div.contains(document.activeElement)&&setTimeout(()=>this.div?.focus({preventScroll:!0}),0)}unselect(){this.isSelected&&(this.isSelected=!1,this.#c?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),this._editToolbar?.hide(),this.#i?.toggleAltTextBadge(!0),this.hasComment&&this._uiManager.toggleComment(this,!1,!1))}updateParams(t,e){}disableEditing(){}enableEditing(){}get canChangeContent(){return!1}enterInEditMode(){this.canChangeContent&&(this.enableEditMode(),this.div.focus())}dblclick(t){t.target.nodeName!=="BUTTON"&&(this.enterInEditMode(),this.parent.updateToolbar({mode:this.constructor._editorType,editId:this.id}))}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return this.#g}set isEditing(t){this.#g=t,this.parent&&(t?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(t,e=!1){if(e){this.#x||=new Map;const{action:s}=t;let i=this.#x.get(s);i&&clearTimeout(i),i=setTimeout(()=>{this._reportTelemetry(t),this.#x.delete(s),this.#x.size===0&&(this.#x=null)},I._telemetryTimeout),this.#x.set(s,i);return}t.type||=this.editorType,this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:t}})}show(t=this._isVisible){this.div.classList.toggle("hidden",!t),this._isVisible=t}enable(){this.div&&(this.div.tabIndex=0),this.#n=!1}disable(){this.div&&(this.div.tabIndex=-1),this.#n=!0}updateFakeAnnotationElement(t){if(!this.#d&&!this.deleted){this.#d=t.addFakeAnnotation(this);return}if(this.deleted){this.#d.remove(),this.#d=null;return}(this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized)&&this.#d.updateEdited({rect:this.getPDFRect(),popup:this.comment})}renderAnnotationElement(t){if(this.deleted)return t.hide(),null;let e=t.container.querySelector(".annotationContent");if(!e)e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),t.container.prepend(e);else if(e.nodeName==="CANVAS"){const s=e;e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),s.before(e)}return e}resetAnnotationElement(t){const{firstChild:e}=t.container;e?.nodeName==="DIV"&&e.classList.contains("annotationContent")&&e.remove()}}class Zo extends I{constructor(t){super(t),this.annotationElementId=t.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const hn=3285377520,jt=4294901760,qt=65535;class fr{constructor(t){this.h1=t?t&4294967295:hn,this.h2=t?t&4294967295:hn}update(t){let e,s;if(typeof t=="string"){e=new Uint8Array(t.length*2),s=0;for(let g=0,y=t.length;g<y;g++){const b=t.charCodeAt(g);b<=255?e[s++]=b:(e[s++]=b>>>8,e[s++]=b&255)}}else if(ArrayBuffer.isView(t))e=t.slice(),s=e.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const i=s>>2,n=s-i*4,r=new Uint32Array(e.buffer,0,i);let a=0,l=0,c=this.h1,h=this.h2;const d=3432918353,u=461845907,f=d&qt,m=u&qt;for(let g=0;g<i;g++)g&1?(a=r[g],a=a*d&jt|a*f&qt,a=a<<15|a>>>17,a=a*u&jt|a*m&qt,c^=a,c=c<<13|c>>>19,c=c*5+3864292196):(l=r[g],l=l*d&jt|l*f&qt,l=l<<15|l>>>17,l=l*u&jt|l*m&qt,h^=l,h=h<<13|h>>>19,h=h*5+3864292196);switch(a=0,n){case 3:a^=e[i*4+2]<<16;case 2:a^=e[i*4+1]<<8;case 1:a^=e[i*4],a=a*d&jt|a*f&qt,a=a<<15|a>>>17,a=a*u&jt|a*m&qt,i&1?c^=a:h^=a}this.h1=c,this.h2=h}hexdigest(){let t=this.h1,e=this.h2;return t^=e>>>1,t=t*3981806797&jt|t*36045&qt,e=e*4283543511&jt|((e<<16|t>>>16)*2950163797&jt)>>>16,t^=e>>>1,t=t*444984403&jt|t*60499&qt,e=e*3301882366&jt|((e<<16|t>>>16)*3120437893&jt)>>>16,t^=e>>>1,(t>>>0).toString(16).padStart(8,"0")+(e>>>0).toString(16).padStart(8,"0")}}const gi=Object.freeze({map:null,hash:"",transfer:void 0});class Ii{#t=!1;#e=null;#i=null;#s=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(t,e){const s=this.#s.get(t);return s===void 0?e:Object.assign(e,s)}getRawValue(t){return this.#s.get(t)}remove(t){const e=this.#s.get(t);if(e!==void 0&&(e instanceof I&&this.#i.delete(e.annotationElementId),this.#s.delete(t),this.#s.size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function")){for(const s of this.#s.values())if(s instanceof I)return;this.onAnnotationEditor(null)}}setValue(t,e){const s=this.#s.get(t);let i=!1;if(s!==void 0)for(const[n,r]of Object.entries(e))s[n]!==r&&(i=!0,s[n]=r);else i=!0,this.#s.set(t,e);i&&this.#a(),e instanceof I&&((this.#i||=new Map).set(e.annotationElementId,e),typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(e.constructor._type))}has(t){return this.#s.has(t)}get size(){return this.#s.size}#a(){this.#t||(this.#t=!0,typeof this.onSetModified=="function"&&this.onSetModified())}resetModified(){this.#t&&(this.#t=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new gr(this)}get serializable(){if(this.#s.size===0)return gi;const t=new Map,e=new fr,s=[],i=Object.create(null);let n=!1;for(const[r,a]of this.#s){const l=a instanceof I?a.serialize(!1,i):a;l&&(t.set(r,l),e.update(`${r}:${JSON.stringify(l)}`),n||=!!l.bitmap)}if(n)for(const r of t.values())r.bitmap&&s.push(r.bitmap);return t.size>0?{map:t,hash:e.hexdigest(),transfer:s}:gi}get editorStats(){let t=null;const e=new Map;let s=0,i=0;for(const n of this.#s.values()){if(!(n instanceof I)){n.popup&&(n.popup.deleted?i+=1:s+=1);continue}n.isCommentDeleted?i+=1:n.hasEditedComment&&(s+=1);const r=n.telemetryFinalData;if(!r)continue;const{type:a}=r;e.has(a)||e.set(a,Object.getPrototypeOf(n).constructor),t||=Object.create(null);const l=t[a]||=new Map;for(const[c,h]of Object.entries(r)){if(c==="type")continue;let d=l.get(c);d||(d=new Map,l.set(c,d));const u=d.get(h)??0;d.set(h,u+1)}}if((i>0||s>0)&&(t||=Object.create(null),t.comments={deleted:i,edited:s}),!t)return null;for(const[n,r]of e)t[n]=r.computeTelemetryFinalData(t[n]);return t}resetModifiedIds(){this.#e=null}updateEditor(t,e){const s=this.#i?.get(t);return s?(s.updateFromAnnotationLayer(e),!0):!1}getEditor(t){return this.#i?.get(t)||null}get modifiedIds(){if(this.#e)return this.#e;const t=[];if(this.#i)for(const e of this.#i.values())e.serialize()&&t.push(e.annotationElementId);return this.#e={ids:new Set(t),hash:t.join(",")}}[Symbol.iterator](){return this.#s.entries()}}class gr extends Ii{#t;constructor(t){super();const{map:e,hash:s,transfer:i}=t.serializable,n=structuredClone(e,i?{transfer:i}:null);this.#t={map:n,hash:s,transfer:i}}get print(){J("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#t}get modifiedIds(){return z(this,"modifiedIds",{ids:new Set,hash:""})}}class tl{#t=new Set;constructor({ownerDocument:t=globalThis.document,styleElement:e=null}){this._document=t,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(t){this.nativeFontFaces.add(t),this._document.fonts.add(t)}removeNativeFontFace(t){this.nativeFontFaces.delete(t),this._document.fonts.delete(t)}insertRule(t){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const e=this.styleElement.sheet;e.insertRule(t,e.cssRules.length)}clear(){for(const t of this.nativeFontFaces)this._document.fonts.delete(t);this.nativeFontFaces.clear(),this.#t.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:t,disableFontFace:e,_inspectFont:s}){if(!(!t||this.#t.has(t.loadedName))){if(W(!e,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:i,src:n,style:r}=t,a=new FontFace(i,n,r);this.addNativeFontFace(a);try{await a.load(),this.#t.add(i),s?.(t)}catch{B(`Cannot load system font: ${t.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(a)}return}J("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(t){if(t.attached||t.missingFile&&!t.systemFontInfo)return;if(t.attached=!0,t.systemFontInfo){await this.loadSystemFont(t);return}if(this.isFontLoadingAPISupported){const s=t.createNativeFontFace();if(s){this.addNativeFontFace(s);try{await s.loaded}catch(i){throw B(`Failed to load font '${s.family}': '${i}'.`),t.disableFontFace=!0,i}}return}const e=t.createFontFaceRule();if(e){if(this.insertRule(e),this.isSyncFontLoadingSupported)return;await new Promise(s=>{const i=this._queueLoadingCallback(s);this._prepareFontLoadEvent(t,i)})}}get isFontLoadingAPISupported(){const t=!!this._document?.fonts;return z(this,"isFontLoadingAPISupported",t)}get isSyncFontLoadingSupported(){return z(this,"isSyncFontLoadingSupported",Ct||bt.platform.isFirefox)}_queueLoadingCallback(t){function e(){for(W(!i.done,"completeRequest() cannot be called twice."),i.done=!0;s.length>0&&s[0].done;){const n=s.shift();setTimeout(n.callback,0)}}const{loadingRequests:s}=this,i={done:!1,complete:e,callback:t};return s.push(i),i}get _loadTestFont(){const t=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return z(this,"_loadTestFont",t)}_prepareFontLoadEvent(t,e){function s(A,v){return A.charCodeAt(v)<<24|A.charCodeAt(v+1)<<16|A.charCodeAt(v+2)<<8|A.charCodeAt(v+3)&255}function i(A,v,k,S){const _=A.substring(0,v),E=A.substring(v+k);return _+S+E}let n,r;const a=this._document.createElement("canvas");a.width=1,a.height=1;const l=a.getContext("2d");let c=0;function h(A,v){if(++c>30){B("Load test font never loaded."),v();return}if(l.font="30px "+A,l.fillText(".",0,20),l.getImageData(0,0,1,1).data[3]>0){v();return}setTimeout(h.bind(null,A,v))}const d=`lt${Date.now()}${this.loadTestFontId++}`;let u=this._loadTestFont;u=i(u,976,d.length,d);const m=16,g=1482184792;let y=s(u,m);for(n=0,r=d.length-3;n<r;n+=4)y=y-g+s(d,n)|0;n<d.length&&(y=y-g+s(d+"XXX",n)|0),u=i(u,m,4,Uo(y));const b=`url(data:font/opentype;base64,${btoa(u)});`,x=`@font-face {font-family:"${d}";src:${b}}`;this.insertRule(x);const w=this._document.createElement("div");w.style.visibility="hidden",w.style.width=w.style.height="10px",w.style.position="absolute",w.style.top=w.style.left="0px";for(const A of[t.loadedName,d]){const v=this._document.createElement("span");v.textContent="Hi",v.style.fontFamily=A,w.append(v)}this._document.body.append(w),h(d,()=>{w.remove(),e.complete()})}}class el{#t;constructor(t,e=null,s,i){this.compiledGlyphs=Object.create(null),this.#t=t,this._inspectFont=e,s&&Object.assign(this,s),i&&(this.charProcOperatorList=i)}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let t;if(!this.cssFontInfo)t=new FontFace(this.loadedName,this.data,{});else{const e={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(e.style=`oblique ${this.cssFontInfo.italicAngle}deg`),t=new FontFace(this.cssFontInfo.fontFamily,this.data,e)}return this._inspectFont?.(this),t}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const t=`url(data:${this.mimetype};base64,${ar(this.data)});`;let e;if(!this.cssFontInfo)e=`@font-face {font-family:"${this.loadedName}";src:${t}}`;else{let s=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(s+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),e=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${s}src:${t}}`}return this._inspectFont?.(this,t),e}getPathGenerator(t,e){if(this.compiledGlyphs[e]!==void 0)return this.compiledGlyphs[e];const s=this.loadedName+"_path_"+e;let i;try{i=t.get(s)}catch(r){B(`getPathGenerator - ignoring character: "${r}".`)}const n=new Path2D(i||"");return this.fontExtraProperties||t.delete(s),this.compiledGlyphs[e]=n}get black(){return this.#t.black}get bold(){return this.#t.bold}get disableFontFace(){return this.#t.disableFontFace??!1}get fontExtraProperties(){return this.#t.fontExtraProperties??!1}get isInvalidPDFjsFont(){return this.#t.isInvalidPDFjsFont}get isType3Font(){return this.#t.isType3Font}get italic(){return this.#t.italic}get missingFile(){return this.#t.missingFile}get remeasure(){return this.#t.remeasure}get vertical(){return this.#t.vertical}get ascent(){return this.#t.ascent}get defaultWidth(){return this.#t.defaultWidth}get descent(){return this.#t.descent}get bbox(){return this.#t.bbox}get fontMatrix(){return this.#t.fontMatrix}get fallbackName(){return this.#t.fallbackName}get loadedName(){return this.#t.loadedName}get mimetype(){return this.#t.mimetype}get name(){return this.#t.name}get data(){return this.#t.data}clearData(){this.#t.clearData()}get cssFontInfo(){return this.#t.cssFontInfo}get systemFontInfo(){return this.#t.systemFontInfo}get defaultVMetrics(){return this.#t.defaultVMetrics}}function sl(o){if(o instanceof URL)return o.href;if(typeof o=="string"){if(Ct)return o;const t=URL.parse(o,window.location);if(t)return t.href}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function il(o){if(Ct&&typeof Buffer<"u"&&o instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(o instanceof Uint8Array&&o.byteLength===o.buffer.byteLength)return o;if(typeof o=="string")return ls(o);if(o instanceof ArrayBuffer||ArrayBuffer.isView(o)||typeof o=="object"&&!isNaN(o?.length))return new Uint8Array(o);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function As(o){if(typeof o!="string")return null;if(o.endsWith("/"))return o;throw new Error(`Invalid factory url: "${o}" must include trailing slash.`)}const mi=o=>typeof o=="object"&&Number.isInteger(o?.num)&&o.num>=0&&Number.isInteger(o?.gen)&&o.gen>=0,nl=o=>typeof o=="object"&&typeof o?.name=="string",mr=Vo.bind(null,mi,nl);class rl{#t=new Map;#e=Promise.resolve();postMessage(t,e){const s={data:structuredClone(t,e?{transfer:e}:null)};this.#e.then(()=>{for(const[i]of this.#t)i.call(this,s)})}addEventListener(t,e,s=null){let i=null;if(s?.signal instanceof AbortSignal){const{signal:n}=s;if(n.aborted){B("LoopbackPort - cannot use an `aborted` signal.");return}const r=()=>this.removeEventListener(t,e);i=()=>n.removeEventListener("abort",r),n.addEventListener("abort",r)}this.#t.set(e,i)}removeEventListener(t,e){this.#t.get(e)?.(),this.#t.delete(e)}terminate(){for(const[,t]of this.#t)t?.();this.#t.clear()}}const ks={DATA:1,ERROR:2},ut={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function dn(){}function Mt(o){if(o instanceof ie||o instanceof Is||o instanceof sn||o instanceof es||o instanceof ii)return o;switch(o instanceof Error||typeof o=="object"&&o!==null||J('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),o.name){case"AbortException":return new ie(o.message);case"InvalidPDFException":return new Is(o.message);case"PasswordException":return new sn(o.message,o.code);case"ResponseException":return new es(o.message,o.status,o.missing);case"UnknownErrorException":return new ii(o.message,o.details)}return new ii(o.message,o.toString())}class Ye{#t=new AbortController;constructor(t,e,s){this.sourceName=t,this.targetName=e,this.comObj=s,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),s.addEventListener("message",this.#e.bind(this),{signal:this.#t.signal})}#e({data:t}){if(t.targetName!==this.sourceName)return;if(t.stream){this.#s(t);return}if(t.callback){const s=t.callbackId,i=this.callbackCapabilities[s];if(!i)throw new Error(`Cannot resolve callback ${s}`);if(delete this.callbackCapabilities[s],t.callback===ks.DATA)i.resolve(t.data);else if(t.callback===ks.ERROR)i.reject(Mt(t.reason));else throw new Error("Unexpected callback case");return}const e=this.actionHandler[t.action];if(!e)throw new Error(`Unknown action from worker: ${t.action}`);if(t.callbackId){const s=this.sourceName,i=t.sourceName,n=this.comObj;Promise.try(e,t.data).then(function(r){n.postMessage({sourceName:s,targetName:i,callback:ks.DATA,callbackId:t.callbackId,data:r})},function(r){n.postMessage({sourceName:s,targetName:i,callback:ks.ERROR,callbackId:t.callbackId,reason:Mt(r)})});return}if(t.streamId){this.#i(t);return}e(t.data)}on(t,e){const s=this.actionHandler;if(s[t])throw new Error(`There is already an actionName called "${t}"`);s[t]=e}send(t,e,s){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,data:e},s)}sendWithPromise(t,e,s){const i=this.callbackId++,n=Promise.withResolvers();this.callbackCapabilities[i]=n;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,callbackId:i,data:e},s)}catch(r){n.reject(r)}return n.promise}sendWithStream(t,e,s,i){const n=this.streamId++,r=this.sourceName,a=this.targetName,l=this.comObj;return new ReadableStream({start:c=>{const h=Promise.withResolvers();return this.streamControllers[n]={controller:c,startCall:h,pullCall:null,cancelCall:null,isClosed:!1},l.postMessage({sourceName:r,targetName:a,action:t,streamId:n,data:e,desiredSize:c.desiredSize},i),h.promise},pull:c=>{const h=Promise.withResolvers();return this.streamControllers[n].pullCall=h,l.postMessage({sourceName:r,targetName:a,stream:ut.PULL,streamId:n,desiredSize:c.desiredSize}),h.promise},cancel:c=>{W(c instanceof Error,"cancel must have a valid reason");const h=Promise.withResolvers();return this.streamControllers[n].cancelCall=h,this.streamControllers[n].isClosed=!0,l.postMessage({sourceName:r,targetName:a,stream:ut.CANCEL,streamId:n,reason:Mt(c)}),h.promise}},s)}#i(t){const e=t.streamId,s=this.sourceName,i=t.sourceName,n=this.comObj,r=this,a=this.actionHandler[t.action],l={enqueue(c,h=1,d){if(this.isCancelled)return;const u=this.desiredSize;this.desiredSize-=h,u>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),n.postMessage({sourceName:s,targetName:i,stream:ut.ENQUEUE,streamId:e,chunk:c},d)},close(){this.isCancelled||(this.isCancelled=!0,n.postMessage({sourceName:s,targetName:i,stream:ut.CLOSE,streamId:e}),delete r.streamSinks[e])},error(c){W(c instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,n.postMessage({sourceName:s,targetName:i,stream:ut.ERROR,streamId:e,reason:Mt(c)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:t.desiredSize,ready:null};l.sinkCapability.resolve(),l.ready=l.sinkCapability.promise,this.streamSinks[e]=l,Promise.try(a,t.data,l).then(function(){n.postMessage({sourceName:s,targetName:i,stream:ut.START_COMPLETE,streamId:e,success:!0})},function(c){n.postMessage({sourceName:s,targetName:i,stream:ut.START_COMPLETE,streamId:e,reason:Mt(c)})})}#s(t){const e=t.streamId,s=this.sourceName,i=t.sourceName,n=this.comObj,r=this.streamControllers[e],a=this.streamSinks[e];switch(t.stream){case ut.START_COMPLETE:t.success?r.startCall.resolve():r.startCall.reject(Mt(t.reason));break;case ut.PULL_COMPLETE:t.success?r.pullCall.resolve():r.pullCall.reject(Mt(t.reason));break;case ut.PULL:if(!a){n.postMessage({sourceName:s,targetName:i,stream:ut.PULL_COMPLETE,streamId:e,success:!0});break}a.desiredSize<=0&&t.desiredSize>0&&a.sinkCapability.resolve(),a.desiredSize=t.desiredSize,Promise.try(a.onPull||dn).then(function(){n.postMessage({sourceName:s,targetName:i,stream:ut.PULL_COMPLETE,streamId:e,success:!0})},function(c){n.postMessage({sourceName:s,targetName:i,stream:ut.PULL_COMPLETE,streamId:e,reason:Mt(c)})});break;case ut.ENQUEUE:if(W(r,"enqueue should have stream controller"),r.isClosed)break;r.controller.enqueue(t.chunk);break;case ut.CLOSE:if(W(r,"close should have stream controller"),r.isClosed)break;r.isClosed=!0,r.controller.close(),this.#a(r,e);break;case ut.ERROR:W(r,"error should have stream controller"),r.controller.error(Mt(t.reason)),this.#a(r,e);break;case ut.CANCEL_COMPLETE:t.success?r.cancelCall.resolve():r.cancelCall.reject(Mt(t.reason)),this.#a(r,e);break;case ut.CANCEL:if(!a)break;const l=Mt(t.reason);Promise.try(a.onCancel||dn,l).then(function(){n.postMessage({sourceName:s,targetName:i,stream:ut.CANCEL_COMPLETE,streamId:e,success:!0})},function(c){n.postMessage({sourceName:s,targetName:i,stream:ut.CANCEL_COMPLETE,streamId:e,reason:Mt(c)})}),a.sinkCapability.reject(l),a.isCancelled=!0,delete this.streamSinks[e];break;default:throw new Error("Unexpected stream case")}}async#a(t,e){await Promise.allSettled([t.startCall?.promise,t.pullCall?.promise,t.cancelCall?.promise]),delete this.streamControllers[e]}destroy(){this.#t?.abort(),this.#t=null}}class br{#t=!1;constructor({enableHWA:t=!1}){this.#t=t}create(t,e){if(t<=0||e<=0)throw new Error("Invalid canvas size");const s=this._createCanvas(t,e);return{canvas:s,context:s.getContext("2d",{willReadFrequently:!this.#t})}}reset(t,e,s){if(!t.canvas)throw new Error("Canvas is not specified");if(e<=0||s<=0)throw new Error("Invalid canvas size");t.canvas.width=e,t.canvas.height=s}destroy(t){if(!t.canvas)throw new Error("Canvas is not specified");t.canvas.width=0,t.canvas.height=0,t.canvas=null,t.context=null}_createCanvas(t,e){J("Abstract method `_createCanvas` called.")}}class al extends br{constructor({ownerDocument:t=globalThis.document,enableHWA:e=!1}){super({enableHWA:e}),this._document=t}_createCanvas(t,e){const s=this._document.createElement("canvas");return s.width=t,s.height=e,s}}class yr{constructor({baseUrl:t=null,isCompressed:e=!0}){this.baseUrl=t,this.isCompressed=e}async fetch({name:t}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!t)throw new Error("CMap name must be specified.");const e=this.baseUrl+t+(this.isCompressed?".bcmap":"");return this._fetch(e).then(s=>({cMapData:s,isCompressed:this.isCompressed})).catch(s=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${e}`)})}async _fetch(t){J("Abstract method `_fetch` called.")}}class un extends yr{async _fetch(t){const e=await He(t,this.isCompressed?"arraybuffer":"text");return e instanceof ArrayBuffer?new Uint8Array(e):ls(e)}}class wr{addFilter(t){return"none"}addHCMFilter(t,e){return"none"}addAlphaFilter(t){return"none"}addLuminosityFilter(t){return"none"}addHighlightHCMFilter(t,e,s,i,n){return"none"}destroy(t=!1){}}class ol extends wr{#t;#e;#i;#s;#a;#n;#r=0;constructor({docId:t,ownerDocument:e=globalThis.document}){super(),this.#s=t,this.#a=e}get#o(){return this.#e||=new Map}get#c(){return this.#n||=new Map}get#l(){if(!this.#i){const t=this.#a.createElement("div"),{style:e}=t;e.visibility="hidden",e.contain="strict",e.width=e.height=0,e.position="absolute",e.top=e.left=0,e.zIndex=-1;const s=this.#a.createElementNS(te,"svg");s.setAttribute("width",0),s.setAttribute("height",0),this.#i=this.#a.createElementNS(te,"defs"),t.append(s),s.append(this.#i),this.#a.body.append(t)}return this.#i}#u(t){if(t.length===1){const l=t[0],c=new Array(256);for(let d=0;d<256;d++)c[d]=l[d]/255;const h=c.join(",");return[h,h,h]}const[e,s,i]=t,n=new Array(256),r=new Array(256),a=new Array(256);for(let l=0;l<256;l++)n[l]=e[l]/255,r[l]=s[l]/255,a[l]=i[l]/255;return[n.join(","),r.join(","),a.join(",")]}#d(t){if(this.#t===void 0){this.#t="";const e=this.#a.URL;e!==this.#a.baseURI&&(hs(e)?B('#createUrl: ignore "data:"-URL for performance reasons.'):this.#t=Ti(e,""))}return`url(${this.#t}#${t})`}addFilter(t){if(!t)return"none";let e=this.#o.get(t);if(e)return e;const[s,i,n]=this.#u(t),r=t.length===1?s:`${s}${i}${n}`;if(e=this.#o.get(r),e)return this.#o.set(t,e),e;const a=`g_${this.#s}_transfer_map_${this.#r++}`,l=this.#d(a);this.#o.set(t,l),this.#o.set(r,l);const c=this.#f(a);return this.#g(s,i,n,c),l}addHCMFilter(t,e){const s=`${t}-${e}`,i="base";let n=this.#c.get(i);if(n?.key===s||(n?(n.filter?.remove(),n.key=s,n.url="none",n.filter=null):(n={key:s,url:"none",filter:null},this.#c.set(i,n)),!t||!e))return n.url;const r=this.#w(t);t=D.makeHexColor(...r);const a=this.#w(e);if(e=D.makeHexColor(...a),this.#l.style.color="",t==="#000000"&&e==="#ffffff"||t===e)return n.url;const l=new Array(256);for(let f=0;f<=255;f++){const m=f/255;l[f]=m<=.03928?m/12.92:((m+.055)/1.055)**2.4}const c=l.join(","),h=`g_${this.#s}_hcm_filter`,d=n.filter=this.#f(h);this.#g(c,c,c,d),this.#m(d);const u=(f,m)=>{const g=r[f]/255,y=a[f]/255,b=new Array(m+1);for(let x=0;x<=m;x++)b[x]=g+x/m*(y-g);return b.join(",")};return this.#g(u(0,5),u(1,5),u(2,5),d),n.url=this.#d(h),n.url}addAlphaFilter(t){let e=this.#o.get(t);if(e)return e;const[s]=this.#u([t]),i=`alpha_${s}`;if(e=this.#o.get(i),e)return this.#o.set(t,e),e;const n=`g_${this.#s}_alpha_map_${this.#r++}`,r=this.#d(n);this.#o.set(t,r),this.#o.set(i,r);const a=this.#f(n);return this.#b(s,a),r}addLuminosityFilter(t){let e=this.#o.get(t||"luminosity");if(e)return e;let s,i;if(t?([s]=this.#u([t]),i=`luminosity_${s}`):i="luminosity",e=this.#o.get(i),e)return this.#o.set(t,e),e;const n=`g_${this.#s}_luminosity_map_${this.#r++}`,r=this.#d(n);this.#o.set(t,r),this.#o.set(i,r);const a=this.#f(n);return this.#p(a),t&&this.#b(s,a),r}addHighlightHCMFilter(t,e,s,i,n){const r=`${e}-${s}-${i}-${n}`;let a=this.#c.get(t);if(a?.key===r||(a?(a.filter?.remove(),a.key=r,a.url="none",a.filter=null):(a={key:r,url:"none",filter:null},this.#c.set(t,a)),!e||!s))return a.url;const[l,c]=[e,s].map(this.#w.bind(this));let h=Math.round(.2126*l[0]+.7152*l[1]+.0722*l[2]),d=Math.round(.2126*c[0]+.7152*c[1]+.0722*c[2]),[u,f]=[i,n].map(this.#w.bind(this));d<h&&([h,d,u,f]=[d,h,f,u]),this.#l.style.color="";const m=(b,x,w)=>{const A=new Array(256),v=(d-h)/w,k=b/255,S=(x-b)/(255*w);let _=0;for(let E=0;E<=w;E++){const T=Math.round(h+E*v),L=k+E*S;for(let G=_;G<=T;G++)A[G]=L;_=T+1}for(let E=_;E<256;E++)A[E]=A[_-1];return A.join(",")},g=`g_${this.#s}_hcm_${t}_filter`,y=a.filter=this.#f(g);return this.#m(y),this.#g(m(u[0],f[0],5),m(u[1],f[1],5),m(u[2],f[2],5),y),a.url=this.#d(g),a.url}destroy(t=!1){t&&this.#n?.size||(this.#i?.parentNode.parentNode.remove(),this.#i=null,this.#e?.clear(),this.#e=null,this.#n?.clear(),this.#n=null,this.#r=0)}#p(t){const e=this.#a.createElementNS(te,"feColorMatrix");e.setAttribute("type","matrix"),e.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(e)}#m(t){const e=this.#a.createElementNS(te,"feColorMatrix");e.setAttribute("type","matrix"),e.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(e)}#f(t){const e=this.#a.createElementNS(te,"filter");return e.setAttribute("color-interpolation-filters","sRGB"),e.setAttribute("id",t),this.#l.append(e),e}#h(t,e,s){const i=this.#a.createElementNS(te,e);i.setAttribute("type","discrete"),i.setAttribute("tableValues",s),t.append(i)}#g(t,e,s,i){const n=this.#a.createElementNS(te,"feComponentTransfer");i.append(n),this.#h(n,"feFuncR",t),this.#h(n,"feFuncG",e),this.#h(n,"feFuncB",s)}#b(t,e){const s=this.#a.createElementNS(te,"feComponentTransfer");e.append(s),this.#h(s,"feFuncA",t)}#w(t){return this.#l.style.color=t,Ue(getComputedStyle(this.#l).getPropertyValue("color"))}}class xr{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!t)throw new Error("Font filename must be specified.");const e=`${this.baseUrl}${t}`;return this._fetch(e).catch(s=>{throw new Error(`Unable to load font data at: ${e}`)})}async _fetch(t){J("Abstract method `_fetch` called.")}}class pn extends xr{async _fetch(t){const e=await He(t,"arraybuffer");return new Uint8Array(e)}}class vr{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error("Ensure that the `wasmUrl` API parameter is provided.");if(!t)throw new Error("Wasm filename must be specified.");const e=`${this.baseUrl}${t}`;return this._fetch(e).catch(s=>{throw new Error(`Unable to load wasm data at: ${e}`)})}async _fetch(t){J("Abstract method `_fetch` called.")}}class fn extends vr{async _fetch(t){const e=await He(t,"arraybuffer");return new Uint8Array(e)}}Ct&&B("Please use the `legacy` build in Node.js environments.");async function Fi(o){const e=await process.getBuiltinModule("fs").promises.readFile(o);return new Uint8Array(e)}class ll extends wr{}class cl extends br{_createCanvas(t,e){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(t,e)}}class hl extends yr{async _fetch(t){return Fi(t)}}class dl extends xr{async _fetch(t){return Fi(t)}}class ul extends vr{async _fetch(t){return Fi(t)}}const Se="__forcedDependency",{floor:gn,ceil:mn}=Math;function Ss(o,t,e,s,i,n){o[t*4+0]=Math.min(o[t*4+0],e),o[t*4+1]=Math.min(o[t*4+1],s),o[t*4+2]=Math.max(o[t*4+2],i),o[t*4+3]=Math.max(o[t*4+3],n)}const bi=new Uint32Array(new Uint8Array([255,255,0,0]).buffer)[0];class pl{#t;#e;constructor(t,e){this.#t=t,this.#e=e}get length(){return this.#t.length}isEmpty(t){return this.#t[t]===bi}minX(t){return this.#e[t*4+0]/256}minY(t){return this.#e[t*4+1]/256}maxX(t){return(this.#e[t*4+2]+1)/256}maxY(t){return(this.#e[t*4+3]+1)/256}}const _s=(o,t)=>{if(!o)return;let e=o.get(t);return e||(e={dependencies:new Set,isRenderingOperation:!1},o.set(t,e)),e};class fl{#t={__proto__:null};#e={__proto__:null,transform:[],moveText:[],sameLineText:[],[Se]:[]};#i=new Map;#s=[];#a=[];#n=[[1,0,0,1,0,0]];#r=[-1/0,-1/0,1/0,1/0];#o=new Float64Array([1/0,1/0,-1/0,-1/0]);#c=-1;#l=new Set;#u=new Map;#d=new Map;#p;#m;#f;#h;#g;constructor(t,e,s=!1){this.#p=t.width,this.#m=t.height,this.#b(e),s&&(this.#g=new Map)}growOperationsCount(t){t>=this.#h.length&&this.#b(t,this.#h)}#b(t,e){const s=new ArrayBuffer(t*4);this.#f=new Uint8ClampedArray(s),this.#h=new Uint32Array(s),e&&e.length>0?(this.#h.set(e),this.#h.fill(bi,e.length)):this.#h.fill(bi)}save(t){return this.#t={__proto__:this.#t},this.#e={__proto__:this.#e,transform:{__proto__:this.#e.transform},moveText:{__proto__:this.#e.moveText},sameLineText:{__proto__:this.#e.sameLineText},[Se]:{__proto__:this.#e[Se]}},this.#r={__proto__:this.#r},this.#s.push(t),this}restore(t){const e=Object.getPrototypeOf(this.#t);if(e===null)return this;this.#t=e,this.#e=Object.getPrototypeOf(this.#e),this.#r=Object.getPrototypeOf(this.#r);const s=this.#s.pop();return s!==void 0&&(_s(this.#g,t)?.dependencies.add(s),this.#h[t]=this.#h[s]),this}recordOpenMarker(t){return this.#s.push(t),this}getOpenMarker(){return this.#s.length===0?null:this.#s.at(-1)}recordCloseMarker(t){const e=this.#s.pop();return e!==void 0&&(_s(this.#g,t)?.dependencies.add(e),this.#h[t]=this.#h[e]),this}beginMarkedContent(t){return this.#a.push(t),this}endMarkedContent(t){const e=this.#a.pop();return e!==void 0&&(_s(this.#g,t)?.dependencies.add(e),this.#h[t]=this.#h[e]),this}pushBaseTransform(t){return this.#n.push(D.multiplyByDOMMatrix(this.#n.at(-1),t.getTransform())),this}popBaseTransform(){return this.#n.length>1&&this.#n.pop(),this}recordSimpleData(t,e){return this.#t[t]=e,this}recordIncrementalData(t,e){return this.#e[t].push(e),this}resetIncrementalData(t,e){return this.#e[t].length=0,this}recordNamedData(t,e){return this.#i.set(t,e),this}recordSimpleDataFromNamed(t,e,s){this.#t[t]=this.#i.get(e)??s}recordFutureForcedDependency(t,e){return this.recordIncrementalData(Se,e),this}inheritSimpleDataAsFutureForcedDependencies(t){for(const e of t)e in this.#t&&this.recordFutureForcedDependency(e,this.#t[e]);return this}inheritPendingDependenciesAsFutureForcedDependencies(){for(const t of this.#l)this.recordFutureForcedDependency(Se,t);return this}resetBBox(t){return this.#c!==t&&(this.#c=t,this.#o[0]=1/0,this.#o[1]=1/0,this.#o[2]=-1/0,this.#o[3]=-1/0),this}recordClipBox(t,e,s,i,n,r){const a=D.multiplyByDOMMatrix(this.#n.at(-1),e.getTransform()),l=[1/0,1/0,-1/0,-1/0];D.axialAlignedBoundingBox([s,n,i,r],a,l);const c=D.intersect(this.#r,l);return c?(this.#r[0]=c[0],this.#r[1]=c[1],this.#r[2]=c[2],this.#r[3]=c[3]):(this.#r[0]=this.#r[1]=1/0,this.#r[2]=this.#r[3]=-1/0),this}recordBBox(t,e,s,i,n,r){const a=this.#r;if(a[0]===1/0)return this;const l=D.multiplyByDOMMatrix(this.#n.at(-1),e.getTransform());if(a[0]===-1/0)return D.axialAlignedBoundingBox([s,n,i,r],l,this.#o),this;const c=[1/0,1/0,-1/0,-1/0];return D.axialAlignedBoundingBox([s,n,i,r],l,c),this.#o[0]=Math.min(this.#o[0],Math.max(c[0],a[0])),this.#o[1]=Math.min(this.#o[1],Math.max(c[1],a[1])),this.#o[2]=Math.max(this.#o[2],Math.min(c[2],a[2])),this.#o[3]=Math.max(this.#o[3],Math.min(c[3],a[3])),this}recordCharacterBBox(t,e,s,i=1,n=0,r=0,a){const l=s.bbox;let c,h;if(l&&(c=l[2]!==l[0]&&l[3]!==l[1]&&this.#d.get(s),c!==!1&&(h=[0,0,0,0],D.axialAlignedBoundingBox(l,s.fontMatrix,h),(i!==1||n!==0||r!==0)&&D.scaleMinMax([i,0,0,-i,n,r],h),c)))return this.recordBBox(t,e,h[0],h[2],h[1],h[3]);if(!a)return this.recordFullPageBBox(t);const d=a();return l&&h&&c===void 0&&(c=h[0]<=n-d.actualBoundingBoxLeft&&h[2]>=n+d.actualBoundingBoxRight&&h[1]<=r-d.actualBoundingBoxAscent&&h[3]>=r+d.actualBoundingBoxDescent,this.#d.set(s,c),c)?this.recordBBox(t,e,h[0],h[2],h[1],h[3]):this.recordBBox(t,e,n-d.actualBoundingBoxLeft,n+d.actualBoundingBoxRight,r-d.actualBoundingBoxAscent,r+d.actualBoundingBoxDescent)}recordFullPageBBox(t){return this.#o[0]=Math.max(0,this.#r[0]),this.#o[1]=Math.max(0,this.#r[1]),this.#o[2]=Math.min(this.#p,this.#r[2]),this.#o[3]=Math.min(this.#m,this.#r[3]),this}getSimpleIndex(t){return this.#t[t]}recordDependencies(t,e){const s=this.#l,i=this.#t,n=this.#e;for(const r of e)r in this.#t?s.add(i[r]):r in n&&n[r].forEach(s.add,s);return this}recordNamedDependency(t,e){return this.#i.has(e)&&this.#l.add(this.#i.get(e)),this}recordOperation(t,e=!1){if(this.recordDependencies(t,[Se]),this.#g){const s=_s(this.#g,t),{dependencies:i}=s;this.#l.forEach(i.add,i),this.#s.forEach(i.add,i),this.#a.forEach(i.add,i),i.delete(t),s.isRenderingOperation=!0}if(this.#c===t){const s=gn(this.#o[0]*256/this.#p),i=gn(this.#o[1]*256/this.#m),n=mn(this.#o[2]*256/this.#p),r=mn(this.#o[3]*256/this.#m);Ss(this.#f,t,s,i,n,r);for(const a of this.#l)a!==t&&Ss(this.#f,a,s,i,n,r);for(const a of this.#s)a!==t&&Ss(this.#f,a,s,i,n,r);for(const a of this.#a)a!==t&&Ss(this.#f,a,s,i,n,r);e||(this.#l.clear(),this.#c=-1)}return this}recordShowTextOperation(t,e=!1){const s=Array.from(this.#l);this.recordOperation(t,e),this.recordIncrementalData("sameLineText",t);for(const i of s)this.recordIncrementalData("sameLineText",i);return this}bboxToClipBoxDropOperation(t,e=!1){return this.#c===t&&(this.#c=-1,this.#r[0]=Math.max(this.#r[0],this.#o[0]),this.#r[1]=Math.max(this.#r[1],this.#o[1]),this.#r[2]=Math.min(this.#r[2],this.#o[2]),this.#r[3]=Math.min(this.#r[3],this.#o[3]),e||this.#l.clear()),this}_takePendingDependencies(){const t=this.#l;return this.#l=new Set,t}_extractOperation(t){const e=this.#u.get(t);return this.#u.delete(t),e}_pushPendingDependencies(t){for(const e of t)this.#l.add(e)}take(){return this.#d.clear(),new pl(this.#h,this.#f)}takeDebugMetadata(){return this.#g}}class js{#t;#e;#i;#s=0;#a=0;constructor(t,e,s){if(t instanceof js&&t.#i===!!s)return t;this.#t=t,this.#e=e,this.#i=!!s}growOperationsCount(){throw new Error("Unreachable")}save(t){return this.#a++,this.#t.save(this.#e),this}restore(t){return this.#a>0&&(this.#t.restore(this.#e),this.#a--),this}recordOpenMarker(t){return this.#s++,this}getOpenMarker(){return this.#s>0?this.#e:this.#t.getOpenMarker()}recordCloseMarker(t){return this.#s--,this}beginMarkedContent(t){return this}endMarkedContent(t){return this}pushBaseTransform(t){return this.#t.pushBaseTransform(t),this}popBaseTransform(){return this.#t.popBaseTransform(),this}recordSimpleData(t,e){return this.#t.recordSimpleData(t,this.#e),this}recordIncrementalData(t,e){return this.#t.recordIncrementalData(t,this.#e),this}resetIncrementalData(t,e){return this.#t.resetIncrementalData(t,this.#e),this}recordNamedData(t,e){return this}recordSimpleDataFromNamed(t,e,s){return this.#t.recordSimpleDataFromNamed(t,e,this.#e),this}recordFutureForcedDependency(t,e){return this.#t.recordFutureForcedDependency(t,this.#e),this}inheritSimpleDataAsFutureForcedDependencies(t){return this.#t.inheritSimpleDataAsFutureForcedDependencies(t),this}inheritPendingDependenciesAsFutureForcedDependencies(){return this.#t.inheritPendingDependenciesAsFutureForcedDependencies(),this}resetBBox(t){return this.#i||this.#t.resetBBox(this.#e),this}recordClipBox(t,e,s,i,n,r){return this.#i||this.#t.recordClipBox(this.#e,e,s,i,n,r),this}recordBBox(t,e,s,i,n,r){return this.#i||this.#t.recordBBox(this.#e,e,s,i,n,r),this}recordCharacterBBox(t,e,s,i,n,r,a){return this.#i||this.#t.recordCharacterBBox(this.#e,e,s,i,n,r,a),this}recordFullPageBBox(t){return this.#i||this.#t.recordFullPageBBox(this.#e),this}getSimpleIndex(t){return this.#t.getSimpleIndex(t)}recordDependencies(t,e){return this.#t.recordDependencies(this.#e,e),this}recordNamedDependency(t,e){return this.#t.recordNamedDependency(this.#e,e),this}recordOperation(t){return this.#t.recordOperation(this.#e,!0),this}recordShowTextOperation(t){return this.#t.recordShowTextOperation(this.#e,!0),this}bboxToClipBoxDropOperation(t){return this.#i||this.#t.bboxToClipBoxDropOperation(this.#e,!0),this}take(){throw new Error("Unreachable")}takeDebugMetadata(){throw new Error("Unreachable")}}const Bt={stroke:["path","transform","filter","strokeColor","strokeAlpha","lineWidth","lineCap","lineJoin","miterLimit","dash"],fill:["path","transform","filter","fillColor","fillAlpha","globalCompositeOperation","SMask"],imageXObject:["transform","SMask","filter","fillAlpha","strokeAlpha","globalCompositeOperation"],rawFillPath:["filter","fillColor","fillAlpha"],showText:["transform","leading","charSpacing","wordSpacing","hScale","textRise","moveText","textMatrix","font","fontObj","filter","fillColor","textRenderingMode","SMask","fillAlpha","strokeAlpha","globalCompositeOperation","sameLineText"],transform:["transform"],transformAndFill:["transform","fillColor"]},wt={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function yi(o,t){if(!t)return;const e=t[2]-t[0],s=t[3]-t[1],i=new Path2D;i.rect(t[0],t[1],e,s),o.clip(i)}class Oi{isModifyingCurrentTransform(){return!1}getPattern(){J("Abstract method `getPattern` called.")}}class gl extends Oi{constructor(t){super(),this._type=t[1],this._bbox=t[2],this._colorStops=t[3],this._p0=t[4],this._p1=t[5],this._r0=t[6],this._r1=t[7],this.matrix=null}_createGradient(t){let e;this._type==="axial"?e=t.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(e=t.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const s of this._colorStops)e.addColorStop(s[0],s[1]);return e}getPattern(t,e,s,i){let n;if(i===wt.STROKE||i===wt.FILL){const r=e.current.getClippedPathBoundingBox(i,at(t))||[0,0,0,0],a=Math.ceil(r[2]-r[0])||1,l=Math.ceil(r[3]-r[1])||1,c=e.cachedCanvases.getCanvas("pattern",a,l),h=c.context;h.clearRect(0,0,h.canvas.width,h.canvas.height),h.beginPath(),h.rect(0,0,h.canvas.width,h.canvas.height),h.translate(-r[0],-r[1]),s=D.transform(s,[1,0,0,1,r[0],r[1]]),h.transform(...e.baseTransform),this.matrix&&h.transform(...this.matrix),yi(h,this._bbox),h.fillStyle=this._createGradient(h),h.fill(),n=t.createPattern(c.canvas,"no-repeat");const d=new DOMMatrix(s);n.setTransform(d)}else yi(t,this._bbox),n=this._createGradient(t);return n}}function ai(o,t,e,s,i,n,r,a){const l=t.coords,c=t.colors,h=o.data,d=o.width*4;let u;l[e+1]>l[s+1]&&(u=e,e=s,s=u,u=n,n=r,r=u),l[s+1]>l[i+1]&&(u=s,s=i,i=u,u=r,r=a,a=u),l[e+1]>l[s+1]&&(u=e,e=s,s=u,u=n,n=r,r=u);const f=(l[e]+t.offsetX)*t.scaleX,m=(l[e+1]+t.offsetY)*t.scaleY,g=(l[s]+t.offsetX)*t.scaleX,y=(l[s+1]+t.offsetY)*t.scaleY,b=(l[i]+t.offsetX)*t.scaleX,x=(l[i+1]+t.offsetY)*t.scaleY;if(m>=x)return;const w=c[n],A=c[n+1],v=c[n+2],k=c[r],S=c[r+1],_=c[r+2],E=c[a],T=c[a+1],L=c[a+2],G=Math.round(m),H=Math.round(x);let O,$,M,R,U,nt,kt,Ot;for(let tt=G;tt<=H;tt++){if(tt<y){const Z=tt<m?0:(m-tt)/(m-y);O=f-(f-g)*Z,$=w-(w-k)*Z,M=A-(A-S)*Z,R=v-(v-_)*Z}else{let Z;tt>x?Z=1:y===x?Z=0:Z=(y-tt)/(y-x),O=g-(g-b)*Z,$=k-(k-E)*Z,M=S-(S-T)*Z,R=_-(_-L)*Z}let X;tt<m?X=0:tt>x?X=1:X=(m-tt)/(m-x),U=f-(f-b)*X,nt=w-(w-E)*X,kt=A-(A-T)*X,Ot=v-(v-L)*X;const St=Math.round(Math.min(O,U)),Lt=Math.round(Math.max(O,U));let _t=d*tt+St*4;for(let Z=St;Z<=Lt;Z++)X=(O-Z)/(O-U),X<0?X=0:X>1&&(X=1),h[_t++]=$-($-nt)*X|0,h[_t++]=M-(M-kt)*X|0,h[_t++]=R-(R-Ot)*X|0,h[_t++]=255}}function ml(o,t,e){const s=t.coords,i=t.colors;let n,r;switch(t.type){case"lattice":const a=t.verticesPerRow,l=Math.floor(s.length/a)-1,c=a-1;for(n=0;n<l;n++){let h=n*a;for(let d=0;d<c;d++,h++)ai(o,e,s[h],s[h+1],s[h+a],i[h],i[h+1],i[h+a]),ai(o,e,s[h+a+1],s[h+1],s[h+a],i[h+a+1],i[h+1],i[h+a])}break;case"triangles":for(n=0,r=s.length;n<r;n+=3)ai(o,e,s[n],s[n+1],s[n+2],i[n],i[n+1],i[n+2]);break;default:throw new Error("illegal figure")}}class bl extends Oi{constructor(t){super(),this._coords=t[2],this._colors=t[3],this._figures=t[4],this._bounds=t[5],this._bbox=t[6],this._background=t[7],this.matrix=null}_createMeshCanvas(t,e,s){const a=Math.floor(this._bounds[0]),l=Math.floor(this._bounds[1]),c=Math.ceil(this._bounds[2])-a,h=Math.ceil(this._bounds[3])-l,d=Math.min(Math.ceil(Math.abs(c*t[0]*1.1)),3e3),u=Math.min(Math.ceil(Math.abs(h*t[1]*1.1)),3e3),f=c/d,m=h/u,g={coords:this._coords,colors:this._colors,offsetX:-a,offsetY:-l,scaleX:1/f,scaleY:1/m},y=d+4,b=u+4,x=s.getCanvas("mesh",y,b),w=x.context,A=w.createImageData(d,u);if(e){const k=A.data;for(let S=0,_=k.length;S<_;S+=4)k[S]=e[0],k[S+1]=e[1],k[S+2]=e[2],k[S+3]=255}for(const k of this._figures)ml(A,k,g);return w.putImageData(A,2,2),{canvas:x.canvas,offsetX:a-2*f,offsetY:l-2*m,scaleX:f,scaleY:m}}isModifyingCurrentTransform(){return!0}getPattern(t,e,s,i){yi(t,this._bbox);const n=new Float32Array(2);if(i===wt.SHADING)D.singularValueDecompose2dScale(at(t),n);else if(this.matrix){D.singularValueDecompose2dScale(this.matrix,n);const[a,l]=n;D.singularValueDecompose2dScale(e.baseTransform,n),n[0]*=a,n[1]*=l}else D.singularValueDecompose2dScale(e.baseTransform,n);const r=this._createMeshCanvas(n,i===wt.SHADING?null:this._background,e.cachedCanvases);return i!==wt.SHADING&&(t.setTransform(...e.baseTransform),this.matrix&&t.transform(...this.matrix)),t.translate(r.offsetX,r.offsetY),t.scale(r.scaleX,r.scaleY),t.createPattern(r.canvas,"no-repeat")}}class yl extends Oi{getPattern(){return"hotpink"}}function wl(o){switch(o[0]){case"RadialAxial":return new gl(o);case"Mesh":return new bl(o);case"Dummy":return new yl}throw new Error(`Unknown IR type: ${o[0]}`)}const bn={COLORED:1,UNCOLORED:2};class ji{static MAX_PATTERN_SIZE=3e3;constructor(t,e,s,i){this.color=t[1],this.operatorList=t[2],this.matrix=t[3],this.bbox=t[4],this.xstep=t[5],this.ystep=t[6],this.paintType=t[7],this.tilingType=t[8],this.ctx=e,this.canvasGraphicsFactory=s,this.baseTransform=i}createPatternCanvas(t,e){const{bbox:s,operatorList:i,paintType:n,tilingType:r,color:a,canvasGraphicsFactory:l}=this;let{xstep:c,ystep:h}=this;c=Math.abs(c),h=Math.abs(h),Us("TilingType: "+r);const d=s[0],u=s[1],f=s[2],m=s[3],g=f-d,y=m-u,b=new Float32Array(2);D.singularValueDecompose2dScale(this.matrix,b);const[x,w]=b;D.singularValueDecompose2dScale(this.baseTransform,b);const A=x*b[0],v=w*b[1];let k=g,S=y,_=!1,E=!1;const T=Math.ceil(c*A),L=Math.ceil(h*v),G=Math.ceil(g*A),H=Math.ceil(y*v);T>=G?k=c:_=!0,L>=H?S=h:E=!0;const O=this.getSizeAndScale(k,this.ctx.canvas.width,A),$=this.getSizeAndScale(S,this.ctx.canvas.height,v),M=t.cachedCanvases.getCanvas("pattern",O.size,$.size),R=M.context,U=l.createCanvasGraphics(R,e);if(U.groupLevel=t.groupLevel,this.setFillAndStrokeStyleToContext(U,n,a),R.translate(-O.scale*d,-$.scale*u),U.transform(0,O.scale,0,0,$.scale,0,0),R.save(),U.dependencyTracker?.save(),this.clipBbox(U,d,u,f,m),U.baseTransform=at(U.ctx),U.executeOperatorList(i),U.endDrawing(),U.dependencyTracker?.restore(),R.restore(),_||E){const nt=M.canvas;_&&(k=c),E&&(S=h);const kt=this.getSizeAndScale(k,this.ctx.canvas.width,A),Ot=this.getSizeAndScale(S,this.ctx.canvas.height,v),tt=kt.size,X=Ot.size,St=t.cachedCanvases.getCanvas("pattern-workaround",tt,X),Lt=St.context,_t=_?Math.floor(g/c):0,Z=E?Math.floor(y/h):0;for(let Gt=0;Gt<=_t;Gt++)for(let Et=0;Et<=Z;Et++)Lt.drawImage(nt,tt*Gt,X*Et,tt,X,0,0,tt,X);return{canvas:St.canvas,scaleX:kt.scale,scaleY:Ot.scale,offsetX:d,offsetY:u}}return{canvas:M.canvas,scaleX:O.scale,scaleY:$.scale,offsetX:d,offsetY:u}}getSizeAndScale(t,e,s){const i=Math.max(ji.MAX_PATTERN_SIZE,e);let n=Math.ceil(t*s);return n>=i?n=i:s=n/t,{scale:s,size:n}}clipBbox(t,e,s,i,n){const r=i-e,a=n-s;t.ctx.rect(e,s,r,a),D.axialAlignedBoundingBox([e,s,i,n],at(t.ctx),t.current.minMax),t.clip(),t.endPath()}setFillAndStrokeStyleToContext(t,e,s){const i=t.ctx,n=t.current;switch(e){case bn.COLORED:const{fillStyle:r,strokeStyle:a}=this.ctx;i.fillStyle=n.fillColor=r,i.strokeStyle=n.strokeColor=a;break;case bn.UNCOLORED:i.fillStyle=i.strokeStyle=s,n.fillColor=n.strokeColor=s;break;default:throw new Ho(`Unsupported paint type: ${e}`)}}isModifyingCurrentTransform(){return!1}getPattern(t,e,s,i,n){let r=s;i!==wt.SHADING&&(r=D.transform(r,e.baseTransform),this.matrix&&(r=D.transform(r,this.matrix)));const a=this.createPatternCanvas(e,n);let l=new DOMMatrix(r);l=l.translate(a.offsetX,a.offsetY),l=l.scale(1/a.scaleX,1/a.scaleY);const c=t.createPattern(a.canvas,"repeat");return c.setTransform(l),c}}function xl({src:o,srcPos:t=0,dest:e,width:s,height:i,nonBlackColor:n=4294967295,inverseDecode:r=!1}){const a=bt.isLittleEndian?4278190080:255,[l,c]=r?[n,a]:[a,n],h=s>>3,d=s&7,u=o.length;e=new Uint32Array(e.buffer);let f=0;for(let m=0;m<i;m++){for(const y=t+h;t<y;t++){const b=t<u?o[t]:255;e[f++]=b&128?c:l,e[f++]=b&64?c:l,e[f++]=b&32?c:l,e[f++]=b&16?c:l,e[f++]=b&8?c:l,e[f++]=b&4?c:l,e[f++]=b&2?c:l,e[f++]=b&1?c:l}if(d===0)continue;const g=t<u?o[t++]:255;for(let y=0;y<d;y++)e[f++]=g&1<<7-y?c:l}return{srcPos:t,destPos:f}}const yn=16,wn=100,vl=15,xn=10,Rt=16,oi=new DOMMatrix,It=new Float32Array(2),Le=new Float32Array([1/0,1/0,-1/0,-1/0]);function Al(o,t){if(o._removeMirroring)throw new Error("Context is already forwarding operations.");o.__originalSave=o.save,o.__originalRestore=o.restore,o.__originalRotate=o.rotate,o.__originalScale=o.scale,o.__originalTranslate=o.translate,o.__originalTransform=o.transform,o.__originalSetTransform=o.setTransform,o.__originalResetTransform=o.resetTransform,o.__originalClip=o.clip,o.__originalMoveTo=o.moveTo,o.__originalLineTo=o.lineTo,o.__originalBezierCurveTo=o.bezierCurveTo,o.__originalRect=o.rect,o.__originalClosePath=o.closePath,o.__originalBeginPath=o.beginPath,o._removeMirroring=()=>{o.save=o.__originalSave,o.restore=o.__originalRestore,o.rotate=o.__originalRotate,o.scale=o.__originalScale,o.translate=o.__originalTranslate,o.transform=o.__originalTransform,o.setTransform=o.__originalSetTransform,o.resetTransform=o.__originalResetTransform,o.clip=o.__originalClip,o.moveTo=o.__originalMoveTo,o.lineTo=o.__originalLineTo,o.bezierCurveTo=o.__originalBezierCurveTo,o.rect=o.__originalRect,o.closePath=o.__originalClosePath,o.beginPath=o.__originalBeginPath,delete o._removeMirroring},o.save=function(){t.save(),this.__originalSave()},o.restore=function(){t.restore(),this.__originalRestore()},o.translate=function(e,s){t.translate(e,s),this.__originalTranslate(e,s)},o.scale=function(e,s){t.scale(e,s),this.__originalScale(e,s)},o.transform=function(e,s,i,n,r,a){t.transform(e,s,i,n,r,a),this.__originalTransform(e,s,i,n,r,a)},o.setTransform=function(e,s,i,n,r,a){t.setTransform(e,s,i,n,r,a),this.__originalSetTransform(e,s,i,n,r,a)},o.resetTransform=function(){t.resetTransform(),this.__originalResetTransform()},o.rotate=function(e){t.rotate(e),this.__originalRotate(e)},o.clip=function(e){t.clip(e),this.__originalClip(e)},o.moveTo=function(e,s){t.moveTo(e,s),this.__originalMoveTo(e,s)},o.lineTo=function(e,s){t.lineTo(e,s),this.__originalLineTo(e,s)},o.bezierCurveTo=function(e,s,i,n,r,a){t.bezierCurveTo(e,s,i,n,r,a),this.__originalBezierCurveTo(e,s,i,n,r,a)},o.rect=function(e,s,i,n){t.rect(e,s,i,n),this.__originalRect(e,s,i,n)},o.closePath=function(){t.closePath(),this.__originalClosePath()},o.beginPath=function(){t.beginPath(),this.__originalBeginPath()}}class kl{constructor(t){this.canvasFactory=t,this.cache=Object.create(null)}getCanvas(t,e,s){let i;return this.cache[t]!==void 0?(i=this.cache[t],this.canvasFactory.reset(i,e,s)):(i=this.canvasFactory.create(e,s),this.cache[t]=i),i}delete(t){delete this.cache[t]}clear(){for(const t in this.cache){const e=this.cache[t];this.canvasFactory.destroy(e),delete this.cache[t]}}}function Es(o,t,e,s,i,n,r,a,l,c){const[h,d,u,f,m,g]=at(o);if(d===0&&u===0){const x=r*h+m,w=Math.round(x),A=a*f+g,v=Math.round(A),k=(r+l)*h+m,S=Math.abs(Math.round(k)-w)||1,_=(a+c)*f+g,E=Math.abs(Math.round(_)-v)||1;return o.setTransform(Math.sign(h),0,0,Math.sign(f),w,v),o.drawImage(t,e,s,i,n,0,0,S,E),o.setTransform(h,d,u,f,m,g),[S,E]}if(h===0&&f===0){const x=a*u+m,w=Math.round(x),A=r*d+g,v=Math.round(A),k=(a+c)*u+m,S=Math.abs(Math.round(k)-w)||1,_=(r+l)*d+g,E=Math.abs(Math.round(_)-v)||1;return o.setTransform(0,Math.sign(d),Math.sign(u),0,w,v),o.drawImage(t,e,s,i,n,0,0,E,S),o.setTransform(h,d,u,f,m,g),[E,S]}o.drawImage(t,e,s,i,n,r,a,l,c);const y=Math.hypot(h,d),b=Math.hypot(u,f);return[y*l,b*c]}class vn{alphaIsShape=!1;fontSize=0;fontSizeScale=1;textMatrix=null;textMatrixScale=1;fontMatrix=pi;leading=0;x=0;y=0;lineX=0;lineY=0;charSpacing=0;wordSpacing=0;textHScale=1;textRenderingMode=yt.FILL;textRise=0;fillColor="#000000";strokeColor="#000000";patternFill=!1;patternStroke=!1;fillAlpha=1;strokeAlpha=1;lineWidth=1;activeSMask=null;transferMaps="none";constructor(t,e,s){s?.(this),this.clipBox=new Float32Array([0,0,t,e]),this.minMax=Le.slice()}clone(){const t=Object.create(this);return t.clipBox=this.clipBox.slice(),t.minMax=this.minMax.slice(),t}getPathBoundingBox(t=wt.FILL,e=null){const s=this.minMax.slice();if(t===wt.STROKE){e||J("Stroke bounding box must include transform."),D.singularValueDecompose2dScale(e,It);const i=It[0]*this.lineWidth/2,n=It[1]*this.lineWidth/2;s[0]-=i,s[1]-=n,s[2]+=i,s[3]+=n}return s}updateClipFromPath(){const t=D.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(t||[0,0,0,0])}isEmptyClip(){return this.minMax[0]===1/0}startNewPathAndClipBox(t){this.clipBox.set(t,0),this.minMax.set(Le,0)}getClippedPathBoundingBox(t=wt.FILL,e=null){return D.intersect(this.clipBox,this.getPathBoundingBox(t,e))}}function An(o,t){if(t instanceof ImageData){o.putImageData(t,0,0);return}const e=t.height,s=t.width,i=e%Rt,n=(e-i)/Rt,r=i===0?n:n+1,a=o.createImageData(s,Rt);let l=0,c;const h=t.data,d=a.data;let u,f,m,g;if(t.kind===Je.GRAYSCALE_1BPP){const y=h.byteLength,b=new Uint32Array(d.buffer,0,d.byteLength>>2),x=b.length,w=s+7>>3,A=4294967295,v=bt.isLittleEndian?4278190080:255;for(u=0;u<r;u++){for(m=u<n?Rt:i,c=0,f=0;f<m;f++){const k=y-l;let S=0;const _=k>w?s:k*8-7,E=_&-8;let T=0,L=0;for(;S<E;S+=8)L=h[l++],b[c++]=L&128?A:v,b[c++]=L&64?A:v,b[c++]=L&32?A:v,b[c++]=L&16?A:v,b[c++]=L&8?A:v,b[c++]=L&4?A:v,b[c++]=L&2?A:v,b[c++]=L&1?A:v;for(;S<_;S++)T===0&&(L=h[l++],T=128),b[c++]=L&T?A:v,T>>=1}for(;c<x;)b[c++]=0;o.putImageData(a,0,u*Rt)}}else if(t.kind===Je.RGBA_32BPP){for(f=0,g=s*Rt*4,u=0;u<n;u++)d.set(h.subarray(l,l+g)),l+=g,o.putImageData(a,0,f),f+=Rt;u<r&&(g=s*i*4,d.set(h.subarray(l,l+g)),o.putImageData(a,0,f))}else if(t.kind===Je.RGB_24BPP)for(m=Rt,g=s*m,u=0;u<r;u++){for(u>=n&&(m=i,g=s*m),c=0,f=g;f--;)d[c++]=h[l++],d[c++]=h[l++],d[c++]=h[l++],d[c++]=255;o.putImageData(a,0,u*Rt)}else throw new Error(`bad image kind: ${t.kind}`)}function kn(o,t){if(t.bitmap){o.drawImage(t.bitmap,0,0);return}const e=t.height,s=t.width,i=e%Rt,n=(e-i)/Rt,r=i===0?n:n+1,a=o.createImageData(s,Rt);let l=0;const c=t.data,h=a.data;for(let d=0;d<r;d++){const u=d<n?Rt:i;({srcPos:l}=xl({src:c,srcPos:l,dest:h,width:s,height:u,nonBlackColor:0})),o.putImageData(a,0,d*Rt)}}function $e(o,t){const e=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const s of e)o[s]!==void 0&&(t[s]=o[s]);o.setLineDash!==void 0&&(t.setLineDash(o.getLineDash()),t.lineDashOffset=o.lineDashOffset)}function Cs(o){o.strokeStyle=o.fillStyle="#000000",o.fillRule="nonzero",o.globalAlpha=1,o.lineWidth=1,o.lineCap="butt",o.lineJoin="miter",o.miterLimit=10,o.globalCompositeOperation="source-over",o.font="10px sans-serif",o.setLineDash!==void 0&&(o.setLineDash([]),o.lineDashOffset=0);const{filter:t}=o;t!=="none"&&t!==""&&(o.filter="none")}function Sn(o,t){if(t)return!0;D.singularValueDecompose2dScale(o,It);const e=Math.fround(zt.pixelRatio*be.PDF_TO_CSS_UNITS);return It[0]<=e&&It[1]<=e}const Sl=["butt","round","square"],_l=["miter","round","bevel"],El={},_n={};class Me{constructor(t,e,s,i,n,{optionalContentConfig:r,markedContentStack:a=null},l,c,h){this.ctx=t,this.current=new vn(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=e,this.objs=s,this.canvasFactory=i,this.filterFactory=n,this.groupStack=[],this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=a||[],this.optionalContentConfig=r,this.cachedCanvases=new kl(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=l,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=c,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map,this.dependencyTracker=h??null}getObject(t,e,s=null){return typeof e=="string"?(this.dependencyTracker?.recordNamedDependency(t,e),e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e)):s}beginDrawing({transform:t,viewport:e,transparency:s=!1,background:i=null}){const n=this.ctx.canvas.width,r=this.ctx.canvas.height,a=this.ctx.fillStyle;if(this.ctx.fillStyle=i||"#ffffff",this.ctx.fillRect(0,0,n,r),this.ctx.fillStyle=a,s){const l=this.cachedCanvases.getCanvas("transparent",n,r);this.compositeCtx=this.ctx,this.transparentCanvas=l.canvas,this.ctx=l.context,this.ctx.save(),this.ctx.transform(...at(this.compositeCtx))}this.ctx.save(),Cs(this.ctx),t&&(this.ctx.transform(...t),this.outputScaleX=t[0],this.outputScaleY=t[0]),this.ctx.transform(...e.transform),this.viewportScale=e.scale,this.baseTransform=at(this.ctx)}executeOperatorList(t,e,s,i,n){const r=t.argsArray,a=t.fnArray;let l=e||0;const c=r.length;if(c===l)return l;const h=c-l>xn&&typeof s=="function",d=h?Date.now()+vl:0;let u=0;const f=this.commonObjs,m=this.objs;let g,y;for(;;){if(i!==void 0&&l===i.nextBreakPoint)return i.breakIt(l,s),l;if(!n||n(l))if(g=a[l],y=r[l]??null,g!==Oe.dependency)y===null?this[g](l):this[g](l,...y);else for(const b of y){this.dependencyTracker?.recordNamedData(b,l);const x=b.startsWith("g_")?f:m;if(!x.has(b))return x.get(b,s),l}if(l++,l===c)return l;if(h&&++u>xn){if(Date.now()>d)return s(),l;u=0}}}#t(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#t(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const t of this._cachedBitmapsMap.values()){for(const e of t.values())typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&(e.width=e.height=0);t.clear()}this._cachedBitmapsMap.clear(),this.#e()}#e(){if(this.pageColors){const t=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(t!=="none"){const e=this.ctx.filter;this.ctx.filter=t,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=e}}}_scaleImage(t,e){const s=t.width??t.displayWidth,i=t.height??t.displayHeight;let n=Math.max(Math.hypot(e[0],e[1]),1),r=Math.max(Math.hypot(e[2],e[3]),1),a=s,l=i,c="prescale1",h,d;for(;n>2&&a>1||r>2&&l>1;){let u=a,f=l;n>2&&a>1&&(u=a>=16384?Math.floor(a/2)-1||1:Math.ceil(a/2),n/=a/u),r>2&&l>1&&(f=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l)/2,r/=l/f),h=this.cachedCanvases.getCanvas(c,u,f),d=h.context,d.clearRect(0,0,u,f),d.drawImage(t,0,0,a,l,0,0,u,f),t=h.canvas,a=u,l=f,c=c==="prescale1"?"prescale2":"prescale1"}return{img:t,paintWidth:a,paintHeight:l}}_createMaskCanvas(t,e){const s=this.ctx,{width:i,height:n}=e,r=this.current.fillColor,a=this.current.patternFill,l=at(s);let c,h,d,u;if((e.bitmap||e.data)&&e.count>1){const T=e.bitmap||e.data.buffer;h=JSON.stringify(a?l:[l.slice(0,4),r]),c=this._cachedBitmapsMap.get(T),c||(c=new Map,this._cachedBitmapsMap.set(T,c));const L=c.get(h);if(L&&!a){const G=Math.round(Math.min(l[0],l[2])+l[4]),H=Math.round(Math.min(l[1],l[3])+l[5]);return this.dependencyTracker?.recordDependencies(t,Bt.transformAndFill),{canvas:L,offsetX:G,offsetY:H}}d=L}d||(u=this.cachedCanvases.getCanvas("maskCanvas",i,n),kn(u.context,e));let f=D.transform(l,[1/i,0,0,-1/n,0,0]);f=D.transform(f,[1,0,0,1,0,-n]);const m=Le.slice();D.axialAlignedBoundingBox([0,0,i,n],f,m);const[g,y,b,x]=m,w=Math.round(b-g)||1,A=Math.round(x-y)||1,v=this.cachedCanvases.getCanvas("fillCanvas",w,A),k=v.context,S=g,_=y;k.translate(-S,-_),k.transform(...f),d||(d=this._scaleImage(u.canvas,Wt(k)),d=d.img,c&&a&&c.set(h,d)),k.imageSmoothingEnabled=Sn(at(k),e.interpolate),Es(k,d,0,0,d.width,d.height,0,0,i,n),k.globalCompositeOperation="source-in";const E=D.transform(Wt(k),[1,0,0,1,-S,-_]);return k.fillStyle=a?r.getPattern(s,this,E,wt.FILL,t):r,k.fillRect(0,0,i,n),c&&!a&&(this.cachedCanvases.delete("fillCanvas"),c.set(h,v.canvas)),this.dependencyTracker?.recordDependencies(t,Bt.transformAndFill),{canvas:v.canvas,offsetX:Math.round(S),offsetY:Math.round(_)}}setLineWidth(t,e){this.dependencyTracker?.recordSimpleData("lineWidth",t),e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(t,e){this.dependencyTracker?.recordSimpleData("lineCap",t),this.ctx.lineCap=Sl[e]}setLineJoin(t,e){this.dependencyTracker?.recordSimpleData("lineJoin",t),this.ctx.lineJoin=_l[e]}setMiterLimit(t,e){this.dependencyTracker?.recordSimpleData("miterLimit",t),this.ctx.miterLimit=e}setDash(t,e,s){this.dependencyTracker?.recordSimpleData("dash",t);const i=this.ctx;i.setLineDash!==void 0&&(i.setLineDash(e),i.lineDashOffset=s)}setRenderingIntent(t,e){}setFlatness(t,e){}setGState(t,e){for(const[s,i]of e)switch(s){case"LW":this.setLineWidth(t,i);break;case"LC":this.setLineCap(t,i);break;case"LJ":this.setLineJoin(t,i);break;case"ML":this.setMiterLimit(t,i);break;case"D":this.setDash(t,i[0],i[1]);break;case"RI":this.setRenderingIntent(t,i);break;case"FL":this.setFlatness(t,i);break;case"Font":this.setFont(t,i[0],i[1]);break;case"CA":this.dependencyTracker?.recordSimpleData("strokeAlpha",t),this.current.strokeAlpha=i;break;case"ca":this.dependencyTracker?.recordSimpleData("fillAlpha",t),this.ctx.globalAlpha=this.current.fillAlpha=i;break;case"BM":this.dependencyTracker?.recordSimpleData("globalCompositeOperation",t),this.ctx.globalCompositeOperation=i;break;case"SMask":this.dependencyTracker?.recordSimpleData("SMask",t),this.current.activeSMask=i?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.dependencyTracker?.recordSimpleData("filter",t),this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(i);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const t=this.inSMaskMode;this.current.activeSMask&&!t?this.beginSMaskMode():!this.current.activeSMask&&t&&this.endSMaskMode()}beginSMaskMode(t){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const e=this.ctx.canvas.width,s=this.ctx.canvas.height,i="smaskGroupAt"+this.groupLevel,n=this.cachedCanvases.getCanvas(i,e,s);this.suspendedCtx=this.ctx;const r=this.ctx=n.context;r.setTransform(this.suspendedCtx.getTransform()),$e(this.suspendedCtx,r),Al(r,this.suspendedCtx),this.setGState(t,[["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),$e(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(t){if(!this.current.activeSMask)return;t?(t[0]=Math.floor(t[0]),t[1]=Math.floor(t[1]),t[2]=Math.ceil(t[2]),t[3]=Math.ceil(t[3])):t=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const e=this.current.activeSMask,s=this.suspendedCtx;this.composeSMask(s,e,this.ctx,t),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(t,e,s,i){const n=i[0],r=i[1],a=i[2]-n,l=i[3]-r;a===0||l===0||(this.genericComposeSMask(e.context,s,a,l,e.subtype,e.backdrop,e.transferMap,n,r,e.offsetX,e.offsetY),t.save(),t.globalAlpha=1,t.globalCompositeOperation="source-over",t.setTransform(1,0,0,1,0,0),t.drawImage(s.canvas,0,0),t.restore())}genericComposeSMask(t,e,s,i,n,r,a,l,c,h,d){let u=t.canvas,f=l-h,m=c-d;if(r)if(f<0||m<0||f+s>u.width||m+i>u.height){const y=this.cachedCanvases.getCanvas("maskExtension",s,i),b=y.context;b.drawImage(u,-f,-m),b.globalCompositeOperation="destination-atop",b.fillStyle=r,b.fillRect(0,0,s,i),b.globalCompositeOperation="source-over",u=y.canvas,f=m=0}else{t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0);const y=new Path2D;y.rect(f,m,s,i),t.clip(y),t.globalCompositeOperation="destination-atop",t.fillStyle=r,t.fillRect(f,m,s,i),t.restore()}e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0),n==="Alpha"&&a?e.filter=this.filterFactory.addAlphaFilter(a):n==="Luminosity"&&(e.filter=this.filterFactory.addLuminosityFilter(a));const g=new Path2D;g.rect(l,c,s,i),e.clip(g),e.globalCompositeOperation="destination-in",e.drawImage(u,f,m,s,i,l,c,s,i),e.restore()}save(t){this.inSMaskMode&&$e(this.ctx,this.suspendedCtx),this.ctx.save();const e=this.current;this.stateStack.push(e),this.current=e.clone(),this.dependencyTracker?.save(t)}restore(t){if(this.dependencyTracker?.restore(t),this.stateStack.length===0){this.inSMaskMode&&this.endSMaskMode();return}this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&$e(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}transform(t,e,s,i,n,r,a){this.dependencyTracker?.recordIncrementalData("transform",t),this.ctx.transform(e,s,i,n,r,a),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(t,e,s,i){let[n]=s;if(!i){n||=s[0]=new Path2D,this[e](t,n);return}if(this.dependencyTracker!==null){const r=e===Oe.stroke?this.current.lineWidth/2:0;this.dependencyTracker.resetBBox(t).recordBBox(t,this.ctx,i[0]-r,i[2]+r,i[1]-r,i[3]+r).recordDependencies(t,["transform"])}if(!(n instanceof Path2D)){const r=s[0]=new Path2D;for(let a=0,l=n.length;a<l;)switch(n[a++]){case xs.moveTo:r.moveTo(n[a++],n[a++]);break;case xs.lineTo:r.lineTo(n[a++],n[a++]);break;case xs.curveTo:r.bezierCurveTo(n[a++],n[a++],n[a++],n[a++],n[a++],n[a++]);break;case xs.closePath:r.closePath();break;default:B(`Unrecognized drawing path operator: ${n[a-1]}`);break}n=r}D.axialAlignedBoundingBox(i,at(this.ctx),this.current.minMax),this[e](t,n),this._pathStartIdx=t}closePath(t){this.ctx.closePath()}stroke(t,e,s=!0){const i=this.ctx,n=this.current.strokeColor;if(i.globalAlpha=this.current.strokeAlpha,this.contentVisible)if(typeof n=="object"&&n?.getPattern){const r=n.isModifyingCurrentTransform()?i.getTransform():null;if(i.save(),i.strokeStyle=n.getPattern(i,this,Wt(i),wt.STROKE,t),r){const a=new Path2D;a.addPath(e,i.getTransform().invertSelf().multiplySelf(r)),e=a}this.rescaleAndStroke(e,!1),i.restore()}else this.rescaleAndStroke(e,!0);this.dependencyTracker?.recordDependencies(t,Bt.stroke),s&&this.consumePath(t,e,this.current.getClippedPathBoundingBox(wt.STROKE,at(this.ctx))),i.globalAlpha=this.current.fillAlpha}closeStroke(t,e){this.stroke(t,e)}fill(t,e,s=!0){const i=this.ctx,n=this.current.fillColor,r=this.current.patternFill;let a=!1;if(r){const c=n.isModifyingCurrentTransform()?i.getTransform():null;if(this.dependencyTracker?.save(t),i.save(),i.fillStyle=n.getPattern(i,this,Wt(i),wt.FILL,t),c){const h=new Path2D;h.addPath(e,i.getTransform().invertSelf().multiplySelf(c)),e=h}a=!0}const l=this.current.getClippedPathBoundingBox();this.contentVisible&&l!==null&&(this.pendingEOFill?(i.fill(e,"evenodd"),this.pendingEOFill=!1):i.fill(e)),this.dependencyTracker?.recordDependencies(t,Bt.fill),a&&(i.restore(),this.dependencyTracker?.restore(t)),s&&this.consumePath(t,e,l)}eoFill(t,e){this.pendingEOFill=!0,this.fill(t,e)}fillStroke(t,e){this.fill(t,e,!1),this.stroke(t,e,!1),this.consumePath(t,e)}eoFillStroke(t,e){this.pendingEOFill=!0,this.fillStroke(t,e)}closeFillStroke(t,e){this.fillStroke(t,e)}closeEOFillStroke(t,e){this.pendingEOFill=!0,this.fillStroke(t,e)}endPath(t,e){this.consumePath(t,e)}rawFillPath(t,e){this.ctx.fill(e),this.dependencyTracker?.recordDependencies(t,Bt.rawFillPath).recordOperation(t)}clip(t){this.dependencyTracker?.recordFutureForcedDependency("clipMode",t),this.pendingClip=El}eoClip(t){this.dependencyTracker?.recordFutureForcedDependency("clipMode",t),this.pendingClip=_n}beginText(t){this.current.textMatrix=null,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0,this.dependencyTracker?.recordOpenMarker(t).resetIncrementalData("sameLineText").resetIncrementalData("moveText",t)}endText(t){const e=this.pendingTextPaths,s=this.ctx;if(this.dependencyTracker){const{dependencyTracker:i}=this;e!==void 0&&i.recordFutureForcedDependency("textClip",i.getOpenMarker()).recordFutureForcedDependency("textClip",t),i.recordCloseMarker(t)}if(e!==void 0){const i=new Path2D,n=s.getTransform().invertSelf();for(const{transform:r,x:a,y:l,fontSize:c,path:h}of e)h&&i.addPath(h,new DOMMatrix(r).preMultiplySelf(n).translate(a,l).scale(c,-c));s.clip(i)}delete this.pendingTextPaths}setCharSpacing(t,e){this.dependencyTracker?.recordSimpleData("charSpacing",t),this.current.charSpacing=e}setWordSpacing(t,e){this.dependencyTracker?.recordSimpleData("wordSpacing",t),this.current.wordSpacing=e}setHScale(t,e){this.dependencyTracker?.recordSimpleData("hScale",t),this.current.textHScale=e/100}setLeading(t,e){this.dependencyTracker?.recordSimpleData("leading",t),this.current.leading=-e}setFont(t,e,s){this.dependencyTracker?.recordSimpleData("font",t).recordSimpleDataFromNamed("fontObj",e,t);const i=this.commonObjs.get(e),n=this.current;if(!i)throw new Error(`Can't find font for ${e}`);if(n.fontMatrix=i.fontMatrix||pi,(n.fontMatrix[0]===0||n.fontMatrix[3]===0)&&B("Invalid font matrix for font "+e),s<0?(s=-s,n.fontDirection=-1):n.fontDirection=1,this.current.font=i,this.current.fontSize=s,i.isType3Font)return;const r=i.loadedName||"sans-serif",a=i.systemFontInfo?.css||`"${r}", ${i.fallbackName}`;let l="normal";i.black?l="900":i.bold&&(l="bold");const c=i.italic?"italic":"normal";let h=s;s<yn?h=yn:s>wn&&(h=wn),this.current.fontSizeScale=s/h,this.ctx.font=`${c} ${l} ${h}px ${a}`}setTextRenderingMode(t,e){this.dependencyTracker?.recordSimpleData("textRenderingMode",t),this.current.textRenderingMode=e}setTextRise(t,e){this.dependencyTracker?.recordSimpleData("textRise",t),this.current.textRise=e}moveText(t,e,s){this.dependencyTracker?.resetIncrementalData("sameLineText").recordIncrementalData("moveText",t),this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=s}setLeadingMoveText(t,e,s){this.setLeading(t,-s),this.moveText(t,e,s)}setTextMatrix(t,e){this.dependencyTracker?.recordSimpleData("textMatrix",t);const{current:s}=this;s.textMatrix=e,s.textMatrixScale=Math.hypot(e[0],e[1]),s.x=s.lineX=0,s.y=s.lineY=0}nextLine(t){this.moveText(t,0,this.current.leading),this.dependencyTracker?.recordIncrementalData("moveText",this.dependencyTracker.getSimpleIndex("leading")??t)}#i(t,e,s){const i=new Path2D;return i.addPath(t,new DOMMatrix(s).invertSelf().multiplySelf(e)),i}paintChar(t,e,s,i,n,r){const a=this.ctx,l=this.current,c=l.font,h=l.textRenderingMode,d=l.fontSize/l.fontSizeScale,u=h&yt.FILL_STROKE_MASK,f=!!(h&yt.ADD_TO_PATH_FLAG),m=l.patternFill&&!c.missingFile,g=l.patternStroke&&!c.missingFile;let y;if((c.disableFontFace||f||m||g)&&!c.missingFile&&(y=c.getPathGenerator(this.commonObjs,e)),y&&(c.disableFontFace||m||g)){a.save(),a.translate(s,i),a.scale(d,-d),this.dependencyTracker?.recordCharacterBBox(t,a,c);let b;if(u===yt.FILL||u===yt.FILL_STROKE)if(n){b=a.getTransform(),a.setTransform(...n);const x=this.#i(y,b,n);a.fill(x)}else a.fill(y);if(u===yt.STROKE||u===yt.FILL_STROKE)if(r){b||=a.getTransform(),a.setTransform(...r);const{a:x,b:w,c:A,d:v}=b,k=D.inverseTransform(r),S=D.transform([x,w,A,v,0,0],k);D.singularValueDecompose2dScale(S,It),a.lineWidth*=Math.max(It[0],It[1])/d,a.stroke(this.#i(y,b,r))}else a.lineWidth/=d,a.stroke(y);a.restore()}else(u===yt.FILL||u===yt.FILL_STROKE)&&(a.fillText(e,s,i),this.dependencyTracker?.recordCharacterBBox(t,a,c,d,s,i,()=>a.measureText(e))),(u===yt.STROKE||u===yt.FILL_STROKE)&&(this.dependencyTracker&&this.dependencyTracker?.recordCharacterBBox(t,a,c,d,s,i,()=>a.measureText(e)).recordDependencies(t,Bt.stroke),a.strokeText(e,s,i));f&&((this.pendingTextPaths||=[]).push({transform:at(a),x:s,y:i,fontSize:d,path:y}),this.dependencyTracker?.recordCharacterBBox(t,a,c,d,s,i))}get isFontSubpixelAAEnabled(){const{context:t}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);t.scale(1.5,1),t.fillText("I",0,10);const e=t.getImageData(0,0,10,10).data;let s=!1;for(let i=3;i<e.length;i+=4)if(e[i]>0&&e[i]<255){s=!0;break}return z(this,"isFontSubpixelAAEnabled",s)}showText(t,e){this.dependencyTracker&&(this.dependencyTracker.recordDependencies(t,Bt.showText).resetBBox(t),this.current.textRenderingMode&yt.ADD_TO_PATH_FLAG&&this.dependencyTracker.recordFutureForcedDependency("textClip",t).inheritPendingDependenciesAsFutureForcedDependencies());const s=this.current,i=s.font;if(i.isType3Font){this.showType3Text(t,e),this.dependencyTracker?.recordShowTextOperation(t);return}const n=s.fontSize;if(n===0){this.dependencyTracker?.recordOperation(t);return}const r=this.ctx,a=s.fontSizeScale,l=s.charSpacing,c=s.wordSpacing,h=s.fontDirection,d=s.textHScale*h,u=e.length,f=i.vertical,m=f?1:-1,g=i.defaultVMetrics,y=n*s.fontMatrix[0],b=s.textRenderingMode===yt.FILL&&!i.disableFontFace&&!s.patternFill;r.save(),s.textMatrix&&r.transform(...s.textMatrix),r.translate(s.x,s.y+s.textRise),h>0?r.scale(d,-1):r.scale(d,1);let x,w;if(s.patternFill){r.save();const _=s.fillColor.getPattern(r,this,Wt(r),wt.FILL,t);x=at(r),r.restore(),r.fillStyle=_}if(s.patternStroke){r.save();const _=s.strokeColor.getPattern(r,this,Wt(r),wt.STROKE,t);w=at(r),r.restore(),r.strokeStyle=_}let A=s.lineWidth;const v=s.textMatrixScale;if(v===0||A===0){const _=s.textRenderingMode&yt.FILL_STROKE_MASK;(_===yt.STROKE||_===yt.FILL_STROKE)&&(A=this.getSinglePixelWidth())}else A/=v;if(a!==1&&(r.scale(a,a),A/=a),r.lineWidth=A,i.isInvalidPDFjsFont){const _=[];let E=0;for(const L of e)_.push(L.unicode),E+=L.width;const T=_.join("");if(r.fillText(T,0,0),this.dependencyTracker!==null){const L=r.measureText(T);this.dependencyTracker.recordBBox(t,this.ctx,-L.actualBoundingBoxLeft,L.actualBoundingBoxRight,-L.actualBoundingBoxAscent,L.actualBoundingBoxDescent).recordShowTextOperation(t)}s.x+=E*y*d,r.restore(),this.compose();return}let k=0,S;for(S=0;S<u;++S){const _=e[S];if(typeof _=="number"){k+=m*_*n/1e3;continue}let E=!1;const T=(_.isSpace?c:0)+l,L=_.fontChar,G=_.accent;let H,O,$=_.width;if(f){const U=_.vmetric||g,nt=-(_.vmetric?U[1]:$*.5)*y,kt=U[2]*y;$=U?-U[0]:$,H=nt/a,O=(k+kt)/a}else H=k/a,O=0;let M;if(i.remeasure&&$>0){M=r.measureText(L);const U=M.width*1e3/n*a;if($<U&&this.isFontSubpixelAAEnabled){const nt=$/U;E=!0,r.save(),r.scale(nt,1),H/=nt}else $!==U&&(H+=($-U)/2e3*n/a)}if(this.contentVisible&&(_.isInFont||i.missingFile)){if(b&&!G)r.fillText(L,H,O),this.dependencyTracker?.recordCharacterBBox(t,r,M?{bbox:null}:i,n/a,H,O,()=>M??r.measureText(L));else if(this.paintChar(t,L,H,O,x,w),G){const U=H+n*G.offset.x/a,nt=O-n*G.offset.y/a;this.paintChar(t,G.fontChar,U,nt,x,w)}}const R=f?$*y-T*h:$*y+T*h;k+=R,E&&r.restore()}f?s.y-=k:s.x+=k*d,r.restore(),this.compose(),this.dependencyTracker?.recordShowTextOperation(t)}showType3Text(t,e){const s=this.ctx,i=this.current,n=i.font,r=i.fontSize,a=i.fontDirection,l=n.vertical?1:-1,c=i.charSpacing,h=i.wordSpacing,d=i.textHScale*a,u=i.fontMatrix||pi,f=e.length,m=i.textRenderingMode===yt.INVISIBLE;let g,y,b,x;if(m||r===0)return;this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,s.save(),i.textMatrix&&s.transform(...i.textMatrix),s.translate(i.x,i.y+i.textRise),s.scale(d,a);const w=this.dependencyTracker;for(this.dependencyTracker=w?new js(w,t):null,g=0;g<f;++g){if(y=e[g],typeof y=="number"){x=l*y*r/1e3,this.ctx.translate(x,0),i.x+=x*d;continue}const A=(y.isSpace?h:0)+c,v=n.charProcOperatorList[y.operatorListId];v?this.contentVisible&&(this.save(),s.scale(r,r),s.transform(...u),this.executeOperatorList(v),this.restore()):B(`Type3 character "${y.operatorListId}" is not available.`);const k=[y.width,0];D.applyTransform(k,u),b=k[0]*r+A,s.translate(b,0),i.x+=b*d}s.restore(),w&&(this.dependencyTracker=w)}setCharWidth(t,e,s){}setCharWidthAndBounds(t,e,s,i,n,r,a){const l=new Path2D;l.rect(i,n,r-i,a-n),this.ctx.clip(l),this.dependencyTracker?.recordBBox(t,this.ctx,i,r,n,a).recordClipBox(t,this.ctx,i,r,n,a),this.endPath(t)}getColorN_Pattern(t,e){let s;if(e[0]==="TilingPattern"){const i=this.baseTransform||at(this.ctx),n={createCanvasGraphics:(r,a)=>new Me(r,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack},void 0,void 0,this.dependencyTracker?new js(this.dependencyTracker,a,!0):null)};s=new ji(e,this.ctx,n,i)}else s=this._getPattern(t,e[1],e[2]);return s}setStrokeColorN(t,...e){this.dependencyTracker?.recordSimpleData("strokeColor",t),this.current.strokeColor=this.getColorN_Pattern(t,e),this.current.patternStroke=!0}setFillColorN(t,...e){this.dependencyTracker?.recordSimpleData("fillColor",t),this.current.fillColor=this.getColorN_Pattern(t,e),this.current.patternFill=!0}setStrokeRGBColor(t,e){this.dependencyTracker?.recordSimpleData("strokeColor",t),this.ctx.strokeStyle=this.current.strokeColor=e,this.current.patternStroke=!1}setStrokeTransparent(t){this.dependencyTracker?.recordSimpleData("strokeColor",t),this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(t,e){this.dependencyTracker?.recordSimpleData("fillColor",t),this.ctx.fillStyle=this.current.fillColor=e,this.current.patternFill=!1}setFillTransparent(t){this.dependencyTracker?.recordSimpleData("fillColor",t),this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(t,e,s=null){let i;return this.cachedPatterns.has(e)?i=this.cachedPatterns.get(e):(i=wl(this.getObject(t,e)),this.cachedPatterns.set(e,i)),s&&(i.matrix=s),i}shadingFill(t,e){if(!this.contentVisible)return;const s=this.ctx;this.save(t);const i=this._getPattern(t,e);s.fillStyle=i.getPattern(s,this,Wt(s),wt.SHADING,t);const n=Wt(s);if(n){const{width:r,height:a}=s.canvas,l=Le.slice();D.axialAlignedBoundingBox([0,0,r,a],n,l);const[c,h,d,u]=l;this.ctx.fillRect(c,h,d-c,u-h)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.dependencyTracker?.resetBBox(t).recordFullPageBBox(t).recordDependencies(t,Bt.transform).recordDependencies(t,Bt.fill).recordOperation(t),this.compose(this.current.getClippedPathBoundingBox()),this.restore(t)}beginInlineImage(){J("Should not call beginInlineImage")}beginImageData(){J("Should not call beginImageData")}paintFormXObjectBegin(t,e,s){if(this.contentVisible&&(this.save(t),this.baseTransformStack.push(this.baseTransform),e&&this.transform(t,...e),this.baseTransform=at(this.ctx),s)){D.axialAlignedBoundingBox(s,this.baseTransform,this.current.minMax);const[i,n,r,a]=s,l=new Path2D;l.rect(i,n,r-i,a-n),this.ctx.clip(l),this.dependencyTracker?.recordClipBox(t,this.ctx,i,r,n,a),this.endPath(t)}}paintFormXObjectEnd(t){this.contentVisible&&(this.restore(t),this.baseTransform=this.baseTransformStack.pop())}beginGroup(t,e){if(!this.contentVisible)return;this.save(t),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const s=this.ctx;e.isolated||Us("TODO: Support non-isolated groups."),e.knockout&&B("Knockout groups not supported.");const i=at(s);if(e.matrix&&s.transform(...e.matrix),!e.bbox)throw new Error("Bounding box is required.");let n=Le.slice();D.axialAlignedBoundingBox(e.bbox,at(s),n);const r=[0,0,s.canvas.width,s.canvas.height];n=D.intersect(n,r)||[0,0,0,0];const a=Math.floor(n[0]),l=Math.floor(n[1]),c=Math.max(Math.ceil(n[2])-a,1),h=Math.max(Math.ceil(n[3])-l,1);this.current.startNewPathAndClipBox([0,0,c,h]);let d="groupAt"+this.groupLevel;e.smask&&(d+="_smask_"+this.smaskCounter++%2);const u=this.cachedCanvases.getCanvas(d,c,h),f=u.context;f.translate(-a,-l),f.transform(...i);let m=new Path2D;const[g,y,b,x]=e.bbox;if(m.rect(g,y,b-g,x-y),e.matrix){const w=new Path2D;w.addPath(m,new DOMMatrix(e.matrix)),m=w}f.clip(m),e.smask&&this.smaskStack.push({canvas:u.canvas,context:f,offsetX:a,offsetY:l,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}),(!e.smask||this.dependencyTracker)&&(s.setTransform(1,0,0,1,0,0),s.translate(a,l),s.save()),$e(s,f),this.ctx=f,this.dependencyTracker?.inheritSimpleDataAsFutureForcedDependencies(["fillAlpha","strokeAlpha","globalCompositeOperation"]).pushBaseTransform(s),this.setGState(t,[["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(s),this.groupLevel++}endGroup(t,e){if(!this.contentVisible)return;this.groupLevel--;const s=this.ctx,i=this.groupStack.pop();if(this.ctx=i,this.ctx.imageSmoothingEnabled=!1,this.dependencyTracker?.popBaseTransform(),e.smask)this.tempSMask=this.smaskStack.pop(),this.restore(t),this.dependencyTracker&&this.ctx.restore();else{this.ctx.restore();const n=at(this.ctx);this.restore(t),this.ctx.save(),this.ctx.setTransform(...n);const r=Le.slice();D.axialAlignedBoundingBox([0,0,s.canvas.width,s.canvas.height],n,r),this.ctx.drawImage(s.canvas,0,0),this.ctx.restore(),this.compose(r)}}beginAnnotation(t,e,s,i,n,r){if(this.#t(),Cs(this.ctx),this.ctx.save(),this.save(t),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),s){const a=s[2]-s[0],l=s[3]-s[1];if(r&&this.annotationCanvasMap){i=i.slice(),i[4]-=s[0],i[5]-=s[1],s=s.slice(),s[0]=s[1]=0,s[2]=a,s[3]=l,D.singularValueDecompose2dScale(at(this.ctx),It);const{viewportScale:c}=this,h=Math.ceil(a*this.outputScaleX*c),d=Math.ceil(l*this.outputScaleY*c);this.annotationCanvas=this.canvasFactory.create(h,d);const{canvas:u,context:f}=this.annotationCanvas;this.annotationCanvasMap.set(e,u),this.annotationCanvas.savedCtx=this.ctx,this.ctx=f,this.ctx.save(),this.ctx.setTransform(It[0],0,0,-It[1],0,l*It[1]),Cs(this.ctx)}else{Cs(this.ctx),this.endPath(t);const c=new Path2D;c.rect(s[0],s[1],a,l),this.ctx.clip(c)}}this.current=new vn(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(t,...i),this.transform(t,...n)}endAnnotation(t){this.annotationCanvas&&(this.ctx.restore(),this.#e(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(t,e){if(!this.contentVisible)return;const s=e.count;e=this.getObject(t,e.data,e),e.count=s;const i=this.ctx,n=this._createMaskCanvas(t,e),r=n.canvas;i.save(),i.setTransform(1,0,0,1,0,0),i.drawImage(r,n.offsetX,n.offsetY),this.dependencyTracker?.resetBBox(t).recordBBox(t,this.ctx,n.offsetX,n.offsetX+r.width,n.offsetY,n.offsetY+r.height).recordOperation(t),i.restore(),this.compose()}paintImageMaskXObjectRepeat(t,e,s,i=0,n=0,r,a){if(!this.contentVisible)return;e=this.getObject(t,e.data,e);const l=this.ctx;l.save();const c=at(l);l.transform(s,i,n,r,0,0);const h=this._createMaskCanvas(t,e);l.setTransform(1,0,0,1,h.offsetX-c[4],h.offsetY-c[5]),this.dependencyTracker?.resetBBox(t);for(let d=0,u=a.length;d<u;d+=2){const f=D.transform(c,[s,i,n,r,a[d],a[d+1]]);l.drawImage(h.canvas,f[4],f[5]),this.dependencyTracker?.recordBBox(t,this.ctx,f[4],f[4]+h.canvas.width,f[5],f[5]+h.canvas.height)}l.restore(),this.compose(),this.dependencyTracker?.recordOperation(t)}paintImageMaskXObjectGroup(t,e){if(!this.contentVisible)return;const s=this.ctx,i=this.current.fillColor,n=this.current.patternFill;this.dependencyTracker?.resetBBox(t).recordDependencies(t,Bt.transformAndFill);for(const r of e){const{data:a,width:l,height:c,transform:h}=r,d=this.cachedCanvases.getCanvas("maskCanvas",l,c),u=d.context;u.save();const f=this.getObject(t,a,r);kn(u,f),u.globalCompositeOperation="source-in",u.fillStyle=n?i.getPattern(u,this,Wt(s),wt.FILL,t):i,u.fillRect(0,0,l,c),u.restore(),s.save(),s.transform(...h),s.scale(1,-1),Es(s,d.canvas,0,0,l,c,0,-1,1,1),this.dependencyTracker?.recordBBox(t,s,0,l,0,c),s.restore()}this.compose(),this.dependencyTracker?.recordOperation(t)}paintImageXObject(t,e){if(!this.contentVisible)return;const s=this.getObject(t,e);if(!s){B("Dependent image isn't ready yet");return}this.paintInlineImageXObject(t,s)}paintImageXObjectRepeat(t,e,s,i,n){if(!this.contentVisible)return;const r=this.getObject(t,e);if(!r){B("Dependent image isn't ready yet");return}const a=r.width,l=r.height,c=[];for(let h=0,d=n.length;h<d;h+=2)c.push({transform:[s,0,0,i,n[h],n[h+1]],x:0,y:0,w:a,h:l});this.paintInlineImageXObjectGroup(t,r,c)}applyTransferMapsToCanvas(t){return this.current.transferMaps!=="none"&&(t.filter=this.current.transferMaps,t.drawImage(t.canvas,0,0),t.filter="none"),t.canvas}applyTransferMapsToBitmap(t){if(this.current.transferMaps==="none")return t.bitmap;const{bitmap:e,width:s,height:i}=t,n=this.cachedCanvases.getCanvas("inlineImage",s,i),r=n.context;return r.filter=this.current.transferMaps,r.drawImage(e,0,0),r.filter="none",n.canvas}paintInlineImageXObject(t,e){if(!this.contentVisible)return;const s=e.width,i=e.height,n=this.ctx;this.save(t);const{filter:r}=n;r!=="none"&&r!==""&&(n.filter="none"),n.scale(1/s,-1/i);let a;if(e.bitmap)a=this.applyTransferMapsToBitmap(e);else if(typeof HTMLElement=="function"&&e instanceof HTMLElement||!e.data)a=e;else{const h=this.cachedCanvases.getCanvas("inlineImage",s,i).context;An(h,e),a=this.applyTransferMapsToCanvas(h)}const l=this._scaleImage(a,Wt(n));n.imageSmoothingEnabled=Sn(at(n),e.interpolate),this.dependencyTracker?.resetBBox(t).recordBBox(t,n,0,s,-i,0).recordDependencies(t,Bt.imageXObject).recordOperation(t),Es(n,l.img,0,0,l.paintWidth,l.paintHeight,0,-i,s,i),this.compose(),this.restore(t)}paintInlineImageXObjectGroup(t,e,s){if(!this.contentVisible)return;const i=this.ctx;let n;if(e.bitmap)n=e.bitmap;else{const r=e.width,a=e.height,c=this.cachedCanvases.getCanvas("inlineImage",r,a).context;An(c,e),n=this.applyTransferMapsToCanvas(c)}this.dependencyTracker?.resetBBox(t);for(const r of s)i.save(),i.transform(...r.transform),i.scale(1,-1),Es(i,n,r.x,r.y,r.w,r.h,0,-1,1,1),this.dependencyTracker?.recordBBox(t,i,0,1,-1,0),i.restore();this.dependencyTracker?.recordOperation(t),this.compose()}paintSolidColorImageMask(t){this.contentVisible&&(this.dependencyTracker?.resetBBox(t).recordBBox(t,this.ctx,0,1,0,1).recordDependencies(t,Bt.fill).recordOperation(t),this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(t,e){}markPointProps(t,e,s){}beginMarkedContent(t,e){this.dependencyTracker?.beginMarkedContent(t),this.markedContentStack.push({visible:!0})}beginMarkedContentProps(t,e,s){this.dependencyTracker?.beginMarkedContent(t),e==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(s)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(t){this.dependencyTracker?.endMarkedContent(t),this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(t){}endCompat(t){}consumePath(t,e,s){const i=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(s);const n=this.ctx;this.pendingClip?(i||(this.pendingClip===_n?n.clip(e,"evenodd"):n.clip(e)),this.pendingClip=null,this.dependencyTracker?.bboxToClipBoxDropOperation(t).recordFutureForcedDependency("clipPath",t)):this.dependencyTracker?.recordOperation(t),this.current.startNewPathAndClipBox(this.current.clipBox)}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const t=at(this.ctx);if(t[1]===0&&t[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(t[0]),Math.abs(t[3]));else{const e=Math.abs(t[0]*t[3]-t[2]*t[1]),s=Math.hypot(t[0],t[2]),i=Math.hypot(t[1],t[3]);this._cachedGetSinglePixelWidth=Math.max(s,i)/e}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:t}=this.current,{a:e,b:s,c:i,d:n}=this.ctx.getTransform();let r,a;if(s===0&&i===0){const l=Math.abs(e),c=Math.abs(n);if(l===c)if(t===0)r=a=1/l;else{const h=l*t;r=a=h<1?1/h:1}else if(t===0)r=1/l,a=1/c;else{const h=l*t,d=c*t;r=h<1?1/h:1,a=d<1?1/d:1}}else{const l=Math.abs(e*n-s*i),c=Math.hypot(e,s),h=Math.hypot(i,n);if(t===0)r=h/l,a=c/l;else{const d=t*l;r=h>d?h/d:1,a=c>d?c/d:1}}this._cachedScaleForStroking[0]=r,this._cachedScaleForStroking[1]=a}return this._cachedScaleForStroking}rescaleAndStroke(t,e){const{ctx:s,current:{lineWidth:i}}=this,[n,r]=this.getScaleForStroking();if(n===r){s.lineWidth=(i||1)*n,s.stroke(t);return}const a=s.getLineDash();e&&s.save(),s.scale(n,r),oi.a=1/n,oi.d=1/r;const l=new Path2D;if(l.addPath(t,oi),a.length>0){const c=Math.max(n,r);s.setLineDash(a.map(h=>h/c)),s.lineDashOffset/=c}s.lineWidth=i||1,s.stroke(l),e&&s.restore()}isContentVisible(){for(let t=this.markedContentStack.length-1;t>=0;t--)if(!this.markedContentStack[t].visible)return!1;return!0}}for(const o in Oe)Me.prototype[o]!==void 0&&(Me.prototype[Oe[o]]=Me.prototype[o]);class Re{#t;#e;#i;static strings=["fontFamily","fontWeight","italicAngle"];static write(t){const e=new TextEncoder,s={};let i=0;for(const c of Re.strings){const h=e.encode(t[c]);s[c]=h,i+=4+h.length}const n=new ArrayBuffer(i),r=new Uint8Array(n),a=new DataView(n);let l=0;for(const c of Re.strings){const h=s[c],d=h.length;a.setUint32(l,d),r.set(h,l+4),l+=4+d}return W(l===n.byteLength,"CssFontInfo.write: Buffer overflow"),n}constructor(t){this.#t=t,this.#e=new DataView(this.#t),this.#i=new TextDecoder}#s(t){W(t<Re.strings.length,"Invalid string index");let e=0;for(let i=0;i<t;i++)e+=this.#e.getUint32(e)+4;const s=this.#e.getUint32(e);return this.#i.decode(new Uint8Array(this.#t,e+4,s))}get fontFamily(){return this.#s(0)}get fontWeight(){return this.#s(1)}get italicAngle(){return this.#s(2)}}class Ne{#t;#e;#i;static strings=["css","loadedName","baseFontName","src"];static write(t){const e=new TextEncoder,s={};let i=0;for(const u of Ne.strings){const f=e.encode(t[u]);s[u]=f,i+=4+f.length}i+=4;let n,r,a=1+i;t.style&&(n=e.encode(t.style.style),r=e.encode(t.style.weight),a+=4+n.length+4+r.length);const l=new ArrayBuffer(a),c=new Uint8Array(l),h=new DataView(l);let d=0;h.setUint8(d++,t.guessFallback?1:0),h.setUint32(d,0),d+=4,i=0;for(const u of Ne.strings){const f=s[u],m=f.length;i+=4+m,h.setUint32(d,m),c.set(f,d+4),d+=4+m}return h.setUint32(d-i-4,i),t.style&&(h.setUint32(d,n.length),c.set(n,d+4),d+=4+n.length,h.setUint32(d,r.length),c.set(r,d+4),d+=4+r.length),W(d<=l.byteLength,"SubstitionInfo.write: Buffer overflow"),l.transferToFixedLength(d)}constructor(t){this.#t=t,this.#e=new DataView(this.#t),this.#i=new TextDecoder}get guessFallback(){return this.#e.getUint8(0)!==0}#s(t){W(t<Ne.strings.length,"Invalid string index");let e=5;for(let i=0;i<t;i++)e+=this.#e.getUint32(e)+4;const s=this.#e.getUint32(e);return this.#i.decode(new Uint8Array(this.#t,e+4,s))}get css(){return this.#s(0)}get loadedName(){return this.#s(1)}get baseFontName(){return this.#s(2)}get src(){return this.#s(3)}get style(){let t=1;t+=4+this.#e.getUint32(t);const e=this.#e.getUint32(t),s=this.#i.decode(new Uint8Array(this.#t,t+4,e));t+=4+e;const i=this.#e.getUint32(t),n=this.#i.decode(new Uint8Array(this.#t,t+4,i));return{style:s,weight:n}}}class K{static bools=["black","bold","disableFontFace","fontExtraProperties","isInvalidPDFjsFont","isType3Font","italic","missingFile","remeasure","vertical"];static numbers=["ascent","defaultWidth","descent"];static strings=["fallbackName","loadedName","mimetype","name"];static#t=Math.ceil(this.bools.length*2/8);static#e=this.#t+this.numbers.length*8;static#i=this.#e+1+8;static#s=this.#i+1+48;static#a=this.#s+1+6;#n;#r;#o;constructor({data:t,extra:e}){this.#n=t,this.#r=new TextDecoder,this.#o=new DataView(this.#n),e&&Object.assign(this,e)}#c(t){W(t<K.bools.length,"Invalid boolean index");const e=Math.floor(t/4),s=t*2%8,i=this.#o.getUint8(e)>>s&3;return i===0?void 0:i===2}get black(){return this.#c(0)}get bold(){return this.#c(1)}get disableFontFace(){return this.#c(2)}get fontExtraProperties(){return this.#c(3)}get isInvalidPDFjsFont(){return this.#c(4)}get isType3Font(){return this.#c(5)}get italic(){return this.#c(6)}get missingFile(){return this.#c(7)}get remeasure(){return this.#c(8)}get vertical(){return this.#c(9)}#l(t){return W(t<K.numbers.length,"Invalid number index"),this.#o.getFloat64(K.#t+t*8)}get ascent(){return this.#l(0)}get defaultWidth(){return this.#l(1)}get descent(){return this.#l(2)}get bbox(){let t=K.#e;if(this.#o.getUint8(t)===0)return;t+=1;const s=[];for(let i=0;i<4;i++)s.push(this.#o.getInt16(t,!0)),t+=2;return s}get fontMatrix(){let t=K.#i;if(this.#o.getUint8(t)===0)return;t+=1;const s=[];for(let i=0;i<6;i++)s.push(this.#o.getFloat64(t,!0)),t+=8;return s}get defaultVMetrics(){let t=K.#s;if(this.#o.getUint8(t)===0)return;t+=1;const s=[];for(let i=0;i<3;i++)s.push(this.#o.getInt16(t,!0)),t+=2;return s}#u(t){W(t<K.strings.length,"Invalid string index");let e=K.#a+4;for(let n=0;n<t;n++)e+=this.#o.getUint32(e)+4;const s=this.#o.getUint32(e),i=new Uint8Array(s);return i.set(new Uint8Array(this.#n,e+4,s)),this.#r.decode(i)}get fallbackName(){return this.#u(0)}get loadedName(){return this.#u(1)}get mimetype(){return this.#u(2)}get name(){return this.#u(3)}get data(){let t=K.#a;const e=this.#o.getUint32(t);t+=4+e;const s=this.#o.getUint32(t);t+=4+s;const i=this.#o.getUint32(t);t+=4+i;const n=this.#o.getUint32(t);if(n!==0)return new Uint8Array(this.#n,t+4,n)}clearData(){let t=K.#a;const e=this.#o.getUint32(t);t+=4+e;const s=this.#o.getUint32(t);t+=4+s;const i=this.#o.getUint32(t);t+=4+i;const n=this.#o.getUint32(t);new Uint8Array(this.#n,t+4,n).fill(0),this.#o.setUint32(t,0)}get cssFontInfo(){let t=K.#a;const e=this.#o.getUint32(t);t+=4+e;const s=this.#o.getUint32(t);t+=4+s;const i=this.#o.getUint32(t);if(i===0)return null;const n=new Uint8Array(i);return n.set(new Uint8Array(this.#n,t+4,i)),new Re(n.buffer)}get systemFontInfo(){let t=K.#a;const e=this.#o.getUint32(t);t+=4+e;const s=this.#o.getUint32(t);if(s===0)return null;const i=new Uint8Array(s);return i.set(new Uint8Array(this.#n,t+4,s)),new Ne(i.buffer)}static write(t){const e=t.systemFontInfo?Ne.write(t.systemFontInfo):null,s=t.cssFontInfo?Re.write(t.cssFontInfo):null,i=new TextEncoder,n={};let r=0;for(const g of K.strings)n[g]=i.encode(t[g]),r+=4+n[g].length;const a=K.#a+4+r+4+(e?e.byteLength:0)+4+(s?s.byteLength:0)+4+(t.data?t.data.length:0),l=new ArrayBuffer(a),c=new Uint8Array(l),h=new DataView(l);let d=0;const u=K.bools.length;let f=0,m=0;for(let g=0;g<u;g++){const y=t[K.bools[g]];f|=(y===void 0?0:y?2:1)<<m,m+=2,(m===8||g===u-1)&&(h.setUint8(d++,f),f=0,m=0)}W(d===K.#t,"FontInfo.write: Boolean properties offset mismatch");for(const g of K.numbers)h.setFloat64(d,t[g]),d+=8;if(W(d===K.#e,"FontInfo.write: Number properties offset mismatch"),t.bbox){h.setUint8(d++,4);for(const g of t.bbox)h.setInt16(d,g,!0),d+=2}else h.setUint8(d++,0),d+=8;if(W(d===K.#i,"FontInfo.write: BBox properties offset mismatch"),t.fontMatrix){h.setUint8(d++,6);for(const g of t.fontMatrix)h.setFloat64(d,g,!0),d+=8}else h.setUint8(d++,0),d+=48;if(W(d===K.#s,"FontInfo.write: FontMatrix properties offset mismatch"),t.defaultVMetrics){h.setUint8(d++,1);for(const g of t.defaultVMetrics)h.setInt16(d,g,!0),d+=2}else h.setUint8(d++,0),d+=6;W(d===K.#a,"FontInfo.write: DefaultVMetrics properties offset mismatch"),h.setUint32(K.#a,0),d+=4;for(const g of K.strings){const y=n[g],b=y.length;h.setUint32(d,b),c.set(y,d+4),d+=4+b}if(h.setUint32(K.#a,d-K.#a-4),!e)h.setUint32(d,0),d+=4;else{const g=e.byteLength;h.setUint32(d,g),W(d+4+g<=l.byteLength,"FontInfo.write: Buffer overflow at systemFontInfo"),c.set(new Uint8Array(e),d+4),d+=4+g}if(!s)h.setUint32(d,0),d+=4;else{const g=s.byteLength;h.setUint32(d,g),W(d+4+g<=l.byteLength,"FontInfo.write: Buffer overflow at cssFontInfo"),c.set(new Uint8Array(s),d+4),d+=4+g}return t.data===void 0?(h.setUint32(d,0),d+=4):(h.setUint32(d,t.data.length),c.set(t.data,d+4),d+=4+t.data.length),W(d<=l.byteLength,"FontInfo.write: Buffer overflow"),l.transferToFixedLength(d)}}class le{static#t=null;static#e="";static get workerPort(){return this.#t}static set workerPort(t){if(!(typeof Worker<"u"&&t instanceof Worker)&&t!==null)throw new Error("Invalid `workerPort` type.");this.#t=t}static get workerSrc(){return this.#e}static set workerSrc(t){if(typeof t!="string")throw new Error("Invalid `workerSrc` type.");this.#e=t}}class Cl{#t;#e;constructor({parsedData:t,rawData:e}){this.#t=t,this.#e=e}getRaw(){return this.#e}get(t){return this.#t.get(t)??null}[Symbol.iterator](){return this.#t.entries()}}const Ce=Symbol("INTERNAL");class Tl{#t=!1;#e=!1;#i=!1;#s=!0;constructor(t,{name:e,intent:s,usage:i,rbGroups:n}){this.#t=!!(t&Nt.DISPLAY),this.#e=!!(t&Nt.PRINT),this.name=e,this.intent=s,this.usage=i,this.rbGroups=n}get visible(){if(this.#i)return this.#s;if(!this.#s)return!1;const{print:t,view:e}=this.usage;return this.#t?e?.viewState!=="OFF":this.#e?t?.printState!=="OFF":!0}_setVisible(t,e,s=!1){t!==Ce&&J("Internal method `_setVisible` called."),this.#i=s,this.#s=e}}class Ll{#t=null;#e=new Map;#i=null;#s=null;constructor(t,e=Nt.DISPLAY){if(this.renderingIntent=e,this.name=null,this.creator=null,t!==null){this.name=t.name,this.creator=t.creator,this.#s=t.order;for(const s of t.groups)this.#e.set(s.id,new Tl(e,s));if(t.baseState==="OFF")for(const s of this.#e.values())s._setVisible(Ce,!1);for(const s of t.on)this.#e.get(s)._setVisible(Ce,!0);for(const s of t.off)this.#e.get(s)._setVisible(Ce,!1);this.#i=this.getHash()}}#a(t){const e=t.length;if(e<2)return!0;const s=t[0];for(let i=1;i<e;i++){const n=t[i];let r;if(Array.isArray(n))r=this.#a(n);else if(this.#e.has(n))r=this.#e.get(n).visible;else return B(`Optional content group not found: ${n}`),!0;switch(s){case"And":if(!r)return!1;break;case"Or":if(r)return!0;break;case"Not":return!r;default:return!0}}return s==="And"}isVisible(t){if(this.#e.size===0)return!0;if(!t)return Us("Optional content group not defined."),!0;if(t.type==="OCG")return this.#e.has(t.id)?this.#e.get(t.id).visible:(B(`Optional content group not found: ${t.id}`),!0);if(t.type==="OCMD"){if(t.expression)return this.#a(t.expression);if(!t.policy||t.policy==="AnyOn"){for(const e of t.ids){if(!this.#e.has(e))return B(`Optional content group not found: ${e}`),!0;if(this.#e.get(e).visible)return!0}return!1}else if(t.policy==="AllOn"){for(const e of t.ids){if(!this.#e.has(e))return B(`Optional content group not found: ${e}`),!0;if(!this.#e.get(e).visible)return!1}return!0}else if(t.policy==="AnyOff"){for(const e of t.ids){if(!this.#e.has(e))return B(`Optional content group not found: ${e}`),!0;if(!this.#e.get(e).visible)return!0}return!1}else if(t.policy==="AllOff"){for(const e of t.ids){if(!this.#e.has(e))return B(`Optional content group not found: ${e}`),!0;if(this.#e.get(e).visible)return!1}return!0}return B(`Unknown optional content policy ${t.policy}.`),!0}return B(`Unknown group type ${t.type}.`),!0}setVisibility(t,e=!0,s=!0){const i=this.#e.get(t);if(!i){B(`Optional content group not found: ${t}`);return}if(s&&e&&i.rbGroups.length)for(const n of i.rbGroups)for(const r of n)r!==t&&this.#e.get(r)?._setVisible(Ce,!1,!0);i._setVisible(Ce,!!e,!0),this.#t=null}setOCGState({state:t,preserveRB:e}){let s;for(const i of t){switch(i){case"ON":case"OFF":case"Toggle":s=i;continue}const n=this.#e.get(i);if(n)switch(s){case"ON":this.setVisibility(i,!0,e);break;case"OFF":this.setVisibility(i,!1,e);break;case"Toggle":this.setVisibility(i,!n.visible,e);break}}this.#t=null}get hasInitialVisibility(){return this.#i===null||this.getHash()===this.#i}getOrder(){return this.#e.size?this.#s?this.#s.slice():[...this.#e.keys()]:null}getGroup(t){return this.#e.get(t)||null}getHash(){if(this.#t!==null)return this.#t;const t=new fr;for(const[e,s]of this.#e)t.update(`${e}:${s.visible}`);return this.#t=t.hexdigest()}[Symbol.iterator](){return this.#e.entries()}}class Pl{constructor(t,{disableRange:e=!1,disableStream:s=!1}){W(t,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:i,initialData:n,progressiveDone:r,contentDispositionFilename:a}=t;if(this._queuedChunks=[],this._progressiveDone=r,this._contentDispositionFilename=a,n?.length>0){const l=n instanceof Uint8Array&&n.byteLength===n.buffer.byteLength?n.buffer:new Uint8Array(n).buffer;this._queuedChunks.push(l)}this._pdfDataRangeTransport=t,this._isStreamingSupported=!s,this._isRangeSupported=!e,this._contentLength=i,this._fullRequestReader=null,this._rangeReaders=[],t.addRangeListener((l,c)=>{this._onReceiveData({begin:l,chunk:c})}),t.addProgressListener((l,c)=>{this._onProgress({loaded:l,total:c})}),t.addProgressiveReadListener(l=>{this._onReceiveData({chunk:l})}),t.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),t.transportReady()}_onReceiveData({begin:t,chunk:e}){const s=e instanceof Uint8Array&&e.byteLength===e.buffer.byteLength?e.buffer:new Uint8Array(e).buffer;if(t===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(s):this._queuedChunks.push(s);else{const i=this._rangeReaders.some(function(n){return n._begin!==t?!1:(n._enqueue(s),!0)});W(i,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(t){t.total===void 0?this._rangeReaders[0]?.onProgress?.({loaded:t.loaded}):this._fullRequestReader?.onProgress?.({loaded:t.loaded,total:t.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(t){const e=this._rangeReaders.indexOf(t);e>=0&&this._rangeReaders.splice(e,1)}getFullReader(){W(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const t=this._queuedChunks;return this._queuedChunks=null,new Ml(this,t,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const s=new Rl(this,t,e);return this._pdfDataRangeTransport.requestDataRange(t,e),this._rangeReaders.push(s),s}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeReaders.slice(0))e.cancel(t);this._pdfDataRangeTransport.abort()}}class Ml{constructor(t,e,s=!1,i=null){this._stream=t,this._done=s||!1,this._filename=Gs(i)?i:null,this._queuedChunks=e||[],this._loaded=0;for(const n of this._queuedChunks)this._loaded+=n.byteLength;this._requests=[],this._headersReady=Promise.resolve(),t._fullRequestReader=this,this.onProgress=null}_enqueue(t){this._done||(this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunks.push(t),this._loaded+=t.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class Rl{constructor(t,e,s){this._stream=t,this._begin=e,this._end=s,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(t){if(!this._done){if(this._requests.length===0)this._queuedChunk=t;else{this._requests.shift().resolve({value:t,done:!1});for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function Nl(o){let t=!0,e=s("filename\\*","i").exec(o);if(e){e=e[1];let h=a(e);return h=unescape(h),h=l(h),h=c(h),n(h)}if(e=r(o),e){const h=c(e);return n(h)}if(e=s("filename","i").exec(o),e){e=e[1];let h=a(e);return h=c(h),n(h)}function s(h,d){return new RegExp("(?:^|;)\\s*"+h+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',d)}function i(h,d){if(h){if(!/^[\x00-\xFF]+$/.test(d))return d;try{const u=new TextDecoder(h,{fatal:!0}),f=ls(d);d=u.decode(f),t=!1}catch{}}return d}function n(h){return t&&/[\x80-\xff]/.test(h)&&(h=i("utf-8",h),t&&(h=i("iso-8859-1",h))),h}function r(h){const d=[];let u;const f=s("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(u=f.exec(h))!==null;){let[,g,y,b]=u;if(g=parseInt(g,10),g in d){if(g===0)break;continue}d[g]=[y,b]}const m=[];for(let g=0;g<d.length&&g in d;++g){let[y,b]=d[g];b=a(b),y&&(b=unescape(b),g===0&&(b=l(b))),m.push(b)}return m.join("")}function a(h){if(h.startsWith('"')){const d=h.slice(1).split('\\"');for(let u=0;u<d.length;++u){const f=d[u].indexOf('"');f!==-1&&(d[u]=d[u].slice(0,f),d.length=u+1),d[u]=d[u].replaceAll(/\\(.)/g,"$1")}h=d.join('"')}return h}function l(h){const d=h.indexOf("'");if(d===-1)return h;const u=h.slice(0,d),m=h.slice(d+1).replace(/^[^']*'/,"");return i(u,m)}function c(h){return!h.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(h)?h:h.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(d,u,f,m){if(f==="q"||f==="Q")return m=m.replaceAll("_"," "),m=m.replaceAll(/=([0-9a-fA-F]{2})/g,function(g,y){return String.fromCharCode(parseInt(y,16))}),i(u,m);try{m=atob(m)}catch{}return i(u,m)})}return""}function Ar(o,t){const e=new Headers;if(!o||!t||typeof t!="object")return e;for(const s in t){const i=t[s];i!==void 0&&e.append(s,i)}return e}function $s(o){return URL.parse(o)?.origin??null}function kr({responseHeaders:o,isHttp:t,rangeChunkSize:e,disableRange:s}){const i={allowRangeRequests:!1,suggestedLength:void 0},n=parseInt(o.get("Content-Length"),10);return!Number.isInteger(n)||(i.suggestedLength=n,n<=2*e)||s||!t||o.get("Accept-Ranges")!=="bytes"||(o.get("Content-Encoding")||"identity")!=="identity"||(i.allowRangeRequests=!0),i}function Sr(o){const t=o.get("Content-Disposition");if(t){let e=Nl(t);if(e.includes("%"))try{e=decodeURIComponent(e)}catch{}if(Gs(e))return e}return null}function ps(o,t){return new es(`Unexpected server response (${o}) while retrieving PDF "${t}".`,o,o===404||o===0&&t.startsWith("file:"))}function _r(o){return o===200||o===206}function Er(o,t,e){return{method:"GET",headers:o,signal:e.signal,mode:"cors",credentials:t?"include":"same-origin",redirect:"follow"}}function Cr(o){return o instanceof Uint8Array?o.buffer:o instanceof ArrayBuffer?o:(B(`getArrayBuffer - unexpected data format: ${o}`),new Uint8Array(o).buffer)}class Dl{_responseOrigin=null;constructor(t){this.source=t,this.isHttp=/^https?:/i.test(t.url),this.headers=Ar(this.isHttp,t.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return W(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new Il(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const s=new Fl(this,t,e);return this._rangeRequestReaders.push(s),s}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class Il{constructor(t){this._stream=t,this._reader=null,this._loaded=0,this._filename=null;const e=t.source;this._withCredentials=e.withCredentials||!1,this._contentLength=e.length,this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange;const s=new Headers(t.headers),i=e.url;fetch(i,Er(s,this._withCredentials,this._abortController)).then(n=>{if(t._responseOrigin=$s(n.url),!_r(n.status))throw ps(n.status,i);this._reader=n.body.getReader(),this._headersCapability.resolve();const r=n.headers,{allowRangeRequests:a,suggestedLength:l}=kr({responseHeaders:r,isHttp:t.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=a,this._contentLength=l||this._contentLength,this._filename=Sr(r),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new ie("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:Cr(t),done:!1})}cancel(t){this._reader?.cancel(t),this._abortController.abort()}}class Fl{constructor(t,e,s){this._stream=t,this._reader=null,this._loaded=0;const i=t.source;this._withCredentials=i.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!i.disableStream,this._abortController=new AbortController;const n=new Headers(t.headers);n.append("Range",`bytes=${e}-${s-1}`);const r=i.url;fetch(r,Er(n,this._withCredentials,this._abortController)).then(a=>{const l=$s(a.url);if(l!==t._responseOrigin)throw new Error(`Expected range response-origin "${l}" to match "${t._responseOrigin}".`);if(!_r(a.status))throw ps(a.status,r);this._readCapability.resolve(),this._reader=a.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,this.onProgress?.({loaded:this._loaded}),{value:Cr(t),done:!1})}cancel(t){this._reader?.cancel(t),this._abortController.abort()}}const li=200,ci=206;function Ol(o){const t=o.response;return typeof t!="string"?t:ls(t).buffer}class jl{_responseOrigin=null;constructor({url:t,httpHeaders:e,withCredentials:s}){this.url=t,this.isHttp=/^https?:/i.test(t),this.headers=Ar(this.isHttp,e),this.withCredentials=s||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(t){const e=new XMLHttpRequest,s=this.currXhrId++,i=this.pendingRequests[s]={xhr:e};e.open("GET",this.url),e.withCredentials=this.withCredentials;for(const[n,r]of this.headers)e.setRequestHeader(n,r);return this.isHttp&&"begin"in t&&"end"in t?(e.setRequestHeader("Range",`bytes=${t.begin}-${t.end-1}`),i.expectedStatus=ci):i.expectedStatus=li,e.responseType="arraybuffer",W(t.onError,"Expected `onError` callback to be provided."),e.onerror=()=>{t.onError(e.status)},e.onreadystatechange=this.onStateChange.bind(this,s),e.onprogress=this.onProgress.bind(this,s),i.onHeadersReceived=t.onHeadersReceived,i.onDone=t.onDone,i.onError=t.onError,i.onProgress=t.onProgress,e.send(null),s}onProgress(t,e){const s=this.pendingRequests[t];s&&s.onProgress?.(e)}onStateChange(t,e){const s=this.pendingRequests[t];if(!s)return;const i=s.xhr;if(i.readyState>=2&&s.onHeadersReceived&&(s.onHeadersReceived(),delete s.onHeadersReceived),i.readyState!==4||!(t in this.pendingRequests))return;if(delete this.pendingRequests[t],i.status===0&&this.isHttp){s.onError(i.status);return}const n=i.status||li;if(!(n===li&&s.expectedStatus===ci)&&n!==s.expectedStatus){s.onError(i.status);return}const a=Ol(i);if(n===ci){const l=i.getResponseHeader("Content-Range"),c=/bytes (\d+)-(\d+)\/(\d+)/.exec(l);c?s.onDone({begin:parseInt(c[1],10),chunk:a}):(B('Missing or invalid "Content-Range" header.'),s.onError(0))}else a?s.onDone({begin:0,chunk:a}):s.onError(i.status)}getRequestXhr(t){return this.pendingRequests[t].xhr}isPendingRequest(t){return t in this.pendingRequests}abortRequest(t){const e=this.pendingRequests[t].xhr;delete this.pendingRequests[t],e.abort()}}class Bl{constructor(t){this._source=t,this._manager=new jl(t),this._rangeChunkSize=t.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(t){const e=this._rangeRequestReaders.indexOf(t);e>=0&&this._rangeRequestReaders.splice(e,1)}getFullReader(){return W(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new Hl(this._manager,this._source),this._fullRequestReader}getRangeReader(t,e){const s=new Ul(this._manager,t,e);return s.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(s),s}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class Hl{constructor(t,e){this._manager=t,this._url=e.url,this._fullRequestId=t.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._contentLength=e.length,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const t=this._fullRequestId,e=this._manager.getRequestXhr(t);this._manager._responseOrigin=$s(e.responseURL);const s=e.getAllResponseHeaders(),i=new Headers(s?s.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(a=>{const[l,...c]=a.split(": ");return[l,c.join(": ")]}):[]),{allowRangeRequests:n,suggestedLength:r}=kr({responseHeaders:i,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});n&&(this._isRangeSupported=!0),this._contentLength=r||this._contentLength,this._filename=Sr(i),this._isRangeSupported&&this._manager.abortRequest(t),this._headersCapability.resolve()}_onDone(t){if(t&&(this._requests.length>0?this._requests.shift().resolve({value:t.chunk,done:!1}):this._cachedChunks.push(t.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(t){this._storedError=ps(t,this._url),this._headersCapability.reject(this._storedError);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(t){this.onProgress?.({loaded:t.loaded,total:t.lengthComputable?t.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0,this._headersCapability.reject(t);for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class Ul{constructor(t,e,s){this._manager=t,this._url=t.url,this._requestId=t.request({begin:e,end:s,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){const t=$s(this._manager.getRequestXhr(this._requestId)?.responseURL);t!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${t}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){this.onClosed?.(this)}_onDone(t){const e=t.chunk;this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunk=e,this._done=!0;for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(t){this._storedError??=ps(t,this._url);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(t){this.isStreamingSupported||this.onProgress?.({loaded:t.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const zl=/^[a-z][a-z0-9\-+.]+:/i;function Gl(o){if(zl.test(o))return new URL(o);const t=process.getBuiltinModule("url");return new URL(t.pathToFileURL(o))}class $l{constructor(t){this.source=t,this.url=Gl(t.url),W(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return W(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new Vl(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const s=new Wl(this,t,e);return this._rangeRequestReaders.push(s),s}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class Vl{constructor(t){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null;const e=t.source;this._contentLength=e.length,this._loaded=0,this._filename=null,this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const s=process.getBuiltinModule("fs");s.promises.lstat(this._url).then(i=>{this._contentLength=i.size,this._setReadableStream(s.createReadStream(this._url)),this._headersCapability.resolve()},i=>{i.code==="ENOENT"&&(i=ps(0,this._url.href)),this._storedError=i,this._headersCapability.reject(i)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new ie("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class Wl{constructor(t,e,s){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const i=t.source;this._isStreamingSupported=!i.disableStream;const n=process.getBuiltinModule("fs");this._setReadableStream(n.createReadStream(this._url,{start:e,end:s-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const Ve=Symbol("INITIAL_DATA");class Tr{#t=Object.create(null);#e(t){return this.#t[t]||={...Promise.withResolvers(),data:Ve}}get(t,e=null){if(e){const i=this.#e(t);return i.promise.then(()=>e(i.data)),null}const s=this.#t[t];if(!s||s.data===Ve)throw new Error(`Requesting object that isn't resolved yet ${t}.`);return s.data}has(t){const e=this.#t[t];return!!e&&e.data!==Ve}delete(t){const e=this.#t[t];return!e||e.data===Ve?!1:(delete this.#t[t],!0)}resolve(t,e=null){const s=this.#e(t);s.data=e,s.resolve()}clear(){for(const t in this.#t){const{data:e}=this.#t[t];e?.bitmap?.close()}this.#t=Object.create(null)}*[Symbol.iterator](){for(const t in this.#t){const{data:e}=this.#t[t];e!==Ve&&(yield[t,e])}}}const ql=1e5,En=30;let is=class Ht{#t=Promise.withResolvers();#e=null;#i=!1;#s=!!globalThis.FontInspector?.enabled;#a=null;#n=null;#r=0;#o=0;#c=null;#l=null;#u=0;#d=0;#p=Object.create(null);#m=[];#f=null;#h=[];#g=new WeakMap;#b=null;static#w=new Map;static#y=new Map;static#_=new WeakMap;static#k=null;static#x=new Set;constructor({textContentSource:t,container:e,viewport:s}){if(t instanceof ReadableStream)this.#f=t;else if(typeof t=="object")this.#f=new ReadableStream({start(l){l.enqueue(t),l.close()}});else throw new Error('No "textContentSource" parameter specified.');this.#e=this.#l=e,this.#d=s.scale*zt.pixelRatio,this.#u=s.rotation,this.#n={div:null,properties:null,ctx:null};const{pageWidth:i,pageHeight:n,pageX:r,pageY:a}=s.rawDims;this.#b=[1,0,0,-1,-r,a+n],this.#o=i,this.#r=n,Ht.#L(),ce(e,s),this.#t.promise.finally(()=>{Ht.#x.delete(this),this.#n=null,this.#p=null}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:t,isFirefox:e}=bt.platform;return z(this,"fontFamilyMap",new Map([["sans-serif",`${t&&e?"Calibri, ":""}sans-serif`],["monospace",`${t&&e?"Lucida Console, ":""}monospace`]]))}render(){const t=()=>{this.#c.read().then(({value:e,done:s})=>{if(s){this.#t.resolve();return}this.#a??=e.lang,Object.assign(this.#p,e.styles),this.#C(e.items),t()},this.#t.reject)};return this.#c=this.#f.getReader(),Ht.#x.add(this),t(),this.#t.promise}update({viewport:t,onBefore:e=null}){const s=t.scale*zt.pixelRatio,i=t.rotation;if(i!==this.#u&&(e?.(),this.#u=i,ce(this.#l,{rotation:i})),s!==this.#d){e?.(),this.#d=s;const n={div:null,properties:null,ctx:Ht.#P(this.#a)};for(const r of this.#h)n.properties=this.#g.get(r),n.div=r,this.#S(n)}}cancel(){const t=new ie("TextLayer task cancelled.");this.#c?.cancel(t).catch(()=>{}),this.#c=null,this.#t.reject(t)}get textDivs(){return this.#h}get textContentItemsStr(){return this.#m}#C(t){if(this.#i)return;this.#n.ctx??=Ht.#P(this.#a);const e=this.#h,s=this.#m;for(const i of t){if(e.length>ql){B("Ignoring additional textDivs for performance reasons."),this.#i=!0;return}if(i.str===void 0){if(i.type==="beginMarkedContentProps"||i.type==="beginMarkedContent"){const n=this.#e;this.#e=document.createElement("span"),this.#e.classList.add("markedContent"),i.id&&this.#e.setAttribute("id",`${i.id}`),n.append(this.#e)}else i.type==="endMarkedContent"&&(this.#e=this.#e.parentNode);continue}s.push(i.str),this.#A(i)}}#A(t){const e=document.createElement("span"),s={angle:0,canvasWidth:0,hasText:t.str!=="",hasEOL:t.hasEOL,fontSize:0};this.#h.push(e);const i=D.transform(this.#b,t.transform);let n=Math.atan2(i[1],i[0]);const r=this.#p[t.fontName];r.vertical&&(n+=Math.PI/2);let a=this.#s&&r.fontSubstitution||r.fontFamily;a=Ht.fontFamilyMap.get(a)||a;const l=Math.hypot(i[2],i[3]),c=l*Ht.#O(a,r,this.#a);let h,d;n===0?(h=i[4],d=i[5]-c):(h=i[4]+c*Math.sin(n),d=i[5]-c*Math.cos(n));const u="calc(var(--total-scale-factor) *",f=e.style;this.#e===this.#l?(f.left=`${(100*h/this.#o).toFixed(2)}%`,f.top=`${(100*d/this.#r).toFixed(2)}%`):(f.left=`${u}${h.toFixed(2)}px)`,f.top=`${u}${d.toFixed(2)}px)`),f.fontSize=`${u}${(Ht.#k*l).toFixed(2)}px)`,f.fontFamily=a,s.fontSize=l,e.setAttribute("role","presentation"),e.textContent=t.str,e.dir=t.dir,this.#s&&(e.dataset.fontName=r.fontSubstitutionLoadedName||t.fontName),n!==0&&(s.angle=n*(180/Math.PI));let m=!1;if(t.str.length>1)m=!0;else if(t.str!==" "&&t.transform[0]!==t.transform[3]){const g=Math.abs(t.transform[0]),y=Math.abs(t.transform[3]);g!==y&&Math.max(g,y)/Math.min(g,y)>1.5&&(m=!0)}if(m&&(s.canvasWidth=r.vertical?t.height:t.width),this.#g.set(e,s),this.#n.div=e,this.#n.properties=s,this.#S(this.#n),s.hasText&&this.#e.append(e),s.hasEOL){const g=document.createElement("br");g.setAttribute("role","presentation"),this.#e.append(g)}}#S(t){const{div:e,properties:s,ctx:i}=t,{style:n}=e;let r="";if(Ht.#k>1&&(r=`scale(${1/Ht.#k})`),s.canvasWidth!==0&&s.hasText){const{fontFamily:a}=n,{canvasWidth:l,fontSize:c}=s;Ht.#T(i,c*this.#d,a);const{width:h}=i.measureText(e.textContent);h>0&&(r=`scaleX(${l*this.#d/h}) ${r}`)}s.angle!==0&&(r=`rotate(${s.angle}deg) ${r}`),r.length>0&&(n.transform=r)}static cleanup(){if(!(this.#x.size>0)){this.#w.clear();for(const{canvas:t}of this.#y.values())t.remove();this.#y.clear()}}static#P(t=null){let e=this.#y.get(t||="");if(!e){const s=document.createElement("canvas");s.className="hiddenCanvasElement",s.lang=t,document.body.append(s),e=s.getContext("2d",{alpha:!1,willReadFrequently:!0}),this.#y.set(t,e),this.#_.set(e,{size:0,family:""})}return e}static#T(t,e,s){const i=this.#_.get(t);e===i.size&&s===i.family||(t.font=`${e}px ${s}`,i.size=e,i.family=s)}static#L(){if(this.#k!==null)return;const t=document.createElement("div");t.style.opacity=0,t.style.lineHeight=1,t.style.fontSize="1px",t.style.position="absolute",t.textContent="X",document.body.append(t),this.#k=t.getBoundingClientRect().height,t.remove()}static#O(t,e,s){const i=this.#w.get(t);if(i)return i;const n=this.#P(s);n.canvas.width=n.canvas.height=En,this.#T(n,En,t);const r=n.measureText(""),a=r.fontBoundingBoxAscent,l=Math.abs(r.fontBoundingBoxDescent);n.canvas.width=n.canvas.height=0;let c=.8;return a?c=a/(a+l):(bt.platform.isFirefox&&B("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),e.ascent?c=e.ascent:e.descent&&(c=1+e.descent)),this.#w.set(t,c),c}};const Xl=100;function Bi(o={}){typeof o=="string"||o instanceof URL?o={url:o}:(o instanceof ArrayBuffer||ArrayBuffer.isView(o))&&(o={data:o});const t=new Hi,{docId:e}=t,s=o.url?sl(o.url):null,i=o.data?il(o.data):null,n=o.httpHeaders||null,r=o.withCredentials===!0,a=o.password??null,l=o.range instanceof Ui?o.range:null,c=Number.isInteger(o.rangeChunkSize)&&o.rangeChunkSize>0?o.rangeChunkSize:2**16;let h=o.worker instanceof je?o.worker:null;const d=o.verbosity,u=typeof o.docBaseUrl=="string"&&!hs(o.docBaseUrl)?o.docBaseUrl:null,f=As(o.cMapUrl),m=o.cMapPacked!==!1,g=o.CMapReaderFactory||(Ct?hl:un),y=As(o.iccUrl),b=As(o.standardFontDataUrl),x=o.StandardFontDataFactory||(Ct?dl:pn),w=As(o.wasmUrl),A=o.WasmFactory||(Ct?ul:fn),v=o.stopAtErrors!==!0,k=Number.isInteger(o.maxImageSize)&&o.maxImageSize>-1?o.maxImageSize:-1,S=o.isEvalSupported!==!1,_=typeof o.isOffscreenCanvasSupported=="boolean"?o.isOffscreenCanvasSupported:!Ct,E=typeof o.isImageDecoderSupported=="boolean"?o.isImageDecoderSupported:!Ct&&(bt.platform.isFirefox||!globalThis.chrome),T=Number.isInteger(o.canvasMaxAreaInBytes)?o.canvasMaxAreaInBytes:-1,L=typeof o.disableFontFace=="boolean"?o.disableFontFace:Ct,G=o.fontExtraProperties===!0,H=o.enableXfa===!0,O=o.ownerDocument||globalThis.document,$=o.disableRange===!0,M=o.disableStream===!0,R=o.disableAutoFetch===!0,U=o.pdfBug===!0,nt=o.CanvasFactory||(Ct?cl:al),kt=o.FilterFactory||(Ct?ll:ol),Ot=o.enableHWA===!0,tt=o.useWasm!==!1,X=l?l.length:o.length??NaN,St=typeof o.useSystemFonts=="boolean"?o.useSystemFonts:!Ct&&!L,Lt=typeof o.useWorkerFetch=="boolean"?o.useWorkerFetch:!!(g===un&&x===pn&&A===fn&&f&&b&&w&&Xe(f,document.baseURI)&&Xe(b,document.baseURI)&&Xe(w,document.baseURI)),_t=null;Oo(d);const Z={canvasFactory:new nt({ownerDocument:O,enableHWA:Ot}),filterFactory:new kt({docId:e,ownerDocument:O}),cMapReaderFactory:Lt?null:new g({baseUrl:f,isCompressed:m}),standardFontDataFactory:Lt?null:new x({baseUrl:b}),wasmFactory:Lt?null:new A({baseUrl:w})};h||(h=je.create({verbosity:d,port:le.workerPort}),t._worker=h);const Gt={docId:e,apiVersion:"5.4.296",data:i,password:a,disableAutoFetch:R,rangeChunkSize:c,length:X,docBaseUrl:u,enableXfa:H,evaluatorOptions:{maxImageSize:k,disableFontFace:L,ignoreErrors:v,isEvalSupported:S,isOffscreenCanvasSupported:_,isImageDecoderSupported:E,canvasMaxAreaInBytes:T,fontExtraProperties:G,useSystemFonts:St,useWasm:tt,useWorkerFetch:Lt,cMapUrl:f,iccUrl:y,standardFontDataUrl:b,wasmUrl:w}},Et={ownerDocument:O,pdfBug:U,styleElement:_t,loadingParams:{disableAutoFetch:R,enableXfa:H}};return h.promise.then(function(){if(t.destroyed)throw new Error("Loading aborted");if(h.destroyed)throw new Error("Worker was destroyed");const rt=h.messageHandler.sendWithPromise("GetDocRequest",Gt,i?[i.buffer]:null);let Jt;if(l)Jt=new Pl(l,{disableRange:$,disableStream:M});else if(!i){if(!s)throw new Error("getDocument - no `url` parameter provided.");const Zt=Xe(s)?Dl:Ct?$l:Bl;Jt=new Zt({url:s,length:X,httpHeaders:n,withCredentials:r,rangeChunkSize:c,disableRange:$,disableStream:M})}return rt.then(Zt=>{if(t.destroyed)throw new Error("Loading aborted");if(h.destroyed)throw new Error("Worker was destroyed");const q=new Ye(e,Zt,h.port),et=new Ql(q,t,Jt,Et,Z,Ot);t._transport=et,q.send("Ready",null)})}).catch(t._capability.reject),t}class Hi{static#t=0;_capability=Promise.withResolvers();_transport=null;_worker=null;docId=`d${Hi.#t++}`;destroyed=!1;onPassword=null;onProgress=null;get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await this._transport?.destroy()}catch(t){throw this._worker?.port&&delete this._worker._pendingDestroy,t}this._transport=null,this._worker?.destroy(),this._worker=null}async getData(){return this._transport.getData()}}let Ui=class{#t=Promise.withResolvers();#e=[];#i=[];#s=[];#a=[];constructor(t,e,s=!1,i=null){this.length=t,this.initialData=e,this.progressiveDone=s,this.contentDispositionFilename=i}addRangeListener(t){this.#a.push(t)}addProgressListener(t){this.#s.push(t)}addProgressiveReadListener(t){this.#i.push(t)}addProgressiveDoneListener(t){this.#e.push(t)}onDataRange(t,e){for(const s of this.#a)s(t,e)}onDataProgress(t,e){this.#t.promise.then(()=>{for(const s of this.#s)s(t,e)})}onDataProgressiveRead(t){this.#t.promise.then(()=>{for(const e of this.#i)e(t)})}onDataProgressiveDone(){this.#t.promise.then(()=>{for(const t of this.#e)t()})}transportReady(){this.#t.resolve()}requestDataRange(t,e){J("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}};class Yl{constructor(t,e){this._pdfInfo=t,this._transport=e}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return z(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(t){return this._transport.getPage(t)}getPageIndex(t){return this._transport.getPageIndex(t)}getDestinations(){return this._transport.getDestinations()}getDestination(t){return this._transport.getDestination(t)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getAnnotationsByType(t,e){return this._transport.getAnnotationsByType(t,e)}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getOptionalContentConfig(e)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(t=!1){return this._transport.startCleanup(t||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(t){return this._transport.cachedPageNumber(t)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}class Kl{#t=!1;constructor(t,e,s,i=!1){this._pageIndex=t,this._pageInfo=e,this._transport=s,this._stats=i?new rn:null,this._pdfBug=i,this.commonObjs=s.commonObjs,this.objs=new Tr,this._intentStates=new Map,this.destroyed=!1,this.recordedBBoxes=null}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:t,rotation:e=this.rotate,offsetX:s=0,offsetY:i=0,dontFlip:n=!1}={}){return new cs({viewBox:this.view,userUnit:this.userUnit,scale:t,rotation:e,offsetX:s,offsetY:i,dontFlip:n})}getAnnotations({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getAnnotations(this._pageIndex,e)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return z(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:t,canvas:e=t.canvas,viewport:s,intent:i="display",annotationMode:n=Qt.ENABLE,transform:r=null,background:a=null,optionalContentConfigPromise:l=null,annotationCanvasMap:c=null,pageColors:h=null,printAnnotationStorage:d=null,isEditing:u=!1,recordOperations:f=!1,operationsFilter:m=null}){this._stats?.time("Overall");const g=this._transport.getRenderingIntent(i,n,d,u),{renderingIntent:y,cacheKey:b}=g;this.#t=!1,l||=this._transport.getOptionalContentConfig(y);let x=this._intentStates.get(b);x||(x=Object.create(null),this._intentStates.set(b,x)),x.streamReaderCancelTimeout&&(clearTimeout(x.streamReaderCancelTimeout),x.streamReaderCancelTimeout=null);const w=!!(y&Nt.PRINT);x.displayReadyCapability||(x.displayReadyCapability=Promise.withResolvers(),x.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(g));const A=!!(this._pdfBug&&globalThis.StepperManager?.enabled),v=!this.recordedBBoxes&&(f||A),k=E=>{if(x.renderTasks.delete(S),v){const T=S.gfx?.dependencyTracker.take();T&&(S.stepper&&S.stepper.setOperatorBBoxes(T,S.gfx.dependencyTracker.takeDebugMetadata()),f&&(this.recordedBBoxes=T))}w&&(this.#t=!0),this.#e(),E?(S.capability.reject(E),this._abortOperatorList({intentState:x,reason:E instanceof Error?E:new Error(E)})):S.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),globalThis.Stats?.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},S=new Pe({callback:k,params:{canvas:e,canvasContext:t,dependencyTracker:v?new fl(e,x.operatorList.length,A):null,viewport:s,transform:r,background:a},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:c,operatorList:x.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!w,pdfBug:this._pdfBug,pageColors:h,enableHWA:this._transport.enableHWA,operationsFilter:m});(x.renderTasks||=new Set).add(S);const _=S.task;return Promise.all([x.displayReadyCapability.promise,l]).then(([E,T])=>{if(this.destroyed){k();return}if(this._stats?.time("Rendering"),!(T.renderingIntent&y))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");S.initializeGraphics({transparency:E,optionalContentConfig:T}),S.operatorListChanged()}).catch(k),_}getOperatorList({intent:t="display",annotationMode:e=Qt.ENABLE,printAnnotationStorage:s=null,isEditing:i=!1}={}){function n(){a.operatorList.lastChunk&&(a.opListReadCapability.resolve(a.operatorList),a.renderTasks.delete(l))}const r=this._transport.getRenderingIntent(t,e,s,i,!0);let a=this._intentStates.get(r.cacheKey);a||(a=Object.create(null),this._intentStates.set(r.cacheKey,a));let l;return a.opListReadCapability||(l=Object.create(null),l.operatorListChanged=n,a.opListReadCapability=Promise.withResolvers(),(a.renderTasks||=new Set).add(l),a.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(r)),a.opListReadCapability.promise}streamTextContent({includeMarkedContent:t=!1,disableNormalization:e=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:t===!0,disableNormalization:e===!0},{highWaterMark:100,size(i){return i.items.length}})}getTextContent(t={}){if(this._transport._htmlForXfa)return this.getXfa().then(s=>ss.textContent(s));const e=this.streamTextContent(t);return new Promise(function(s,i){function n(){r.read().then(function({value:l,done:c}){if(c){s(a);return}a.lang??=l.lang,Object.assign(a.styles,l.styles),a.items.push(...l.items),n()},i)}const r=e.getReader(),a={items:[],styles:Object.create(null),lang:null};n()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const t=[];for(const e of this._intentStates.values())if(this._abortOperatorList({intentState:e,reason:new Error("Page was destroyed."),force:!0}),!e.opListReadCapability)for(const s of e.renderTasks)t.push(s.completed),s.cancel();return this.objs.clear(),this.#t=!1,Promise.all(t)}cleanup(t=!1){this.#t=!0;const e=this.#e();return t&&e&&(this._stats&&=new rn),e}#e(){if(!this.#t||this.destroyed)return!1;for(const{renderTasks:t,operatorList:e}of this._intentStates.values())if(t.size>0||!e.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#t=!1,!0}_startRenderPage(t,e){const s=this._intentStates.get(e);s&&(this._stats?.timeEnd("Page Request"),s.displayReadyCapability?.resolve(t))}_renderPageChunk(t,e){for(let s=0,i=t.length;s<i;s++)e.operatorList.fnArray.push(t.fnArray[s]),e.operatorList.argsArray.push(t.argsArray[s]);e.operatorList.lastChunk=t.lastChunk,e.operatorList.separateAnnots=t.separateAnnots;for(const s of e.renderTasks)s.operatorListChanged();t.lastChunk&&this.#e()}_pumpOperatorList({renderingIntent:t,cacheKey:e,annotationStorageSerializable:s,modifiedIds:i}){const{map:n,transfer:r}=s,l=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:t,cacheKey:e,annotationStorage:n,modifiedIds:i},r).getReader(),c=this._intentStates.get(e);c.streamReader=l;const h=()=>{l.read().then(({value:d,done:u})=>{if(u){c.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(d,c),h())},d=>{if(c.streamReader=null,!this._transport.destroyed){if(c.operatorList){c.operatorList.lastChunk=!0;for(const u of c.renderTasks)u.operatorListChanged();this.#e()}if(c.displayReadyCapability)c.displayReadyCapability.reject(d);else if(c.opListReadCapability)c.opListReadCapability.reject(d);else throw d}})};h()}_abortOperatorList({intentState:t,reason:e,force:s=!1}){if(t.streamReader){if(t.streamReaderCancelTimeout&&(clearTimeout(t.streamReaderCancelTimeout),t.streamReaderCancelTimeout=null),!s){if(t.renderTasks.size>0)return;if(e instanceof zs){let i=Xl;e.extraDelay>0&&e.extraDelay<1e3&&(i+=e.extraDelay),t.streamReaderCancelTimeout=setTimeout(()=>{t.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:t,reason:e,force:!0})},i);return}}if(t.streamReader.cancel(new ie(e.message)).catch(()=>{}),t.streamReader=null,!this._transport.destroyed){for(const[i,n]of this._intentStates)if(n===t){this._intentStates.delete(i);break}this.cleanup()}}}get stats(){return this._stats}}var oe,Ut,ee,pe,Bs,fe,ge,Tt,Ps,Lr,Pr,Ke,Fe,Ms;const it=class it{constructor({name:t=null,port:e=null,verbosity:s=jo()}={}){$t(this,Tt);$t(this,oe,Promise.withResolvers());$t(this,Ut,null);$t(this,ee,null);$t(this,pe,null);if(this.name=t,this.destroyed=!1,this.verbosity=s,e){if(st(it,ge).has(e))throw new Error("Cannot use more than one PDFWorker per port.");st(it,ge).set(e,this),Vt(this,Tt,Lr).call(this,e)}else Vt(this,Tt,Pr).call(this)}get promise(){return st(this,oe).promise}get port(){return st(this,ee)}get messageHandler(){return st(this,Ut)}destroy(){this.destroyed=!0,st(this,pe)?.terminate(),Pt(this,pe,null),st(it,ge).delete(st(this,ee)),Pt(this,ee,null),st(this,Ut)?.destroy(),Pt(this,Ut,null)}static create(t){const e=st(this,ge).get(t?.port);if(e){if(e._pendingDestroy)throw new Error("PDFWorker.create - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return e}return new it(t)}static get workerSrc(){if(le.workerSrc)return le.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return z(this,"_setupFakeWorkerGlobal",(async()=>st(this,Fe,Ms)?st(this,Fe,Ms):(await import(this.workerSrc)).WorkerMessageHandler)())}};oe=new WeakMap,Ut=new WeakMap,ee=new WeakMap,pe=new WeakMap,Bs=new WeakMap,fe=new WeakMap,ge=new WeakMap,Tt=new WeakSet,Ps=function(){st(this,oe).resolve(),st(this,Ut).send("configure",{verbosity:this.verbosity})},Lr=function(t){Pt(this,ee,t),Pt(this,Ut,new Ye("main","worker",t)),st(this,Ut).on("ready",()=>{}),Vt(this,Tt,Ps).call(this)},Pr=function(){if(st(it,fe)||st(it,Fe,Ms)){Vt(this,Tt,Ke).call(this);return}let{workerSrc:t}=it;try{it._isSameOrigin(window.location,t)||(t=it._createCDNWrapper(new URL(t,window.location).href));const e=new Worker(t,{type:"module"}),s=new Ye("main","worker",e),i=()=>{n.abort(),s.destroy(),e.terminate(),this.destroyed?st(this,oe).reject(new Error("Worker was destroyed")):Vt(this,Tt,Ke).call(this)},n=new AbortController;e.addEventListener("error",()=>{st(this,pe)||i()},{signal:n.signal}),s.on("test",a=>{if(n.abort(),this.destroyed||!a){i();return}Pt(this,Ut,s),Pt(this,ee,e),Pt(this,pe,e),Vt(this,Tt,Ps).call(this)}),s.on("ready",a=>{if(n.abort(),this.destroyed){i();return}try{r()}catch{Vt(this,Tt,Ke).call(this)}});const r=()=>{const a=new Uint8Array;s.send("test",a,[a.buffer])};r();return}catch{Us("The worker has been disabled.")}Vt(this,Tt,Ke).call(this)},Ke=function(){st(it,fe)||(B("Setting up fake worker."),Pt(it,fe,!0)),it._setupFakeWorkerGlobal.then(t=>{if(this.destroyed){st(this,oe).reject(new Error("Worker was destroyed"));return}const e=new rl;Pt(this,ee,e);const s=`fake${Ki(it,Bs)._++}`,i=new Ye(s+"_worker",s,e);t.setup(i,e),Pt(this,Ut,new Ye(s,s+"_worker",e)),Vt(this,Tt,Ps).call(this)}).catch(t=>{st(this,oe).reject(new Error(`Setting up fake worker failed: "${t.message}".`))})},Fe=new WeakSet,Ms=function(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}},$t(it,Fe),$t(it,Bs,0),$t(it,fe,!1),$t(it,ge,new WeakMap),Ct&&(Pt(it,fe,!0),le.workerSrc||="./pdf.worker.mjs"),it._isSameOrigin=(t,e)=>{const s=URL.parse(t);if(!s?.origin||s.origin==="null")return!1;const i=new URL(e,s);return s.origin===i.origin},it._createCDNWrapper=t=>{const e=`await import("${t}");`;return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))},it.fromPort=t=>{if(qo("`PDFWorker.fromPort` - please use `PDFWorker.create` instead."),!t?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");return it.create(t)};let je=it;class Ql{#t=new Map;#e=new Map;#i=new Map;#s=new Map;#a=null;constructor(t,e,s,i,n,r){this.messageHandler=t,this.loadingTask=e,this.commonObjs=new Tr,this.fontLoader=new tl({ownerDocument:i.ownerDocument,styleElement:i.styleElement}),this.loadingParams=i.loadingParams,this._params=i,this.canvasFactory=n.canvasFactory,this.filterFactory=n.filterFactory,this.cMapReaderFactory=n.cMapReaderFactory,this.standardFontDataFactory=n.standardFontDataFactory,this.wasmFactory=n.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=s,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.enableHWA=r,this.setupMessageHandler()}#n(t,e=null){const s=this.#t.get(t);if(s)return s;const i=this.messageHandler.sendWithPromise(t,e);return this.#t.set(t,i),i}get annotationStorage(){return z(this,"annotationStorage",new Ii)}getRenderingIntent(t,e=Qt.ENABLE,s=null,i=!1,n=!1){let r=Nt.DISPLAY,a=gi;switch(t){case"any":r=Nt.ANY;break;case"display":break;case"print":r=Nt.PRINT;break;default:B(`getRenderingIntent - invalid intent: ${t}`)}const l=r&Nt.PRINT&&s instanceof gr?s:this.annotationStorage;switch(e){case Qt.DISABLE:r+=Nt.ANNOTATIONS_DISABLE;break;case Qt.ENABLE:break;case Qt.ENABLE_FORMS:r+=Nt.ANNOTATIONS_FORMS;break;case Qt.ENABLE_STORAGE:r+=Nt.ANNOTATIONS_STORAGE,a=l.serializable;break;default:B(`getRenderingIntent - invalid annotationMode: ${e}`)}i&&(r+=Nt.IS_EDITING),n&&(r+=Nt.OPLIST);const{ids:c,hash:h}=l.modifiedIds,d=[r,a.hash,h];return{renderingIntent:r,cacheKey:d.join("_"),annotationStorageSerializable:a,modifiedIds:c}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),this.#a?.reject(new Error("Worker was destroyed during onPassword callback"));const t=[];for(const s of this.#e.values())t.push(s._destroy());this.#e.clear(),this.#i.clear(),this.#s.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const e=this.messageHandler.sendWithPromise("Terminate",null);return t.push(e),Promise.all(t).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(),is.cleanup(),this._networkStream?.cancelAllRequests(new ie("Worker was terminated.")),this.messageHandler?.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:t,loadingTask:e}=this;t.on("GetReader",(s,i)=>{W(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=n=>{this._lastProgress={loaded:n.loaded,total:n.total}},i.onPull=()=>{this._fullReader.read().then(function({value:n,done:r}){if(r){i.close();return}W(n instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(n),1,[n])}).catch(n=>{i.error(n)})},i.onCancel=n=>{this._fullReader.cancel(n),i.ready.catch(r=>{if(!this.destroyed)throw r})}}),t.on("ReaderHeadersReady",async s=>{await this._fullReader.headersReady;const{isStreamingSupported:i,isRangeSupported:n,contentLength:r}=this._fullReader;return(!i||!n)&&(this._lastProgress&&e.onProgress?.(this._lastProgress),this._fullReader.onProgress=a=>{e.onProgress?.({loaded:a.loaded,total:a.total})}),{isStreamingSupported:i,isRangeSupported:n,contentLength:r}}),t.on("GetRangeReader",(s,i)=>{W(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const n=this._networkStream.getRangeReader(s.begin,s.end);if(!n){i.close();return}i.onPull=()=>{n.read().then(function({value:r,done:a}){if(a){i.close();return}W(r instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(r),1,[r])}).catch(r=>{i.error(r)})},i.onCancel=r=>{n.cancel(r),i.ready.catch(a=>{if(!this.destroyed)throw a})}}),t.on("GetDoc",({pdfInfo:s})=>{this._numPages=s.numPages,this._htmlForXfa=s.htmlForXfa,delete s.htmlForXfa,e._capability.resolve(new Yl(s,this))}),t.on("DocException",s=>{e._capability.reject(Mt(s))}),t.on("PasswordRequest",s=>{this.#a=Promise.withResolvers();try{if(!e.onPassword)throw Mt(s);const i=n=>{n instanceof Error?this.#a.reject(n):this.#a.resolve({password:n})};e.onPassword(i,s.code)}catch(i){this.#a.reject(i)}return this.#a.promise}),t.on("DataLoaded",s=>{e.onProgress?.({loaded:s.length,total:s.length}),this.downloadInfoCapability.resolve(s)}),t.on("StartRenderPage",s=>{if(this.destroyed)return;this.#e.get(s.pageIndex)._startRenderPage(s.transparency,s.cacheKey)}),t.on("commonobj",([s,i,n])=>{if(this.destroyed||this.commonObjs.has(s))return null;switch(i){case"Font":if("error"in n){const h=n.error;B(`Error during font loading: ${h}`),this.commonObjs.resolve(s,h);break}const r=new K(n),a=this._params.pdfBug&&globalThis.FontInspector?.enabled?(h,d)=>globalThis.FontInspector.fontAdded(h,d):null,l=new el(r,a,n.extra,n.charProcOperatorList);this.fontLoader.bind(l).catch(()=>t.sendWithPromise("FontFallback",{id:s})).finally(()=>{!l.fontExtraProperties&&l.data&&l.clearData(),this.commonObjs.resolve(s,l)});break;case"CopyLocalImage":const{imageRef:c}=n;W(c,"The imageRef must be defined.");for(const h of this.#e.values())for(const[,d]of h.objs)if(d?.ref===c)return d.dataLen?(this.commonObjs.resolve(s,structuredClone(d)),d.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(s,n);break;default:throw new Error(`Got unknown common object type ${i}`)}return null}),t.on("obj",([s,i,n,r])=>{if(this.destroyed)return;const a=this.#e.get(i);if(!a.objs.has(s)){if(a._intentStates.size===0){r?.bitmap?.close();return}switch(n){case"Image":case"Pattern":a.objs.resolve(s,r);break;default:throw new Error(`Got unknown object type ${n}`)}}}),t.on("DocProgress",s=>{this.destroyed||e.onProgress?.({loaded:s.loaded,total:s.total})}),t.on("FetchBinaryData",async s=>{if(this.destroyed)throw new Error("Worker was destroyed.");const i=this[s.type];if(!i)throw new Error(`${s.type} not initialized, see the \`useWorkerFetch\` parameter.`);return i.fetch(s)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&B("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:t,transfer:e}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:t,filename:this._fullReader?.filename??null},e).finally(()=>{this.annotationStorage.resetModified()})}getPage(t){if(!Number.isInteger(t)||t<=0||t>this._numPages)return Promise.reject(new Error("Invalid page request."));const e=t-1,s=this.#i.get(e);if(s)return s;const i=this.messageHandler.sendWithPromise("GetPage",{pageIndex:e}).then(n=>{if(this.destroyed)throw new Error("Transport destroyed");n.refStr&&this.#s.set(n.refStr,t);const r=new Kl(e,n,this,this._params.pdfBug);return this.#e.set(e,r),r});return this.#i.set(e,i),i}getPageIndex(t){return mi(t)?this.messageHandler.sendWithPromise("GetPageIndex",{num:t.num,gen:t.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(t,e){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:t,intent:e})}getFieldObjects(){return this.#n("GetFieldObjects")}hasJSActions(){return this.#n("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(t){return typeof t!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:t})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getAnnotationsByType(t,e){return this.messageHandler.sendWithPromise("GetAnnotationsByType",{types:t,pageIndexesToSkip:e})}getDocJSActions(){return this.#n("GetDocJSActions")}getPageJSActions(t){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:t})}getStructTree(t){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:t})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(t){return this.#n("GetOptionalContentConfig").then(e=>new Ll(e,t))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const t="GetMetadata",e=this.#t.get(t);if(e)return e;const s=this.messageHandler.sendWithPromise(t,null).then(i=>({info:i[0],metadata:i[1]?new Cl(i[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null}));return this.#t.set(t,s),s}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(t=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const e of this.#e.values())if(!e.cleanup())throw new Error(`startCleanup: Page ${e.pageNumber} is currently rendering.`);this.commonObjs.clear(),t||this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(!0),is.cleanup()}}cachedPageNumber(t){if(!mi(t))return null;const e=t.gen===0?`${t.num}R`:`${t.num}R${t.gen}`;return this.#s.get(e)??null}}class Jl{#t=null;onContinue=null;onError=null;constructor(t){this.#t=t}get promise(){return this.#t.capability.promise}cancel(t=0){this.#t.cancel(null,t)}get separateAnnots(){const{separateAnnots:t}=this.#t.operatorList;if(!t)return!1;const{annotationCanvasMap:e}=this.#t;return t.form||t.canvas&&e?.size>0}}class Pe{#t=null;static#e=new WeakSet;constructor({callback:t,params:e,objs:s,commonObjs:i,annotationCanvasMap:n,operatorList:r,pageIndex:a,canvasFactory:l,filterFactory:c,useRequestAnimationFrame:h=!1,pdfBug:d=!1,pageColors:u=null,enableHWA:f=!1,operationsFilter:m=null}){this.callback=t,this.params=e,this.objs=s,this.commonObjs=i,this.annotationCanvasMap=n,this.operatorListIdx=null,this.operatorList=r,this._pageIndex=a,this.canvasFactory=l,this.filterFactory=c,this._pdfBug=d,this.pageColors=u,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=h===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new Jl(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=e.canvas,this._canvasContext=e.canvas?null:e.canvasContext,this._enableHWA=f,this._dependencyTracker=e.dependencyTracker,this._operationsFilter=m}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:t=!1,optionalContentConfig:e}){if(this.cancelled)return;if(this._canvas){if(Pe.#e.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");Pe.#e.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{viewport:s,transform:i,background:n,dependencyTracker:r}=this.params,a=this._canvasContext||this._canvas.getContext("2d",{alpha:!1,willReadFrequently:!this._enableHWA});this.gfx=new Me(a,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:e},this.annotationCanvasMap,this.pageColors,r),this.gfx.beginDrawing({transform:i,viewport:s,transparency:t,background:n}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(t=null,e=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),this.#t&&(window.cancelAnimationFrame(this.#t),this.#t=null),Pe.#e.delete(this._canvas),t||=new zs(`Rendering cancelled, page ${this._pageIndex+1}`,e),this.callback(t),this.task.onError?.(t)}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||=this._continueBound;return}this.gfx.dependencyTracker?.growOperationsCount(this.operatorList.fnArray.length),this.stepper?.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?this.#t=window.requestAnimationFrame(()=>{this.#t=null,this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper,this._operationsFilter),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),Pe.#e.delete(this._canvas),this.callback())))}}const ns="5.4.296",Mr="f56dc8601";class Dt{#t=null;#e=null;#i;#s=null;#a=!1;#n=!1;#r=null;#o;#c=null;#l=null;static#u=null;static get _keyboardManager(){return z(this,"_keyboardManager",new ds([[["Escape","mac+Escape"],Dt.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],Dt.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],Dt.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],Dt.prototype._moveToPrevious],[["Home","mac+Home"],Dt.prototype._moveToBeginning],[["End","mac+End"],Dt.prototype._moveToEnd]]))}constructor({editor:t=null,uiManager:e=null}){t?(this.#n=!1,this.#r=t):this.#n=!0,this.#l=t?._uiManager||e,this.#o=this.#l._eventBus,this.#i=t?.color?.toUpperCase()||this.#l?.highlightColors.values().next().value||"#FFFF98",Dt.#u||=Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"})}renderButton(){const t=this.#t=document.createElement("button");t.className="colorPicker",t.tabIndex="0",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),t.ariaHasPopup="true",this.#r&&(t.ariaControls=`${this.#r.id}_colorpicker_dropdown`);const e=this.#l._signal;t.addEventListener("click",this.#f.bind(this),{signal:e}),t.addEventListener("keydown",this.#m.bind(this),{signal:e});const s=this.#e=document.createElement("span");return s.className="swatch",s.ariaHidden="true",s.style.backgroundColor=this.#i,t.append(s),t}renderMainDropdown(){const t=this.#s=this.#d();return t.ariaOrientation="horizontal",t.ariaLabelledBy="highlightColorPickerLabel",t}#d(){const t=document.createElement("div"),e=this.#l._signal;t.addEventListener("contextmenu",Ft,{signal:e}),t.className="dropdown",t.role="listbox",t.ariaMultiSelectable="false",t.ariaOrientation="vertical",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown"),this.#r&&(t.id=`${this.#r.id}_colorpicker_dropdown`);for(const[s,i]of this.#l.highlightColors){const n=document.createElement("button");n.tabIndex="0",n.role="option",n.setAttribute("data-color",i),n.title=s,n.setAttribute("data-l10n-id",Dt.#u[s]);const r=document.createElement("span");n.append(r),r.className="swatch",r.style.backgroundColor=i,n.ariaSelected=i===this.#i,n.addEventListener("click",this.#p.bind(this,i),{signal:e}),t.append(n)}return t.addEventListener("keydown",this.#m.bind(this),{signal:e}),t}#p(t,e){e.stopPropagation(),this.#o.dispatch("switchannotationeditorparams",{source:this,type:V.HIGHLIGHT_COLOR,value:t}),this.updateColor(t)}_colorSelectFromKeyboard(t){if(t.target===this.#t){this.#f(t);return}const e=t.target.getAttribute("data-color");e&&this.#p(e,t)}_moveToNext(t){if(!this.#g){this.#f(t);return}if(t.target===this.#t){this.#s.firstChild?.focus();return}t.target.nextSibling?.focus()}_moveToPrevious(t){if(t.target===this.#s?.firstChild||t.target===this.#t){this.#g&&this._hideDropdownFromKeyboard();return}this.#g||this.#f(t),t.target.previousSibling?.focus()}_moveToBeginning(t){if(!this.#g){this.#f(t);return}this.#s.firstChild?.focus()}_moveToEnd(t){if(!this.#g){this.#f(t);return}this.#s.lastChild?.focus()}#m(t){Dt._keyboardManager.exec(this,t)}#f(t){if(this.#g){this.hideDropdown();return}if(this.#a=t.detail===0,this.#c||(this.#c=new AbortController,window.addEventListener("pointerdown",this.#h.bind(this),{signal:this.#l.combinedSignal(this.#c)})),this.#t.ariaExpanded="true",this.#s){this.#s.classList.remove("hidden");return}const e=this.#s=this.#d();this.#t.append(e)}#h(t){this.#s?.contains(t.target)||this.hideDropdown()}hideDropdown(){this.#s?.classList.add("hidden"),this.#t.ariaExpanded="false",this.#c?.abort(),this.#c=null}get#g(){return this.#s&&!this.#s.classList.contains("hidden")}_hideDropdownFromKeyboard(){if(!this.#n){if(!this.#g){this.#r?.unselect();return}this.hideDropdown(),this.#t.focus({preventScroll:!0,focusVisible:this.#a})}}updateColor(t){if(this.#e&&(this.#e.style.backgroundColor=t),!this.#s)return;const e=this.#l.highlightColors.values();for(const s of this.#s.children)s.ariaSelected=e.next().value===t.toUpperCase()}destroy(){this.#t?.remove(),this.#t=null,this.#e=null,this.#s?.remove(),this.#s=null}}class rs{#t=null;#e=null;#i=null;static#s=null;constructor(t){this.#e=t,this.#i=t._uiManager,rs.#s||=Object.freeze({freetext:"pdfjs-editor-color-picker-free-text-input",ink:"pdfjs-editor-color-picker-ink-input"})}renderButton(){if(this.#t)return this.#t;const{editorType:t,colorType:e,colorValue:s}=this.#e,i=this.#t=document.createElement("input");return i.type="color",i.value=s||"#000000",i.className="basicColorPicker",i.tabIndex=0,i.setAttribute("data-l10n-id",rs.#s[t]),i.addEventListener("input",()=>{this.#i.updateParams(e,i.value)},{signal:this.#i._signal}),i}update(t){this.#t&&(this.#t.value=t)}destroy(){this.#t?.remove(),this.#t=null}hideDropdown(){}}function Cn(o){return Math.floor(Math.max(0,Math.min(1,o))*255).toString(16).padStart(2,"0")}function We(o){return Math.max(0,Math.min(255,255*o))}class Tn{static CMYK_G([t,e,s,i]){return["G",1-Math.min(1,.3*t+.59*s+.11*e+i)]}static G_CMYK([t]){return["CMYK",0,0,0,1-t]}static G_RGB([t]){return["RGB",t,t,t]}static G_rgb([t]){return t=We(t),[t,t,t]}static G_HTML([t]){const e=Cn(t);return`#${e}${e}${e}`}static RGB_G([t,e,s]){return["G",.3*t+.59*e+.11*s]}static RGB_rgb(t){return t.map(We)}static RGB_HTML(t){return`#${t.map(Cn).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([t,e,s,i]){return["RGB",1-Math.min(1,t+i),1-Math.min(1,s+i),1-Math.min(1,e+i)]}static CMYK_rgb([t,e,s,i]){return[We(1-Math.min(1,t+i)),We(1-Math.min(1,s+i)),We(1-Math.min(1,e+i))]}static CMYK_HTML(t){const e=this.CMYK_RGB(t).slice(1);return this.RGB_HTML(e)}static RGB_CMYK([t,e,s]){const i=1-t,n=1-e,r=1-s,a=Math.min(i,n,r);return["CMYK",i,n,r,a]}}class Zl{create(t,e,s=!1){if(t<=0||e<=0)throw new Error("Invalid SVG dimensions");const i=this._createSVG("svg:svg");return i.setAttribute("version","1.1"),s||(i.setAttribute("width",`${t}px`),i.setAttribute("height",`${e}px`)),i.setAttribute("preserveAspectRatio","none"),i.setAttribute("viewBox",`0 0 ${t} ${e}`),i}createElement(t){if(typeof t!="string")throw new Error("Invalid SVG element type");return this._createSVG(t)}_createSVG(t){J("Abstract method `_createSVG` called.")}}class as extends Zl{_createSVG(t){return document.createElementNS(te,t)}}const tc=9,ye=new WeakSet,ec=new Date().getTimezoneOffset()*60*1e3;class Ln{static create(t){switch(t.data.annotationType){case ht.LINK:return new zi(t);case ht.TEXT:return new ic(t);case ht.WIDGET:switch(t.data.fieldType){case"Tx":return new nc(t);case"Btn":return t.data.radioButton?new Rr(t):t.data.checkBox?new ac(t):new oc(t);case"Ch":return new lc(t);case"Sig":return new rc(t)}return new ve(t);case ht.POPUP:return new wi(t);case ht.FREETEXT:return new Nr(t);case ht.LINE:return new hc(t);case ht.SQUARE:return new dc(t);case ht.CIRCLE:return new uc(t);case ht.POLYLINE:return new Dr(t);case ht.CARET:return new fc(t);case ht.INK:return new Gi(t);case ht.POLYGON:return new pc(t);case ht.HIGHLIGHT:return new Ir(t);case ht.UNDERLINE:return new gc(t);case ht.SQUIGGLY:return new mc(t);case ht.STRIKEOUT:return new bc(t);case ht.STAMP:return new Fr(t);case ht.FILEATTACHMENT:return new yc(t);default:return new lt(t)}}}class lt{#t=null;#e=!1;#i=null;constructor(t,{isRenderable:e=!1,ignoreBorder:s=!1,createQuadrilaterals:i=!1}={}){this.isRenderable=e,this.data=t.data,this.layer=t.layer,this.linkService=t.linkService,this.downloadManager=t.downloadManager,this.imageResourcesPath=t.imageResourcesPath,this.renderForms=t.renderForms,this.svgFactory=t.svgFactory,this.annotationStorage=t.annotationStorage,this.enableComment=t.enableComment,this.enableScripting=t.enableScripting,this.hasJSActions=t.hasJSActions,this._fieldObjects=t.fieldObjects,this.parent=t.parent,e&&(this.container=this._createContainer(s)),i&&this._createQuadrilaterals()}static _hasPopupData({contentsObj:t,richText:e}){return!!(t?.str||e?.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return lt._hasPopupData(this.data)||this.enableComment&&!!this.commentText}get commentData(){const{data:t}=this,e=this.annotationStorage?.getEditor(t.id);return e?e.getData():t}get hasCommentButton(){return this.enableComment&&this.hasPopupElement}get commentButtonPosition(){const t=this.annotationStorage?.getEditor(this.data.id);if(t)return t.commentButtonPositionInPage;const{quadPoints:e,inkLists:s,rect:i}=this.data;let n=-1/0,r=-1/0;if(e?.length>=8){for(let a=0;a<e.length;a+=8)e[a+1]>r?(r=e[a+1],n=e[a+2]):e[a+1]===r&&(n=Math.max(n,e[a+2]));return[n,r]}if(s?.length>=1){for(const a of s)for(let l=0,c=a.length;l<c;l+=2)a[l+1]>r?(r=a[l+1],n=a[l]):a[l+1]===r&&(n=Math.max(n,a[l]));if(n!==1/0)return[n,r]}return i?[i[2],i[3]]:null}_normalizePoint(t){const{page:{view:e},viewport:{rawDims:{pageWidth:s,pageHeight:i,pageX:n,pageY:r}}}=this.parent;return t[1]=e[3]-t[1]+e[1],t[0]=100*(t[0]-n)/s,t[1]=100*(t[1]-r)/i,t}get commentText(){const{data:t}=this;return this.annotationStorage.getRawValue(`${ts}${t.id}`)?.popup?.contents||t.contentsObj?.str||""}set commentText(t){const{data:e}=this,s={deleted:!t,contents:t||""};this.annotationStorage.updateEditor(e.id,{popup:s})||this.annotationStorage.setValue(`${ts}${e.id}`,{id:e.id,annotationType:e.annotationType,pageIndex:this.parent.page._pageIndex,popup:s,popupRef:e.popupRef,modificationDate:new Date}),t||this.removePopup()}removePopup(){(this.#i?.popup||this.popup)?.remove(),this.#i=this.popup=null}updateEdited(t){if(!this.container)return;t.rect&&(this.#t||={rect:this.data.rect.slice(0)});const{rect:e,popup:s}=t;e&&this.#s(e);let i=this.#i?.popup||this.popup;!i&&s?.text&&(this._createPopup(s),i=this.#i.popup),i&&(i.updateEdited(t),s?.deleted&&(i.remove(),this.#i=null,this.popup=null))}resetEdited(){this.#t&&(this.#s(this.#t.rect),this.#i?.popup.resetEdited(),this.#t=null)}#s(t){const{container:{style:e},data:{rect:s,rotation:i},parent:{viewport:{rawDims:{pageWidth:n,pageHeight:r,pageX:a,pageY:l}}}}=this;s?.splice(0,4,...t),e.left=`${100*(t[0]-a)/n}%`,e.top=`${100*(r-t[3]+l)/r}%`,i===0?(e.width=`${100*(t[2]-t[0])/n}%`,e.height=`${100*(t[3]-t[1])/r}%`):this.setRotation(i)}_createContainer(t){const{data:e,parent:{page:s,viewport:i}}=this,n=document.createElement("section");n.setAttribute("data-annotation-id",e.id),!(this instanceof ve)&&!(this instanceof zi)&&(n.tabIndex=0);const{style:r}=n;if(r.zIndex=this.parent.zIndex,this.parent.zIndex+=2,e.alternativeText&&(n.title=e.alternativeText),e.noRotate&&n.classList.add("norotate"),!e.rect||this instanceof wi){const{rotation:g}=e;return!e.hasOwnCanvas&&g!==0&&this.setRotation(g,n),n}const{width:a,height:l}=this;if(!t&&e.borderStyle.width>0){r.borderWidth=`${e.borderStyle.width}px`;const g=e.borderStyle.horizontalCornerRadius,y=e.borderStyle.verticalCornerRadius;if(g>0||y>0){const x=`calc(${g}px * var(--total-scale-factor)) / calc(${y}px * var(--total-scale-factor))`;r.borderRadius=x}else if(this instanceof Rr){const x=`calc(${a}px * var(--total-scale-factor)) / calc(${l}px * var(--total-scale-factor))`;r.borderRadius=x}switch(e.borderStyle.style){case Ee.SOLID:r.borderStyle="solid";break;case Ee.DASHED:r.borderStyle="dashed";break;case Ee.BEVELED:B("Unimplemented border style: beveled");break;case Ee.INSET:B("Unimplemented border style: inset");break;case Ee.UNDERLINE:r.borderBottomStyle="solid";break}const b=e.borderColor||null;b?(this.#e=!0,r.borderColor=D.makeHexColor(b[0]|0,b[1]|0,b[2]|0)):r.borderWidth=0}const c=D.normalizeRect([e.rect[0],s.view[3]-e.rect[1]+s.view[1],e.rect[2],s.view[3]-e.rect[3]+s.view[1]]),{pageWidth:h,pageHeight:d,pageX:u,pageY:f}=i.rawDims;r.left=`${100*(c[0]-u)/h}%`,r.top=`${100*(c[1]-f)/d}%`;const{rotation:m}=e;return e.hasOwnCanvas||m===0?(r.width=`${100*a/h}%`,r.height=`${100*l/d}%`):this.setRotation(m,n),n}setRotation(t,e=this.container){if(!this.data.rect)return;const{pageWidth:s,pageHeight:i}=this.parent.viewport.rawDims;let{width:n,height:r}=this;t%180!==0&&([n,r]=[r,n]),e.style.width=`${100*n/s}%`,e.style.height=`${100*r/i}%`,e.setAttribute("data-main-rotation",(360-t)%360)}get _commonActions(){const t=(e,s,i)=>{const n=i.detail[e],r=n[0],a=n.slice(1);i.target.style[s]=Tn[`${r}_HTML`](a),this.annotationStorage.setValue(this.data.id,{[s]:Tn[`${r}_rgb`](a)})};return z(this,"_commonActions",{display:e=>{const{display:s}=e.detail,i=s%2===1;this.container.style.visibility=i?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:i,noPrint:s===1||s===2})},print:e=>{this.annotationStorage.setValue(this.data.id,{noPrint:!e.detail.print})},hidden:e=>{const{hidden:s}=e.detail;this.container.style.visibility=s?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:s,noView:s})},focus:e=>{setTimeout(()=>e.target.focus({preventScroll:!1}),0)},userName:e=>{e.target.title=e.detail.userName},readonly:e=>{e.target.disabled=e.detail.readonly},required:e=>{this._setRequired(e.target,e.detail.required)},bgColor:e=>{t("bgColor","backgroundColor",e)},fillColor:e=>{t("fillColor","backgroundColor",e)},fgColor:e=>{t("fgColor","color",e)},textColor:e=>{t("textColor","color",e)},borderColor:e=>{t("borderColor","borderColor",e)},strokeColor:e=>{t("strokeColor","borderColor",e)},rotation:e=>{const s=e.detail.rotation;this.setRotation(s),this.annotationStorage.setValue(this.data.id,{rotation:s})}})}_dispatchEventFromSandbox(t,e){const s=this._commonActions;for(const i of Object.keys(e.detail))(t[i]||s[i])?.(e)}_setDefaultPropertiesFromJS(t){if(!this.enableScripting)return;const e=this.annotationStorage.getRawValue(this.data.id);if(!e)return;const s=this._commonActions;for(const[i,n]of Object.entries(e)){const r=s[i];if(r){const a={detail:{[i]:n},target:t};r(a),delete e[i]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:t}=this.data;if(!t)return;const[e,s,i,n]=this.data.rect.map(g=>Math.fround(g));if(t.length===8){const[g,y,b,x]=t.subarray(2,6);if(i===g&&n===y&&e===b&&s===x)return}const{style:r}=this.container;let a;if(this.#e){const{borderColor:g,borderWidth:y}=r;r.borderWidth=0,a=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${g}" stroke-width="${y}">`],this.container.classList.add("hasBorder")}const l=i-e,c=n-s,{svgFactory:h}=this,d=h.createElement("svg");d.classList.add("quadrilateralsContainer"),d.setAttribute("width",0),d.setAttribute("height",0),d.role="none";const u=h.createElement("defs");d.append(u);const f=h.createElement("clipPath"),m=`clippath_${this.data.id}`;f.setAttribute("id",m),f.setAttribute("clipPathUnits","objectBoundingBox"),u.append(f);for(let g=2,y=t.length;g<y;g+=8){const b=t[g],x=t[g+1],w=t[g+2],A=t[g+3],v=h.createElement("rect"),k=(w-e)/l,S=(n-x)/c,_=(b-w)/l,E=(x-A)/c;v.setAttribute("x",k),v.setAttribute("y",S),v.setAttribute("width",_),v.setAttribute("height",E),f.append(v),a?.push(`<rect vector-effect="non-scaling-stroke" x="${k}" y="${S}" width="${_}" height="${E}"/>`)}this.#e&&(a.push("</g></svg>')"),r.backgroundImage=a.join("")),this.container.append(d),this.container.style.clipPath=`url(#${m})`}_createPopup(t=null){const{data:e}=this;let s,i;t?(s={str:t.text},i=t.date):(s=e.contentsObj,i=e.modificationDate);const n=this.#i=new wi({data:{color:e.color,titleObj:e.titleObj,modificationDate:i,contentsObj:s,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation,noRotate:!0},linkService:this.linkService,parent:this.parent,elements:[this]});this.parent._commentManager||this.parent.div.append(n.render())}get hasPopupElement(){return!!(this.#i||this.popup||this.data.popupRef)}get extraPopupElement(){return this.#i}render(){J("Abstract method `AnnotationElement.render` called")}_getElementsByName(t,e=null){const s=[];if(this._fieldObjects){const i=this._fieldObjects[t];if(i)for(const{page:n,id:r,exportValues:a}of i){if(n===-1||r===e)continue;const l=typeof a=="string"?a:null,c=document.querySelector(`[data-element-id="${r}"]`);if(c&&!ye.has(c)){B(`_getElementsByName - element not allowed: ${r}`);continue}s.push({id:r,exportValue:l,domElement:c})}return s}for(const i of document.getElementsByName(t)){const{exportValue:n}=i,r=i.getAttribute("data-element-id");r!==e&&ye.has(i)&&s.push({id:r,exportValue:n,domElement:i})}return s}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const t=this.getElementsToTriggerPopup();if(Array.isArray(t))for(const e of t)e.classList.add("highlightArea");else t.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:t,data:{id:e}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:t,editId:e,mustEnterInEditMode:!0})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}}class sc extends lt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.editor=t.editor}render(){return this.container.className="editorAnnotation",this.container}createOrUpdatePopup(){const{editor:t}=this;t.hasComment&&(this._createPopup(t.comment),this.extraPopupElement.popup.renderCommentButton())}get hasCommentButton(){return this.enableComment&&this.editor.hasComment}get commentButtonPosition(){return this.editor.commentButtonPositionInPage}get commentText(){return this.editor.comment.text}set commentText(t){this.editor.comment=t,t||this.removePopup()}get commentData(){return this.editor.getData()}remove(){this.container.remove(),this.container=null,this.removePopup()}}class zi extends lt{constructor(t,e=null){super(t,{isRenderable:!0,ignoreBorder:!!e?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=t.data.isTooltipOnly}render(){const{data:t,linkService:e}=this,s=document.createElement("a");s.setAttribute("data-element-id",t.id);let i=!1;return t.url?(e.addLinkAttributes(s,t.url,t.newWindow),i=!0):t.action?(this._bindNamedAction(s,t.action,t.overlaidText),i=!0):t.attachment?(this.#e(s,t.attachment,t.overlaidText,t.attachmentDest),i=!0):t.setOCGState?(this.#i(s,t.setOCGState,t.overlaidText),i=!0):t.dest?(this._bindLink(s,t.dest,t.overlaidText),i=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(s,t),i=!0),t.resetForm?(this._bindResetFormAction(s,t.resetForm),i=!0):this.isTooltipOnly&&!i&&(this._bindLink(s,""),i=!0)),this.container.classList.add("linkAnnotation"),i&&this.container.append(s),this.container}#t(){this.container.setAttribute("data-internal-link","")}_bindLink(t,e,s=""){t.href=this.linkService.getDestinationHash(e),t.onclick=()=>(e&&this.linkService.goToDestination(e),!1),(e||e==="")&&this.#t(),s&&(t.title=s)}_bindNamedAction(t,e,s=""){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(e),!1),s&&(t.title=s),this.#t()}#e(t,e,s="",i=null){t.href=this.linkService.getAnchorUrl(""),e.description?t.title=e.description:s&&(t.title=s),t.onclick=()=>(this.downloadManager?.openOrDownloadData(e.content,e.filename,i),!1),this.#t()}#i(t,e,s=""){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeSetOCGState(e),!1),s&&(t.title=s),this.#t()}_bindJSAction(t,e){t.href=this.linkService.getAnchorUrl("");const s=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const i of Object.keys(e.actions)){const n=s.get(i);n&&(t[n]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e.id,name:i}}),!1))}e.overlaidText&&(t.title=e.overlaidText),t.onclick||(t.onclick=()=>!1),this.#t()}_bindResetFormAction(t,e){const s=t.onclick;if(s||(t.href=this.linkService.getAnchorUrl("")),this.#t(),!this._fieldObjects){B('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),s||(t.onclick=()=>!1);return}t.onclick=()=>{s?.();const{fields:i,refs:n,include:r}=e,a=[];if(i.length!==0||n.length!==0){const h=new Set(n);for(const d of i){const u=this._fieldObjects[d]||[];for(const{id:f}of u)h.add(f)}for(const d of Object.values(this._fieldObjects))for(const u of d)h.has(u.id)===r&&a.push(u)}else for(const h of Object.values(this._fieldObjects))a.push(...h);const l=this.annotationStorage,c=[];for(const h of a){const{id:d}=h;switch(c.push(d),h.type){case"text":{const f=h.defaultValue||"";l.setValue(d,{value:f});break}case"checkbox":case"radiobutton":{const f=h.defaultValue===h.exportValues;l.setValue(d,{value:f});break}case"combobox":case"listbox":{const f=h.defaultValue||"";l.setValue(d,{value:f});break}default:continue}const u=document.querySelector(`[data-element-id="${d}"]`);if(u){if(!ye.has(u)){B(`_bindResetFormAction - element not allowed: ${d}`);continue}}else continue;u.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:c,name:"ResetForm"}}),!1}}}class ic extends lt{constructor(t){super(t,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const t=document.createElement("img");return t.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",t.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),t.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(t),this.container}}class ve extends lt{render(){return this.container}showElementAndHideCanvas(t){this.data.hasOwnCanvas&&(t.previousSibling?.nodeName==="CANVAS"&&(t.previousSibling.hidden=!0),t.hidden=!1)}_getKeyModifier(t){return bt.platform.isMac?t.metaKey:t.ctrlKey}_setEventListener(t,e,s,i,n){s.includes("mouse")?t.addEventListener(s,r=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:n(r),shift:r.shiftKey,modifier:this._getKeyModifier(r)}})}):t.addEventListener(s,r=>{if(s==="blur"){if(!e.focused||!r.relatedTarget)return;e.focused=!1}else if(s==="focus"){if(e.focused)return;e.focused=!0}n&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:n(r)}})})}_setEventListeners(t,e,s,i){for(const[n,r]of s)(r==="Action"||this.data.actions?.[r])&&((r==="Focus"||r==="Blur")&&(e||={focused:!1}),this._setEventListener(t,e,n,r,i),r==="Focus"&&!this.data.actions?.Blur?this._setEventListener(t,e,"blur","Blur",null):r==="Blur"&&!this.data.actions?.Focus&&this._setEventListener(t,e,"focus","Focus",null))}_setBackgroundColor(t){const e=this.data.backgroundColor||null;t.style.backgroundColor=e===null?"transparent":D.makeHexColor(e[0],e[1],e[2])}_setTextStyle(t){const e=["left","center","right"],{fontColor:s}=this.data.defaultAppearanceData,i=this.data.defaultAppearanceData.fontSize||tc,n=t.style;let r;const a=2,l=c=>Math.round(10*c)/10;if(this.data.multiLine){const c=Math.abs(this.data.rect[3]-this.data.rect[1]-a),h=Math.round(c/(si*i))||1,d=c/h;r=Math.min(i,l(d/si))}else{const c=Math.abs(this.data.rect[3]-this.data.rect[1]-a);r=Math.min(i,l(c/si))}n.fontSize=`calc(${r}px * var(--total-scale-factor))`,n.color=D.makeHexColor(s[0],s[1],s[2]),this.data.textAlignment!==null&&(n.textAlign=e[this.data.textAlignment])}_setRequired(t,e){e?t.setAttribute("required",!0):t.removeAttribute("required"),t.setAttribute("aria-required",e)}}class nc extends ve{constructor(t){const e=t.renderForms||t.data.hasOwnCanvas||!t.data.hasAppearance&&!!t.data.fieldValue;super(t,{isRenderable:e})}setPropertyOnSiblings(t,e,s,i){const n=this.annotationStorage;for(const r of this._getElementsByName(t.name,t.id))r.domElement&&(r.domElement[e]=s),n.setValue(r.id,{[i]:s})}render(){const t=this.annotationStorage,e=this.data.id;this.container.classList.add("textWidgetAnnotation");let s=null;if(this.renderForms){const i=t.getValue(e,{value:this.data.fieldValue});let n=i.value||"";const r=t.getValue(e,{charLimit:this.data.maxLen}).charLimit;r&&n.length>r&&(n=n.slice(0,r));let a=i.formattedValue||this.data.textContent?.join(`
`)||null;a&&this.data.comb&&(a=a.replaceAll(/\s+/g,""));const l={userValue:n,formattedValue:a,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(s=document.createElement("textarea"),s.textContent=a??n,this.data.doNotScroll&&(s.style.overflowY="hidden")):(s=document.createElement("input"),s.type=this.data.password?"password":"text",s.setAttribute("value",a??n),this.data.doNotScroll&&(s.style.overflowX="hidden")),this.data.hasOwnCanvas&&(s.hidden=!0),ye.add(s),s.setAttribute("data-element-id",e),s.disabled=this.data.readOnly,s.name=this.data.fieldName,s.tabIndex=0;const{datetimeFormat:c,datetimeType:h,timeStep:d}=this.data,u=!!h&&this.enableScripting;c&&(s.title=c),this._setRequired(s,this.data.required),r&&(s.maxLength=r),s.addEventListener("input",m=>{t.setValue(e,{value:m.target.value}),this.setPropertyOnSiblings(s,"value",m.target.value,"value"),l.formattedValue=null}),s.addEventListener("resetform",m=>{const g=this.data.defaultFieldValue??"";s.value=l.userValue=g,l.formattedValue=null});let f=m=>{const{formattedValue:g}=l;g!=null&&(m.target.value=g),m.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){s.addEventListener("focus",g=>{if(l.focused)return;const{target:y}=g;if(u&&(y.type=h,d&&(y.step=d)),l.userValue){const b=l.userValue;if(u)if(h==="time"){const x=new Date(b),w=[x.getHours(),x.getMinutes(),x.getSeconds()];y.value=w.map(A=>A.toString().padStart(2,"0")).join(":")}else y.value=new Date(b-ec).toISOString().split(h==="date"?"T":".",1)[0];else y.value=b}l.lastCommittedValue=y.value,l.commitKey=1,this.data.actions?.Focus||(l.focused=!0)}),s.addEventListener("updatefromsandbox",g=>{this.showElementAndHideCanvas(g.target);const y={value(b){l.userValue=b.detail.value??"",u||t.setValue(e,{value:l.userValue.toString()}),b.target.value=l.userValue},formattedValue(b){const{formattedValue:x}=b.detail;l.formattedValue=x,x!=null&&b.target!==document.activeElement&&(b.target.value=x);const w={formattedValue:x};u&&(w.value=x),t.setValue(e,w)},selRange(b){b.target.setSelectionRange(...b.detail.selRange)},charLimit:b=>{const{charLimit:x}=b.detail,{target:w}=b;if(x===0){w.removeAttribute("maxLength");return}w.setAttribute("maxLength",x);let A=l.userValue;!A||A.length<=x||(A=A.slice(0,x),w.value=l.userValue=A,t.setValue(e,{value:A}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:A,willCommit:!0,commitKey:1,selStart:w.selectionStart,selEnd:w.selectionEnd}}))}};this._dispatchEventFromSandbox(y,g)}),s.addEventListener("keydown",g=>{l.commitKey=1;let y=-1;if(g.key==="Escape"?y=0:g.key==="Enter"&&!this.data.multiLine?y=2:g.key==="Tab"&&(l.commitKey=3),y===-1)return;const{value:b}=g.target;l.lastCommittedValue!==b&&(l.lastCommittedValue=b,l.userValue=b,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:b,willCommit:!0,commitKey:y,selStart:g.target.selectionStart,selEnd:g.target.selectionEnd}}))});const m=f;f=null,s.addEventListener("blur",g=>{if(!l.focused||!g.relatedTarget)return;this.data.actions?.Blur||(l.focused=!1);const{target:y}=g;let{value:b}=y;if(u){if(b&&h==="time"){const x=b.split(":").map(w=>parseInt(w,10));b=new Date(2e3,0,1,x[0],x[1],x[2]||0).valueOf(),y.step=""}else b.includes("T")||(b=`${b}T00:00`),b=new Date(b).valueOf();y.type="text"}l.userValue=b,l.lastCommittedValue!==b&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:b,willCommit:!0,commitKey:l.commitKey,selStart:g.target.selectionStart,selEnd:g.target.selectionEnd}}),m(g)}),this.data.actions?.Keystroke&&s.addEventListener("beforeinput",g=>{l.lastCommittedValue=null;const{data:y,target:b}=g,{value:x,selectionStart:w,selectionEnd:A}=b;let v=w,k=A;switch(g.inputType){case"deleteWordBackward":{const S=x.substring(0,w).match(/\w*[^\w]*$/);S&&(v-=S[0].length);break}case"deleteWordForward":{const S=x.substring(w).match(/^[^\w]*\w*/);S&&(k+=S[0].length);break}case"deleteContentBackward":w===A&&(v-=1);break;case"deleteContentForward":w===A&&(k+=1);break}g.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:x,change:y||"",willCommit:!1,selStart:v,selEnd:k}})}),this._setEventListeners(s,l,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],g=>g.target.value)}if(f&&s.addEventListener("blur",f),this.data.comb){const g=(this.data.rect[2]-this.data.rect[0])/r;s.classList.add("comb"),s.style.letterSpacing=`calc(${g}px * var(--total-scale-factor) - 1ch)`}}else s=document.createElement("div"),s.textContent=this.data.fieldValue,s.style.verticalAlign="middle",s.style.display="table-cell",this.data.hasOwnCanvas&&(s.hidden=!0);return this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class rc extends ve{constructor(t){super(t,{isRenderable:!!t.data.hasOwnCanvas})}}class ac extends ve{constructor(t){super(t,{isRenderable:t.renderForms})}render(){const t=this.annotationStorage,e=this.data,s=e.id;let i=t.getValue(s,{value:e.exportValue===e.fieldValue}).value;typeof i=="string"&&(i=i!=="Off",t.setValue(s,{value:i})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const n=document.createElement("input");return ye.add(n),n.setAttribute("data-element-id",s),n.disabled=e.readOnly,this._setRequired(n,this.data.required),n.type="checkbox",n.name=e.fieldName,i&&n.setAttribute("checked",!0),n.setAttribute("exportValue",e.exportValue),n.tabIndex=0,n.addEventListener("change",r=>{const{name:a,checked:l}=r.target;for(const c of this._getElementsByName(a,s)){const h=l&&c.exportValue===e.exportValue;c.domElement&&(c.domElement.checked=h),t.setValue(c.id,{value:h})}t.setValue(s,{value:l})}),n.addEventListener("resetform",r=>{const a=e.defaultFieldValue||"Off";r.target.checked=a===e.exportValue}),this.enableScripting&&this.hasJSActions&&(n.addEventListener("updatefromsandbox",r=>{const a={value(l){l.target.checked=l.detail.value!=="Off",t.setValue(s,{value:l.target.checked})}};this._dispatchEventFromSandbox(a,r)}),this._setEventListeners(n,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],r=>r.target.checked)),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class Rr extends ve{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const t=this.annotationStorage,e=this.data,s=e.id;let i=t.getValue(s,{value:e.fieldValue===e.buttonValue}).value;if(typeof i=="string"&&(i=i!==e.buttonValue,t.setValue(s,{value:i})),i)for(const r of this._getElementsByName(e.fieldName,s))t.setValue(r.id,{value:!1});const n=document.createElement("input");if(ye.add(n),n.setAttribute("data-element-id",s),n.disabled=e.readOnly,this._setRequired(n,this.data.required),n.type="radio",n.name=e.fieldName,i&&n.setAttribute("checked",!0),n.tabIndex=0,n.addEventListener("change",r=>{const{name:a,checked:l}=r.target;for(const c of this._getElementsByName(a,s))t.setValue(c.id,{value:!1});t.setValue(s,{value:l})}),n.addEventListener("resetform",r=>{const a=e.defaultFieldValue;r.target.checked=a!=null&&a===e.buttonValue}),this.enableScripting&&this.hasJSActions){const r=e.buttonValue;n.addEventListener("updatefromsandbox",a=>{const l={value:c=>{const h=r===c.detail.value;for(const d of this._getElementsByName(c.target.name)){const u=h&&d.id===s;d.domElement&&(d.domElement.checked=u),t.setValue(d.id,{value:u})}}};this._dispatchEventFromSandbox(l,a)}),this._setEventListeners(n,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)}return this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class oc extends zi{constructor(t){super(t,{ignoreBorder:t.data.hasAppearance})}render(){const t=super.render();t.classList.add("buttonWidgetAnnotation","pushButton");const e=t.lastChild;return this.enableScripting&&this.hasJSActions&&e&&(this._setDefaultPropertiesFromJS(e),e.addEventListener("updatefromsandbox",s=>{this._dispatchEventFromSandbox({},s)})),t}}class lc extends ve{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const t=this.annotationStorage,e=this.data.id,s=t.getValue(e,{value:this.data.fieldValue}),i=document.createElement("select");ye.add(i),i.setAttribute("data-element-id",e),i.disabled=this.data.readOnly,this._setRequired(i,this.data.required),i.name=this.data.fieldName,i.tabIndex=0;let n=this.data.combo&&this.data.options.length>0;this.data.combo||(i.size=this.data.options.length,this.data.multiSelect&&(i.multiple=!0)),i.addEventListener("resetform",h=>{const d=this.data.defaultFieldValue;for(const u of i.options)u.selected=u.value===d});for(const h of this.data.options){const d=document.createElement("option");d.textContent=h.displayValue,d.value=h.exportValue,s.value.includes(h.exportValue)&&(d.setAttribute("selected",!0),n=!1),i.append(d)}let r=null;if(n){const h=document.createElement("option");h.value=" ",h.setAttribute("hidden",!0),h.setAttribute("selected",!0),i.prepend(h),r=()=>{h.remove(),i.removeEventListener("input",r),r=null},i.addEventListener("input",r)}const a=h=>{const d=h?"value":"textContent",{options:u,multiple:f}=i;return f?Array.prototype.filter.call(u,m=>m.selected).map(m=>m[d]):u.selectedIndex===-1?null:u[u.selectedIndex][d]};let l=a(!1);const c=h=>{const d=h.target.options;return Array.prototype.map.call(d,u=>({displayValue:u.textContent,exportValue:u.value}))};return this.enableScripting&&this.hasJSActions?(i.addEventListener("updatefromsandbox",h=>{const d={value(u){r?.();const f=u.detail.value,m=new Set(Array.isArray(f)?f:[f]);for(const g of i.options)g.selected=m.has(g.value);t.setValue(e,{value:a(!0)}),l=a(!1)},multipleSelection(u){i.multiple=!0},remove(u){const f=i.options,m=u.detail.remove;f[m].selected=!1,i.remove(m),f.length>0&&Array.prototype.findIndex.call(f,y=>y.selected)===-1&&(f[0].selected=!0),t.setValue(e,{value:a(!0),items:c(u)}),l=a(!1)},clear(u){for(;i.length!==0;)i.remove(0);t.setValue(e,{value:null,items:[]}),l=a(!1)},insert(u){const{index:f,displayValue:m,exportValue:g}=u.detail.insert,y=i.children[f],b=document.createElement("option");b.textContent=m,b.value=g,y?y.before(b):i.append(b),t.setValue(e,{value:a(!0),items:c(u)}),l=a(!1)},items(u){const{items:f}=u.detail;for(;i.length!==0;)i.remove(0);for(const m of f){const{displayValue:g,exportValue:y}=m,b=document.createElement("option");b.textContent=g,b.value=y,i.append(b)}i.options.length>0&&(i.options[0].selected=!0),t.setValue(e,{value:a(!0),items:c(u)}),l=a(!1)},indices(u){const f=new Set(u.detail.indices);for(const m of u.target.options)m.selected=f.has(m.index);t.setValue(e,{value:a(!0)}),l=a(!1)},editable(u){u.target.disabled=!u.detail.editable}};this._dispatchEventFromSandbox(d,h)}),i.addEventListener("input",h=>{const d=a(!0),u=a(!1);t.setValue(e,{value:d}),h.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:l,change:u,changeEx:d,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(i,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],h=>h.target.value)):i.addEventListener("input",function(h){t.setValue(e,{value:a(!0)})}),this.data.combo&&this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class wi extends lt{constructor(t){const{data:e,elements:s,parent:i}=t,n=!!i._commentManager;if(super(t,{isRenderable:!n&&lt._hasPopupData(e)}),this.elements=s,n&&lt._hasPopupData(e)){const r=this.popup=this.#t();for(const a of s)a.popup=r}else this.popup=null}#t(){return new cc({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate||this.data.creationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open,commentManager:this.parent._commentManager})}render(){const{container:t}=this;t.classList.add("popupAnnotation"),t.role="comment";const e=this.popup=this.#t(),s=[];for(const i of this.elements)i.popup=e,i.container.ariaHasPopup="dialog",s.push(i.data.id),i.addHighlightArea();return this.container.setAttribute("aria-controls",s.map(i=>`${Pi}${i}`).join(",")),this.container}}class cc{#t=null;#e=this.#$.bind(this);#i=this.#B.bind(this);#s=this.#N.bind(this);#a=this.#v.bind(this);#n=null;#r=null;#o=null;#c=null;#l=null;#u=null;#d=null;#p=!1;#m=null;#f=null;#h=null;#g=null;#b=null;#w=null;#y=null;#_=null;#k=null;#x=null;#C=!1;#A=null;#S=null;constructor({container:t,color:e,elements:s,titleObj:i,modificationDate:n,contentsObj:r,richText:a,parent:l,rect:c,parentRect:h,open:d,commentManager:u=null}){this.#r=t,this.#k=i,this.#o=r,this.#_=a,this.#u=l,this.#n=e,this.#y=c,this.#d=h,this.#l=s,this.#t=u,this.#A=s[0],this.#c=Fs.toDateObject(n),this.trigger=s.flatMap(f=>f.getElementsToTriggerPopup()),u?this.renderCommentButton():(this.#P(),this.#r.hidden=!0,d&&this.#v())}#P(){if(this.#f)return;this.#f=new AbortController;const{signal:t}=this.#f;for(const e of this.trigger)e.addEventListener("click",this.#a,{signal:t}),e.addEventListener("pointerenter",this.#s,{signal:t}),e.addEventListener("pointerleave",this.#i,{signal:t}),e.classList.add("popupTriggerArea");for(const e of this.#l)e.container?.addEventListener("keydown",this.#e,{signal:t})}#T(){const t=this.#l.find(e=>e.hasCommentButton);t&&(this.#b=t._normalizePoint(t.commentButtonPosition))}renderCommentButton(){if(this.#g||(this.#b||this.#T(),!this.#b))return;const{signal:t}=this.#f=new AbortController,e=!!this.#A.extraPopupElement,s=()=>{this.#t.toggleCommentPopup(this,!0,void 0,!e)},i=()=>{this.#t.toggleCommentPopup(this,!1,!0,!e)},n=()=>{this.#t.toggleCommentPopup(this,!1,!1)};if(e){this.#g=this.#A.container;for(const r of this.trigger)r.ariaHasPopup="dialog",r.ariaControls="commentPopup",r.addEventListener("keydown",this.#e,{signal:t}),r.addEventListener("click",s,{signal:t}),r.addEventListener("pointerenter",i,{signal:t}),r.addEventListener("pointerleave",n,{signal:t}),r.classList.add("popupTriggerArea")}else{const r=this.#g=document.createElement("button");r.className="annotationCommentButton";const a=this.#A.container;r.style.zIndex=a.style.zIndex+1,r.tabIndex=0,r.ariaHasPopup="dialog",r.ariaControls="commentPopup",r.setAttribute("data-l10n-id","pdfjs-show-comment-button"),this.#O(),this.#L(),r.addEventListener("keydown",this.#e,{signal:t}),r.addEventListener("click",s,{signal:t}),r.addEventListener("pointerenter",i,{signal:t}),r.addEventListener("pointerleave",n,{signal:t}),a.after(r)}}#L(){if(this.#A.extraPopupElement&&!this.#A.editor)return;this.renderCommentButton();const[t,e]=this.#b,{style:s}=this.#g;s.left=`calc(${t}%)`,s.top=`calc(${e}% - var(--comment-button-dim))`}#O(){this.#A.extraPopupElement||(this.renderCommentButton(),this.#g.style.backgroundColor=this.commentButtonColor||"")}get commentButtonColor(){const{color:t,opacity:e}=this.#A.commentData;return t?this.#u._commentManager.makeCommentColor(t,e):null}focusCommentButton(){setTimeout(()=>{this.#g?.focus()},0)}getData(){const{richText:t,color:e,opacity:s,creationDate:i,modificationDate:n}=this.#A.commentData;return{contentsObj:{str:this.comment},richText:t,color:e,opacity:s,creationDate:i,modificationDate:n}}get elementBeforePopup(){return this.#g}get comment(){return this.#S||=this.#A.commentText,this.#S}set comment(t){t!==this.comment&&(this.#A.commentText=this.#S=t)}get parentBoundingClientRect(){return this.#A.layer.getBoundingClientRect()}setCommentButtonStates({selected:t,hasPopup:e}){this.#g&&(this.#g.classList.toggle("selected",t),this.#g.ariaExpanded=e)}setSelectedCommentButton(t){this.#g.classList.toggle("selected",t)}get commentPopupPosition(){if(this.#w)return this.#w;const{x:t,y:e,height:s}=this.#g.getBoundingClientRect(),{x:i,y:n,width:r,height:a}=this.#A.layer.getBoundingClientRect();return[(t-i)/r,(e+s-n)/a]}set commentPopupPosition(t){this.#w=t}hasDefaultPopupPosition(){return this.#w===null}get commentButtonPosition(){return this.#b}get commentButtonWidth(){return this.#g.getBoundingClientRect().width/this.parentBoundingClientRect.width}editComment(t){const[e,s]=this.#w||this.commentButtonPosition.map(c=>c/100),i=this.parentBoundingClientRect,{x:n,y:r,width:a,height:l}=i;this.#t.showDialog(null,this,n+e*a,r+s*l,{...t,parentDimensions:i})}render(){if(this.#m)return;const t=this.#m=document.createElement("div");if(t.className="popup",this.#n){const s=t.style.outlineColor=D.makeHexColor(...this.#n);t.style.backgroundColor=`color-mix(in srgb, ${s} 30%, white)`}const e=document.createElement("span");if(e.className="header",this.#k?.str){const s=document.createElement("span");s.className="title",e.append(s),{dir:s.dir,str:s.textContent}=this.#k}if(t.append(e),this.#c){const s=document.createElement("time");s.className="popupDate",s.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),s.setAttribute("data-l10n-args",JSON.stringify({dateObj:this.#c.valueOf()})),s.dateTime=this.#c.toISOString(),e.append(s)}Ri({html:this.#R||this.#o.str,dir:this.#o?.dir,className:"popupContent"},t),this.#r.append(t)}get#R(){const t=this.#_,e=this.#o;return t?.str&&(!e?.str||e.str===t.str)&&this.#_.html||null}get#D(){return this.#R?.attributes?.style?.fontSize||0}get#j(){return this.#R?.attributes?.style?.color||null}#I(t){const e=[],s={str:t,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:e}]}},i={style:{color:this.#j,fontSize:this.#D?`calc(${this.#D}px * var(--total-scale-factor))`:""}};for(const n of t.split(`
`))e.push({name:"span",value:n,attributes:i});return s}#$(t){t.altKey||t.shiftKey||t.ctrlKey||t.metaKey||(t.key==="Enter"||t.key==="Escape"&&this.#p)&&this.#v()}updateEdited({rect:t,popup:e,deleted:s}){if(this.#t){s?(this.remove(),this.#S=null):e&&(e.deleted?this.remove():(this.#O(),this.#S=e.text)),t&&(this.#b=null,this.#T(),this.#L());return}if(s||e?.deleted){this.remove();return}this.#P(),this.#x||={contentsObj:this.#o,richText:this.#_},t&&(this.#h=null),e&&e.text&&(this.#_=this.#I(e.text),this.#c=Fs.toDateObject(e.date),this.#o=null),this.#m?.remove(),this.#m=null}resetEdited(){this.#x&&({contentsObj:this.#o,richText:this.#_}=this.#x,this.#x=null,this.#m?.remove(),this.#m=null,this.#h=null)}remove(){if(this.#f?.abort(),this.#f=null,this.#m?.remove(),this.#m=null,this.#C=!1,this.#p=!1,this.#g?.remove(),this.#g=null,this.trigger)for(const t of this.trigger)t.classList.remove("popupTriggerArea")}#E(){if(this.#h!==null)return;const{page:{view:t},viewport:{rawDims:{pageWidth:e,pageHeight:s,pageX:i,pageY:n}}}=this.#u;let r=!!this.#d,a=r?this.#d:this.#y;for(const m of this.#l)if(!a||D.intersect(m.data.rect,a)!==null){a=m.data.rect,r=!0;break}const l=D.normalizeRect([a[0],t[3]-a[1]+t[1],a[2],t[3]-a[3]+t[1]]),h=r?a[2]-a[0]+5:0,d=l[0]+h,u=l[1];this.#h=[100*(d-i)/e,100*(u-n)/s];const{style:f}=this.#r;f.left=`${this.#h[0]}%`,f.top=`${this.#h[1]}%`}#v(){if(this.#t){this.#t.toggleCommentPopup(this,!1);return}this.#p=!this.#p,this.#p?(this.#N(),this.#r.addEventListener("click",this.#a),this.#r.addEventListener("keydown",this.#e)):(this.#B(),this.#r.removeEventListener("click",this.#a),this.#r.removeEventListener("keydown",this.#e))}#N(){this.#m||this.render(),this.isVisible?this.#p&&this.#r.classList.add("focused"):(this.#E(),this.#r.hidden=!1,this.#r.style.zIndex=parseInt(this.#r.style.zIndex)+1e3)}#B(){this.#r.classList.remove("focused"),!(this.#p||!this.isVisible)&&(this.#r.hidden=!0,this.#r.style.zIndex=parseInt(this.#r.style.zIndex)-1e3)}forceHide(){this.#C=this.isVisible,this.#C&&(this.#r.hidden=!0)}maybeShow(){this.#t||(this.#P(),this.#C&&(this.#m||this.#N(),this.#C=!1,this.#r.hidden=!1))}get isVisible(){return this.#t?!1:this.#r.hidden===!1}}class Nr extends lt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.textContent=t.data.textContent,this.textPosition=t.data.textPosition,this.annotationEditorType=j.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const t=document.createElement("div");t.classList.add("annotationTextContent"),t.setAttribute("role","comment");for(const e of this.textContent){const s=document.createElement("span");s.textContent=e,t.append(s)}this.container.append(t)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}class hc extends lt{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");const{data:t,width:e,height:s}=this,i=this.svgFactory.create(e,s,!0),n=this.#t=this.svgFactory.createElement("svg:line");return n.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),n.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),n.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),n.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),n.setAttribute("stroke-width",t.borderStyle.width||1),n.setAttribute("stroke","transparent"),n.setAttribute("fill","transparent"),i.append(n),this.container.append(i),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class dc extends lt{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");const{data:t,width:e,height:s}=this,i=this.svgFactory.create(e,s,!0),n=t.borderStyle.width,r=this.#t=this.svgFactory.createElement("svg:rect");return r.setAttribute("x",n/2),r.setAttribute("y",n/2),r.setAttribute("width",e-n),r.setAttribute("height",s-n),r.setAttribute("stroke-width",n||1),r.setAttribute("stroke","transparent"),r.setAttribute("fill","transparent"),i.append(r),this.container.append(i),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class uc extends lt{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");const{data:t,width:e,height:s}=this,i=this.svgFactory.create(e,s,!0),n=t.borderStyle.width,r=this.#t=this.svgFactory.createElement("svg:ellipse");return r.setAttribute("cx",e/2),r.setAttribute("cy",s/2),r.setAttribute("rx",e/2-n/2),r.setAttribute("ry",s/2-n/2),r.setAttribute("stroke-width",n||1),r.setAttribute("stroke","transparent"),r.setAttribute("fill","transparent"),i.append(r),this.container.append(i),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class Dr extends lt{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,vertices:e,borderStyle:s,popupRef:i},width:n,height:r}=this;if(!e)return this.container;const a=this.svgFactory.create(n,r,!0);let l=[];for(let h=0,d=e.length;h<d;h+=2){const u=e[h]-t[0],f=t[3]-e[h+1];l.push(`${u},${f}`)}l=l.join(" ");const c=this.#t=this.svgFactory.createElement(this.svgElementName);return c.setAttribute("points",l),c.setAttribute("stroke-width",s.width||1),c.setAttribute("stroke","transparent"),c.setAttribute("fill","transparent"),a.append(c),this.container.append(a),!i&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class pc extends Dr{constructor(t){super(t),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class fc extends lt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class Gi extends lt{#t=null;#e=[];constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?j.HIGHLIGHT:j.INK}#i(t,e){switch(t){case 90:return{transform:`rotate(90) translate(${-e[0]},${e[1]}) scale(1,-1)`,width:e[3]-e[1],height:e[2]-e[0]};case 180:return{transform:`rotate(180) translate(${-e[2]},${e[1]}) scale(1,-1)`,width:e[2]-e[0],height:e[3]-e[1]};case 270:return{transform:`rotate(270) translate(${-e[2]},${e[3]}) scale(1,-1)`,width:e[3]-e[1],height:e[2]-e[0]};default:return{transform:`translate(${-e[0]},${e[3]}) scale(1,-1)`,width:e[2]-e[0],height:e[3]-e[1]}}}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,rotation:e,inkLists:s,borderStyle:i,popupRef:n}}=this,{transform:r,width:a,height:l}=this.#i(e,t),c=this.svgFactory.create(a,l,!0),h=this.#t=this.svgFactory.createElement("svg:g");c.append(h),h.setAttribute("stroke-width",i.width||1),h.setAttribute("stroke-linecap","round"),h.setAttribute("stroke-linejoin","round"),h.setAttribute("stroke-miterlimit",10),h.setAttribute("stroke","transparent"),h.setAttribute("fill","transparent"),h.setAttribute("transform",r);for(let d=0,u=s.length;d<u;d++){const f=this.svgFactory.createElement(this.svgElementName);this.#e.push(f),f.setAttribute("points",s[d].join(",")),h.append(f)}return!n&&this.hasPopupData&&this._createPopup(),this.container.append(c),this._editOnDoubleClick(),this.container}updateEdited(t){super.updateEdited(t);const{thickness:e,points:s,rect:i}=t,n=this.#t;if(e>=0&&n.setAttribute("stroke-width",e||1),s)for(let r=0,a=this.#e.length;r<a;r++)this.#e[r].setAttribute("points",s[r].join(","));if(i){const{transform:r,width:a,height:l}=this.#i(this.data.rotation,i);n.parentElement.setAttribute("viewBox",`0 0 ${a} ${l}`),n.setAttribute("transform",r)}}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class Ir extends lt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=j.HIGHLIGHT}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),t){const s=document.createElement("mark");s.classList.add("overlaidText"),s.textContent=t,this.container.append(s)}return this.container}}class gc extends lt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),t){const s=document.createElement("u");s.classList.add("overlaidText"),s.textContent=t,this.container.append(s)}return this.container}}class mc extends lt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),t){const s=document.createElement("u");s.classList.add("overlaidText"),s.textContent=t,this.container.append(s)}return this.container}}class bc extends lt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),t){const s=document.createElement("s");s.classList.add("overlaidText"),s.textContent=t,this.container.append(s)}return this.container}}class Fr extends lt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=j.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}class yc extends lt{#t=null;constructor(t){super(t,{isRenderable:!0});const{file:e}=this.data;this.filename=e.filename,this.content=e.content,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,...e})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:t,data:e}=this;let s;e.hasAppearance||e.fillAlpha===0?s=document.createElement("div"):(s=document.createElement("img"),s.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(e.name)?"paperclip":"pushpin"}.svg`,e.fillAlpha&&e.fillAlpha<1&&(s.style=`filter: opacity(${Math.round(e.fillAlpha*100)}%);`)),s.addEventListener("dblclick",this.#e.bind(this)),this.#t=s;const{isMac:i}=bt.platform;return t.addEventListener("keydown",n=>{n.key==="Enter"&&(i?n.metaKey:n.ctrlKey)&&this.#e()}),!e.popupRef&&this.hasPopupData?this._createPopup():s.classList.add("popupTriggerArea"),t.append(s),t}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}#e(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}}let $i=class Or{#t=null;#e=null;#i=null;#s=new Map;#a=null;#n=null;constructor({div:t,accessibilityManager:e,annotationCanvasMap:s,annotationEditorUIManager:i,page:n,viewport:r,structTreeLayer:a,commentManager:l,linkService:c,annotationStorage:h}){this.div=t,this.#t=e,this.#e=s,this.#a=a||null,this.#n=c||null,this.#i=h||new Ii,this.page=n,this.viewport=r,this.zIndex=0,this._annotationEditorUIManager=i,this._commentManager=l||null}hasEditableAnnotations(){return this.#s.size>0}async#r(t,e,s){const i=t.firstChild||t,n=i.id=`${Pi}${e}`,r=await this.#a?.getAriaAttributes(n);if(r)for(const[a,l]of r)i.setAttribute(a,l);s?s.at(-1).container.after(t):(this.div.append(t),this.#t?.moveElementInDOM(this.div,t,i,!1))}async render(t){const{annotations:e}=t,s=this.div;ce(s,this.viewport);const i=new Map,n={data:null,layer:s,linkService:this.#n,downloadManager:t.downloadManager,imageResourcesPath:t.imageResourcesPath||"",renderForms:t.renderForms!==!1,svgFactory:new as,annotationStorage:this.#i,enableComment:t.enableComment===!0,enableScripting:t.enableScripting===!0,hasJSActions:t.hasJSActions,fieldObjects:t.fieldObjects,parent:this,elements:null};for(const r of e){if(r.noHTML)continue;const a=r.annotationType===ht.POPUP;if(a){const h=i.get(r.id);if(!h)continue;n.elements=h}else if(r.rect[2]===r.rect[0]||r.rect[3]===r.rect[1])continue;n.data=r;const l=Ln.create(n);if(!l.isRenderable)continue;if(!a&&r.popupRef){const h=i.get(r.popupRef);h?h.push(l):i.set(r.popupRef,[l])}const c=l.render();r.hidden&&(c.style.visibility="hidden"),await this.#r(c,r.id,n.elements),l.extraPopupElement?.popup?.renderCommentButton(),l._isEditable&&(this.#s.set(l.data.id,l),this._annotationEditorUIManager?.renderAnnotationElement(l))}this.#o()}async addLinkAnnotations(t){const e={data:null,layer:this.div,linkService:this.#n,svgFactory:new as,parent:this};for(const s of t){s.borderStyle||=Or._defaultBorderStyle,e.data=s;const i=Ln.create(e);if(!i.isRenderable)continue;const n=i.render();await this.#r(n,s.id,null)}}update({viewport:t}){const e=this.div;this.viewport=t,ce(e,{rotation:t.rotation}),this.#o(),e.hidden=!1}#o(){if(!this.#e)return;const t=this.div;for(const[e,s]of this.#e){const i=t.querySelector(`[data-annotation-id="${e}"]`);if(!i)continue;s.className="annotationContent";const{firstChild:n}=i;n?n.nodeName==="CANVAS"?n.replaceWith(s):n.classList.contains("annotationContent")?n.after(s):n.before(s):i.append(s);const r=this.#s.get(e);r&&(r._hasNoCanvas?(this._annotationEditorUIManager?.setMissingCanvas(e,i.id,s),r._hasNoCanvas=!1):r.canvas=s)}this.#e.clear()}getEditableAnnotations(){return Array.from(this.#s.values())}getEditableAnnotation(t){return this.#s.get(t)}addFakeAnnotation(t){const{div:e}=this,{id:s,rotation:i}=t,n=new sc({data:{id:s,rect:t.getPDFRect(),rotation:i},editor:t,layer:e,parent:this,enableComment:!!this._commentManager,linkService:this.#n,annotationStorage:this.#i}),r=n.render();return e.append(r),this.#t?.moveElementInDOM(e,r,r,!1),n.createOrUpdatePopup(),n}static get _defaultBorderStyle(){return z(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:Ee.SOLID,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}};const Ts=/\r\n?|\n/g;class gt extends I{#t="";#e=`${this.id}-editor`;#i=null;#s;_colorPicker=null;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){const t=gt.prototype,e=n=>n.isEmpty(),s=ne.TRANSLATE_SMALL,i=ne.TRANSLATE_BIG;return z(this,"_keyboardManager",new ds([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-s,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-i,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[s,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[i,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-s],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-i],checker:e}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,s],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,i],checker:e}]]))}static _type="freetext";static _editorType=j.FREETEXT;constructor(t){super({...t,name:"freeTextEditor"}),this.color=t.color||gt._defaultColor||I._defaultLineColor,this.#s=t.fontSize||gt._defaultFontSize,this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-freetext-added-alert")}static initialize(t,e){I.initialize(t,e);const s=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(s.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,e){switch(t){case V.FREETEXT_SIZE:gt._defaultFontSize=e;break;case V.FREETEXT_COLOR:gt._defaultColor=e;break}}updateParams(t,e){switch(t){case V.FREETEXT_SIZE:this.#a(e);break;case V.FREETEXT_COLOR:this.#n(e);break}}static get defaultPropertiesToUpdate(){return[[V.FREETEXT_SIZE,gt._defaultFontSize],[V.FREETEXT_COLOR,gt._defaultColor||I._defaultLineColor]]}get propertiesToUpdate(){return[[V.FREETEXT_SIZE,this.#s],[V.FREETEXT_COLOR,this.color]]}get toolbarButtons(){return this._colorPicker||=new rs(this),[["colorPicker",this._colorPicker]]}get colorType(){return V.FREETEXT_COLOR}#a(t){const e=i=>{this.editorDiv.style.fontSize=`calc(${i}px * var(--total-scale-factor))`,this.translate(0,-(i-this.#s)*this.parentScale),this.#s=i,this.#o()},s=this.#s;this.addCommands({cmd:e.bind(this,t),undo:e.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:V.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}onUpdatedColor(){this.editorDiv.style.color=this.color,this._colorPicker?.update(this.color),super.onUpdatedColor()}#n(t){const e=i=>{this.color=i,this.onUpdatedColor()},s=this.color;this.addCommands({cmd:e.bind(this,t),undo:e.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:V.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(t,e){this._uiManager.translateSelectedEditors(t,e,!0)}getInitialTranslation(){const t=this.parentScale;return[-gt._internalPadding*t,-(gt._internalPadding+this.#s)*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(!super.enableEditMode())return!1;this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.#i=new AbortController;const t=this._uiManager.combinedSignal(this.#i);return this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t}),!0}disableEditMode(){return super.disableEditMode()?(this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#e),this._isDraggable=!0,this.#i?.abort(),this.#i=null,this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"),!0):!1}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(t){this.width||(this.enableEditMode(),t&&this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}#r(){const t=[];this.editorDiv.normalize();let e=null;for(const s of this.editorDiv.childNodes)e?.nodeType===Node.TEXT_NODE&&s.nodeName==="BR"||(t.push(gt.#c(s)),e=s);return t.join(`
`)}#o(){const[t,e]=this.parentDimensions;let s;if(this.isAttachedToDOM)s=this.div.getBoundingClientRect();else{const{currentLayer:i,div:n}=this,r=n.style.display,a=n.classList.contains("hidden");n.classList.remove("hidden"),n.style.display="hidden",i.div.append(this.div),s=n.getBoundingClientRect(),n.remove(),n.style.display=r,n.classList.toggle("hidden",a)}this.rotation%180===this.parentRotation%180?(this.width=s.width/t,this.height=s.height/e):(this.width=s.height/t,this.height=s.width/e),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const t=this.#t,e=this.#t=this.#r().trimEnd();if(t===e)return;const s=i=>{if(this.#t=i,!i){this.remove();return}this.#l(),this._uiManager.rebuild(this),this.#o()};this.addCommands({cmd:()=>{s(e)},undo:()=>{s(t)},mustExec:!1}),this.#o()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}keydown(t){t.target===this.div&&t.key==="Enter"&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){gt._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}get canChangeContent(){return!0}render(){if(this.div)return this.div;let t,e;(this._isCopy||this.annotationElementId)&&(t=this.x,e=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#e),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:s}=this.editorDiv;if(s.fontSize=`calc(${this.#s}px * var(--total-scale-factor))`,s.color=this.color,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),this._isCopy||this.annotationElementId){const[i,n]=this.parentDimensions;if(this.annotationElementId){const{position:r}=this._initialData;let[a,l]=this.getInitialTranslation();[a,l]=this.pageTranslationToScreen(a,l);const[c,h]=this.pageDimensions,[d,u]=this.pageTranslation;let f,m;switch(this.rotation){case 0:f=t+(r[0]-d)/c,m=e+this.height-(r[1]-u)/h;break;case 90:f=t+(r[0]-d)/c,m=e-(r[1]-u)/h,[a,l]=[l,-a];break;case 180:f=t-this.width+(r[0]-d)/c,m=e-(r[1]-u)/h,[a,l]=[-a,-l];break;case 270:f=t+(r[0]-d-this.height*h)/c,m=e+(r[1]-u-this.width*c)/h,[a,l]=[-l,a];break}this.setAt(f*i,m*n,a,l)}else this._moveAfterPaste(t,e);this.#l(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}static#c(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(Ts,"")}editorDivPaste(t){const e=t.clipboardData||window.clipboardData,{types:s}=e;if(s.length===1&&s[0]==="text/plain")return;t.preventDefault();const i=gt.#d(e.getData("text")||"").replaceAll(Ts,`
`);if(!i)return;const n=window.getSelection();if(!n.rangeCount)return;this.editorDiv.normalize(),n.deleteFromDocument();const r=n.getRangeAt(0);if(!i.includes(`
`)){r.insertNode(document.createTextNode(i)),this.editorDiv.normalize(),n.collapseToStart();return}const{startContainer:a,startOffset:l}=r,c=[],h=[];if(a.nodeType===Node.TEXT_NODE){const f=a.parentElement;if(h.push(a.nodeValue.slice(l).replaceAll(Ts,"")),f!==this.editorDiv){let m=c;for(const g of this.editorDiv.childNodes){if(g===f){m=h;continue}m.push(gt.#c(g))}}c.push(a.nodeValue.slice(0,l).replaceAll(Ts,""))}else if(a===this.editorDiv){let f=c,m=0;for(const g of this.editorDiv.childNodes)m++===l&&(f=h),f.push(gt.#c(g))}this.#t=`${c.join(`
`)}${i}${h.join(`
`)}`,this.#l();const d=new Range;let u=Math.sumPrecise(c.map(f=>f.length));for(const{firstChild:f}of this.editorDiv.childNodes)if(f.nodeType===Node.TEXT_NODE){const m=f.nodeValue.length;if(u<=m){d.setStart(f,u),d.setEnd(f,u);break}u-=m}n.removeAllRanges(),n.addRange(d)}#l(){if(this.editorDiv.replaceChildren(),!!this.#t)for(const t of this.#t.split(`
`)){const e=document.createElement("div");e.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(e)}}#u(){return this.#t.replaceAll(""," ")}static#d(t){return t.replaceAll(" ","")}get contentDiv(){return this.editorDiv}getPDFRect(){const t=gt._internalPadding*this.parentScale;return this.getRect(t,t)}static async deserialize(t,e,s){let i=null;if(t instanceof Nr){const{data:{defaultAppearanceData:{fontSize:r,fontColor:a},rect:l,rotation:c,id:h,popupRef:d,richText:u,contentsObj:f,creationDate:m,modificationDate:g},textContent:y,textPosition:b,parent:{page:{pageNumber:x}}}=t;if(!y||y.length===0)return null;i=t={annotationType:j.FREETEXT,color:Array.from(a),fontSize:r,value:y.join(`
`),position:b,pageIndex:x-1,rect:l.slice(0),rotation:c,annotationElementId:h,id:h,deleted:!1,popupRef:d,comment:f?.str||null,richText:u,creationDate:m,modificationDate:g}}const n=await super.deserialize(t,e,s);return n.#s=t.fontSize,n.color=D.makeHexColor(...t.color),n.#t=gt.#d(t.value),n._initialData=i,t.comment&&n.setCommentData(t),n}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const e=I._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.color),s=Object.assign(super.serialize(t),{color:e,fontSize:this.#s,value:this.#u()});return this.addComment(s),t?(s.isCopy=!0,s):this.annotationElementId&&!this.#p(s)?null:(s.id=this.annotationElementId,s)}#p(t){const{value:e,fontSize:s,color:i,pageIndex:n}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||t.value!==e||t.fontSize!==s||t.color.some((r,a)=>r!==i[a])||t.pageIndex!==n}renderAnnotationElement(t){const e=super.renderAnnotationElement(t);if(!e)return null;const{style:s}=e;s.fontSize=`calc(${this.#s}px * var(--total-scale-factor))`,s.color=this.color,e.replaceChildren();for(const i of this.#t.split(`
`)){const n=document.createElement("div");n.append(i?document.createTextNode(i):document.createElement("br")),e.append(n)}return t.updateEdited({rect:this.getPDFRect(),popup:this._uiManager.hasCommentManager()||this.hasEditedComment?this.comment:{text:this.#t}}),e}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}}class N{static PRECISION=1e-4;toSVGPath(){J("Abstract method `toSVGPath` must be implemented.")}get box(){J("Abstract getter `box` must be implemented.")}serialize(t,e){J("Abstract method `serialize` must be implemented.")}static _rescale(t,e,s,i,n,r){r||=new Float32Array(t.length);for(let a=0,l=t.length;a<l;a+=2)r[a]=e+t[a]*i,r[a+1]=s+t[a+1]*n;return r}static _rescaleAndSwap(t,e,s,i,n,r){r||=new Float32Array(t.length);for(let a=0,l=t.length;a<l;a+=2)r[a]=e+t[a+1]*i,r[a+1]=s+t[a]*n;return r}static _translate(t,e,s,i){i||=new Float32Array(t.length);for(let n=0,r=t.length;n<r;n+=2)i[n]=e+t[n],i[n+1]=s+t[n+1];return i}static svgRound(t){return Math.round(t*1e4)}static _normalizePoint(t,e,s,i,n){switch(n){case 90:return[1-e/s,t/i];case 180:return[1-t/s,1-e/i];case 270:return[e/s,1-t/i];default:return[t/s,e/i]}}static _normalizePagePoint(t,e,s){switch(s){case 90:return[1-e,t];case 180:return[1-t,1-e];case 270:return[e,1-t];default:return[t,e]}}static createBezierPoints(t,e,s,i,n,r){return[(t+5*s)/6,(e+5*i)/6,(5*s+n)/6,(5*i+r)/6,(s+n)/2,(i+r)/2]}}class ue{#t;#e=[];#i;#s;#a=[];#n=new Float32Array(18);#r;#o;#c;#l;#u;#d;#p=[];static#m=8;static#f=2;static#h=ue.#m+ue.#f;constructor({x:t,y:e},s,i,n,r,a=0){this.#t=s,this.#d=n*i,this.#s=r,this.#n.set([NaN,NaN,NaN,NaN,t,e],6),this.#i=a,this.#l=ue.#m*i,this.#c=ue.#h*i,this.#u=i,this.#p.push(t,e)}isEmpty(){return isNaN(this.#n[8])}#g(){const t=this.#n.subarray(4,6),e=this.#n.subarray(16,18),[s,i,n,r]=this.#t;return[(this.#r+(t[0]-e[0])/2-s)/n,(this.#o+(t[1]-e[1])/2-i)/r,(this.#r+(e[0]-t[0])/2-s)/n,(this.#o+(e[1]-t[1])/2-i)/r]}add({x:t,y:e}){this.#r=t,this.#o=e;const[s,i,n,r]=this.#t;let[a,l,c,h]=this.#n.subarray(8,12);const d=t-c,u=e-h,f=Math.hypot(d,u);if(f<this.#c)return!1;const m=f-this.#l,g=m/f,y=g*d,b=g*u;let x=a,w=l;a=c,l=h,c+=y,h+=b,this.#p?.push(t,e);const A=-b/m,v=y/m,k=A*this.#d,S=v*this.#d;return this.#n.set(this.#n.subarray(2,8),0),this.#n.set([c+k,h+S],4),this.#n.set(this.#n.subarray(14,18),12),this.#n.set([c-k,h-S],16),isNaN(this.#n[6])?(this.#a.length===0&&(this.#n.set([a+k,l+S],2),this.#a.push(NaN,NaN,NaN,NaN,(a+k-s)/n,(l+S-i)/r),this.#n.set([a-k,l-S],14),this.#e.push(NaN,NaN,NaN,NaN,(a-k-s)/n,(l-S-i)/r)),this.#n.set([x,w,a,l,c,h],6),!this.isEmpty()):(this.#n.set([x,w,a,l,c,h],6),Math.abs(Math.atan2(w-l,x-a)-Math.atan2(b,y))<Math.PI/2?([a,l,c,h]=this.#n.subarray(2,6),this.#a.push(NaN,NaN,NaN,NaN,((a+c)/2-s)/n,((l+h)/2-i)/r),[a,l,x,w]=this.#n.subarray(14,18),this.#e.push(NaN,NaN,NaN,NaN,((x+a)/2-s)/n,((w+l)/2-i)/r),!0):([x,w,a,l,c,h]=this.#n.subarray(0,6),this.#a.push(((x+5*a)/6-s)/n,((w+5*l)/6-i)/r,((5*a+c)/6-s)/n,((5*l+h)/6-i)/r,((a+c)/2-s)/n,((l+h)/2-i)/r),[c,h,a,l,x,w]=this.#n.subarray(12,18),this.#e.push(((x+5*a)/6-s)/n,((w+5*l)/6-i)/r,((5*a+c)/6-s)/n,((5*l+h)/6-i)/r,((a+c)/2-s)/n,((l+h)/2-i)/r),!0))}toSVGPath(){if(this.isEmpty())return"";const t=this.#a,e=this.#e;if(isNaN(this.#n[6])&&!this.isEmpty())return this.#b();const s=[];s.push(`M${t[4]} ${t[5]}`);for(let i=6;i<t.length;i+=6)isNaN(t[i])?s.push(`L${t[i+4]} ${t[i+5]}`):s.push(`C${t[i]} ${t[i+1]} ${t[i+2]} ${t[i+3]} ${t[i+4]} ${t[i+5]}`);this.#y(s);for(let i=e.length-6;i>=6;i-=6)isNaN(e[i])?s.push(`L${e[i+4]} ${e[i+5]}`):s.push(`C${e[i]} ${e[i+1]} ${e[i+2]} ${e[i+3]} ${e[i+4]} ${e[i+5]}`);return this.#w(s),s.join(" ")}#b(){const[t,e,s,i]=this.#t,[n,r,a,l]=this.#g();return`M${(this.#n[2]-t)/s} ${(this.#n[3]-e)/i} L${(this.#n[4]-t)/s} ${(this.#n[5]-e)/i} L${n} ${r} L${a} ${l} L${(this.#n[16]-t)/s} ${(this.#n[17]-e)/i} L${(this.#n[14]-t)/s} ${(this.#n[15]-e)/i} Z`}#w(t){const e=this.#e;t.push(`L${e[4]} ${e[5]} Z`)}#y(t){const[e,s,i,n]=this.#t,r=this.#n.subarray(4,6),a=this.#n.subarray(16,18),[l,c,h,d]=this.#g();t.push(`L${(r[0]-e)/i} ${(r[1]-s)/n} L${l} ${c} L${h} ${d} L${(a[0]-e)/i} ${(a[1]-s)/n}`)}newFreeDrawOutline(t,e,s,i,n,r){return new jr(t,e,s,i,n,r)}getOutlines(){const t=this.#a,e=this.#e,s=this.#n,[i,n,r,a]=this.#t,l=new Float32Array((this.#p?.length??0)+2);for(let d=0,u=l.length-2;d<u;d+=2)l[d]=(this.#p[d]-i)/r,l[d+1]=(this.#p[d+1]-n)/a;if(l[l.length-2]=(this.#r-i)/r,l[l.length-1]=(this.#o-n)/a,isNaN(s[6])&&!this.isEmpty())return this.#_(l);const c=new Float32Array(this.#a.length+24+this.#e.length);let h=t.length;for(let d=0;d<h;d+=2){if(isNaN(t[d])){c[d]=c[d+1]=NaN;continue}c[d]=t[d],c[d+1]=t[d+1]}h=this.#x(c,h);for(let d=e.length-6;d>=6;d-=6)for(let u=0;u<6;u+=2){if(isNaN(e[d+u])){c[h]=c[h+1]=NaN,h+=2;continue}c[h]=e[d+u],c[h+1]=e[d+u+1],h+=2}return this.#k(c,h),this.newFreeDrawOutline(c,l,this.#t,this.#u,this.#i,this.#s)}#_(t){const e=this.#n,[s,i,n,r]=this.#t,[a,l,c,h]=this.#g(),d=new Float32Array(36);return d.set([NaN,NaN,NaN,NaN,(e[2]-s)/n,(e[3]-i)/r,NaN,NaN,NaN,NaN,(e[4]-s)/n,(e[5]-i)/r,NaN,NaN,NaN,NaN,a,l,NaN,NaN,NaN,NaN,c,h,NaN,NaN,NaN,NaN,(e[16]-s)/n,(e[17]-i)/r,NaN,NaN,NaN,NaN,(e[14]-s)/n,(e[15]-i)/r],0),this.newFreeDrawOutline(d,t,this.#t,this.#u,this.#i,this.#s)}#k(t,e){const s=this.#e;return t.set([NaN,NaN,NaN,NaN,s[4],s[5]],e),e+=6}#x(t,e){const s=this.#n.subarray(4,6),i=this.#n.subarray(16,18),[n,r,a,l]=this.#t,[c,h,d,u]=this.#g();return t.set([NaN,NaN,NaN,NaN,(s[0]-n)/a,(s[1]-r)/l,NaN,NaN,NaN,NaN,c,h,NaN,NaN,NaN,NaN,d,u,NaN,NaN,NaN,NaN,(i[0]-n)/a,(i[1]-r)/l],e),e+=24}}class jr extends N{#t;#e=new Float32Array(4);#i;#s;#a;#n;#r;constructor(t,e,s,i,n,r){super(),this.#r=t,this.#a=e,this.#t=s,this.#n=i,this.#i=n,this.#s=r,this.firstPoint=[NaN,NaN],this.lastPoint=[NaN,NaN],this.#o(r);const[a,l,c,h]=this.#e;for(let d=0,u=t.length;d<u;d+=2)t[d]=(t[d]-a)/c,t[d+1]=(t[d+1]-l)/h;for(let d=0,u=e.length;d<u;d+=2)e[d]=(e[d]-a)/c,e[d+1]=(e[d+1]-l)/h}toSVGPath(){const t=[`M${this.#r[4]} ${this.#r[5]}`];for(let e=6,s=this.#r.length;e<s;e+=6){if(isNaN(this.#r[e])){t.push(`L${this.#r[e+4]} ${this.#r[e+5]}`);continue}t.push(`C${this.#r[e]} ${this.#r[e+1]} ${this.#r[e+2]} ${this.#r[e+3]} ${this.#r[e+4]} ${this.#r[e+5]}`)}return t.push("Z"),t.join(" ")}serialize([t,e,s,i],n){const r=s-t,a=i-e;let l,c;switch(n){case 0:l=N._rescale(this.#r,t,i,r,-a),c=N._rescale(this.#a,t,i,r,-a);break;case 90:l=N._rescaleAndSwap(this.#r,t,e,r,a),c=N._rescaleAndSwap(this.#a,t,e,r,a);break;case 180:l=N._rescale(this.#r,s,e,-r,a),c=N._rescale(this.#a,s,e,-r,a);break;case 270:l=N._rescaleAndSwap(this.#r,s,i,-r,-a),c=N._rescaleAndSwap(this.#a,s,i,-r,-a);break}return{outline:Array.from(l),points:[Array.from(c)]}}#o(t){const e=this.#r;let s=e[4],i=e[5];const n=[s,i,s,i];let r=s,a=i,l=s,c=i;const h=t?Math.max:Math.min,d=new Float32Array(4);for(let f=6,m=e.length;f<m;f+=6){const g=e[f+4],y=e[f+5];isNaN(e[f])?(D.pointBoundingBox(g,y,n),a>y?(r=g,a=y):a===y&&(r=h(r,g)),c<y?(l=g,c=y):c===y&&(l=h(l,g))):(d[0]=d[1]=1/0,d[2]=d[3]=-1/0,D.bezierBoundingBox(s,i,...e.slice(f,f+6),d),D.rectBoundingBox(d[0],d[1],d[2],d[3],n),a>d[1]?(r=d[0],a=d[1]):a===d[1]&&(r=h(r,d[0])),c<d[3]?(l=d[2],c=d[3]):c===d[3]&&(l=h(l,d[2]))),s=g,i=y}const u=this.#e;u[0]=n[0]-this.#i,u[1]=n[1]-this.#i,u[2]=n[2]-n[0]+2*this.#i,u[3]=n[3]-n[1]+2*this.#i,this.firstPoint=[r,a],this.lastPoint=[l,c]}get box(){return this.#e}newOutliner(t,e,s,i,n,r=0){return new ue(t,e,s,i,n,r)}getNewOutline(t,e){const[s,i,n,r]=this.#e,[a,l,c,h]=this.#t,d=n*c,u=r*h,f=s*c+a,m=i*h+l,g=this.newOutliner({x:this.#a[0]*d+f,y:this.#a[1]*u+m},this.#t,this.#n,t,this.#s,e??this.#i);for(let y=2;y<this.#a.length;y+=2)g.add({x:this.#a[y]*d+f,y:this.#a[y+1]*u+m});return g.getOutlines()}}class xi{#t;#e;#i;#s=[];#a=[];constructor(t,e=0,s=0,i=!0){const n=[1/0,1/0,-1/0,-1/0],r=10**-4;for(const{x:g,y,width:b,height:x}of t){const w=Math.floor((g-e)/r)*r,A=Math.ceil((g+b+e)/r)*r,v=Math.floor((y-e)/r)*r,k=Math.ceil((y+x+e)/r)*r,S=[w,v,k,!0],_=[A,v,k,!1];this.#s.push(S,_),D.rectBoundingBox(w,v,A,k,n)}const a=n[2]-n[0]+2*s,l=n[3]-n[1]+2*s,c=n[0]-s,h=n[1]-s;let d=i?-1/0:1/0,u=1/0;const f=this.#s.at(i?-1:-2),m=[f[0],f[2]];for(const g of this.#s){const[y,b,x,w]=g;!w&&i?b<u?(u=b,d=y):b===u&&(d=Math.max(d,y)):w&&!i&&(b<u?(u=b,d=y):b===u&&(d=Math.min(d,y))),g[0]=(y-c)/a,g[1]=(b-h)/l,g[2]=(x-h)/l}this.#t=new Float32Array([c,h,a,l]),this.#e=[d,u],this.#i=m}getOutlines(){this.#s.sort((e,s)=>e[0]-s[0]||e[1]-s[1]||e[2]-s[2]);const t=[];for(const e of this.#s)e[3]?(t.push(...this.#l(e)),this.#o(e)):(this.#c(e),t.push(...this.#l(e)));return this.#n(t)}#n(t){const e=[],s=new Set;for(const r of t){const[a,l,c]=r;e.push([a,l,r],[a,c,r])}e.sort((r,a)=>r[1]-a[1]||r[0]-a[0]);for(let r=0,a=e.length;r<a;r+=2){const l=e[r][2],c=e[r+1][2];l.push(c),c.push(l),s.add(l),s.add(c)}const i=[];let n;for(;s.size>0;){const r=s.values().next().value;let[a,l,c,h,d]=r;s.delete(r);let u=a,f=l;for(n=[a,c],i.push(n);;){let m;if(s.has(h))m=h;else if(s.has(d))m=d;else break;s.delete(m),[a,l,c,h,d]=m,u!==a&&(n.push(u,f,a,f===l?l:c),u=a),f=f===l?c:l}n.push(u,f)}return new wc(i,this.#t,this.#e,this.#i)}#r(t){const e=this.#a;let s=0,i=e.length-1;for(;s<=i;){const n=s+i>>1,r=e[n][0];if(r===t)return n;r<t?s=n+1:i=n-1}return i+1}#o([,t,e]){const s=this.#r(t);this.#a.splice(s,0,[t,e])}#c([,t,e]){const s=this.#r(t);for(let i=s;i<this.#a.length;i++){const[n,r]=this.#a[i];if(n!==t)break;if(n===t&&r===e){this.#a.splice(i,1);return}}for(let i=s-1;i>=0;i--){const[n,r]=this.#a[i];if(n!==t)break;if(n===t&&r===e){this.#a.splice(i,1);return}}}#l(t){const[e,s,i]=t,n=[[e,s,i]],r=this.#r(i);for(let a=0;a<r;a++){const[l,c]=this.#a[a];for(let h=0,d=n.length;h<d;h++){const[,u,f]=n[h];if(!(c<=u||f<=l)){if(u>=l){if(f>c)n[h][1]=c;else{if(d===1)return[];n.splice(h,1),h--,d--}continue}n[h][2]=l,f>c&&n.push([e,c,f])}}}return n}}class wc extends N{#t;#e;constructor(t,e,s,i){super(),this.#e=t,this.#t=e,this.firstPoint=s,this.lastPoint=i}toSVGPath(){const t=[];for(const e of this.#e){let[s,i]=e;t.push(`M${s} ${i}`);for(let n=2;n<e.length;n+=2){const r=e[n],a=e[n+1];r===s?(t.push(`V${a}`),i=a):a===i&&(t.push(`H${r}`),s=r)}t.push("Z")}return t.join(" ")}serialize([t,e,s,i],n){const r=[],a=s-t,l=i-e;for(const c of this.#e){const h=new Array(c.length);for(let d=0;d<c.length;d+=2)h[d]=t+c[d]*a,h[d+1]=i-c[d+1]*l;r.push(h)}return r}get box(){return this.#t}get classNamesForOutlining(){return["highlightOutline"]}}class vi extends ue{newFreeDrawOutline(t,e,s,i,n,r){return new xc(t,e,s,i,n,r)}}class xc extends jr{newOutliner(t,e,s,i,n,r=0){return new vi(t,e,s,i,n,r)}}class dt extends I{#t=null;#e=0;#i;#s=null;#a=null;#n=null;#r=null;#o=0;#c=null;#l=null;#u=null;#d=!1;#p=null;#m=null;#f=null;#h="";#g;#b="";static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=12;static _type="highlight";static _editorType=j.HIGHLIGHT;static _freeHighlightId=-1;static _freeHighlight=null;static _freeHighlightClipId="";static get _keyboardManager(){const t=dt.prototype;return z(this,"_keyboardManager",new ds([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}constructor(t){super({...t,name:"highlightEditor"}),this.color=t.color||dt._defaultColor,this.#g=t.thickness||dt._defaultThickness,this.opacity=t.opacity||dt._defaultOpacity,this.#i=t.boxes||null,this.#b=t.methodOfCreation||"",this.#h=t.text||"",this._isDraggable=!1,this.defaultL10nId="pdfjs-editor-highlight-editor",t.highlightId>-1?(this.#d=!0,this.#y(t),this.#A()):this.#i&&(this.#t=t.anchorNode,this.#e=t.anchorOffset,this.#r=t.focusNode,this.#o=t.focusOffset,this.#w(),this.#A(),this.rotate(this.rotation)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-highlight-added-alert")}get telemetryInitialData(){return{action:"added",type:this.#d?"free_highlight":"highlight",color:this._uiManager.getNonHCMColorName(this.color),thickness:this.#g,methodOfCreation:this.#b}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.getNonHCMColorName(this.color)}}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}#w(){const t=new xi(this.#i,.001);this.#l=t.getOutlines(),[this.x,this.y,this.width,this.height]=this.#l.box;const e=new xi(this.#i,.0025,.001,this._uiManager.direction==="ltr");this.#n=e.getOutlines();const{firstPoint:s}=this.#l;this.#p=[(s[0]-this.x)/this.width,(s[1]-this.y)/this.height];const{lastPoint:i}=this.#n;this.#m=[(i[0]-this.x)/this.width,(i[1]-this.y)/this.height]}#y({highlightOutlines:t,highlightId:e,clipPathId:s}){this.#l=t;const i=1.5;if(this.#n=t.getNewOutline(this.#g/2+i,.0025),e>=0)this.#u=e,this.#s=s,this.parent.drawLayer.finalizeDraw(e,{bbox:t.box,path:{d:t.toSVGPath()}}),this.#f=this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:this.#n.box,path:{d:this.#n.toSVGPath()}},!0);else if(this.parent){const d=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(this.#u,{bbox:dt.#S(this.#l.box,(d-this.rotation+360)%360),path:{d:t.toSVGPath()}}),this.parent.drawLayer.updateProperties(this.#f,{bbox:dt.#S(this.#n.box,d),path:{d:this.#n.toSVGPath()}})}const[n,r,a,l]=t.box;switch(this.rotation){case 0:this.x=n,this.y=r,this.width=a,this.height=l;break;case 90:{const[d,u]=this.parentDimensions;this.x=r,this.y=1-n,this.width=a*u/d,this.height=l*d/u;break}case 180:this.x=1-n,this.y=1-r,this.width=a,this.height=l;break;case 270:{const[d,u]=this.parentDimensions;this.x=1-r,this.y=n,this.width=a*u/d,this.height=l*d/u;break}}const{firstPoint:c}=t;this.#p=[(c[0]-n)/a,(c[1]-r)/l];const{lastPoint:h}=this.#n;this.#m=[(h[0]-n)/a,(h[1]-r)/l]}static initialize(t,e){I.initialize(t,e),dt._defaultColor||=e.highlightColors?.values().next().value||"#fff066"}static updateDefaultParams(t,e){switch(t){case V.HIGHLIGHT_COLOR:dt._defaultColor=e;break;case V.HIGHLIGHT_THICKNESS:dt._defaultThickness=e;break}}translateInPage(t,e){}get toolbarPosition(){return this.#m}get commentButtonPosition(){return this.#p}updateParams(t,e){switch(t){case V.HIGHLIGHT_COLOR:this.#_(e);break;case V.HIGHLIGHT_THICKNESS:this.#k(e);break}}static get defaultPropertiesToUpdate(){return[[V.HIGHLIGHT_COLOR,dt._defaultColor],[V.HIGHLIGHT_THICKNESS,dt._defaultThickness]]}get propertiesToUpdate(){return[[V.HIGHLIGHT_COLOR,this.color||dt._defaultColor],[V.HIGHLIGHT_THICKNESS,this.#g||dt._defaultThickness],[V.HIGHLIGHT_FREE,this.#d]]}onUpdatedColor(){this.parent?.drawLayer.updateProperties(this.#u,{root:{fill:this.color,"fill-opacity":this.opacity}}),this.#a?.updateColor(this.color),super.onUpdatedColor()}#_(t){const e=(n,r)=>{this.color=n,this.opacity=r,this.onUpdatedColor()},s=this.color,i=this.opacity;this.addCommands({cmd:e.bind(this,t,dt._defaultOpacity),undo:e.bind(this,s,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:V.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.getNonHCMColorName(t)},!0)}#k(t){const e=this.#g,s=i=>{this.#g=i,this.#x(i)};this.addCommands({cmd:s.bind(this,t),undo:s.bind(this,e),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:V.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)}get toolbarButtons(){return this._uiManager.highlightColors?[["colorPicker",this.#a=new Dt({editor:this})]]:super.toolbarButtons}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(this.#L())}getBaseTranslation(){return[0,0]}getRect(t,e){return super.getRect(t,e,this.#L())}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),t&&this.div.focus()}remove(){this.#C(),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#A(),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){let e=!1;this.parent&&!t?this.#C():t&&(this.#A(t),e=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(t),this.show(this._isVisible),e&&this.select()}#x(t){this.#d&&(this.#y({highlightOutlines:this.#l.getNewOutline(t/2)}),this.fixAndSetPosition(),this.setDims(this.width,this.height))}#C(){this.#u===null||!this.parent||(this.parent.drawLayer.remove(this.#u),this.#u=null,this.parent.drawLayer.remove(this.#f),this.#f=null)}#A(t=this.parent){this.#u===null&&({id:this.#u,clipPathId:this.#s}=t.drawLayer.draw({bbox:this.#l.box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":this.opacity},rootClass:{highlight:!0,free:this.#d},path:{d:this.#l.toSVGPath()}},!1,!0),this.#f=t.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:this.#d},bbox:this.#n.box,path:{d:this.#n.toSVGPath()}},this.#d),this.#c&&(this.#c.style.clipPath=this.#s))}static#S([t,e,s,i],n){switch(n){case 90:return[1-e-i,t,i,s];case 180:return[1-t-s,1-e-i,s,i];case 270:return[e,1-t-s,i,s]}return[t,e,s,i]}rotate(t){const{drawLayer:e}=this.parent;let s;this.#d?(t=(t-this.rotation+360)%360,s=dt.#S(this.#l.box,t)):s=dt.#S([this.x,this.y,this.width,this.height],t),e.updateProperties(this.#u,{bbox:s,root:{"data-main-rotation":t}}),e.updateProperties(this.#f,{bbox:dt.#S(this.#n.box,t),root:{"data-main-rotation":t}})}render(){if(this.div)return this.div;const t=super.render();this.#h&&(t.setAttribute("aria-label",this.#h),t.setAttribute("role","mark")),this.#d?t.classList.add("free"):this.div.addEventListener("keydown",this.#P.bind(this),{signal:this._uiManager._signal});const e=this.#c=document.createElement("div");return t.append(e),e.setAttribute("aria-hidden","true"),e.className="internal",e.style.clipPath=this.#s,this.setDims(this.width,this.height),pr(this,this.#c,["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#f,{rootClass:{hovered:!0}})}pointerleave(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#f,{rootClass:{hovered:!1}})}#P(t){dt._keyboardManager.exec(this,t)}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:this.#T(!0);break;case 1:case 3:this.#T(!1);break}}#T(t){if(!this.#t)return;const e=window.getSelection();t?e.setPosition(this.#t,this.#e):e.setPosition(this.#r,this.#o)}select(){super.select(),this.#f&&this.parent?.drawLayer.updateProperties(this.#f,{rootClass:{hovered:!1,selected:!0}})}unselect(){super.unselect(),this.#f&&(this.parent?.drawLayer.updateProperties(this.#f,{rootClass:{selected:!1}}),this.#d||this.#T(!1))}get _mustFixPosition(){return!this.#d}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.updateProperties(this.#u,{rootClass:{hidden:!t}}),this.parent.drawLayer.updateProperties(this.#f,{rootClass:{hidden:!t}}))}#L(){return this.#d?this.rotation:0}#O(){if(this.#d)return null;const[t,e]=this.pageDimensions,[s,i]=this.pageTranslation,n=this.#i,r=new Float32Array(n.length*8);let a=0;for(const{x:l,y:c,width:h,height:d}of n){const u=l*t+s,f=(1-c)*e+i;r[a]=r[a+4]=u,r[a+1]=r[a+3]=f,r[a+2]=r[a+6]=u+h*t,r[a+5]=r[a+7]=f-d*e,a+=8}return r}#R(t){return this.#l.serialize(t,this.#L())}static startHighlighting(t,e,{target:s,x:i,y:n}){const{x:r,y:a,width:l,height:c}=s.getBoundingClientRect(),h=new AbortController,d=t.combinedSignal(h),u=f=>{h.abort(),this.#j(t,f)};window.addEventListener("blur",u,{signal:d}),window.addEventListener("pointerup",u,{signal:d}),window.addEventListener("pointerdown",ot,{capture:!0,passive:!1,signal:d}),window.addEventListener("contextmenu",Ft,{signal:d}),s.addEventListener("pointermove",this.#D.bind(this,t),{signal:d}),this._freeHighlight=new vi({x:i,y:n},[r,a,l,c],t.scale,this._defaultThickness/2,e,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static#D(t,e){this._freeHighlight.add(e)&&t.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})}static#j(t,e){this._freeHighlight.isEmpty()?t.drawLayer.remove(this._freeHighlightId):t.createAndAddNewEditor(e,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""}static async deserialize(t,e,s){let i=null;if(t instanceof Ir){const{data:{quadPoints:m,rect:g,rotation:y,id:b,color:x,opacity:w,popupRef:A,richText:v,contentsObj:k,creationDate:S,modificationDate:_},parent:{page:{pageNumber:E}}}=t;i=t={annotationType:j.HIGHLIGHT,color:Array.from(x),opacity:w,quadPoints:m,boxes:null,pageIndex:E-1,rect:g.slice(0),rotation:y,annotationElementId:b,id:b,deleted:!1,popupRef:A,richText:v,comment:k?.str||null,creationDate:S,modificationDate:_}}else if(t instanceof Gi){const{data:{inkLists:m,rect:g,rotation:y,id:b,color:x,borderStyle:{rawWidth:w},popupRef:A,richText:v,contentsObj:k,creationDate:S,modificationDate:_},parent:{page:{pageNumber:E}}}=t;i=t={annotationType:j.HIGHLIGHT,color:Array.from(x),thickness:w,inkLists:m,boxes:null,pageIndex:E-1,rect:g.slice(0),rotation:y,annotationElementId:b,id:b,deleted:!1,popupRef:A,richText:v,comment:k?.str||null,creationDate:S,modificationDate:_}}const{color:n,quadPoints:r,inkLists:a,opacity:l}=t,c=await super.deserialize(t,e,s);c.color=D.makeHexColor(...n),c.opacity=l||1,a&&(c.#g=t.thickness),c._initialData=i,t.comment&&c.setCommentData(t);const[h,d]=c.pageDimensions,[u,f]=c.pageTranslation;if(r){const m=c.#i=[];for(let g=0;g<r.length;g+=8)m.push({x:(r[g]-u)/h,y:1-(r[g+1]-f)/d,width:(r[g+2]-r[g])/h,height:(r[g+1]-r[g+5])/d});c.#w(),c.#A(),c.rotate(c.rotation)}else if(a){c.#d=!0;const m=a[0],g={x:m[0]-u,y:d-(m[1]-f)},y=new vi(g,[0,0,h,d],1,c.#g/2,!0,.001);for(let w=0,A=m.length;w<A;w+=2)g.x=m[w]-u,g.y=d-(m[w+1]-f),y.add(g);const{id:b,clipPathId:x}=e.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:c.color,"fill-opacity":c._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:y.toSVGPath()}},!0,!0);c.#y({highlightOutlines:y.getOutlines(),highlightId:b,clipPathId:x}),c.#A(),c.rotate(c.parentRotation)}return c}serialize(t=!1){if(this.isEmpty()||t)return null;if(this.deleted)return this.serializeDeleted();const e=I._colorManager.convert(this._uiManager.getNonHCMColor(this.color)),s=super.serialize(t);return Object.assign(s,{color:e,opacity:this.opacity,thickness:this.#g,quadPoints:this.#O(),outlines:this.#R(s.rect)}),this.addComment(s),this.annotationElementId&&!this.#I(s)?null:(s.id=this.annotationElementId,s)}#I(t){const{color:e}=this._initialData;return this.hasEditedComment||t.color.some((s,i)=>s!==e[i])}renderAnnotationElement(t){return this.deleted?(t.hide(),null):(t.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}static canCreateNewEmptyEditor(){return!1}}class Br{#t=Object.create(null);updateProperty(t,e){this[t]=e,this.updateSVGProperty(t,e)}updateProperties(t){if(t)for(const[e,s]of Object.entries(t))e.startsWith("_")||this.updateProperty(e,s)}updateSVGProperty(t,e){this.#t[t]=e}toSVGProperties(){const t=this.#t;return this.#t=Object.create(null),{root:t}}reset(){this.#t=Object.create(null)}updateAll(t=this){this.updateProperties(t)}clone(){J("Not implemented")}}class F extends I{#t=null;#e;_colorPicker=null;_drawId=null;static _currentDrawId=-1;static _currentParent=null;static#i=null;static#s=null;static#a=null;static#n=NaN;static#r=null;static#o=null;static#c=NaN;static _INNER_MARGIN=3;constructor(t){super(t),this.#e=t.mustBeCommitted||!1,this._addOutlines(t)}onUpdatedColor(){this._colorPicker?.update(this.color),super.onUpdatedColor()}_addOutlines(t){t.drawOutlines&&(this.#l(t),this.#p())}#l({drawOutlines:t,drawId:e,drawingOptions:s}){this.#t=t,this._drawingOptions||=s,this.annotationElementId||this._uiManager.a11yAlert(`pdfjs-editor-${this.editorType}-added-alert`),e>=0?(this._drawId=e,this.parent.drawLayer.finalizeDraw(e,t.defaultProperties)):this._drawId=this.#u(t,this.parent),this.#h(t.box)}#u(t,e){const{id:s}=e.drawLayer.draw(F._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),!1,!1);return s}static _mergeSVGProperties(t,e){const s=new Set(Object.keys(t));for(const[i,n]of Object.entries(e))s.has(i)?Object.assign(t[i],n):t[i]=n;return t}static getDefaultDrawingOptions(t){J("Not implemented")}static get typesMap(){J("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(t,e){const s=this.typesMap.get(t);s&&this._defaultDrawingOptions.updateProperty(s,e),this._currentParent&&(F.#i.updateProperty(s,e),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(t,e){const s=this.constructor.typesMap.get(t);s&&this._updateProperty(t,s,e)}static get defaultPropertiesToUpdate(){const t=[],e=this._defaultDrawingOptions;for(const[s,i]of this.typesMap)t.push([s,e[i]]);return t}get propertiesToUpdate(){const t=[],{_drawingOptions:e}=this;for(const[s,i]of this.constructor.typesMap)t.push([s,e[i]]);return t}_updateProperty(t,e,s){const i=this._drawingOptions,n=i[e],r=a=>{i.updateProperty(e,a);const l=this.#t.updateProperty(e,a);l&&this.#h(l),this.parent?.drawLayer.updateProperties(this._drawId,i.toSVGProperties()),t===this.colorType&&this.onUpdatedColor()};this.addCommands({cmd:r.bind(this,s),undo:r.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:t,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){this.parent?.drawLayer.updateProperties(this._drawId,F._mergeSVGProperties(this.#t.getPathResizingSVGProperties(this.#f()),{bbox:this.#g()}))}_onResized(){this.parent?.drawLayer.updateProperties(this._drawId,F._mergeSVGProperties(this.#t.getPathResizedSVGProperties(this.#f()),{bbox:this.#g()}))}_onTranslating(t,e){this.parent?.drawLayer.updateProperties(this._drawId,{bbox:this.#g()})}_onTranslated(){this.parent?.drawLayer.updateProperties(this._drawId,F._mergeSVGProperties(this.#t.getPathTranslatedSVGProperties(this.#f(),this.parentDimensions),{bbox:this.#g()}))}_onStartDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,this.#e&&(this.#e=!1,this.commit(),this.parent.setSelected(this),t&&this.isOnScreen&&this.div.focus())}remove(){this.#d(),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#p(),this.#h(this.#t.box),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){let e=!1;this.parent&&!t?(this._uiManager.removeShouldRescale(this),this.#d()):t&&(this._uiManager.addShouldRescale(this),this.#p(t),e=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(t),e&&this.select()}#d(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())}#p(t=this.parent){if(!(this._drawId!==null&&this.parent===t)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,t.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=this.#u(this.#t,t)}}#m([t,e,s,i]){const{parentDimensions:[n,r],rotation:a}=this;switch(a){case 90:return[e,1-t,s*(r/n),i*(n/r)];case 180:return[1-t,1-e,s,i];case 270:return[1-e,t,s*(r/n),i*(n/r)];default:return[t,e,s,i]}}#f(){const{x:t,y:e,width:s,height:i,parentDimensions:[n,r],rotation:a}=this;switch(a){case 90:return[1-e,t,s*(n/r),i*(r/n)];case 180:return[1-t,1-e,s,i];case 270:return[e,1-t,s*(n/r),i*(r/n)];default:return[t,e,s,i]}}#h(t){[this.x,this.y,this.width,this.height]=this.#m(t),this.div&&(this.fixAndSetPosition(),this.setDims()),this._onResized()}#g(){const{x:t,y:e,width:s,height:i,rotation:n,parentRotation:r,parentDimensions:[a,l]}=this;switch((n*4+r)/90){case 1:return[1-e-i,t,i,s];case 2:return[1-t-s,1-e-i,s,i];case 3:return[e,1-t-s,i,s];case 4:return[t,e-s*(a/l),i*(l/a),s*(a/l)];case 5:return[1-e,t,s*(a/l),i*(l/a)];case 6:return[1-t-i*(l/a),1-e,i*(l/a),s*(a/l)];case 7:return[e-s*(a/l),1-t-i*(l/a),s*(a/l),i*(l/a)];case 8:return[t-s,e-i,s,i];case 9:return[1-e,t-s,i,s];case 10:return[1-t,1-e,s,i];case 11:return[e-i,1-t,i,s];case 12:return[t-i*(l/a),e,i*(l/a),s*(a/l)];case 13:return[1-e-s*(a/l),t-i*(l/a),s*(a/l),i*(l/a)];case 14:return[1-t,1-e-s*(a/l),i*(l/a),s*(a/l)];case 15:return[e,1-t,s*(a/l),i*(l/a)];default:return[t,e,s,i]}}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,F._mergeSVGProperties({bbox:this.#g()},this.#t.updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&this.#h(this.#t.updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let t,e;this._isCopy&&(t=this.x,e=this.y);const s=super.render();s.classList.add("draw");const i=document.createElement("div");return s.append(i),i.setAttribute("aria-hidden","true"),i.className="internal",this.setDims(),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(t,e),s}static createDrawerInstance(t,e,s,i,n){J("Not implemented")}static startDrawing(t,e,s,i){const{target:n,offsetX:r,offsetY:a,pointerId:l,pointerType:c}=i;if(F.#r&&F.#r!==c)return;const{viewport:{rotation:h}}=t,{width:d,height:u}=n.getBoundingClientRect(),f=F.#s=new AbortController,m=t.combinedSignal(f);if(F.#n||=l,F.#r??=c,window.addEventListener("pointerup",g=>{F.#n===g.pointerId?this._endDraw(g):F.#o?.delete(g.pointerId)},{signal:m}),window.addEventListener("pointercancel",g=>{F.#n===g.pointerId?this._currentParent.endDrawingSession():F.#o?.delete(g.pointerId)},{signal:m}),window.addEventListener("pointerdown",g=>{F.#r===g.pointerType&&((F.#o||=new Set).add(g.pointerId),F.#i.isCancellable()&&(F.#i.removeLastElement(),F.#i.isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:m}),window.addEventListener("contextmenu",Ft,{signal:m}),n.addEventListener("pointermove",this._drawMove.bind(this),{signal:m}),n.addEventListener("touchmove",g=>{g.timeStamp===F.#c&&ot(g)},{signal:m}),t.toggleDrawing(),e._editorUndoBar?.hide(),F.#i){t.drawLayer.updateProperties(this._currentDrawId,F.#i.startNew(r,a,d,u,h));return}e.updateUIForDefaultProperties(this),F.#i=this.createDrawerInstance(r,a,d,u,h),F.#a=this.getDefaultDrawingOptions(),this._currentParent=t,{id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(F.#a.toSVGProperties(),F.#i.defaultSVGProperties),!0,!1)}static _drawMove(t){if(F.#c=-1,!F.#i)return;const{offsetX:e,offsetY:s,pointerId:i}=t;if(F.#n===i){if(F.#o?.size>=1){this._endDraw(t);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,F.#i.add(e,s)),F.#c=t.timeStamp,ot(t)}}static _cleanup(t){t&&(this._currentDrawId=-1,this._currentParent=null,F.#i=null,F.#a=null,F.#r=null,F.#c=NaN),F.#s&&(F.#s.abort(),F.#s=null,F.#n=NaN,F.#o=null)}static _endDraw(t){const e=this._currentParent;if(e){if(e.toggleDrawing(!0),this._cleanup(!1),t?.target===e.div&&e.drawLayer.updateProperties(this._currentDrawId,F.#i.end(t.offsetX,t.offsetY)),this.supportMultipleDrawings){const s=F.#i,i=this._currentDrawId,n=s.getLastElement();e.addCommands({cmd:()=>{e.drawLayer.updateProperties(i,s.setLastElement(n))},undo:()=>{e.drawLayer.updateProperties(i,s.removeLastElement())},mustExec:!1,type:V.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(t){const e=this._currentParent;if(!e)return null;if(e.toggleDrawing(!0),e.cleanUndoStack(V.DRAW_STEP),!F.#i.isEmpty()){const{pageDimensions:[s,i],scale:n}=e,r=e.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:F.#i.getOutlines(s*n,i*n,n,this._INNER_MARGIN),drawingOptions:F.#a,mustBeCommitted:!t});return this._cleanup(!0),r}return e.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(t){}static deserializeDraw(t,e,s,i,n,r){J("Not implemented")}static async deserialize(t,e,s){const{rawDims:{pageWidth:i,pageHeight:n,pageX:r,pageY:a}}=e.viewport,l=this.deserializeDraw(r,a,i,n,this._INNER_MARGIN,t),c=await super.deserialize(t,e,s);return c.createDrawingOptions(t),c.#l({drawOutlines:l}),c.#p(),c.onScaleChanging(),c.rotate(),c}serializeDraw(t){const[e,s]=this.pageTranslation,[i,n]=this.pageDimensions;return this.#t.serialize([e,s,i,n],t)}renderAnnotationElement(t){return t.updateEdited({rect:this.getPDFRect()}),null}static canCreateNewEmptyEditor(){return!1}}class vc{#t=new Float64Array(6);#e;#i;#s;#a;#n;#r="";#o=0;#c=new fs;#l;#u;constructor(t,e,s,i,n,r){this.#l=s,this.#u=i,this.#s=n,this.#a=r,[t,e]=this.#d(t,e);const a=this.#e=[NaN,NaN,NaN,NaN,t,e];this.#n=[t,e],this.#i=[{line:a,points:this.#n}],this.#t.set(a,0)}updateProperty(t,e){t==="stroke-width"&&(this.#a=e)}#d(t,e){return N._normalizePoint(t,e,this.#l,this.#u,this.#s)}isEmpty(){return!this.#i||this.#i.length===0}isCancellable(){return this.#n.length<=10}add(t,e){[t,e]=this.#d(t,e);const[s,i,n,r]=this.#t.subarray(2,6),a=t-n,l=e-r;return Math.hypot(this.#l*a,this.#u*l)<=2?null:(this.#n.push(t,e),isNaN(s)?(this.#t.set([n,r,t,e],2),this.#e.push(NaN,NaN,NaN,NaN,t,e),{path:{d:this.toSVGPath()}}):(isNaN(this.#t[0])&&this.#e.splice(6,6),this.#t.set([s,i,n,r,t,e],0),this.#e.push(...N.createBezierPoints(s,i,n,r,t,e)),{path:{d:this.toSVGPath()}}))}end(t,e){const s=this.add(t,e);return s||(this.#n.length===2?{path:{d:this.toSVGPath()}}:null)}startNew(t,e,s,i,n){this.#l=s,this.#u=i,this.#s=n,[t,e]=this.#d(t,e);const r=this.#e=[NaN,NaN,NaN,NaN,t,e];this.#n=[t,e];const a=this.#i.at(-1);return a&&(a.line=new Float32Array(a.line),a.points=new Float32Array(a.points)),this.#i.push({line:r,points:this.#n}),this.#t.set(r,0),this.#o=0,this.toSVGPath(),null}getLastElement(){return this.#i.at(-1)}setLastElement(t){return this.#i?(this.#i.push(t),this.#e=t.line,this.#n=t.points,this.#o=0,{path:{d:this.toSVGPath()}}):this.#c.setLastElement(t)}removeLastElement(){if(!this.#i)return this.#c.removeLastElement();this.#i.pop(),this.#r="";for(let t=0,e=this.#i.length;t<e;t++){const{line:s,points:i}=this.#i[t];this.#e=s,this.#n=i,this.#o=0,this.toSVGPath()}return{path:{d:this.#r}}}toSVGPath(){const t=N.svgRound(this.#e[4]),e=N.svgRound(this.#e[5]);if(this.#n.length===2)return this.#r=`${this.#r} M ${t} ${e} Z`,this.#r;if(this.#n.length<=6){const i=this.#r.lastIndexOf("M");this.#r=`${this.#r.slice(0,i)} M ${t} ${e}`,this.#o=6}if(this.#n.length===4){const i=N.svgRound(this.#e[10]),n=N.svgRound(this.#e[11]);return this.#r=`${this.#r} L ${i} ${n}`,this.#o=12,this.#r}const s=[];this.#o===0&&(s.push(`M ${t} ${e}`),this.#o=6);for(let i=this.#o,n=this.#e.length;i<n;i+=6){const[r,a,l,c,h,d]=this.#e.slice(i,i+6).map(N.svgRound);s.push(`C${r} ${a} ${l} ${c} ${h} ${d}`)}return this.#r+=s.join(" "),this.#o=this.#e.length,this.#r}getOutlines(t,e,s,i){const n=this.#i.at(-1);return n.line=new Float32Array(n.line),n.points=new Float32Array(n.points),this.#c.build(this.#i,t,e,s,this.#s,this.#a,i),this.#t=null,this.#e=null,this.#i=null,this.#r=null,this.#c}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}class fs extends N{#t;#e=0;#i;#s;#a;#n;#r;#o;#c;build(t,e,s,i,n,r,a){this.#a=e,this.#n=s,this.#r=i,this.#o=n,this.#c=r,this.#i=a??0,this.#s=t,this.#d()}get thickness(){return this.#c}setLastElement(t){return this.#s.push(t),{path:{d:this.toSVGPath()}}}removeLastElement(){return this.#s.pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const t=[];for(const{line:e}of this.#s){if(t.push(`M${N.svgRound(e[4])} ${N.svgRound(e[5])}`),e.length===6){t.push("Z");continue}if(e.length===12&&isNaN(e[6])){t.push(`L${N.svgRound(e[10])} ${N.svgRound(e[11])}`);continue}for(let s=6,i=e.length;s<i;s+=6){const[n,r,a,l,c,h]=e.subarray(s,s+6).map(N.svgRound);t.push(`C${n} ${r} ${a} ${l} ${c} ${h}`)}}return t.join("")}serialize([t,e,s,i],n){const r=[],a=[],[l,c,h,d]=this.#u();let u,f,m,g,y,b,x,w,A;switch(this.#o){case 0:A=N._rescale,u=t,f=e+i,m=s,g=-i,y=t+l*s,b=e+(1-c-d)*i,x=t+(l+h)*s,w=e+(1-c)*i;break;case 90:A=N._rescaleAndSwap,u=t,f=e,m=s,g=i,y=t+c*s,b=e+l*i,x=t+(c+d)*s,w=e+(l+h)*i;break;case 180:A=N._rescale,u=t+s,f=e,m=-s,g=i,y=t+(1-l-h)*s,b=e+c*i,x=t+(1-l)*s,w=e+(c+d)*i;break;case 270:A=N._rescaleAndSwap,u=t+s,f=e+i,m=-s,g=-i,y=t+(1-c-d)*s,b=e+(1-l-h)*i,x=t+(1-c)*s,w=e+(1-l)*i;break}for(const{line:v,points:k}of this.#s)r.push(A(v,u,f,m,g,n?new Array(v.length):null)),a.push(A(k,u,f,m,g,n?new Array(k.length):null));return{lines:r,points:a,rect:[y,b,x,w]}}static deserialize(t,e,s,i,n,{paths:{lines:r,points:a},rotation:l,thickness:c}){const h=[];let d,u,f,m,g;switch(l){case 0:g=N._rescale,d=-t/s,u=e/i+1,f=1/s,m=-1/i;break;case 90:g=N._rescaleAndSwap,d=-e/i,u=-t/s,f=1/i,m=1/s;break;case 180:g=N._rescale,d=t/s+1,u=-e/i,f=-1/s,m=1/i;break;case 270:g=N._rescaleAndSwap,d=e/i+1,u=t/s+1,f=-1/i,m=-1/s;break}if(!r){r=[];for(const b of a){const x=b.length;if(x===2){r.push(new Float32Array([NaN,NaN,NaN,NaN,b[0],b[1]]));continue}if(x===4){r.push(new Float32Array([NaN,NaN,NaN,NaN,b[0],b[1],NaN,NaN,NaN,NaN,b[2],b[3]]));continue}const w=new Float32Array(3*(x-2));r.push(w);let[A,v,k,S]=b.subarray(0,4);w.set([NaN,NaN,NaN,NaN,A,v],0);for(let _=4;_<x;_+=2){const E=b[_],T=b[_+1];w.set(N.createBezierPoints(A,v,k,S,E,T),(_-2)*3),[A,v,k,S]=[k,S,E,T]}}}for(let b=0,x=r.length;b<x;b++)h.push({line:g(r[b].map(w=>w??NaN),d,u,f,m),points:g(a[b].map(w=>w??NaN),d,u,f,m)});const y=new this.prototype.constructor;return y.build(h,s,i,1,l,c,n),y}#l(t=this.#c){const e=this.#i+t/2*this.#r;return this.#o%180===0?[e/this.#a,e/this.#n]:[e/this.#n,e/this.#a]}#u(){const[t,e,s,i]=this.#t,[n,r]=this.#l(0);return[t+n,e+r,s-2*n,i-2*r]}#d(){const t=this.#t=new Float32Array([1/0,1/0,-1/0,-1/0]);for(const{line:i}of this.#s){if(i.length<=12){for(let a=4,l=i.length;a<l;a+=6)D.pointBoundingBox(i[a],i[a+1],t);continue}let n=i[4],r=i[5];for(let a=6,l=i.length;a<l;a+=6){const[c,h,d,u,f,m]=i.subarray(a,a+6);D.bezierBoundingBox(n,r,c,h,d,u,f,m,t),n=f,r=m}}const[e,s]=this.#l();t[0]=vt(t[0]-e,0,1),t[1]=vt(t[1]-s,0,1),t[2]=vt(t[2]+e,0,1),t[3]=vt(t[3]+s,0,1),t[2]-=t[0],t[3]-=t[1]}get box(){return this.#t}updateProperty(t,e){return t==="stroke-width"?this.#p(e):null}#p(t){const[e,s]=this.#l();this.#c=t;const[i,n]=this.#l(),[r,a]=[i-e,n-s],l=this.#t;return l[0]-=r,l[1]-=a,l[2]+=2*r,l[3]+=2*a,l}updateParentDimensions([t,e],s){const[i,n]=this.#l();this.#a=t,this.#n=e,this.#r=s;const[r,a]=this.#l(),l=r-i,c=a-n,h=this.#t;return h[0]-=l,h[1]-=c,h[2]+=2*l,h[3]+=2*c,h}updateRotation(t){return this.#e=t,{path:{transform:this.rotationTransform}}}get viewBox(){return this.#t.map(N.svgRound).join(" ")}get defaultProperties(){const[t,e]=this.#t;return{root:{viewBox:this.viewBox},path:{"transform-origin":`${N.svgRound(t)} ${N.svgRound(e)}`}}}get rotationTransform(){const[,,t,e]=this.#t;let s=0,i=0,n=0,r=0,a=0,l=0;switch(this.#e){case 90:i=e/t,n=-t/e,a=t;break;case 180:s=-1,r=-1,a=t,l=e;break;case 270:i=-e/t,n=t/e,l=e;break;default:return""}return`matrix(${s} ${i} ${n} ${r} ${N.svgRound(a)} ${N.svgRound(l)})`}getPathResizingSVGProperties([t,e,s,i]){const[n,r]=this.#l(),[a,l,c,h]=this.#t;if(Math.abs(c-n)<=N.PRECISION||Math.abs(h-r)<=N.PRECISION){const g=t+s/2-(a+c/2),y=e+i/2-(l+h/2);return{path:{"transform-origin":`${N.svgRound(t)} ${N.svgRound(e)}`,transform:`${this.rotationTransform} translate(${g} ${y})`}}}const d=(s-2*n)/(c-2*n),u=(i-2*r)/(h-2*r),f=c/s,m=h/i;return{path:{"transform-origin":`${N.svgRound(a)} ${N.svgRound(l)}`,transform:`${this.rotationTransform} scale(${f} ${m}) translate(${N.svgRound(n)} ${N.svgRound(r)}) scale(${d} ${u}) translate(${N.svgRound(-n)} ${N.svgRound(-r)})`}}}getPathResizedSVGProperties([t,e,s,i]){const[n,r]=this.#l(),a=this.#t,[l,c,h,d]=a;if(a[0]=t,a[1]=e,a[2]=s,a[3]=i,Math.abs(h-n)<=N.PRECISION||Math.abs(d-r)<=N.PRECISION){const y=t+s/2-(l+h/2),b=e+i/2-(c+d/2);for(const{line:x,points:w}of this.#s)N._translate(x,y,b,x),N._translate(w,y,b,w);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${N.svgRound(t)} ${N.svgRound(e)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const u=(s-2*n)/(h-2*n),f=(i-2*r)/(d-2*r),m=-u*(l+n)+t+n,g=-f*(c+r)+e+r;if(u!==1||f!==1||m!==0||g!==0)for(const{line:y,points:b}of this.#s)N._rescale(y,m,g,u,f,y),N._rescale(b,m,g,u,f,b);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${N.svgRound(t)} ${N.svgRound(e)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([t,e],s){const[i,n]=s,r=this.#t,a=t-r[0],l=e-r[1];if(this.#a===i&&this.#n===n)for(const{line:c,points:h}of this.#s)N._translate(c,a,l,c),N._translate(h,a,l,h);else{const c=this.#a/i,h=this.#n/n;this.#a=i,this.#n=n;for(const{line:d,points:u}of this.#s)N._rescale(d,a,l,c,h,d),N._rescale(u,a,l,c,h,u);r[2]*=c,r[3]*=h}return r[0]=t,r[1]=e,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${N.svgRound(t)} ${N.svgRound(e)}`}}}get defaultSVGProperties(){const t=this.#t;return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${N.svgRound(t[0])} ${N.svgRound(t[1])}`,transform:this.rotationTransform||null},bbox:t}}}class Vs extends Br{constructor(t){super(),this._viewParameters=t,super.updateProperties({fill:"none",stroke:I._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(t,e){t==="stroke-width"&&(e??=this["stroke-width"],e*=this._viewParameters.realScale),super.updateSVGProperty(t,e)}clone(){const t=new Vs(this._viewParameters);return t.updateAll(this),t}}class Vi extends F{static _type="ink";static _editorType=j.INK;static _defaultDrawingOptions=null;constructor(t){super({...t,name:"inkEditor"}),this._willKeepAspectRatio=!0,this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(t,e){I.initialize(t,e),this._defaultDrawingOptions=new Vs(e.viewParameters)}static getDefaultDrawingOptions(t){const e=this._defaultDrawingOptions.clone();return e.updateProperties(t),e}static get supportMultipleDrawings(){return!0}static get typesMap(){return z(this,"typesMap",new Map([[V.INK_THICKNESS,"stroke-width"],[V.INK_COLOR,"stroke"],[V.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(t,e,s,i,n){return new vc(t,e,s,i,n,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(t,e,s,i,n,r){return fs.deserialize(t,e,s,i,n,r)}static async deserialize(t,e,s){let i=null;if(t instanceof Gi){const{data:{inkLists:r,rect:a,rotation:l,id:c,color:h,opacity:d,borderStyle:{rawWidth:u},popupRef:f,richText:m,contentsObj:g,creationDate:y,modificationDate:b},parent:{page:{pageNumber:x}}}=t;i=t={annotationType:j.INK,color:Array.from(h),thickness:u,opacity:d,paths:{points:r},boxes:null,pageIndex:x-1,rect:a.slice(0),rotation:l,annotationElementId:c,id:c,deleted:!1,popupRef:f,richText:m,comment:g?.str||null,creationDate:y,modificationDate:b}}const n=await super.deserialize(t,e,s);return n._initialData=i,t.comment&&n.setCommentData(t),n}get toolbarButtons(){return this._colorPicker||=new rs(this),[["colorPicker",this._colorPicker]]}get colorType(){return V.INK_COLOR}get color(){return this._drawingOptions.stroke}get opacity(){return this._drawingOptions["stroke-opacity"]}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:t,_drawingOptions:e,parent:s}=this;e.updateSVGProperty("stroke-width"),s.drawLayer.updateProperties(t,e.toSVGProperties())}static onScaleChangingWhenDrawing(){const t=this._currentParent;t&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),t.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:t,thickness:e,opacity:s}){this._drawingOptions=Vi.getDefaultDrawingOptions({stroke:D.makeHexColor(...t),"stroke-width":e,"stroke-opacity":s})}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:e,points:s}=this.serializeDraw(t),{_drawingOptions:{stroke:i,"stroke-opacity":n,"stroke-width":r}}=this,a=Object.assign(super.serialize(t),{color:I._colorManager.convert(i),opacity:n,thickness:r,paths:{lines:e,points:s}});return this.addComment(a),t?(a.isCopy=!0,a):this.annotationElementId&&!this.#t(a)?null:(a.id=this.annotationElementId,a)}#t(t){const{color:e,thickness:s,opacity:i,pageIndex:n}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized||t.color.some((r,a)=>r!==e[a])||t.thickness!==s||t.opacity!==i||t.pageIndex!==n}renderAnnotationElement(t){if(this.deleted)return t.hide(),null;const{points:e,rect:s}=this.serializeDraw(!1);return t.updateEdited({rect:s,thickness:this._drawingOptions["stroke-width"],points:e,popup:this.comment}),null}}class Ai extends fs{toSVGPath(){let t=super.toSVGPath();return t.endsWith("Z")||(t+="Z"),t}}const Ls=8,qe=3;class de{static#t={maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16};static#e(t,e,s,i){return s-=t,i-=e,s===0?i>0?0:4:s===1?i+6:2-i}static#i=new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]);static#s(t,e,s,i,n,r,a){const l=this.#e(s,i,n,r);for(let c=0;c<8;c++){const h=(-c+l-a+16)%8,d=this.#i[2*h],u=this.#i[2*h+1];if(t[(s+d)*e+(i+u)]!==0)return h}return-1}static#a(t,e,s,i,n,r,a){const l=this.#e(s,i,n,r);for(let c=0;c<8;c++){const h=(c+l+a+16)%8,d=this.#i[2*h],u=this.#i[2*h+1];if(t[(s+d)*e+(i+u)]!==0)return h}return-1}static#n(t,e,s,i){const n=t.length,r=new Int32Array(n);for(let h=0;h<n;h++)r[h]=t[h]<=i?1:0;for(let h=1;h<s-1;h++)r[h*e]=r[h*e+e-1]=0;for(let h=0;h<e;h++)r[h]=r[e*s-1-h]=0;let a=1,l;const c=[];for(let h=1;h<s-1;h++){l=1;for(let d=1;d<e-1;d++){const u=h*e+d,f=r[u];if(f===0)continue;let m=h,g=d;if(f===1&&r[u-1]===0)a+=1,g-=1;else if(f>=1&&r[u+1]===0)a+=1,g+=1,f>1&&(l=f);else{f!==1&&(l=Math.abs(f));continue}const y=[d,h],b=g===d+1,x={isHole:b,points:y,id:a,parent:0};c.push(x);let w;for(const L of c)if(L.id===l){w=L;break}w?w.isHole?x.parent=b?w.parent:l:x.parent=b?l:w.parent:x.parent=b?l:0;const A=this.#s(r,e,h,d,m,g,0);if(A===-1){r[u]=-a,r[u]!==1&&(l=Math.abs(r[u]));continue}let v=this.#i[2*A],k=this.#i[2*A+1];const S=h+v,_=d+k;m=S,g=_;let E=h,T=d;for(;;){const L=this.#a(r,e,E,T,m,g,1);v=this.#i[2*L],k=this.#i[2*L+1];const G=E+v,H=T+k;y.push(H,G);const O=E*e+T;if(r[O+1]===0?r[O]=-a:r[O]===1&&(r[O]=a),G===h&&H===d&&E===S&&T===_){r[u]!==1&&(l=Math.abs(r[u]));break}else m=E,g=T,E=G,T=H}}}return c}static#r(t,e,s,i){if(s-e<=4){for(let S=e;S<s-2;S+=2)i.push(t[S],t[S+1]);return}const n=t[e],r=t[e+1],a=t[s-4]-n,l=t[s-3]-r,c=Math.hypot(a,l),h=a/c,d=l/c,u=h*r-d*n,f=l/a,m=1/c,g=Math.atan(f),y=Math.cos(g),b=Math.sin(g),x=m*(Math.abs(y)+Math.abs(b)),w=m*(1-x+x**2),A=Math.max(Math.atan(Math.abs(b+y)*w),Math.atan(Math.abs(b-y)*w));let v=0,k=e;for(let S=e+2;S<s-2;S+=2){const _=Math.abs(u-h*t[S+1]+d*t[S]);_>v&&(k=S,v=_)}v>(c*A)**2?(this.#r(t,e,k+2,i),this.#r(t,k,s,i)):i.push(n,r)}static#o(t){const e=[],s=t.length;return this.#r(t,0,s,e),e.push(t[s-2],t[s-1]),e.length<=4?null:e}static#c(t,e,s,i,n,r){const a=new Float32Array(r**2),l=-2*i**2,c=r>>1;for(let g=0;g<r;g++){const y=(g-c)**2;for(let b=0;b<r;b++)a[g*r+b]=Math.exp((y+(b-c)**2)/l)}const h=new Float32Array(256),d=-2*n**2;for(let g=0;g<256;g++)h[g]=Math.exp(g**2/d);const u=t.length,f=new Uint8Array(u),m=new Uint32Array(256);for(let g=0;g<s;g++)for(let y=0;y<e;y++){const b=g*e+y,x=t[b];let w=0,A=0;for(let k=0;k<r;k++){const S=g+k-c;if(!(S<0||S>=s))for(let _=0;_<r;_++){const E=y+_-c;if(E<0||E>=e)continue;const T=t[S*e+E],L=a[k*r+_]*h[Math.abs(T-x)];w+=T*L,A+=L}}const v=f[b]=Math.round(w/A);m[v]++}return[f,m]}static#l(t){const e=new Uint32Array(256);for(const s of t)e[s]++;return e}static#u(t){const e=t.length,s=new Uint8ClampedArray(e>>2);let i=-1/0,n=1/0;for(let a=0,l=s.length;a<l;a++){const c=s[a]=t[a<<2];i=Math.max(i,c),n=Math.min(n,c)}const r=255/(i-n);for(let a=0,l=s.length;a<l;a++)s[a]=(s[a]-n)*r;return s}static#d(t){let e,s=-1/0,i=-1/0;const n=t.findIndex(l=>l!==0);let r=n,a=n;for(e=n;e<256;e++){const l=t[e];l>s&&(e-r>i&&(i=e-r,a=e-1),s=l,r=e)}for(e=a-1;e>=0&&!(t[e]>t[e+1]);e--);return e}static#p(t){const e=t,{width:s,height:i}=t,{maxDim:n}=this.#t;let r=s,a=i;if(s>n||i>n){let u=s,f=i,m=Math.log2(Math.max(s,i)/n);const g=Math.floor(m);m=m===g?g-1:g;for(let b=0;b<m;b++){r=Math.ceil(u/2),a=Math.ceil(f/2);const x=new OffscreenCanvas(r,a);x.getContext("2d").drawImage(t,0,0,u,f,0,0,r,a),u=r,f=a,t!==e&&t.close(),t=x.transferToImageBitmap()}const y=Math.min(n/r,n/a);r=Math.round(r*y),a=Math.round(a*y)}const c=new OffscreenCanvas(r,a).getContext("2d",{willReadFrequently:!0});c.fillStyle="white",c.fillRect(0,0,r,a),c.filter="grayscale(1)",c.drawImage(t,0,0,t.width,t.height,0,0,r,a);const h=c.getImageData(0,0,r,a).data;return[this.#u(h),r,a]}static extractContoursFromText(t,{fontFamily:e,fontStyle:s,fontWeight:i},n,r,a,l){let c=new OffscreenCanvas(1,1),h=c.getContext("2d",{alpha:!1});const d=200,u=h.font=`${s} ${i} ${d}px ${e}`,{actualBoundingBoxLeft:f,actualBoundingBoxRight:m,actualBoundingBoxAscent:g,actualBoundingBoxDescent:y,fontBoundingBoxAscent:b,fontBoundingBoxDescent:x,width:w}=h.measureText(t),A=1.5,v=Math.ceil(Math.max(Math.abs(f)+Math.abs(m)||0,w)*A),k=Math.ceil(Math.max(Math.abs(g)+Math.abs(y)||d,Math.abs(b)+Math.abs(x)||d)*A);c=new OffscreenCanvas(v,k),h=c.getContext("2d",{alpha:!0,willReadFrequently:!0}),h.font=u,h.filter="grayscale(1)",h.fillStyle="white",h.fillRect(0,0,v,k),h.fillStyle="black",h.fillText(t,v*(A-1)/2,k*(3-A)/2);const S=this.#u(h.getImageData(0,0,v,k).data),_=this.#l(S),E=this.#d(_),T=this.#n(S,v,k,E);return this.processDrawnLines({lines:{curves:T,width:v,height:k},pageWidth:n,pageHeight:r,rotation:a,innerMargin:l,mustSmooth:!0,areContours:!0})}static process(t,e,s,i,n){const[r,a,l]=this.#p(t),[c,h]=this.#c(r,a,l,Math.hypot(a,l)*this.#t.sigmaSFactor,this.#t.sigmaR,this.#t.kernelSize),d=this.#d(h),u=this.#n(c,a,l,d);return this.processDrawnLines({lines:{curves:u,width:a,height:l},pageWidth:e,pageHeight:s,rotation:i,innerMargin:n,mustSmooth:!0,areContours:!0})}static processDrawnLines({lines:t,pageWidth:e,pageHeight:s,rotation:i,innerMargin:n,mustSmooth:r,areContours:a}){i%180!==0&&([e,s]=[s,e]);const{curves:l,width:c,height:h}=t,d=t.thickness??0,u=[],f=Math.min(e/c,s/h),m=f/e,g=f/s,y=[];for(const{points:x}of l){const w=r?this.#o(x):x;if(!w)continue;y.push(w);const A=w.length,v=new Float32Array(A),k=new Float32Array(3*(A===2?2:A-2));if(u.push({line:k,points:v}),A===2){v[0]=w[0]*m,v[1]=w[1]*g,k.set([NaN,NaN,NaN,NaN,v[0],v[1]],0);continue}let[S,_,E,T]=w;S*=m,_*=g,E*=m,T*=g,v.set([S,_,E,T],0),k.set([NaN,NaN,NaN,NaN,S,_],0);for(let L=4;L<A;L+=2){const G=v[L]=w[L]*m,H=v[L+1]=w[L+1]*g;k.set(N.createBezierPoints(S,_,E,T,G,H),(L-2)*3),[S,_,E,T]=[E,T,G,H]}}if(u.length===0)return null;const b=a?new Ai:new fs;return b.build(u,e,s,1,i,a?0:d,n),{outline:b,newCurves:y,areContours:a,thickness:d,width:c,height:h}}static async compressSignature({outlines:t,areContours:e,thickness:s,width:i,height:n}){let r=1/0,a=-1/0,l=0;for(const w of t){l+=w.length;for(let A=2,v=w.length;A<v;A++){const k=w[A]-w[A-2];r=Math.min(r,k),a=Math.max(a,k)}}let c;r>=-128&&a<=127?c=Int8Array:r>=-32768&&a<=32767?c=Int16Array:c=Int32Array;const h=t.length,d=Ls+qe*h,u=new Uint32Array(d);let f=0;u[f++]=d*Uint32Array.BYTES_PER_ELEMENT+(l-2*h)*c.BYTES_PER_ELEMENT,u[f++]=0,u[f++]=i,u[f++]=n,u[f++]=e?0:1,u[f++]=Math.max(0,Math.floor(s??0)),u[f++]=h,u[f++]=c.BYTES_PER_ELEMENT;for(const w of t)u[f++]=w.length-2,u[f++]=w[0],u[f++]=w[1];const m=new CompressionStream("deflate-raw"),g=m.writable.getWriter();await g.ready,g.write(u);const y=c.prototype.constructor;for(const w of t){const A=new y(w.length-2);for(let v=2,k=w.length;v<k;v++)A[v-2]=w[v]-w[v-2];g.write(A)}g.close();const b=await new Response(m.readable).arrayBuffer(),x=new Uint8Array(b);return ar(x)}static async decompressSignature(t){try{const e=Wo(t),{readable:s,writable:i}=new DecompressionStream("deflate-raw"),n=i.getWriter();await n.ready,n.write(e).then(async()=>{await n.ready,await n.close()}).catch(()=>{});let r=null,a=0;for await(const w of s)r||=new Uint8Array(new Uint32Array(w.buffer,0,4)[0]),r.set(w,a),a+=w.length;const l=new Uint32Array(r.buffer,0,r.length>>2),c=l[1];if(c!==0)throw new Error(`Invalid version: ${c}`);const h=l[2],d=l[3],u=l[4]===0,f=l[5],m=l[6],g=l[7],y=[],b=(Ls+qe*m)*Uint32Array.BYTES_PER_ELEMENT;let x;switch(g){case Int8Array.BYTES_PER_ELEMENT:x=new Int8Array(r.buffer,b);break;case Int16Array.BYTES_PER_ELEMENT:x=new Int16Array(r.buffer,b);break;case Int32Array.BYTES_PER_ELEMENT:x=new Int32Array(r.buffer,b);break}a=0;for(let w=0;w<m;w++){const A=l[qe*w+Ls],v=new Float32Array(A+2);y.push(v);for(let k=0;k<qe-1;k++)v[k]=l[qe*w+Ls+k+1];for(let k=0;k<A;k++)v[k+2]=v[k]+x[a++]}return{areContours:u,thickness:f,outlines:y,width:h,height:d}}catch(e){return B(`decompressSignature: ${e}`),null}}}class Wi extends Br{constructor(){super(),super.updateProperties({fill:I._defaultLineColor,"stroke-width":0})}clone(){const t=new Wi;return t.updateAll(this),t}}class qi extends Vs{constructor(t){super(t),super.updateProperties({stroke:I._defaultLineColor,"stroke-width":1})}clone(){const t=new qi(this._viewParameters);return t.updateAll(this),t}}class Xt extends F{#t=!1;#e=null;#i=null;#s=null;static _type="signature";static _editorType=j.SIGNATURE;static _defaultDrawingOptions=null;constructor(t){super({...t,mustBeCommitted:!0,name:"signatureEditor"}),this._willKeepAspectRatio=!0,this.#i=t.signatureData||null,this.#e=null,this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(t,e){I.initialize(t,e),this._defaultDrawingOptions=new Wi,this._defaultDrawnSignatureOptions=new qi(e.viewParameters)}static getDefaultDrawingOptions(t){const e=this._defaultDrawingOptions.clone();return e.updateProperties(t),e}static get supportMultipleDrawings(){return!1}static get typesMap(){return z(this,"typesMap",new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:"signature",hasDescription:!!this.#e}}static computeTelemetryFinalData(t){const e=t.get("hasDescription");return{hasAltText:e.get(!0)??0,hasNoAltText:e.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){this._drawId!==null&&super.onScaleChanging()}render(){if(this.div)return this.div;let t,e;const{_isCopy:s}=this;if(s&&(this._isCopy=!1,t=this.x,e=this.y),super.render(),this._drawId===null)if(this.#i){const{lines:i,mustSmooth:n,areContours:r,description:a,uuid:l,heightInPage:c}=this.#i,{rawDims:{pageWidth:h,pageHeight:d},rotation:u}=this.parent.viewport,f=de.processDrawnLines({lines:i,pageWidth:h,pageHeight:d,rotation:u,innerMargin:Xt._INNER_MARGIN,mustSmooth:n,areContours:r});this.addSignature(f,c,a,l)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this);else this.div.setAttribute("data-l10n-args",JSON.stringify({description:this.#e||""}));return s&&(this._isCopy=!0,this._moveAfterPaste(t,e)),this.div}setUuid(t){this.#s=t,this.addEditToolbar()}getUuid(){return this.#s}get description(){return this.#e}set description(t){this.#e=t,this.div&&(this.div.setAttribute("data-l10n-args",JSON.stringify({description:t})),super.addEditToolbar().then(e=>{e?.updateEditSignatureButton(t)}))}getSignaturePreview(){const{newCurves:t,areContours:e,thickness:s,width:i,height:n}=this.#i,r=Math.max(i,n),a=de.processDrawnLines({lines:{curves:t.map(l=>({points:l})),thickness:s,width:i,height:n},pageWidth:r,pageHeight:r,rotation:0,innerMargin:0,mustSmooth:!1,areContours:e});return{areContours:e,outline:a.outline}}get toolbarButtons(){return this._uiManager.signatureManager?[["editSignature",this._uiManager.signatureManager]]:super.toolbarButtons}addSignature(t,e,s,i){const{x:n,y:r}=this,{outline:a}=this.#i=t;this.#t=a instanceof Ai,this.description=s;let l;this.#t?l=Xt.getDefaultDrawingOptions():(l=Xt._defaultDrawnSignatureOptions.clone(),l.updateProperties({"stroke-width":a.thickness})),this._addOutlines({drawOutlines:a,drawingOptions:l});const[,c]=this.pageDimensions;let h=e/c;h=h>=1?.5:h,this.width*=h/this.height,this.width>=1&&(h*=.9/this.width,this.width=.9),this.height=h,this.setDims(),this.x=n,this.y=r,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(i),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!i,hasDescription:!!s}}),this.div.hidden=!1}getFromImage(t){const{rawDims:{pageWidth:e,pageHeight:s},rotation:i}=this.parent.viewport;return de.process(t,e,s,i,Xt._INNER_MARGIN)}getFromText(t,e){const{rawDims:{pageWidth:s,pageHeight:i},rotation:n}=this.parent.viewport;return de.extractContoursFromText(t,e,s,i,n,Xt._INNER_MARGIN)}getDrawnSignature(t){const{rawDims:{pageWidth:e,pageHeight:s},rotation:i}=this.parent.viewport;return de.processDrawnLines({lines:t,pageWidth:e,pageHeight:s,rotation:i,innerMargin:Xt._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions({areContours:t,thickness:e}){t?this._drawingOptions=Xt.getDefaultDrawingOptions():(this._drawingOptions=Xt._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":e}))}serialize(t=!1){if(this.isEmpty())return null;const{lines:e,points:s}=this.serializeDraw(t),{_drawingOptions:{"stroke-width":i}}=this,n=Object.assign(super.serialize(t),{isSignature:!0,areContours:this.#t,color:[0,0,0],thickness:this.#t?0:i});return this.addComment(n),t?(n.paths={lines:e,points:s},n.uuid=this.#s,n.isCopy=!0):n.lines=e,this.#e&&(n.accessibilityData={type:"Figure",alt:this.#e}),n}static deserializeDraw(t,e,s,i,n,r){return r.areContours?Ai.deserialize(t,e,s,i,n,r):fs.deserialize(t,e,s,i,n,r)}static async deserialize(t,e,s){const i=await super.deserialize(t,e,s);return i.#t=t.areContours,i.description=t.accessibilityData?.alt||"",i.#s=t.uuid,i}}class Ac extends I{#t=null;#e=null;#i=null;#s=null;#a=null;#n="";#r=null;#o=!1;#c=null;#l=!1;#u=!1;static _type="stamp";static _editorType=j.STAMP;constructor(t){super({...t,name:"stampEditor"}),this.#s=t.bitmapUrl,this.#a=t.bitmapFile,this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(t,e){I.initialize(t,e)}static isHandlingMimeForPasting(t){return Os.includes(t)}static paste(t,e){e.pasteEditor({mode:j.STAMP},{bitmapFile:t.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){return{type:"stamp",hasAltText:!!this.altTextData?.altText}}static computeTelemetryFinalData(t){const e=t.get("hasAltText");return{hasAltText:e.get(!0)??0,hasNoAltText:e.get(!1)??0}}#d(t,e=!1){if(!t){this.remove();return}this.#t=t.bitmap,e||(this.#e=t.id,this.#l=t.isSvg),t.file&&(this.#n=t.file.name),this.#f()}#p(){if(this.#i=null,this._uiManager.enableWaiting(!1),!!this.#r){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#t){this.addEditToolbar().then(()=>{this._editToolbar.hide(),this._uiManager.editAltText(this,!0)});return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#t){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}}async mlGuessAltText(t=null,e=!0){if(this.hasAltTextData())return null;const{mlManager:s}=this._uiManager;if(!s)throw new Error("No ML.");if(!await s.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:i,width:n,height:r}=t||this.copyCanvas(null,null,!0).imageData,a=await s.guess({name:"altText",request:{data:i,width:n,height:r,channels:i.length/(n*r)}});if(!a)throw new Error("No response from the AI service.");if(a.error)throw new Error("Error from the AI service.");if(a.cancel)return null;if(!a.output)throw new Error("No valid response from the AI service.");const l=a.output;return await this.setGuessedAltText(l),e&&!this.hasAltTextData()&&(this.altTextData={alt:l,decorative:!1}),l}#m(){if(this.#e){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(this.#e).then(s=>this.#d(s,!0)).finally(()=>this.#p());return}if(this.#s){const s=this.#s;this.#s=null,this._uiManager.enableWaiting(!0),this.#i=this._uiManager.imageManager.getFromUrl(s).then(i=>this.#d(i)).finally(()=>this.#p());return}if(this.#a){const s=this.#a;this.#a=null,this._uiManager.enableWaiting(!0),this.#i=this._uiManager.imageManager.getFromFile(s).then(i=>this.#d(i)).finally(()=>this.#p());return}const t=document.createElement("input");t.type="file",t.accept=Os.join(",");const e=this._uiManager._signal;this.#i=new Promise(s=>{t.addEventListener("change",async()=>{if(!t.files||t.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const i=await this._uiManager.imageManager.getFromFile(t.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),this.#d(i)}s()},{signal:e}),t.addEventListener("cancel",()=>{this.remove(),s()},{signal:e})}).finally(()=>this.#p()),t.click()}remove(){this.#e&&(this.#t=null,this._uiManager.imageManager.deleteId(this.#e),this.#r?.remove(),this.#r=null,this.#c&&(clearTimeout(this.#c),this.#c=null)),super.remove()}rebuild(){if(!this.parent){this.#e&&this.#m();return}super.rebuild(),this.div!==null&&(this.#e&&this.#r===null&&this.#m(),this.isAttachedToDOM||this.parent.add(this))}onceAdded(t){this._isDraggable=!0,t&&this.div.focus()}isEmpty(){return!(this.#i||this.#t||this.#s||this.#a||this.#e||this.#o)}get toolbarButtons(){return[["altText",this.createAltText()]]}get isResizable(){return!0}render(){if(this.div)return this.div;let t,e;return this._isCopy&&(t=this.x,e=this.y),super.render(),this.div.hidden=!0,this.createAltText(),this.#o||(this.#t?this.#f():this.#m()),this._isCopy&&this._moveAfterPaste(t,e),this._uiManager.addShouldRescale(this),this.div}setCanvas(t,e){const{id:s,bitmap:i}=this._uiManager.imageManager.getFromCanvas(t,e);e.remove(),s&&this._uiManager.imageManager.isValidId(s)&&(this.#e=s,i&&(this.#t=i),this.#o=!1,this.#f())}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;this.#c!==null&&clearTimeout(this.#c);const t=200;this.#c=setTimeout(()=>{this.#c=null,this.#g()},t)}#f(){const{div:t}=this;let{width:e,height:s}=this.#t;const[i,n]=this.pageDimensions,r=.75;if(this.width)e=this.width*i,s=this.height*n;else if(e>r*i||s>r*n){const l=Math.min(r*i/e,r*n/s);e*=l,s*=l}this._uiManager.enableWaiting(!1);const a=this.#r=document.createElement("canvas");a.setAttribute("role","img"),this.addContainer(a),this.width=e/i,this.height=s/n,this.setDims(),this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(t.hidden=!1),this.#g(),this.#u||(this.parent.addUndoableEditor(this),this.#u=!0),this._reportTelemetry({action:"inserted_image"}),this.#n&&this.div.setAttribute("aria-description",this.#n),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-stamp-added-alert")}copyCanvas(t,e,s=!1){t||(t=224);const{width:i,height:n}=this.#t,r=new zt;let a=this.#t,l=i,c=n,h=null;if(e){if(i>e||n>e){const k=Math.min(e/i,e/n);l=Math.floor(i*k),c=Math.floor(n*k)}h=document.createElement("canvas");const u=h.width=Math.ceil(l*r.sx),f=h.height=Math.ceil(c*r.sy);this.#l||(a=this.#h(u,f));const m=h.getContext("2d");m.filter=this._uiManager.hcmFilter;let g="white",y="#cfcfd8";this._uiManager.hcmFilter!=="none"?y="black":Yo.isDarkMode&&(g="#8f8f9d",y="#42414d");const b=15,x=b*r.sx,w=b*r.sy,A=new OffscreenCanvas(x*2,w*2),v=A.getContext("2d");v.fillStyle=g,v.fillRect(0,0,x*2,w*2),v.fillStyle=y,v.fillRect(0,0,x,w),v.fillRect(x,w,x,w),m.fillStyle=m.createPattern(A,"repeat"),m.fillRect(0,0,u,f),m.drawImage(a,0,0,a.width,a.height,0,0,u,f)}let d=null;if(s){let u,f;if(r.symmetric&&a.width<t&&a.height<t)u=a.width,f=a.height;else if(a=this.#t,i>t||n>t){const y=Math.min(t/i,t/n);u=Math.floor(i*y),f=Math.floor(n*y),this.#l||(a=this.#h(u,f))}const g=new OffscreenCanvas(u,f).getContext("2d",{willReadFrequently:!0});g.drawImage(a,0,0,a.width,a.height,0,0,u,f),d={width:u,height:f,data:g.getImageData(0,0,u,f).data}}return{canvas:h,width:l,height:c,imageData:d}}#h(t,e){const{width:s,height:i}=this.#t;let n=s,r=i,a=this.#t;for(;n>2*t||r>2*e;){const l=n,c=r;n>2*t&&(n=n>=16384?Math.floor(n/2)-1:Math.ceil(n/2)),r>2*e&&(r=r>=16384?Math.floor(r/2)-1:Math.ceil(r/2));const h=new OffscreenCanvas(n,r);h.getContext("2d").drawImage(a,0,0,l,c,0,0,n,r),a=h.transferToImageBitmap()}return a}#g(){const[t,e]=this.parentDimensions,{width:s,height:i}=this,n=new zt,r=Math.ceil(s*t*n.sx),a=Math.ceil(i*e*n.sy),l=this.#r;if(!l||l.width===r&&l.height===a)return;l.width=r,l.height=a;const c=this.#l?this.#t:this.#h(r,a),h=l.getContext("2d");h.filter=this._uiManager.hcmFilter,h.drawImage(c,0,0,c.width,c.height,0,0,r,a)}#b(t){if(t){if(this.#l){const i=this._uiManager.imageManager.getSvgUrl(this.#e);if(i)return i}const e=document.createElement("canvas");return{width:e.width,height:e.height}=this.#t,e.getContext("2d").drawImage(this.#t,0,0),e.toDataURL()}if(this.#l){const[e,s]=this.pageDimensions,i=Math.round(this.width*e*be.PDF_TO_CSS_UNITS),n=Math.round(this.height*s*be.PDF_TO_CSS_UNITS),r=new OffscreenCanvas(i,n);return r.getContext("2d").drawImage(this.#t,0,0,this.#t.width,this.#t.height,0,0,i,n),r.transferToImageBitmap()}return structuredClone(this.#t)}static async deserialize(t,e,s){let i=null,n=!1;if(t instanceof Fr){const{data:{rect:g,rotation:y,id:b,structParent:x,popupRef:w,richText:A,contentsObj:v,creationDate:k,modificationDate:S},container:_,parent:{page:{pageNumber:E}},canvas:T}=t;let L,G;T?(delete t.canvas,{id:L,bitmap:G}=s.imageManager.getFromCanvas(_.id,T),T.remove()):(n=!0,t._hasNoCanvas=!0);const H=(await e._structTree.getAriaAttributes(`${Pi}${b}`))?.get("aria-label")||"";i=t={annotationType:j.STAMP,bitmapId:L,bitmap:G,pageIndex:E-1,rect:g.slice(0),rotation:y,annotationElementId:b,id:b,deleted:!1,accessibilityData:{decorative:!1,altText:H},isSvg:!1,structParent:x,popupRef:w,richText:A,comment:v?.str||null,creationDate:k,modificationDate:S}}const r=await super.deserialize(t,e,s),{rect:a,bitmap:l,bitmapUrl:c,bitmapId:h,isSvg:d,accessibilityData:u}=t;n?(s.addMissingCanvas(t.id,r),r.#o=!0):h&&s.imageManager.isValidId(h)?(r.#e=h,l&&(r.#t=l)):r.#s=c,r.#l=d;const[f,m]=r.pageDimensions;return r.width=(a[2]-a[0])/f,r.height=(a[3]-a[1])/m,u&&(r.altTextData=u),r._initialData=i,t.comment&&r.setCommentData(t),r.#u=!!i,r}serialize(t=!1,e=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const s=Object.assign(super.serialize(t),{bitmapId:this.#e,isSvg:this.#l});if(this.addComment(s),t)return s.bitmapUrl=this.#b(!0),s.accessibilityData=this.serializeAltText(!0),s.isCopy=!0,s;const{decorative:i,altText:n}=this.serializeAltText(!1);if(!i&&n&&(s.accessibilityData={type:"Figure",alt:n}),this.annotationElementId){const a=this.#w(s);return a.isSame?null:(a.isSameAltText?delete s.accessibilityData:s.accessibilityData.structParent=this._initialData.structParent??-1,s.id=this.annotationElementId,delete s.bitmapId,s)}if(e===null)return s;e.stamps||=new Map;const r=this.#l?(s.rect[2]-s.rect[0])*(s.rect[3]-s.rect[1]):null;if(!e.stamps.has(this.#e))e.stamps.set(this.#e,{area:r,serialized:s}),s.bitmap=this.#b(!1);else if(this.#l){const a=e.stamps.get(this.#e);r>a.area&&(a.area=r,a.serialized.bitmap.close(),a.serialized.bitmap=this.#b(!1))}return s}#w(t){const{pageIndex:e,accessibilityData:{altText:s}}=this._initialData,i=t.pageIndex===e,n=(t.accessibilityData?.alt||"")===s;return{isSame:!this.hasEditedComment&&!this._hasBeenMoved&&!this._hasBeenResized&&i&&n,isSameAltText:n}}renderAnnotationElement(t){return this.deleted?(t.hide(),null):(t.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}}class Kt{#t;#e=!1;#i=null;#s=null;#a=null;#n=new Map;#r=!1;#o=!1;#c=!1;#l=null;#u=null;#d=null;#p=null;#m=null;#f=-1;#h;static _initialized=!1;static#g=new Map([gt,Vi,Ac,dt,Xt].map(t=>[t._editorType,t]));constructor({uiManager:t,pageIndex:e,div:s,structTreeLayer:i,accessibilityManager:n,annotationLayer:r,drawLayer:a,textLayer:l,viewport:c,l10n:h}){const d=[...Kt.#g.values()];if(!Kt._initialized){Kt._initialized=!0;for(const u of d)u.initialize(h,t)}t.registerEditorTypes(d),this.#h=t,this.pageIndex=e,this.div=s,this.#t=n,this.#i=r,this.viewport=c,this.#d=l,this.drawLayer=a,this._structTree=i,this.#h.addLayer(this)}get isEmpty(){return this.#n.size===0}get isInvisible(){return this.isEmpty&&this.#h.getMode()===j.NONE}updateToolbar(t){this.#h.updateToolbar(t)}updateMode(t=this.#h.getMode()){switch(this.#x(),t){case j.NONE:this.div.classList.toggle("nonEditing",!0),this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case j.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case j.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:e}=this.div;if(e.toggle("nonEditing",!1),t===j.POPUP)e.toggle("commentEditing",!0);else{e.toggle("commentEditing",!1);for(const s of Kt.#g.values())e.toggle(`${s._type}Editing`,t===s._editorType)}this.div.hidden=!1}hasTextLayer(t){return t===this.#d?.div}setEditingState(t){this.#h.setEditingState(t)}addCommands(t){this.#h.addCommands(t)}cleanUndoStack(t){this.#h.cleanUndoStack(t)}toggleDrawing(t=!1){this.div.classList.toggle("drawing",!t)}togglePointerEvents(t=!1){this.div.classList.toggle("disabled",!t)}toggleAnnotationLayerPointerEvents(t=!1){this.#i?.div.classList.toggle("disabled",!t)}get#b(){return this.#n.size!==0?this.#n.values():this.#h.getEditors(this.pageIndex)}async enable(){this.#c=!0,this.div.tabIndex=0,this.togglePointerEvents(!0),this.div.classList.toggle("nonEditing",!1),this.#m?.abort(),this.#m=null;const t=new Set;for(const s of this.#b)s.enableEditing(),s.show(!0),s.annotationElementId&&(this.#h.removeChangedExistingAnnotation(s),t.add(s.annotationElementId));const e=this.#i;if(e)for(const s of e.getEditableAnnotations()){if(s.hide(),this.#h.isDeletedAnnotationElement(s.data.id)||t.has(s.data.id))continue;const i=await this.deserialize(s);i&&(this.addOrRebuild(i),i.enableEditing())}this.#c=!1,this.#h._eventBus.dispatch("editorsrendered",{source:this,pageNumber:this.pageIndex+1})}disable(){if(this.#o=!0,this.div.tabIndex=-1,this.togglePointerEvents(!1),this.div.classList.toggle("nonEditing",!0),this.#d&&!this.#m){this.#m=new AbortController;const s=this.#h.combinedSignal(this.#m);this.#d.div.addEventListener("pointerdown",i=>{const{clientX:r,clientY:a,timeStamp:l}=i,c=this.#f;if(l-c>500){this.#f=l;return}this.#f=-1;const{classList:h}=this.div;h.toggle("getElements",!0);const d=document.elementsFromPoint(r,a);if(h.toggle("getElements",!1),!this.div.contains(d[0]))return;let u;const f=new RegExp(`^${ts}[0-9]+$`);for(const g of d)if(f.test(g.id)){u=g.id;break}if(!u)return;const m=this.#n.get(u);m?.annotationElementId===null&&(i.stopPropagation(),i.preventDefault(),m.dblclick(i))},{signal:s,capture:!0})}const t=this.#i;if(t){const s=new Map,i=new Map;for(const r of this.#b){if(r.disableEditing(),!r.annotationElementId){r.updateFakeAnnotationElement(t);continue}if(r.serialize()!==null){s.set(r.annotationElementId,r);continue}else i.set(r.annotationElementId,r);this.getEditableAnnotation(r.annotationElementId)?.show(),r.remove()}const n=t.getEditableAnnotations();for(const r of n){const{id:a}=r.data;if(this.#h.isDeletedAnnotationElement(a)){r.updateEdited({deleted:!0});continue}let l=i.get(a);if(l){l.resetAnnotationElement(r),l.show(!1),r.show();continue}l=s.get(a),l&&(this.#h.addChangedExistingAnnotation(l),l.renderAnnotationElement(r)&&l.show(!1)),r.show()}}this.#x(),this.isEmpty&&(this.div.hidden=!0);const{classList:e}=this.div;for(const s of Kt.#g.values())e.remove(`${s._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),this.#o=!1}getEditableAnnotation(t){return this.#i?.getEditableAnnotation(t)||null}setActiveEditor(t){this.#h.getActive()!==t&&this.#h.setActiveEditor(t)}enableTextSelection(){if(this.div.tabIndex=-1,this.#d?.div&&!this.#p){this.#p=new AbortController;const t=this.#h.combinedSignal(this.#p);this.#d.div.addEventListener("pointerdown",this.#w.bind(this),{signal:t}),this.#d.div.classList.add("highlighting")}}disableTextSelection(){this.div.tabIndex=0,this.#d?.div&&this.#p&&(this.#p.abort(),this.#p=null,this.#d.div.classList.remove("highlighting"))}#w(t){this.#h.unselectAll();const{target:e}=t;if(e===this.#d.div||(e.getAttribute("role")==="img"||e.classList.contains("endOfContent"))&&this.#d.div.contains(e)){const{isMac:s}=bt.platform;if(t.button!==0||t.ctrlKey&&s)return;this.#h.showAllEditors("highlight",!0,!0),this.#d.div.classList.add("free"),this.toggleDrawing(),dt.startHighlighting(this,this.#h.direction==="ltr",{target:this.#d.div,x:t.x,y:t.y}),this.#d.div.addEventListener("pointerup",()=>{this.#d.div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:this.#h._signal}),t.preventDefault()}}enableClick(){if(this.#s)return;this.#s=new AbortController;const t=this.#h.combinedSignal(this.#s);this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:t});const e=this.pointerup.bind(this);this.div.addEventListener("pointerup",e,{signal:t}),this.div.addEventListener("pointercancel",e,{signal:t})}disableClick(){this.#s?.abort(),this.#s=null}attach(t){this.#n.set(t.id,t);const{annotationElementId:e}=t;e&&this.#h.isDeletedAnnotationElement(e)&&this.#h.removeDeletedAnnotationElement(t)}detach(t){this.#n.delete(t.id),this.#t?.removePointerInTextLayer(t.contentDiv),!this.#o&&t.annotationElementId&&this.#h.addDeletedAnnotationElement(t)}remove(t){this.detach(t),this.#h.removeEditor(t),t.div.remove(),t.isAttachedToDOM=!1}changeParent(t){t.parent!==this&&(t.parent&&t.annotationElementId&&(this.#h.addDeletedAnnotationElement(t.annotationElementId),I.deleteAnnotationElement(t),t.annotationElementId=null),this.attach(t),t.parent?.detach(t),t.setParent(this),t.div&&t.isAttachedToDOM&&(t.div.remove(),this.div.append(t.div)))}add(t){if(!(t.parent===this&&t.isAttachedToDOM)){if(this.changeParent(t),this.#h.addEditor(t),this.attach(t),!t.isAttachedToDOM){const e=t.render();this.div.append(e),t.isAttachedToDOM=!0}t.fixAndSetPosition(),t.onceAdded(!this.#c),this.#h.addToAnnotationStorage(t),t._reportTelemetry(t.telemetryInitialData)}}moveEditorInDOM(t){if(!t.isAttachedToDOM)return;const{activeElement:e}=document;t.div.contains(e)&&!this.#a&&(t._focusEventsAllowed=!1,this.#a=setTimeout(()=>{this.#a=null,t.div.contains(document.activeElement)?t._focusEventsAllowed=!0:(t.div.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this.#h._signal}),e.focus())},0)),t._structTreeParentId=this.#t?.moveElementInDOM(this.div,t.div,t.contentDiv,!0)}addOrRebuild(t){t.needsToBeRebuilt()?(t.parent||=this,t.rebuild(),t.show()):this.add(t)}addUndoableEditor(t){const e=()=>t._uiManager.rebuild(t),s=()=>{t.remove()};this.addCommands({cmd:e,undo:s,mustExec:!1})}getEditorByUID(t){for(const e of this.#n.values())if(e.uid===t)return e;return null}getNextId(){return this.#h.getId()}get#y(){return Kt.#g.get(this.#h.getMode())}combinedSignal(t){return this.#h.combinedSignal(t)}#_(t){const e=this.#y;return e?new e.prototype.constructor(t):null}canCreateNewEmptyEditor(){return this.#y?.canCreateNewEmptyEditor()}async pasteEditor(t,e){this.updateToolbar(t),await this.#h.updateMode(t.mode);const{offsetX:s,offsetY:i}=this.#k(),n=this.getNextId(),r=this.#_({parent:this,id:n,x:s,y:i,uiManager:this.#h,isCentered:!0,...e});r&&this.add(r)}async deserialize(t){return await Kt.#g.get(t.annotationType??t.annotationEditorType)?.deserialize(t,this,this.#h)||null}createAndAddNewEditor(t,e,s={}){const i=this.getNextId(),n=this.#_({parent:this,id:i,x:t.offsetX,y:t.offsetY,uiManager:this.#h,isCentered:e,...s});return n&&this.add(n),n}get boundingClientRect(){return this.div.getBoundingClientRect()}#k(){const{x:t,y:e,width:s,height:i}=this.boundingClientRect,n=Math.max(0,t),r=Math.max(0,e),a=Math.min(window.innerWidth,t+s),l=Math.min(window.innerHeight,e+i),c=(n+a)/2-t,h=(r+l)/2-e,[d,u]=this.viewport.rotation%180===0?[c,h]:[h,c];return{offsetX:d,offsetY:u}}addNewEditor(t={}){this.createAndAddNewEditor(this.#k(),!0,t)}setSelected(t){this.#h.setSelected(t)}toggleSelected(t){this.#h.toggleSelected(t)}unselect(t){this.#h.unselect(t)}pointerup(t){const{isMac:e}=bt.platform;if(t.button!==0||t.ctrlKey&&e||t.target!==this.div||!this.#r||(this.#r=!1,this.#y?.isDrawer&&this.#y.supportMultipleDrawings))return;if(!this.#e){this.#e=!0;return}const s=this.#h.getMode();if(s===j.STAMP||s===j.SIGNATURE){this.#h.unselectAll();return}this.createAndAddNewEditor(t,!1)}pointerdown(t){if(this.#h.getMode()===j.HIGHLIGHT&&this.enableTextSelection(),this.#r){this.#r=!1;return}const{isMac:e}=bt.platform;if(t.button!==0||t.ctrlKey&&e||t.target!==this.div)return;if(this.#r=!0,this.#y?.isDrawer){this.startDrawingSession(t);return}const s=this.#h.getActive();this.#e=!s||s.isEmpty()}startDrawingSession(t){if(this.div.focus({preventScroll:!0}),this.#l){this.#y.startDrawing(this,this.#h,!1,t);return}this.#h.setCurrentDrawingSession(this),this.#l=new AbortController;const e=this.#h.combinedSignal(this.#l);this.div.addEventListener("blur",({relatedTarget:s})=>{s&&!this.div.contains(s)&&(this.#u=null,this.commitOrRemove())},{signal:e}),this.#y.startDrawing(this,this.#h,!1,t)}pause(t){if(t){const{activeElement:e}=document;this.div.contains(e)&&(this.#u=e);return}this.#u&&setTimeout(()=>{this.#u?.focus(),this.#u=null},0)}endDrawingSession(t=!1){return this.#l?(this.#h.setCurrentDrawingSession(null),this.#l.abort(),this.#l=null,this.#u=null,this.#y.endDrawing(t)):null}findNewParent(t,e,s){const i=this.#h.findParent(e,s);return i===null||i===this?!1:(i.changeParent(t),!0)}commitOrRemove(){return this.#l?(this.endDrawingSession(),!0):!1}onScaleChanging(){this.#l&&this.#y.onScaleChangingWhenDrawing(this)}destroy(){this.commitOrRemove(),this.#h.getActive()?.parent===this&&(this.#h.commitOrRemove(),this.#h.setActiveEditor(null)),this.#a&&(clearTimeout(this.#a),this.#a=null);for(const t of this.#n.values())this.#t?.removePointerInTextLayer(t.contentDiv),t.setParent(null),t.isAttachedToDOM=!1,t.div.remove();this.div=null,this.#n.clear(),this.#h.removeLayer(this)}#x(){for(const t of this.#n.values())t.isEmpty()&&t.remove()}render({viewport:t}){this.viewport=t,ce(this.div,t);for(const e of this.#h.getEditors(this.pageIndex))this.add(e),e.rebuild();this.updateMode()}update({viewport:t}){this.#h.commitOrRemove(),this.#x();const e=this.viewport.rotation,s=t.rotation;if(this.viewport=t,ce(this.div,{rotation:s}),e!==s)for(const i of this.#n.values())i.rotate(s)}get pageDimensions(){const{pageWidth:t,pageHeight:e}=this.viewport.rawDims;return[t,e]}get scale(){return this.#h.viewParameters.realScale}}class mt{#t=null;#e=new Map;#i=new Map;static#s=0;constructor({pageIndex:t}){this.pageIndex=t}setParent(t){if(!this.#t){this.#t=t;return}if(this.#t!==t){if(this.#e.size>0)for(const e of this.#e.values())e.remove(),t.append(e);this.#t=t}}static get _svgFactory(){return z(this,"_svgFactory",new as)}static#a(t,[e,s,i,n]){const{style:r}=t;r.top=`${100*s}%`,r.left=`${100*e}%`,r.width=`${100*i}%`,r.height=`${100*n}%`}#n(){const t=mt._svgFactory.create(1,1,!0);return this.#t.append(t),t.setAttribute("aria-hidden",!0),t}#r(t,e){const s=mt._svgFactory.createElement("clipPath");t.append(s);const i=`clip_${e}`;s.setAttribute("id",i),s.setAttribute("clipPathUnits","objectBoundingBox");const n=mt._svgFactory.createElement("use");return s.append(n),n.setAttribute("href",`#${e}`),n.classList.add("clip"),i}#o(t,e){for(const[s,i]of Object.entries(e))i===null?t.removeAttribute(s):t.setAttribute(s,i)}draw(t,e=!1,s=!1){const i=mt.#s++,n=this.#n(),r=mt._svgFactory.createElement("defs");n.append(r);const a=mt._svgFactory.createElement("path");r.append(a);const l=`path_p${this.pageIndex}_${i}`;a.setAttribute("id",l),a.setAttribute("vector-effect","non-scaling-stroke"),e&&this.#i.set(i,a);const c=s?this.#r(r,l):null,h=mt._svgFactory.createElement("use");return n.append(h),h.setAttribute("href",`#${l}`),this.updateProperties(n,t),this.#e.set(i,n),{id:i,clipPathId:`url(#${c})`}}drawOutline(t,e){const s=mt.#s++,i=this.#n(),n=mt._svgFactory.createElement("defs");i.append(n);const r=mt._svgFactory.createElement("path");n.append(r);const a=`path_p${this.pageIndex}_${s}`;r.setAttribute("id",a),r.setAttribute("vector-effect","non-scaling-stroke");let l;if(e){const d=mt._svgFactory.createElement("mask");n.append(d),l=`mask_p${this.pageIndex}_${s}`,d.setAttribute("id",l),d.setAttribute("maskUnits","objectBoundingBox");const u=mt._svgFactory.createElement("rect");d.append(u),u.setAttribute("width","1"),u.setAttribute("height","1"),u.setAttribute("fill","white");const f=mt._svgFactory.createElement("use");d.append(f),f.setAttribute("href",`#${a}`),f.setAttribute("stroke","none"),f.setAttribute("fill","black"),f.setAttribute("fill-rule","nonzero"),f.classList.add("mask")}const c=mt._svgFactory.createElement("use");i.append(c),c.setAttribute("href",`#${a}`),l&&c.setAttribute("mask",`url(#${l})`);const h=c.cloneNode();return i.append(h),c.classList.add("mainOutline"),h.classList.add("secondaryOutline"),this.updateProperties(i,t),this.#e.set(s,i),s}finalizeDraw(t,e){this.#i.delete(t),this.updateProperties(t,e)}updateProperties(t,e){if(!e)return;const{root:s,bbox:i,rootClass:n,path:r}=e,a=typeof t=="number"?this.#e.get(t):t;if(a){if(s&&this.#o(a,s),i&&mt.#a(a,i),n){const{classList:l}=a;for(const[c,h]of Object.entries(n))l.toggle(c,h)}if(r){const c=a.firstChild.firstChild;this.#o(c,r)}}}updateParent(t,e){if(e===this)return;const s=this.#e.get(t);s&&(e.#t.append(s),this.#e.delete(t),e.#e.set(t,s))}remove(t){this.#i.delete(t),this.#t!==null&&(this.#e.get(t).remove(),this.#e.delete(t))}destroy(){this.#t=null;for(const t of this.#e.values())t.remove();this.#e.clear(),this.#i.clear()}}globalThis._pdfjsTestingUtils={HighlightOutliner:xi};globalThis.pdfjsLib={AbortException:ie,AnnotationEditorLayer:Kt,AnnotationEditorParamsType:V,AnnotationEditorType:j,AnnotationEditorUIManager:ne,AnnotationLayer:$i,AnnotationMode:Qt,AnnotationType:ht,applyOpacity:dr,build:Mr,ColorPicker:Dt,createValidAbsoluteUrl:Ci,CSSConstants:hr,DOMSVGFactory:as,DrawLayer:mt,FeatureTest:bt,fetchData:He,findContrastColor:ur,getDocument:Bi,getFilenameFromUrl:or,getPdfFilenameFromUrl:lr,getRGB:Ue,getUuid:Li,getXfaPageViewport:cr,GlobalWorkerOptions:le,ImageKind:Je,InvalidPDFException:Is,isDataScheme:hs,isPdfFile:Gs,isValidExplicitDest:mr,MathClamp:vt,noContextMenu:Ft,normalizeUnicode:rr,OPS:Oe,OutputScale:zt,PasswordResponses:ir,PDFDataRangeTransport:Ui,PDFDateString:Fs,PDFWorker:je,PermissionFlag:sr,PixelsPerInch:be,RenderingCancelledException:zs,renderRichText:Ri,ResponseException:es,setLayerDimensions:ce,shadow:z,SignatureExtractor:de,stopEvent:ot,SupportedImageMimeTypes:Os,TextLayer:is,TouchManager:us,updateUrlHash:Ti,Util:D,VerbosityLevel:os,version:ns,XfaLayer:Mi};const kc=Object.freeze(Object.defineProperty({__proto__:null,AbortException:ie,AnnotationEditorLayer:Kt,AnnotationEditorParamsType:V,AnnotationEditorType:j,AnnotationEditorUIManager:ne,AnnotationLayer:$i,AnnotationMode:Qt,AnnotationType:ht,CSSConstants:hr,ColorPicker:Dt,DOMSVGFactory:as,DrawLayer:mt,FeatureTest:bt,GlobalWorkerOptions:le,ImageKind:Je,InvalidPDFException:Is,MathClamp:vt,OPS:Oe,OutputScale:zt,PDFDataRangeTransport:Ui,PDFDateString:Fs,PDFWorker:je,PasswordResponses:ir,PermissionFlag:sr,PixelsPerInch:be,RenderingCancelledException:zs,ResponseException:es,SignatureExtractor:de,SupportedImageMimeTypes:Os,TextLayer:is,TouchManager:us,Util:D,VerbosityLevel:os,XfaLayer:Mi,applyOpacity:dr,build:Mr,createValidAbsoluteUrl:Ci,fetchData:He,findContrastColor:ur,getDocument:Bi,getFilenameFromUrl:or,getPdfFilenameFromUrl:lr,getRGB:Ue,getUuid:Li,getXfaPageViewport:cr,isDataScheme:hs,isPdfFile:Gs,isValidExplicitDest:mr,noContextMenu:Ft,normalizeUnicode:rr,renderRichText:Ri,setLayerDimensions:ce,shadow:z,stopEvent:ot,updateUrlHash:Ti,version:ns},Symbol.toStringTag,{value:"Module"}));function Hr(o){var t,e,s="";if(typeof o=="string"||typeof o=="number")s+=o;else if(typeof o=="object")if(Array.isArray(o)){var i=o.length;for(t=0;t<i;t++)o[t]&&(e=Hr(o[t]))&&(s&&(s+=" "),s+=e)}else for(e in o)o[e]&&(s&&(s+=" "),s+=e);return s}function Ws(){for(var o,t,e=0,s="",i=arguments.length;e<i;e++)(o=arguments[e])&&(t=Hr(o))&&(s&&(s+=" "),s+=t);return s}var Pn=Object.prototype.hasOwnProperty;function Mn(o,t,e){for(e of o.keys())if(De(e,t))return e}function De(o,t){var e,s,i;if(o===t)return!0;if(o&&t&&(e=o.constructor)===t.constructor){if(e===Date)return o.getTime()===t.getTime();if(e===RegExp)return o.toString()===t.toString();if(e===Array){if((s=o.length)===t.length)for(;s--&&De(o[s],t[s]););return s===-1}if(e===Set){if(o.size!==t.size)return!1;for(s of o)if(i=s,i&&typeof i=="object"&&(i=Mn(t,i),!i)||!t.has(i))return!1;return!0}if(e===Map){if(o.size!==t.size)return!1;for(s of o)if(i=s[0],i&&typeof i=="object"&&(i=Mn(t,i),!i)||!De(s[1],t.get(i)))return!1;return!0}if(e===ArrayBuffer)o=new Uint8Array(o),t=new Uint8Array(t);else if(e===DataView){if((s=o.byteLength)===t.byteLength)for(;s--&&o.getInt8(s)===t.getInt8(s););return s===-1}if(ArrayBuffer.isView(o)){if((s=o.byteLength)===t.byteLength)for(;s--&&o[s]===t[s];);return s===-1}if(!e||typeof o=="object"){s=0;for(e in o)if(Pn.call(o,e)&&++s&&!Pn.call(t,e)||!(e in t)||!De(o[e],t[e]))return!1;return Object.keys(t).length===s}}return o!==o&&t!==t}function gs(o){let t=!1;return{promise:new Promise((s,i)=>{o.then(n=>!t&&s(n)).catch(n=>!t&&i(n))}),cancel(){t=!0}}}const Sc=["onCopy","onCut","onPaste"],_c=["onCompositionEnd","onCompositionStart","onCompositionUpdate"],Ec=["onFocus","onBlur"],Cc=["onInput","onInvalid","onReset","onSubmit"],Tc=["onLoad","onError"],Lc=["onKeyDown","onKeyPress","onKeyUp"],Pc=["onAbort","onCanPlay","onCanPlayThrough","onDurationChange","onEmptied","onEncrypted","onEnded","onError","onLoadedData","onLoadedMetadata","onLoadStart","onPause","onPlay","onPlaying","onProgress","onRateChange","onSeeked","onSeeking","onStalled","onSuspend","onTimeUpdate","onVolumeChange","onWaiting"],Mc=["onClick","onContextMenu","onDoubleClick","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp"],Rc=["onDrag","onDragEnd","onDragEnter","onDragExit","onDragLeave","onDragOver","onDragStart","onDrop"],Nc=["onSelect"],Dc=["onTouchCancel","onTouchEnd","onTouchMove","onTouchStart"],Ic=["onPointerDown","onPointerMove","onPointerUp","onPointerCancel","onGotPointerCapture","onLostPointerCapture","onPointerEnter","onPointerLeave","onPointerOver","onPointerOut"],Fc=["onScroll"],Oc=["onWheel"],jc=["onAnimationStart","onAnimationEnd","onAnimationIteration"],Bc=["onTransitionEnd"],Hc=["onToggle"],Uc=["onChange"],zc=[...Sc,..._c,...Ec,...Cc,...Tc,...Lc,...Pc,...Mc,...Rc,...Nc,...Dc,...Ic,...Fc,...Oc,...jc,...Bc,...Uc,...Hc];function Ur(o,t){const e={};for(const s of zc){const i=o[s];i&&(t?e[s]=(n=>i(n,t(s))):e[s]=i)}return e}var Gc="Invariant failed";function Q(o,t){if(!o)throw new Error(Gc)}var hi,Rn;function $c(){if(Rn)return hi;Rn=1;var o=function(){};return hi=o,hi}var Vc=$c();const At=fa(Vc),zr=C.createContext(null),Wc="noopener noreferrer nofollow";class qc{constructor(){this.externalLinkEnabled=!0,this.externalLinkRel=void 0,this.externalLinkTarget=void 0,this.isInPresentationMode=!1,this.pdfDocument=void 0,this.pdfViewer=void 0}setDocument(t){this.pdfDocument=t}setViewer(t){this.pdfViewer=t}setExternalLinkRel(t){this.externalLinkRel=t}setExternalLinkTarget(t){this.externalLinkTarget=t}setHash(){}setHistory(){}get pagesCount(){return this.pdfDocument?this.pdfDocument.numPages:0}get page(){return Q(this.pdfViewer),this.pdfViewer.currentPageNumber||0}set page(t){Q(this.pdfViewer),this.pdfViewer.currentPageNumber=t}get rotation(){return 0}set rotation(t){}addLinkAttributes(t,e,s){t.href=e,t.rel=this.externalLinkRel||Wc,t.target=s?"_blank":this.externalLinkTarget||""}goToDestination(t){return new Promise(e=>{Q(this.pdfDocument),Q(t),typeof t=="string"?this.pdfDocument.getDestination(t).then(e):Array.isArray(t)?e(t):t.then(e)}).then(e=>{Q(Array.isArray(e));const s=e[0];new Promise(i=>{Q(this.pdfDocument),s instanceof Object?this.pdfDocument.getPageIndex(s).then(n=>{i(n)}).catch(()=>{Q(!1)}):typeof s=="number"?i(s):Q(!1)}).then(i=>{const n=i+1;Q(this.pdfViewer),Q(n>=1&&n<=this.pagesCount),this.pdfViewer.scrollPageIntoView({dest:e,pageIndex:i,pageNumber:n})})})}goToPage(t){const e=t-1;Q(this.pdfViewer),Q(t>=1&&t<=this.pagesCount),this.pdfViewer.scrollPageIntoView({pageIndex:e,pageNumber:t})}goToXY(){}cachePageRef(){}getDestinationHash(){return"#"}getAnchorUrl(){return"#"}executeNamedAction(){}executeSetOCGState(){}isPageVisible(){return!0}isPageCached(){return!0}navigateTo(t){this.goToDestination(t)}}function Ie({children:o,type:t}){return p.jsx("div",{className:`react-pdf__message react-pdf__message--${t}`,children:o})}const Nn={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};function Xc(o,t){switch(t.type){case"RESOLVE":return{value:t.value,error:void 0};case"REJECT":return{value:!1,error:t.error};case"RESET":return{value:void 0,error:void 0};default:return o}}function Be(){return C.useReducer(Xc,{value:void 0,error:void 0})}const qs=typeof window<"u",Gr=qs&&window.location.protocol==="file:";function Yc(o){return typeof o<"u"}function he(o){return Yc(o)&&o!==null}function Kc(o){return typeof o=="string"}function Qc(o){return o instanceof ArrayBuffer}function Jc(o){return Q(qs),o instanceof Blob}function ki(o){return Kc(o)&&/^data:/.test(o)}function Dn(o){Q(ki(o));const[t="",e=""]=o.split(",");return t.split(";").indexOf("base64")!==-1?atob(e):unescape(e)}function Zc(){return qs&&window.devicePixelRatio||1}const $r="On Chromium based browsers, you can use --allow-file-access-from-files flag for debugging purposes.";function In(){At(!Gr,`Loading PDF as base64 strings/URLs may not work on protocols other than HTTP/HTTPS. ${$r}`)}function th(){At(!Gr,`Loading PDF.js worker may not work on protocols other than HTTP/HTTPS. ${$r}`)}function we(o){o?.cancel&&o.cancel()}function Si(o,t){return Object.defineProperty(o,"width",{get(){return this.view[2]*t},configurable:!0}),Object.defineProperty(o,"height",{get(){return this.view[3]*t},configurable:!0}),Object.defineProperty(o,"originalWidth",{get(){return this.view[2]},configurable:!0}),Object.defineProperty(o,"originalHeight",{get(){return this.view[3]},configurable:!0}),o}function eh(o){return o.name==="RenderingCancelledException"}function sh(o){return new Promise((t,e)=>{const s=new FileReader;s.onload=()=>{if(!s.result)return e(new Error("Error while reading a file."));t(s.result)},s.onerror=i=>{if(!i.target)return e(new Error("Error while reading a file."));const{error:n}=i.target;if(!n)return e(new Error("Error while reading a file."));switch(n.code){case n.NOT_FOUND_ERR:return e(new Error("Error while reading a file: File not found."));case n.SECURITY_ERR:return e(new Error("Error while reading a file: Security error."));case n.ABORT_ERR:return e(new Error("Error while reading a file: Aborted."));default:return e(new Error("Error while reading a file."))}},s.readAsArrayBuffer(o)})}const{PDFDataRangeTransport:ih}=kc,nh=(o,t)=>{switch(t){case Nn.NEED_PASSWORD:{const e=prompt("Enter the password to open this PDF file.");o(e);break}case Nn.INCORRECT_PASSWORD:{const e=prompt("Invalid password. Please try again.");o(e);break}}};function Fn(o){return typeof o=="object"&&o!==null&&("data"in o||"range"in o||"url"in o)}const rh=C.forwardRef(function({children:t,className:e,error:s="Failed to load PDF file.",externalLinkRel:i,externalLinkTarget:n,file:r,inputRef:a,imageResourcesPath:l,loading:c="Loading PDF",noData:h="No PDF file specified.",onItemClick:d,onLoadError:u,onLoadProgress:f,onLoadSuccess:m,onPassword:g=nh,onSourceError:y,onSourceSuccess:b,options:x,renderMode:w,rotate:A,scale:v,...k},S){const[_,E]=Be(),{value:T,error:L}=_,[G,H]=Be(),{value:O,error:$}=G,M=C.useRef(new qc),R=C.useRef([]),U=C.useRef(void 0),nt=C.useRef(void 0);r&&r!==U.current&&Fn(r)&&(At(!De(r,U.current),`File prop passed to <Document /> changed, but it's equal to previous one. This might result in unnecessary reloads. Consider memoizing the value passed to "file" prop.`),U.current=r),x&&x!==nt.current&&(At(!De(x,nt.current),`Options prop passed to <Document /> changed, but it's equal to previous one. This might result in unnecessary reloads. Consider memoizing the value passed to "options" prop.`),nt.current=x);const kt=C.useRef({scrollPageIntoView:q=>{const{dest:et,pageNumber:pt,pageIndex:ft=pt-1}=q;if(d){d({dest:et,pageIndex:ft,pageNumber:pt});return}const Ae=R.current[ft];if(Ae){Ae.scrollIntoView();return}At(!1,`An internal link leading to page ${pt} was clicked, but neither <Document> was provided with onItemClick nor it was able to find the page within itself. Either provide onItemClick to <Document> and handle navigating by yourself or ensure that all pages are rendered within <Document>.`)}});C.useImperativeHandle(S,()=>({linkService:M,pages:R,viewer:kt}),[]);function Ot(){b&&b()}function tt(){L&&(At(!1,L.toString()),y&&y(L))}function X(){E({type:"RESET"})}C.useEffect(X,[r,E]);const St=C.useCallback(async()=>{if(!r)return null;if(typeof r=="string")return ki(r)?{data:Dn(r)}:(In(),{url:r});if(r instanceof ih)return{range:r};if(Qc(r))return{data:r};if(qs&&Jc(r))return{data:await sh(r)};if(Q(typeof r=="object"),Q(Fn(r)),"url"in r&&typeof r.url=="string"){if(ki(r.url)){const{url:q,...et}=r;return{data:Dn(q),...et}}In()}return r},[r]);C.useEffect(()=>{const q=gs(St());return q.promise.then(et=>{E({type:"RESOLVE",value:et})}).catch(et=>{E({type:"REJECT",error:et})}),()=>{we(q)}},[St,E]),C.useEffect(()=>{if(!(typeof T>"u")){if(T===!1){tt();return}Ot()}},[T]);function Lt(){O&&(m&&m(O),R.current=new Array(O.numPages),M.current.setDocument(O))}function _t(){$&&(At(!1,$.toString()),u&&u($))}C.useEffect(function(){H({type:"RESET"})},[H,T]),C.useEffect(function(){if(!T)return;const et=x?{...T,...x}:T,pt=Bi(et);f&&(pt.onProgress=f),g&&(pt.onPassword=g);const ft=pt,Ae=ft.promise.then(ze=>{H({type:"RESOLVE",value:ze})}).catch(ze=>{ft.destroyed||H({type:"REJECT",error:ze})});return()=>{Ae.finally(()=>ft.destroy())}},[x,H,T]),C.useEffect(()=>{if(!(typeof O>"u")){if(O===!1){_t();return}Lt()}},[O]),C.useEffect(function(){M.current.setViewer(kt.current),M.current.setExternalLinkRel(i),M.current.setExternalLinkTarget(n)},[i,n]);const Z=C.useCallback((q,et)=>{R.current[q]=et},[]),Gt=C.useCallback(q=>{delete R.current[q]},[]),Et=C.useMemo(()=>({imageResourcesPath:l,linkService:M.current,onItemClick:d,pdf:O,registerPage:Z,renderMode:w,rotate:A,scale:v,unregisterPage:Gt}),[l,d,O,Z,w,A,v,Gt]),rt=C.useMemo(()=>Ur(k,()=>O),[k,O]);function Jt(){function q(pt){return!!pt?.pdf}if(!q(Et))throw new Error("pdf is undefined");const et=typeof t=="function"?t(Et):t;return p.jsx(zr.Provider,{value:Et,children:et})}function Zt(){return r?O==null?p.jsx(Ie,{type:"loading",children:typeof c=="function"?c():c}):O===!1?p.jsx(Ie,{type:"error",children:typeof s=="function"?s():s}):Jt():p.jsx(Ie,{type:"no-data",children:typeof h=="function"?h():h})}return p.jsx("div",{className:Ws("react-pdf__Document",e),ref:a,...rt,children:Zt()})});function Vr(){return C.useContext(zr)}function Wr(){for(var o=[],t=0;t<arguments.length;t++)o[t]=arguments[t];var e=o.filter(Boolean);if(e.length<=1){var s=e[0];return s||null}return function(n){for(var r=0,a=e;r<a.length;r++){var l=a[r];typeof l=="function"?l(n):l&&(l.current=n)}}}const qr=C.createContext(null);function Xs(){return C.useContext(qr)}function ah(){const o=Vr(),t=Xs();Q(t);const e={...o,...t},{imageResourcesPath:s,linkService:i,onGetAnnotationsError:n,onGetAnnotationsSuccess:r,onRenderAnnotationLayerError:a,onRenderAnnotationLayerSuccess:l,page:c,pdf:h,renderForms:d,rotate:u,scale:f=1}=e;Q(h),Q(c),Q(i);const[m,g]=Be(),{value:y,error:b}=m,x=C.useRef(null);At(Number.parseInt(window.getComputedStyle(document.body).getPropertyValue("--react-pdf-annotation-layer"),10)===1,"AnnotationLayer styles not found. Read more: https://github.com/wojtekmaj/react-pdf#support-for-annotations");function w(){y&&r&&r(y)}function A(){b&&(At(!1,b.toString()),n&&n(b))}C.useEffect(function(){g({type:"RESET"})},[g,c]),C.useEffect(function(){if(!c)return;const E=gs(c.getAnnotations()),T=E;return E.promise.then(L=>{g({type:"RESOLVE",value:L})}).catch(L=>{g({type:"REJECT",error:L})}),()=>{we(T)}},[g,c]),C.useEffect(()=>{if(y!==void 0){if(y===!1){A();return}w()}},[y]);function v(){l&&l()}function k(_){At(!1,`${_}`),a&&a(_)}const S=C.useMemo(()=>c.getViewport({scale:f,rotation:u}),[c,u,f]);return C.useEffect(function(){if(!h||!c||!i||!y)return;const{current:E}=x;if(!E)return;const T=S.clone({dontFlip:!0}),L={accessibilityManager:null,annotationCanvasMap:null,annotationEditorUIManager:null,annotationStorage:h.annotationStorage,commentManager:null,div:E,l10n:null,linkService:i,page:c,structTreeLayer:null,viewport:T},G={annotations:y,annotationStorage:h.annotationStorage,div:E,imageResourcesPath:s,linkService:i,page:c,renderForms:d,viewport:T};E.innerHTML="";try{new $i(L).render(G),v()}catch(H){k(H)}return()=>{}},[y,s,i,c,h,d,S]),p.jsx("div",{className:Ws("react-pdf__Page__annotations","annotationLayer"),ref:x})}const Xr={Document:null,DocumentFragment:null,Part:"group",Sect:"group",Div:"group",Aside:"note",NonStruct:"none",P:null,H:"heading",Title:null,FENote:"note",Sub:"group",Lbl:null,Span:null,Em:null,Strong:null,Link:"link",Annot:"note",Form:"form",Ruby:null,RB:null,RT:null,RP:null,Warichu:null,WT:null,WP:null,L:"list",LI:"listitem",LBody:null,Table:"table",TR:"row",TH:"columnheader",TD:"cell",THead:"columnheader",TBody:null,TFoot:null,Caption:null,Figure:"figure",Formula:null,Artifact:null},oh=/^H(\d+)$/;function lh(o){return o in Xr}function Ys(o){return"children"in o}function Yr(o){return Ys(o)?o.children.length===1&&0 in o.children&&"id"in o.children[0]:!1}function ch(o){const t={};if(Ys(o)){const{role:e}=o,s=e.match(oh);if(s)t.role="heading",t["aria-level"]=Number(s[1]);else if(lh(e)){const i=Xr[e];i&&(t.role=i)}}return t}function Kr(o){const t={};if(Ys(o)){if(o.alt!==void 0&&(t["aria-label"]=o.alt),o.lang!==void 0&&(t.lang=o.lang),Yr(o)){const[e]=o.children;if(e){const s=Kr(e);return{...t,...s}}}}else"id"in o&&(t["aria-owns"]=o.id);return t}function hh(o){return o?{...ch(o),...Kr(o)}:null}function Qr({className:o,node:t}){const e=C.useMemo(()=>hh(t),[t]),s=C.useMemo(()=>!Ys(t)||Yr(t)?null:t.children.map((i,n)=>p.jsx(Qr,{node:i},n)),[t]);return p.jsx("span",{className:o,...e,children:s})}function dh(){const o=Xs();Q(o);const{onGetStructTreeError:t,onGetStructTreeSuccess:e}=o,[s,i]=Be(),{value:n,error:r}=s,{customTextRenderer:a,page:l}=o;function c(){n&&e&&e(n)}function h(){r&&(At(!1,r.toString()),t&&t(r))}return C.useEffect(function(){i({type:"RESET"})},[i,l]),C.useEffect(function(){if(a||!l)return;const u=gs(l.getStructTree()),f=u;return u.promise.then(m=>{i({type:"RESOLVE",value:m})}).catch(m=>{i({type:"REJECT",error:m})}),()=>we(f)},[a,l,i]),C.useEffect(()=>{if(n!==void 0){if(n===!1){h();return}c()}},[n]),n?p.jsx(Qr,{className:"react-pdf__Page__structTree structTree",node:n}):null}const On=Qt;function uh(o){const t=Xs();Q(t);const e={...t,...o},{_className:s,canvasBackground:i,devicePixelRatio:n=Zc(),onRenderError:r,onRenderSuccess:a,page:l,renderForms:c,renderTextLayer:h,rotate:d,scale:u}=e,{canvasRef:f}=o;Q(l);const m=C.useRef(null);function g(){l&&a&&a(Si(l,u))}function y(A){eh(A)||(At(!1,A.toString()),r&&r(A))}const b=C.useMemo(()=>l.getViewport({scale:u*n,rotation:d}),[n,l,d,u]),x=C.useMemo(()=>l.getViewport({scale:u,rotation:d}),[l,d,u]);C.useEffect(function(){if(!l)return;l.cleanup();const{current:v}=m;if(!v)return;v.width=b.width,v.height=b.height,v.style.width=`${Math.floor(x.width)}px`,v.style.height=`${Math.floor(x.height)}px`,v.style.visibility="hidden";const k={annotationMode:c?On.ENABLE_FORMS:On.ENABLE,canvas:v,canvasContext:v.getContext("2d",{alpha:!1}),viewport:b};i&&(k.background=i);const S=l.render(k),_=S;return S.promise.then(()=>{v.style.visibility="",g()}).catch(y),()=>we(_)},[i,l,c,b,x]);const w=C.useCallback(()=>{const{current:A}=m;A&&(A.width=0,A.height=0)},[]);return C.useEffect(()=>w,[w]),p.jsx("canvas",{className:`${s}__canvas`,dir:"ltr",ref:Wr(f,m),style:{display:"block",userSelect:"none"},children:h?p.jsx(dh,{}):null})}function ph(o){return"str"in o}function fh(){const o=Xs();Q(o);const{customTextRenderer:t,onGetTextError:e,onGetTextSuccess:s,onRenderTextLayerError:i,onRenderTextLayerSuccess:n,page:r,pageIndex:a,pageNumber:l,rotate:c,scale:h}=o;Q(r);const[d,u]=Be(),{value:f,error:m}=d,g=C.useRef(null);At(Number.parseInt(window.getComputedStyle(document.body).getPropertyValue("--react-pdf-text-layer"),10)===1,"TextLayer styles not found. Read more: https://github.com/wojtekmaj/react-pdf#support-for-text-layer");function y(){f&&s&&s(f)}function b(){m&&(At(!1,m.toString()),e&&e(m))}C.useEffect(function(){u({type:"RESET"})},[r,u]),C.useEffect(function(){if(!r)return;const _=gs(r.getTextContent()),E=_;return _.promise.then(T=>{u({type:"RESOLVE",value:T})}).catch(T=>{u({type:"REJECT",error:T})}),()=>we(E)},[r,u]),C.useEffect(()=>{if(f!==void 0){if(f===!1){b();return}y()}},[f]);const x=C.useCallback(()=>{n&&n()},[n]),w=C.useCallback(S=>{At(!1,S.toString()),i&&i(S)},[i]);function A(){const S=g.current;S&&S.classList.add("selecting")}function v(){const S=g.current;S&&S.classList.remove("selecting")}const k=C.useMemo(()=>r.getViewport({scale:h,rotation:c}),[r,c,h]);return C.useLayoutEffect(function(){if(!r||!f)return;const{current:_}=g;if(!_)return;_.innerHTML="";const E=r.streamTextContent({includeMarkedContent:!0}),T={container:_,textContentSource:E,viewport:k},L=new is(T),G=L;return L.render().then(()=>{const H=document.createElement("div");H.className="endOfContent",_.append(H);const O=_.querySelectorAll('[role="presentation"]');if(t){let $=0;f.items.forEach((M,R)=>{if(!ph(M))return;const U=O[$];if(!U)return;const nt=t({pageIndex:a,pageNumber:l,itemIndex:R,...M});U.innerHTML=nt,$+=M.str&&M.hasEOL?2:1})}x()}).catch(w),()=>we(G)},[t,w,x,r,a,l,f,k]),p.jsx("div",{className:Ws("react-pdf__Page__textContent","textLayer"),onMouseUp:v,onMouseDown:A,ref:g})}const jn=1;function Bn(o){const e={...Vr(),...o},{_className:s="react-pdf__Page",_enableRegisterUnregisterPage:i=!0,canvasBackground:n,canvasRef:r,children:a,className:l,customRenderer:c,customTextRenderer:h,devicePixelRatio:d,error:u="Failed to load the page.",height:f,inputRef:m,loading:g="Loading page",noData:y="No page specified.",onGetAnnotationsError:b,onGetAnnotationsSuccess:x,onGetStructTreeError:w,onGetStructTreeSuccess:A,onGetTextError:v,onGetTextSuccess:k,onLoadError:S,onLoadSuccess:_,onRenderAnnotationLayerError:E,onRenderAnnotationLayerSuccess:T,onRenderError:L,onRenderSuccess:G,onRenderTextLayerError:H,onRenderTextLayerSuccess:O,pageIndex:$,pageNumber:M,pdf:R,registerPage:U,renderAnnotationLayer:nt=!0,renderForms:kt=!1,renderMode:Ot="canvas",renderTextLayer:tt=!0,rotate:X,scale:St=jn,unregisterPage:Lt,width:_t,...Z}=e,[Gt,Et]=Be(),{value:rt,error:Jt}=Gt,Zt=C.useRef(null);Q(R);const q=he(M)?M-1:$??null,et=M??(he($)?$+1:null),pt=X??(rt?rt.rotate:null),ft=C.useMemo(()=>{if(!rt)return null;let re=1;const ke=St??jn;if(_t||f){const ae=rt.getViewport({scale:1,rotation:pt});_t?re=_t/ae.width:f&&(re=f/ae.height)}return ke*re},[f,rt,pt,St,_t]);C.useEffect(function(){return()=>{he(q)&&i&&Lt&&Lt(q)}},[i,R,q,Lt]);function Ae(){if(_){if(!rt||!ft)return;_(Si(rt,ft))}if(i&&U){if(!he(q)||!Zt.current)return;U(q,Zt.current)}}function ze(){Jt&&(At(!1,Jt.toString()),S&&S(Jt))}C.useEffect(function(){Et({type:"RESET"})},[Et,R,q]),C.useEffect(function(){if(!R||!et)return;const ke=gs(R.getPage(et)),ae=ke;return ke.promise.then(Qs=>{Et({type:"RESOLVE",value:Qs})}).catch(Qs=>{Et({type:"REJECT",error:Qs})}),()=>we(ae)},[Et,R,et]),C.useEffect(()=>{if(rt!==void 0){if(rt===!1){ze();return}Ae()}},[rt,ft]);const Ks=C.useMemo(()=>he(q)&&et&&he(pt)&&he(ft)?{_className:s,canvasBackground:n,customTextRenderer:h,devicePixelRatio:d,onGetAnnotationsError:b,onGetAnnotationsSuccess:x,onGetStructTreeError:w,onGetStructTreeSuccess:A,onGetTextError:v,onGetTextSuccess:k,onRenderAnnotationLayerError:E,onRenderAnnotationLayerSuccess:T,onRenderError:L,onRenderSuccess:G,onRenderTextLayerError:H,onRenderTextLayerSuccess:O,page:rt,pageIndex:q,pageNumber:et,renderForms:kt,renderTextLayer:tt,rotate:pt,scale:ft}:null,[s,n,h,d,b,x,w,A,v,k,E,T,L,G,H,O,rt,q,et,kt,tt,pt,ft]),aa=C.useMemo(()=>Ur(Z,()=>rt&&(ft?Si(rt,ft):void 0)),[Z,rt,ft]),bs=`${q}@${ft}/${pt}`;function oa(){switch(Ot){case"custom":return Q(c),p.jsx(c,{},`${bs}_custom`);case"none":return null;case"canvas":default:return p.jsx(uh,{canvasRef:r},`${bs}_canvas`)}}function la(){return tt?p.jsx(fh,{},`${bs}_text`):null}function ca(){return nt?p.jsx(ah,{},`${bs}_annotations`):null}function ha(){function re(ae){return!!ae?.page}if(!re(Ks))throw new Error("page is undefined");const ke=typeof a=="function"?a(Ks):a;return p.jsxs(qr.Provider,{value:Ks,children:[oa(),la(),ca(),ke]})}function da(){return et?R===null||rt===void 0||rt===null?p.jsx(Ie,{type:"loading",children:typeof g=="function"?g():g}):R===!1||rt===!1?p.jsx(Ie,{type:"error",children:typeof u=="function"?u():u}):ha():p.jsx(Ie,{type:"no-data",children:typeof y=="function"?y():y})}return p.jsx("div",{className:Ws(s,l),"data-page-number":et,ref:Wr(m,Zt),style:{"--scale-round-x":"1px","--scale-round-y":"1px","--scale-factor":"1","--user-unit":`${ft}`,"--total-scale-factor":"calc(var(--scale-factor) * var(--user-unit))",backgroundColor:n||"white",position:"relative",minWidth:"min-content",minHeight:"min-content"},...aa,children:da()})}th();le.workerSrc="pdf.worker.mjs";le.workerSrc=`https://unpkg.com/pdfjs-dist@${ns}/build/pdf.worker.min.mjs`;function gh({pdfPath:o}){const[t,e]=C.useState(null),[s,i]=C.useState(1),[n,r]=C.useState(1),[a,l]=C.useState(null),[c,h]=C.useState(600),[d,u]=C.useState(1),f=C.useMemo(()=>({cMapUrl:`https://unpkg.com/pdfjs-dist@${ns}/cmaps/`,cMapPacked:!0,standardFontDataUrl:`https://unpkg.com/pdfjs-dist@${ns}/standard_fonts/`}),[]),m=({numPages:v})=>{e(v),l(null)},g=v=>{console.error("Error loading PDF:",v),l("Failed to load PDF preview. Please try downloading it instead.")},y=()=>u(v=>Math.min(v+.25,2.5)),b=()=>u(v=>Math.max(v-.25,.5)),x=()=>u(1);C.useEffect(()=>{const v=()=>h(Math.min(600,window.innerWidth*.9));return v(),window.addEventListener("resize",v),()=>window.removeEventListener("resize",v)},[]);const w=v=>{v!==s&&i(v)},A=s!==n;return p.jsxs("div",{className:"w-full max-w-3xl mx-auto bg-white dark:bg-gray-800 rounded-lg shadow-sm overflow-hidden  border border-gray-200 dark:border-gray-700",children:[p.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700 flex flex-wrap justify-between items-center gap-2",children:[p.jsx("div",{className:"flex items-center space-x-2",children:t&&p.jsxs("span",{className:"text-xs font-medium text-gray-700 dark:text-gray-300",children:["Page ",s," of ",t]})}),p.jsxs("div",{className:"flex items-center space-x-2",children:[p.jsxs("div",{className:"flex items-center border border-gray-300 dark:border-gray-600 rounded-md divide-x divide-gray-300 dark:divide-gray-600",children:[p.jsx("button",{onClick:b,disabled:d<=.5,className:"px-2 py-1 text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600 disabled:opacity-50",title:"Zoom Out",children:p.jsx("svg",{className:"w-4 h-4 text-gray-700 dark:text-gray-200",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 12H4"})})}),p.jsxs("button",{onClick:x,className:"px-2 py-1 text-xs text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600",title:"Reset Zoom",children:[Math.round(d*100),"%"]}),p.jsx("button",{onClick:y,disabled:d>=2.5,className:"px-2 py-1 text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600 disabled:opacity-50",title:"Zoom In",children:p.jsx("svg",{className:"w-4 h-4 text-gray-700 dark:text-gray-200",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})})]}),p.jsx("a",{href:o,download:!0,className:"px-3 py-1.5 text-xs font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 transition-colors whitespace-nowrap",children:"Download PDF"})]})]}),p.jsx("div",{className:"overflow-auto h-[70vh] p-3 relative min-h-[500px]",children:a?p.jsxs("div",{className:"text-center p-6",children:[p.jsx("p",{className:"text-red-500 text-sm mb-3",children:a}),p.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-3",children:["Tried to load: ",o]}),p.jsx("a",{href:o,className:"text-blue-600 dark:text-blue-400 hover:underline text-sm",target:"_blank",rel:"noopener noreferrer",children:"Open PDF in new tab"})]}):p.jsx(rh,{file:o,onLoadSuccess:m,onLoadError:g,options:f,loading:p.jsx("div",{className:"flex justify-center items-center h-48",children:p.jsx("div",{className:"animate-pulse text-gray-500 text-sm",children:"Loading PDF..."})}),children:p.jsxs("div",{className:"relative flex justify-center",children:[p.jsx(Bn,{pageNumber:n,width:c*d,renderTextLayer:!0,renderAnnotationLayer:!0}),A&&p.jsxs("div",{className:"absolute inset-0 flex justify-center items-center z-10 bg-white/70 dark:bg-gray-800/70",children:[p.jsx(Bn,{pageNumber:s,width:c*d,renderTextLayer:!0,renderAnnotationLayer:!0,onLoadSuccess:()=>r(s)}),p.jsxs("div",{className:"absolute animate-pulse text-gray-500 text-sm",children:["Loading page ",s,"..."]})]})]})})}),t>1&&p.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 flex justify-between items-center",children:[p.jsx("button",{onClick:()=>w(Math.max(s-1,1)),disabled:s<=1||A,className:"px-3 py-1.5 text-xs font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Previous"}),p.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-300",children:[s," / ",t]}),p.jsx("button",{onClick:()=>w(Math.min(s+1,t)),disabled:s>=t||A,className:"px-3 py-1.5 text-xs font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Next"})]})]})}const mh={hidden:{opacity:0},show:{opacity:1,transition:{when:"beforeChildren",staggerChildren:.08,delayChildren:.1}}},bh={hidden:{opacity:0,x:-20,scale:.95},show:{opacity:1,x:0,scale:1,transition:{type:"spring",stiffness:100,damping:15}},exit:{opacity:0,scale:.9,transition:{duration:.15}}},yh={hidden:{opacity:0,scale:.8},show:{opacity:1,scale:1,transition:{type:"spring",stiffness:200,damping:20}}},Hn={hidden:{opacity:0,x:20},show:{opacity:1,x:0,transition:{type:"spring",stiffness:100,damping:15}},exit:{opacity:0,x:20,transition:{duration:.2}}},wh=()=>{const[o,t]=C.useState(null),[e,s]=C.useState(null),[i,n]=C.useState("All"),r=C.useRef(null),a=["All",...new Set(ei.map(d=>d.category))],l=i==="All"?ei:ei.filter(d=>d.category===i),c=d=>{t(d),document.getElementById("pdf-viewer")?.scrollIntoView({behavior:"smooth"})},h=d=>{n(d)};return p.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-white to-gray-50 dark:from-gray-950 dark:via-gray-900 dark:to-gray-950",children:p.jsxs(P.div,{className:"container max-w-7xl mt-10 mx-auto px-4 sm:px-6 py-16 sm:py-20",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},ref:r,children:[p.jsxs("div",{className:"space-y-3 sm:space-y-4 mb-8",children:[p.jsx(P.h1,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.2,ease:[.25,.46,.45,.94]},className:"text-2xl sm:text-3xl font-bold tracking-tight text-center",children:p.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-purple-600 via-blue-600 to-emerald-600 dark:from-purple-400 dark:via-blue-400 dark:to-emerald-400",children:"RESOURCES"})}),p.jsx(P.div,{className:"space-y-2 text-center",initial:{opacity:0,y:15},animate:{opacity:1,y:0},transition:{duration:.6,delay:.3,ease:[.25,.46,.45,.94]},children:p.jsx("h2",{className:"text-base sm:text-lg font-light text-gray-600 dark:text-gray-400 max-w-3xl mx-auto",children:"A collection of valuable assets and knowledge resources"})})]}),p.jsx(P.div,{className:"flex flex-wrap justify-center gap-2 mb-6",variants:mh,initial:"hidden",animate:"show",children:a.map(d=>p.jsx(P.button,{variants:yh,onClick:()=>h(d),whileHover:{scale:1.05},whileTap:{scale:.95},className:`px-3 py-1.5 rounded-full text-xs font-medium transition-colors ${i===d?"bg-gradient-to-r from-blue-600 to-cyan-500 text-white shadow-md shadow-blue-500/10":"bg-white dark:bg-gray-800/50 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700/50 border border-gray-200 dark:border-gray-700/50"}`,children:d},d))}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[p.jsx(P.div,{className:"md:col-span-1",children:p.jsxs(P.div,{className:"space-y-3 max-h-[84vh] mx-2 pl-2 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 dark:scrollbar-thumb-gray-700 scrollbar-track-transparent",layout:!0,children:[p.jsx(se,{mode:"popLayout",children:l.map(d=>p.jsxs(P.div,{variants:bh,initial:"hidden",animate:"show",exit:"exit",layout:!0,layoutId:`resource-${d.id}`,onClick:()=>c(d.pdfPath),onHoverStart:()=>s(d.id),onHoverEnd:()=>s(null),whileHover:{y:-2,boxShadow:"0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)",transition:{type:"spring",stiffness:400,damping:10}},whileTap:{scale:.98},className:`relative p-4 rounded-xl cursor-pointer transition-colors ${o===d.pdfPath?"bg-blue-50 dark:bg-blue-900/30 border-l-4 border-blue-500":"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700"}`,children:[p.jsx("h3",{className:"font-medium text-gray-900 dark:text-white text-sm pr-6",children:d.title}),p.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-300 mt-1 line-clamp-2",children:d.description}),p.jsxs("div",{className:"flex justify-between items-center mt-3",children:[p.jsx("span",{className:"text-xs px-2.5 py-1 bg-blue-100 dark:bg-blue-900/50 text-blue-800 dark:text-blue-100 rounded-full",children:d.category}),p.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:new Date(d.date).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})})]}),p.jsx(P.div,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-blue-500",initial:{opacity:0,x:-5},animate:{opacity:o===d.pdfPath?1:0,x:o===d.pdfPath?0:-5},transition:{type:"spring",stiffness:300,damping:20},children:p.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:p.jsx("path",{fillRule:"evenodd",d:"M16.707 10.293a1 1 0 010 1.414l-6 6a1 1 0 01-1.414 0l-6-6a1 1 0 111.414-1.414L9 14.586V3a1 1 0 012 0v11.586l4.293-4.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]},d.id))}),l.length===0&&p.jsx(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center py-12",children:p.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No resources found in this category"})})]})}),p.jsx(P.div,{id:"pdf-viewer",className:"md:col-span-2 max-w-4xl mx-auto w-full",layout:!0,children:p.jsx(se,{mode:"wait",children:o?p.jsx(P.div,{variants:Hn,initial:"hidden",animate:"show",exit:"exit",className:"w-[95%] mx-auto",children:p.jsx(gh,{pdfPath:o})},"pdf-content"):p.jsxs(P.div,{variants:Hn,initial:"hidden",animate:"show",exit:"exit",className:"flex flex-col items-center justify-center h-96 text-gray-500 dark:text-gray-400 bg-white dark:bg-gray-800 rounded-xl shadow-sm w-full max-w-2xl mx-auto border-2 border-dashed border-gray-200 dark:border-gray-700",children:[p.jsx(P.div,{className:"w-20 h-20 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center mb-4",animate:{scale:[1,1.05,1],rotate:[0,5,-5,0]},transition:{duration:3,repeat:1/0,repeatType:"reverse"},children:p.jsx("svg",{className:"w-10 h-10 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),p.jsx(P.h3,{className:"text-xl font-medium text-gray-700 dark:text-gray-300 mb-2",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2},children:"No Resource Selected"}),p.jsx(P.p,{className:"text-gray-500 dark:text-gray-400 text-center max-w-md px-4",initial:{opacity:0,y:10},animate:{opacity:.8,y:0},transition:{delay:.3},children:"Select a resource from the list to view its contents"})]},"empty-state")})})]})]})})},xd=Object.freeze(Object.defineProperty({__proto__:null,default:wh},Symbol.toStringTag,{value:"Module"}));class ms{constructor(t=0,e="Network Error"){this.status=t,this.text=e}}const xh=()=>{if(!(typeof localStorage>"u"))return{get:o=>Promise.resolve(localStorage.getItem(o)),set:(o,t)=>Promise.resolve(localStorage.setItem(o,t)),remove:o=>Promise.resolve(localStorage.removeItem(o))}},xt={origin:"https://api.emailjs.com",blockHeadless:!1,storageProvider:xh()},Xi=o=>o?typeof o=="string"?{publicKey:o}:o.toString()==="[object Object]"?o:{}:{},vh=(o,t="https://api.emailjs.com")=>{if(!o)return;const e=Xi(o);xt.publicKey=e.publicKey,xt.blockHeadless=e.blockHeadless,xt.storageProvider=e.storageProvider,xt.blockList=e.blockList,xt.limitRate=e.limitRate,xt.origin=e.origin||t},Jr=async(o,t,e={})=>{const s=await fetch(xt.origin+o,{method:"POST",headers:e,body:t}),i=await s.text(),n=new ms(s.status,i);if(s.ok)return n;throw n},Zr=(o,t,e)=>{if(!o||typeof o!="string")throw"The public key is required. Visit https://dashboard.emailjs.com/admin/account";if(!t||typeof t!="string")throw"The service ID is required. Visit https://dashboard.emailjs.com/admin";if(!e||typeof e!="string")throw"The template ID is required. Visit https://dashboard.emailjs.com/admin/templates"},Ah=o=>{if(o&&o.toString()!=="[object Object]")throw"The template params have to be the object. Visit https://www.emailjs.com/docs/sdk/send/"},ta=o=>o.webdriver||!o.languages||o.languages.length===0,ea=()=>new ms(451,"Unavailable For Headless Browser"),kh=(o,t)=>{if(!Array.isArray(o))throw"The BlockList list has to be an array";if(typeof t!="string")throw"The BlockList watchVariable has to be a string"},Sh=o=>!o.list?.length||!o.watchVariable,_h=(o,t)=>o instanceof FormData?o.get(t):o[t],sa=(o,t)=>{if(Sh(o))return!1;kh(o.list,o.watchVariable);const e=_h(t,o.watchVariable);return typeof e!="string"?!1:o.list.includes(e)},ia=()=>new ms(403,"Forbidden"),Eh=(o,t)=>{if(typeof o!="number"||o<0)throw"The LimitRate throttle has to be a positive number";if(t&&typeof t!="string")throw"The LimitRate ID has to be a non-empty string"},Ch=async(o,t,e)=>{const s=Number(await e.get(o)||0);return t-Date.now()+s},na=async(o,t,e)=>{if(!t.throttle||!e)return!1;Eh(t.throttle,t.id);const s=t.id||o;return await Ch(s,t.throttle,e)>0?!0:(await e.set(s,Date.now().toString()),!1)},ra=()=>new ms(429,"Too Many Requests"),Th=async(o,t,e,s)=>{const i=Xi(s),n=i.publicKey||xt.publicKey,r=i.blockHeadless||xt.blockHeadless,a=i.storageProvider||xt.storageProvider,l={...xt.blockList,...i.blockList},c={...xt.limitRate,...i.limitRate};return r&&ta(navigator)?Promise.reject(ea()):(Zr(n,o,t),Ah(e),e&&sa(l,e)?Promise.reject(ia()):await na(location.pathname,c,a)?Promise.reject(ra()):Jr("/api/v1.0/email/send",JSON.stringify({lib_version:"4.4.1",user_id:n,service_id:o,template_id:t,template_params:e}),{"Content-type":"application/json"}))},Lh=o=>{if(!o||o.nodeName!=="FORM")throw"The 3rd parameter is expected to be the HTML form element or the style selector of the form"},Ph=o=>typeof o=="string"?document.querySelector(o):o,Mh=async(o,t,e,s)=>{const i=Xi(s),n=i.publicKey||xt.publicKey,r=i.blockHeadless||xt.blockHeadless,a=xt.storageProvider||i.storageProvider,l={...xt.blockList,...i.blockList},c={...xt.limitRate,...i.limitRate};if(r&&ta(navigator))return Promise.reject(ea());const h=Ph(e);Zr(n,o,t),Lh(h);const d=new FormData(h);return sa(l,d)?Promise.reject(ia()):await na(location.pathname,c,a)?Promise.reject(ra()):(d.append("lib_version","4.4.1"),d.append("service_id",o),d.append("template_id",t),d.append("user_id",n),Jr("/api/v1.0/email/send-form",d))},Rh={init:vh,send:Th,sendForm:Mh,EmailJSResponseStatus:ms},Nh=["badword1","badword2"],Un={MAX_REQUESTS:3,WINDOW_MS:600*1e3},zn=2,Gn=20,$n=500,Dh={hidden:{opacity:0},visible:{opacity:1,transition:{duration:.4,ease:"easeOut"}}},_e={hidden:{opacity:0,y:25},visible:(o=0)=>({opacity:1,y:0,transition:{delay:o*.15,type:"spring",stiffness:80,damping:14}})},di=()=>{const o=Math.floor(Math.random()*10)+1,t=Math.floor(Math.random()*5)+1;return{question:`What is ${o} + ${t}?`,answer:o+t}},Vn=o=>o.trim().split(/\s+/).filter(t=>t.length>0).length;function Ih(){const[o,t]=C.useState({name:"",email:"",subject:"",message:"",website:"",botCheck:""}),[e,s]=C.useState(!1),[i,n]=C.useState({success:null,message:""}),[r,a]=C.useState(di()),[l,c]=C.useState(0),h=C.useRef(null),[d,u]=C.useState(()=>{const w=localStorage.getItem("contactFormTimestamps");return w?JSON.parse(w):[]});C.useEffect(()=>{localStorage.setItem("contactFormTimestamps",JSON.stringify(d))},[d]),C.useEffect(()=>()=>{h.current&&clearTimeout(h.current)},[]);const f=w=>w?String(w).replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"):"",m=w=>{const A=w.toLowerCase();return Nh.some(v=>A.includes(v))},g=()=>{const w=Date.now();return d.filter(v=>w-v<Un.WINDOW_MS).length>=Un.MAX_REQUESTS},y=w=>{const{name:A,value:v}=w.target;t(k=>({...k,[A]:f(v)}))},b=w=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(String(w).toLowerCase()),x=async w=>{w.preventDefault();const A=Date.now();if(A-l<5e3){n({success:!1,message:"Please wait a moment before sending another message."});return}if(o.website){console.log("Bot detected (honeypot)");return}if(parseInt(o.botCheck,10)!==r.answer){n({success:!1,message:"Please answer the math question correctly."}),a(di());return}if(!o.name||!o.email||!o.message){n({success:!1,message:"Please fill in all required fields."});return}if(!b(o.email)){n({success:!1,message:"Please enter a valid email address."});return}const v=o.message.split(/\n/).filter(S=>S.trim().length>0),k=Vn(o.message);if(v.length<zn){n({success:!1,message:`Your message must contain at least ${zn} paragraphs (use a blank line to separate).`});return}if(k<Gn){n({success:!1,message:`Message too short  please write at least ${Gn} words (you have ${k}).`});return}if(k>$n){n({success:!1,message:`Message too long  keep it under ${$n} words.`});return}if(g()){n({success:!1,message:"Too many requests. Try again later."});return}if(m(o.name)||m(o.message)||m(o.subject)){n({success:!1,message:"Your message contains inappropriate language."});return}s(!0),n({success:null,message:""}),c(A),u(S=>[...S,A]);try{const{website:S,botCheck:_,...E}=o;await Rh.send("service_73sgf1a","template_nqfno4q",E,"H-ggagzVwQ5xyXv-z"),n({success:!0,message:"Your message has been sent! I'll reply soon."}),t({name:"",email:"",subject:"",message:"",website:"",botCheck:""}),a(di())}catch(S){console.error(S),n({success:!1,message:"Failed to send. Try again later or email me directly."})}finally{s(!1),i.success&&(h.current=setTimeout(()=>{n({success:null,message:""})},5e3))}};return p.jsx(P.div,{className:"min-h-screen mt-10 bg-gradient-to-br from-gray-50 via-white to-gray-50 dark:from-gray-950 dark:via-gray-900 dark:to-gray-950 flex items-center justify-center",variants:Dh,initial:"hidden",animate:"visible",children:p.jsxs("div",{className:"flex flex-col items-center justify-center w-full px-4 sm:px-6 lg:px-8 py-8",children:[p.jsxs("div",{className:"w-full max-w-4xl mt-10 text-center mb-12",children:[p.jsx(P.h1,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.2,ease:[.25,.46,.45,.94]},className:"text-2xl sm:text-3xl font-bold tracking-tight",children:p.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-purple-600 via-blue-600 to-emerald-600 dark:from-purple-400 dark:via-blue-400 dark:to-emerald-400",children:"GET IN TOUCH"})}),p.jsxs(P.div,{initial:{opacity:0,y:15},animate:{opacity:1,y:0},transition:{duration:.6,delay:.3,ease:[.25,.46,.45,.94]},className:"space-y-2",children:[p.jsx("p",{className:"text-base sm:text-lg font-light text-gray-600 dark:text-gray-400",children:"Have a project in mind or want to discuss potential opportunities?"}),p.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"I'll get back to you as soon as possible."})]})]}),p.jsxs(P.div,{initial:"hidden",animate:"visible",variants:{visible:{opacity:1,y:0,transition:{duration:.5}},hidden:{opacity:0,y:20}},className:"w-full max-w-3xl bg-white dark:bg-gray-800 rounded-2xl p-6 sm:p-8 shadow-lg dark:shadow-gray-800/10",children:[i.message&&p.jsx(P.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{type:"spring",stiffness:80,damping:12},className:`mb-4 p-3 rounded-lg text-sm ${i.success?"bg-green-50 dark:bg-green-900/30 text-green-700 dark:text-green-200":"bg-red-50 dark:bg-red-900/30 text-red-700 dark:text-red-200"}`,children:i.message}),p.jsxs("form",{onSubmit:x,className:"space-y-4 relative",children:[p.jsxs("div",{style:{position:"absolute",left:"-5000px"},"aria-hidden":"true",children:[p.jsx("label",{htmlFor:"website",children:"Leave blank if human"}),p.jsx("input",{type:"text",id:"website",name:"website",tabIndex:"-1",value:o.website,onChange:y})]}),p.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[p.jsxs(P.div,{variants:_e,custom:0,whileHover:{scale:1.02},children:[p.jsxs("label",{htmlFor:"name",className:"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1",children:["Name ",p.jsx("span",{className:"text-red-500",children:"*"})]}),p.jsx("input",{type:"text",id:"name",name:"name",required:!0,value:o.name,onChange:y,placeholder:"John Doe",className:"block w-full px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-600 focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white/50 dark:bg-gray-800/80 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-500 transition-all duration-200"})]}),p.jsxs(P.div,{variants:_e,custom:1,whileHover:{scale:1.02},children:[p.jsxs("label",{htmlFor:"email",className:"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1",children:["Email ",p.jsx("span",{className:"text-red-500",children:"*"})]}),p.jsx("input",{type:"email",id:"email",name:"email",required:!0,value:o.email,onChange:y,placeholder:"you@example.com",className:"block w-full px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-600 focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white/50 dark:bg-gray-800/80 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-500 transition-all duration-200"})]}),p.jsxs(P.div,{variants:_e,custom:2,className:"sm:col-span-2",children:[p.jsx("label",{htmlFor:"subject",className:"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1",children:"Subject"}),p.jsx("input",{type:"text",id:"subject",name:"subject",value:o.subject,onChange:y,placeholder:"How can I help?",className:"block w-full px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-600 focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white/50 dark:bg-gray-800/80 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-500 transition-all duration-200"})]}),p.jsxs(P.div,{variants:_e,custom:3,className:"sm:col-span-2",children:[p.jsxs("label",{htmlFor:"message",className:"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1",children:["Message ",p.jsx("span",{className:"text-red-500",children:"*"})]}),p.jsx("textarea",{id:"message",name:"message",rows:5,required:!0,value:o.message,onChange:y,placeholder:"Write your message...",className:"block w-full px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-600 focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white/50 dark:bg-gray-800/80 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-500 transition-all duration-200 resize-none"}),p.jsxs("div",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:[Vn(o.message)," words "," ",o.message.split(/\n/).filter(w=>w.trim()).length," ","paragraph(s)"]})]}),p.jsxs(P.div,{variants:_e,custom:4,className:"sm:col-span-2 space-y-2",children:[p.jsxs("label",{htmlFor:"botCheck",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[r.question," ",p.jsx("span",{className:"text-red-500",children:"*"})]}),p.jsx("input",{type:"number",id:"botCheck",name:"botCheck",required:!0,value:o.botCheck,onChange:y,placeholder:"Answer",className:"block w-full px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-600 focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white/50 dark:bg-gray-800/80 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-500 transition-all duration-200"}),p.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 flex items-center gap-1",children:[p.jsx(za,{className:"w-3 h-3"}),"Spam protection"]})]})]}),p.jsx(P.div,{variants:_e,custom:5,className:"pt-2",children:p.jsx(P.button,{type:"submit",disabled:e,whileHover:e?{}:{scale:1.02},whileTap:e?{}:{scale:.98},className:`relative w-full flex items-center justify-center px-5 py-2.5 rounded-xl text-sm font-medium text-white bg-gradient-to-r from-blue-600 to-cyan-500 hover:from-blue-700 hover:to-cyan-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all duration-200 shadow-sm hover:shadow-md ${e?"opacity-85 cursor-not-allowed":""}`,children:e?p.jsxs(p.Fragment,{children:[p.jsx(ja,{className:"animate-spin -ml-1 mr-2 h-4 w-4"}),"Sending"]}):p.jsxs(p.Fragment,{children:["Send Message",p.jsx(_i,{className:"ml-2 h-4 w-4"})]})})})]})]})]})})}const vd=Object.freeze(Object.defineProperty({__proto__:null,default:Ih},Symbol.toStringTag,{value:"Module"}));export{vd as $,Bh as A,qn as B,qh as C,Yn as D,Zh as E,lo as F,ct as G,er as H,ad as I,fo as J,od as K,gd as L,Kh as M,po as N,cd as O,pd as P,dd as Q,ld as R,td as S,sd as T,hd as U,rd as V,ud as W,nd as X,tr as Y,Za as Z,xd as _,Yh as a,Xh as b,zh as c,Jh as d,Zn as e,ui as f,Ds as g,ys as h,Zs as i,fd as j,md as k,bd as l,yd as m,ed as n,Uh as o,Gh as p,Wh as q,id as r,$h as s,Vh as t,_i as u,Kn as v,Xn as w,Qh as x,Hh as y,Pa as z};
